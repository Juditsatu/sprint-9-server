(self.webpackChunksprint_9_pets_app=self.webpackChunksprint_9_pets_app||[]).push([[179],{6518:(Yn,Ut,he)=>{"use strict";he.d(Ut,{e:()=>xt});var _=he(529),Q=he(9646),ot=he(4004),c=he(262),ze=he(8505),Vt=he(2340),Ft=he(1571),st=he(9371);let xt=(()=>{class ut{constructor(lt,dn){this.http=lt,this.router=dn,this.baseUrl=Vt.N.baseUrl}get auth(){return{...this._user}}verifyAuth(){const lt=`${this.baseUrl}/auth/renew`,dn=(new _.WM).set("x-token",localStorage.getItem("token")||"");return localStorage.getItem("token")?this.http.get(lt,{headers:dn}).pipe((0,ot.U)(jt=>(localStorage.setItem("token",jt.token),this._user={name:jt.name,email:jt.email,uid:jt.uid},jt.ok)),(0,c.K)(jt=>(0,Q.of)(!1))):(0,Q.of)(!1)}register(lt,dn,jt){return this.http.post(`${this.baseUrl}/auth/new`,{name:lt,email:dn,password:jt}).pipe((0,ze.b)(xn=>{xn.ok&&(localStorage.setItem("token",xn.token),this._user={name:xn.name,email:xn.email,uid:xn.uid},localStorage.setItem("user",this._user.name))}),(0,ot.U)(xn=>xn.ok),(0,c.K)(xn=>(0,Q.of)(xn.error.msg)))}login(lt,dn){return this.http.post(`${this.baseUrl}/auth`,{email:lt,password:dn}).pipe((0,ze.b)(Gt=>{Gt.ok&&(localStorage.setItem("token",Gt.token),this._user={name:Gt.name,email:Gt.email,uid:Gt.uid},localStorage.setItem("user",this._user.name))}),(0,ot.U)(Gt=>Gt.ok),(0,c.K)(Gt=>(0,Q.of)(Gt.error.msg)))}validateToken(){const lt=`${this.baseUrl}/auth/renew`,dn=(new _.WM).set("x-token",localStorage.getItem("token")||"");return this.http.get(lt,{headers:dn}).pipe((0,ot.U)(jt=>(localStorage.setItem("token",jt.token),jt.ok)),(0,c.K)(jt=>(0,Q.of)(!1)))}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.router.navigateByUrl("/")}}return ut.\u0275fac=function(lt){return new(lt||ut)(Ft.LFG(_.eN),Ft.LFG(st.F0))},ut.\u0275prov=Ft.Yz7({token:ut,factory:ut.\u0275fac,providedIn:"root"}),ut})()},2340:(Yn,Ut,he)=>{"use strict";he.d(Ut,{N:()=>_});const _={production:!0,apiKey:"pk.eyJ1IjoianVkaXRzYXR1IiwiYSI6ImNsOGU5MHJlMTA4d2kzdnA5eGFsZDgxbG4ifQ.wMlLCh_YtV97MTyQE_QWQg",baseUrl:"https://pet-mimos.herokuapp.com//api"}},8012:(Yn,Ut,he)=>{"use strict";var _=he(1481),Q=he(1571),ot=he(529),c=he(9371),ze=he(8505),Vt=he(6518);let Ft=(()=>{class Qt{constructor(Rt,Kt){this.authService=Rt,this.router=Kt}canActivate(Rt,Kt){return this.authService.verifyAuth().pipe((0,ze.b)(it=>{it||this.router.navigate(["/"])}))}canLoad(Rt,Kt){return this.authService.verifyAuth().pipe((0,ze.b)(it=>{it||this.router.navigate(["/"])}))}}return Qt.\u0275fac=function(Rt){return new(Rt||Qt)(Q.LFG(Vt.e),Q.LFG(c.F0))},Qt.\u0275prov=Q.Yz7({token:Qt,factory:Qt.\u0275fac,providedIn:"root"}),Qt})();const st=[{path:"",loadChildren:()=>he.e(4).then(he.bind(he,5004)).then(Qt=>Qt.MimosModule)},{path:"member",loadChildren:()=>he.e(94).then(he.bind(he,2094)).then(Qt=>Qt.AuthModule)},{path:"",loadChildren:()=>he.e(650).then(he.bind(he,7650)).then(Qt=>Qt.ProtectedModule),canLoad:[Ft],canActivate:[Ft]},{path:"**",redirectTo:""}];let xt=(()=>{class Qt{}return Qt.\u0275fac=function(Rt){return new(Rt||Qt)},Qt.\u0275mod=Q.oAB({type:Qt}),Qt.\u0275inj=Q.cJS({imports:[c.Bz.forRoot(st),c.Bz]}),Qt})();var ut=he(9898),Et=he(2340),lt=he(6895),dn=he(9837);function jt(Qt,tn){if(1&Qt){const Rt=Q.EpF();Q.TgZ(0,"div",20)(1,"button",21),Q._uU(2,"Account"),Q.qZA(),Q.TgZ(3,"button",22),Q._uU(4,"Favorites"),Q.qZA(),Q.TgZ(5,"button",23),Q._uU(6,"Points"),Q.qZA(),Q._UZ(7,"hr"),Q.TgZ(8,"button",24),Q.NdJ("click",function(){Q.CHM(Rt);const it=Q.oxw(2);return Q.KtG(it.logout())}),Q._UZ(9,"i",25),Q._uU(10," LOG OUT"),Q.qZA()()}}function Xt(Qt,tn){if(1&Qt&&(Q.TgZ(0,"div",16)(1,"button",17),Q._UZ(2,"img",18),Q.qZA(),Q.YNc(3,jt,11,0,"div",19),Q.qZA()),2&Qt){const Rt=Q.oxw();Q.xp6(3),Q.Q6J("ngIf",Rt.isLogged)}}function Gt(Qt,tn){1&Qt&&(Q.TgZ(0,"ul",26)(1,"li",10)(2,"a",27),Q._uU(3," Log In "),Q.qZA()()())}function xn(Qt,tn){1&Qt&&(Q.TgZ(0,"li",10)(1,"a",28),Q._uU(2," Log In "),Q.qZA()())}function on(Qt,tn){1&Qt&&(Q.TgZ(0,"div")(1,"button",29),Q._uU(2,"Sign Up"),Q.qZA()())}function vn(Qt,tn){if(1&Qt){const Rt=Q.EpF();Q.TgZ(0,"div",30)(1,"button",31),Q._UZ(2,"img",18),Q.TgZ(3,"span",32),Q._uU(4),Q.qZA()(),Q.TgZ(5,"div",33)(6,"button",21),Q._uU(7,"Account"),Q.qZA(),Q.TgZ(8,"button",22),Q._uU(9,"Favorites"),Q.qZA(),Q.TgZ(10,"p",34)(11,"span",35),Q._uU(12,"12"),Q.qZA(),Q._uU(13," Service Time"),Q.qZA(),Q._UZ(14,"hr"),Q.TgZ(15,"button",24),Q.NdJ("click",function(){Q.CHM(Rt);const it=Q.oxw();return Q.KtG(it.logout())}),Q._UZ(16,"i",25),Q._uU(17," LOG OUT"),Q.qZA()()()}if(2&Qt){const Rt=Q.oxw();Q.xp6(4),Q.hij(" ",Rt.userName," ")}}let ki=(()=>{class Qt{constructor(Rt){this.authService=Rt,this.isCollapsed=!0,this.isLogged=!1,this.userName=""}ngOnInit(){this.userIsLogged()}userIsLogged(){localStorage.getItem("token")&&(this.isLogged=!0,this.userName=localStorage.getItem("user"))}logout(){this.isLogged=!1,this.authService.logout()}}return Qt.\u0275fac=function(Rt){return new(Rt||Qt)(Q.Y36(Vt.e))},Qt.\u0275cmp=Q.Xpm({type:Qt,selectors:[["app-navbar"]],decls:19,vars:6,consts:[["data-navbar-on-scroll","data-navbar-on-scroll",1,"navbar","navbar-expand-lg","navbar-light","py-3","backdrop","sticky-top","shadow-transition"],[1,"container-fluid"],["src","../../../assets/img/mimos-logo.svg","alt","Logo mimos","routerLink","/",1,"navbar-logo","d-flex","align-items-center"],[1,"d-flex","justify-content-end"],["ngbDropdown","","class","d-lg-none me-2",4,"ngIf"],["class","navbar-nav d-lg-none me-3",4,"ngIf"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler",3,"click"],[1,"navbar-toggler-icon"],[1,"collapse","navbar-collapse",3,"ngbCollapse"],[1,"navbar-nav","ms-auto","pt-2","pt-lg-0"],[1,"nav-item"],["routerLink","/search",1,"nav-link","fw-medium"],["routerLink","/about",1,"nav-link","fw-medium"],["class","nav-item",4,"ngIf"],[4,"ngIf"],["ngbDropdown","","class","d-none d-lg-inline",4,"ngIf"],["ngbDropdown","",1,"d-lg-none","me-2"],["type","button","id","dropdownBasic1","ngbDropdownToggle","",1,"btn","btn-outline-primary"],["src","../assets/img/gallery/user-card-1.png","alt","user-avatar","height","100","width","100","id","uploadedAvatar",1,"img-fluid"],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1",4,"ngIf"],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1"],["ngbDropdownItem","","routerLink","/account"],["ngbDropdownItem","","routerLink","/favorites"],["ngbDropdownItem","","routerLink","/"],["ngbDropdownItem","",3,"click"],[1,"bi","bi-power"],[1,"navbar-nav","d-lg-none","me-3"],["routerLink","/member/login",1,"nav-link","fw-medium"],["routerLink","/member/login",1,"nav-link","fw-medium","me-2"],["routerLink","/member/signup",1,"btn","btn-primary","rounded-pill","bg-gradient","order-0"],["ngbDropdown","",1,"d-none","d-lg-inline"],["type","button","ngbDropdownToggle","",1,"btn","btn-outline-primary","px-2"],[1,""],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1",1,"dropdown-menu-end"],["ngbDropdownItem",""],[1,"badge","bg-secondary","text-nowrap","text-primary"]],template:function(Rt,Kt){1&Rt&&(Q.TgZ(0,"nav",0)(1,"div",1),Q._UZ(2,"img",2),Q.TgZ(3,"div",3),Q.YNc(4,Xt,4,1,"div",4),Q.YNc(5,Gt,4,0,"ul",5),Q.TgZ(6,"button",6),Q.NdJ("click",function(){return Kt.isCollapsed=!Kt.isCollapsed}),Q._UZ(7,"span",7),Q.qZA()(),Q.TgZ(8,"div",8)(9,"ul",9)(10,"li",10)(11,"a",11),Q._uU(12," Search sitters "),Q.qZA()(),Q.TgZ(13,"li",10)(14,"a",12),Q._uU(15," About "),Q.qZA()(),Q.YNc(16,xn,3,0,"li",13),Q.qZA(),Q.YNc(17,on,3,0,"div",14),Q.YNc(18,vn,18,1,"div",15),Q.qZA()()()),2&Rt&&(Q.xp6(4),Q.Q6J("ngIf",Kt.isLogged),Q.xp6(1),Q.Q6J("ngIf",!Kt.isLogged),Q.xp6(3),Q.Q6J("ngbCollapse",Kt.isCollapsed),Q.xp6(8),Q.Q6J("ngIf",!Kt.isLogged),Q.xp6(1),Q.Q6J("ngIf",!Kt.isLogged),Q.xp6(1),Q.Q6J("ngIf",Kt.isLogged))},dependencies:[lt.O5,c.rH,c.yS,dn._D,dn.jt,dn.iD,dn.Vi,dn.TH,dn.M2],styles:[".navbar-logo[_ngcontent-%COMP%]{width:150px;cursor:pointer}.nav-link[_ngcontent-%COMP%]:hover, .nav-link[_ngcontent-%COMP%]:focus{text-decoration:none}@media (min-width: 992px){.navbar[_ngcontent-%COMP%]{max-height:76px}}.navbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding-right:1rem;padding-left:1rem}.navbar-toggler[_ngcontent-%COMP%]{padding:.25rem .75rem;font-size:1.2rem;line-height:1;background-color:transparent;color:transparent;border:1px solid transparent;border-radius:.313rem;transition:box-shadow .15s ease-in-out}.navbar-toggler-icon[_ngcontent-%COMP%]:hover{background-image:url(\"data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0, 128, 0, 0.8)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 8h24M4 16h24M4 24h24'/%3E%3C/svg%3E\")}.navbar-light[_ngcontent-%COMP%]   .navbar-toggler-icon[_ngcontent-%COMP%]{background-image:url(\"data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba%280, 0, 0, 0.95%29' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M0 6h30M0 14h30M0 22h30'/%3E%3C/svg%3E\")}.shadow-transition[_ngcontent-%COMP%]{box-shadow:0 25px 45px #4f566513;transition:box-shadow .4s ease}.navbar-toggler[_ngcontent-%COMP%]:focus{text-decoration:none;outline:0;box-shadow:0 0}.backdrop[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);background-color:#f9fafd30;transition:none 0s ease 0s}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#442953}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover, .navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:focus{color:#e94842}.navbar-light[_ngcontent-%COMP%]   .navbar-toggler[_ngcontent-%COMP%]{color:#000000f2;border-color:#0000001a}.img-fluid[_ngcontent-%COMP%]{height:32px;width:32px;border-radius:100%;object-fit:cover}.btn-outline-primary[_ngcontent-%COMP%]{border-color:transparent}.btn-outline-primary[_ngcontent-%COMP%]:hover{border-color:transparent;color:#e94842;background-color:transparent}"]}),Qt})(),At=(()=>{class Qt{constructor(){this.currentYear=new Date}}return Qt.\u0275fac=function(Rt){return new(Rt||Qt)},Qt.\u0275cmp=Q.Xpm({type:Qt,selectors:[["app-footer"]],decls:80,vars:4,consts:[[1,"pb-0","pt-4","bg-primary-gradient"],[1,"bg-holder",2,"background-image","url(assets/img/illustrations/footer-bg.png)","background-position","center","background-size","cover"],[1,"container"],[1,"row","justify-content-lg-between"],[1,"col-6","col-sm-4","col-lg-auto","mb-3"],[1,"mb-5"],[1,"list-unstyled","mb-md-4","mb-lg-0"],[1,"mb-3"],["href","#!",1,"text-decoration-none"],[1,"col-12","col-sm-12","col-lg-auto","mb-3"],[1,"row","row-cols-lg-auto","g-0","align-items-center"],[1,"col-9","col-lg-8"],["for","colFormLabel",1,"visually-hidden"],[1,"input-group"],["id","colFormLabel","type","email","placeholder","email address",1,"rounded-end-0","form-control","me-3"],[1,"col-3","col-lg-4"],["type","submit",1,"btn","btn-primary","rounded-start-0"],[1,"col-auto","my-4"],[1,"list-unstyled","list-inline"],[1,"list-inline-item","me-3"],["href","#!"],["xmlns","http://www.w3.org/2000/svg","width","25","fill","#442953","viewBox","0 0 16 16",1,"bi","bi-twitter"],["d","M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"],["xmlns","http://www.w3.org/2000/svg","width","25","fill","#442953","viewBox","0 0 16 16",1,"bi","bi-facebook"],["d","M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"],["xmlns","http://www.w3.org/2000/svg","width","25","fill","#442953","viewBox","0 0 16 16",1,"bi","bi-instagram"],["d","M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"],[1,"row","justify-content-center"],[1,"col-auto","mb-2"],[1,"mb-0","fs--1","my-2","text-center"]],template:function(Rt,Kt){1&Rt&&(Q.TgZ(0,"section",0),Q._UZ(1,"div",1),Q.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),Q._uU(6,"COMPANY "),Q.qZA(),Q.TgZ(7,"ul",6)(8,"li",7)(9,"a",8),Q._uU(10,"Blog"),Q.qZA()(),Q.TgZ(11,"li",7)(12,"a",8),Q._uU(13,"Warranty"),Q.qZA()(),Q.TgZ(14,"li",7)(15,"a",8),Q._uU(16,"Safety"),Q.qZA()(),Q.TgZ(17,"li",7)(18,"a",8),Q._uU(19,"Contact Us"),Q.qZA()(),Q.TgZ(20,"li",7)(21,"a",8),Q._uU(22,"The Team"),Q.qZA()()()(),Q.TgZ(23,"div",4)(24,"h5",5),Q._uU(25,"ABOUT MIMOS"),Q.qZA(),Q.TgZ(26,"ul",6)(27,"li",7)(28,"a",8),Q._uU(29,"About Us"),Q.qZA()(),Q.TgZ(30,"li",7)(31,"a",8),Q._uU(32,"Get the App"),Q.qZA()(),Q.TgZ(33,"li",7)(34,"a",8),Q._uU(35,"Privacy Statement"),Q.qZA()(),Q.TgZ(36,"li",7)(37,"a",8),Q._uU(38,"Cookie Policy"),Q.qZA()()()(),Q.TgZ(39,"div",4)(40,"h5",5),Q._uU(41,"NEED HELP?"),Q.qZA(),Q.TgZ(42,"ul",6)(43,"li",7)(44,"a",8),Q._uU(45,"Help Center"),Q.qZA()(),Q.TgZ(46,"li",7)(47,"a",8),Q._uU(48,"FAQ"),Q.qZA()()()(),Q.TgZ(49,"div",9)(50,"h5",5),Q._uU(51,"SUBSCRIBE"),Q.qZA(),Q.TgZ(52,"form",10)(53,"div",11)(54,"label",12),Q._uU(55,"Username"),Q.qZA(),Q.TgZ(56,"div",13),Q._UZ(57,"input",14),Q.qZA()(),Q.TgZ(58,"div",15)(59,"button",16),Q._uU(60,"Submit"),Q.qZA()()(),Q.TgZ(61,"div",17)(62,"ul",18)(63,"li",19)(64,"a",20),Q.O4$(),Q.TgZ(65,"svg",21),Q._UZ(66,"path",22),Q.qZA()()(),Q.kcU(),Q.TgZ(67,"li",19)(68,"a",8),Q.O4$(),Q.TgZ(69,"svg",23),Q._UZ(70,"path",24),Q.qZA()()(),Q.kcU(),Q.TgZ(71,"li",19)(72,"a",20),Q.O4$(),Q.TgZ(73,"svg",25),Q._UZ(74,"path",26),Q.qZA()()()()()()(),Q.kcU(),Q.TgZ(75,"div",27)(76,"div",28)(77,"p",29),Q._uU(78),Q.ALo(79,"date"),Q.qZA()()()()()),2&Rt&&(Q.xp6(78),Q.hij(" Mimos \xa9 ",Q.xi3(79,1,Kt.currentYear,"y")," All Rights Reserved. "))},dependencies:[lt.uU],encapsulation:2}),Qt})(),St=(()=>{class Qt{constructor(){this.title="sprint-9-pets-app"}ngOnInit(){ut.accessToken=Et.N.apiKey}}return Qt.\u0275fac=function(Rt){return new(Rt||Qt)},Qt.\u0275cmp=Q.Xpm({type:Qt,selectors:[["app-root"]],decls:3,vars:0,template:function(Rt,Kt){1&Rt&&Q._UZ(0,"app-navbar")(1,"router-outlet")(2,"app-footer")},dependencies:[c.lC,ki,At]}),Qt})(),Zt=(()=>{class Qt{}return Qt.\u0275fac=function(Rt){return new(Rt||Qt)},Qt.\u0275mod=Q.oAB({type:Qt,bootstrap:[St]}),Qt.\u0275inj=Q.cJS({imports:[_.b2,xt,ot.JF,dn.IJ]}),Qt})();Et.N.production&&(0,Q.G48)(),_.q6().bootstrapModule(Zt).catch(Qt=>console.error(Qt))},9898:function(Yn){Yn.exports=function(){"use strict";var Ut,he,_;function Q(c,ze){if(Ut)if(he){var Vt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ut+")(sharedChunk); ("+he+")(sharedChunk); self.onerror = null;",Ft={};Ut(Ft),_=ze(Ft),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([Vt],{type:"text/javascript"})))}else he=ze;else Ut=ze}return Q(0,function(c){var ze=typeof self<"u"?self:{},Vt=Ft;function Ft(n,e,t,s){this.cx=3*n,this.bx=3*(t-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=t,this.p2y=s}Ft.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},Ft.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},Ft.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},Ft.prototype.solveCurveX=function(n,e){var t,s,u,f,g;for(void 0===e&&(e=1e-6),u=n,g=0;g<8;g++){if(f=this.sampleCurveX(u)-n,Math.abs(f)<e)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=f/b}if((u=n)<(t=0))return t;if(u>(s=1))return s;for(;t<s;){if(f=this.sampleCurveX(u),Math.abs(f-n)<e)return u;n>f?t=u:s=u,u=.5*(s-t)+t}return u},Ft.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var st=xt;function xt(n,e){this.x=n,this.y=e}xt.prototype={clone:function(){return new xt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,t=n.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),t=Math.sin(n),s=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=s,this},_rotateAround:function(n,e){var t=Math.cos(n),s=Math.sin(n),u=e.y+s*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xt.convert=function(n){return n instanceof xt?n:Array.isArray(n)?new xt(n[0],n[1]):n};const ut=Math.PI/180,Et=180/Math.PI;function lt(n){return n*ut}function dn(n){return n*Et}const jt=[[0,0],[1,0],[1,1],[0,1]];function Xt(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,t=e*n;return 4*(n<.5?t:3*(n-e)+t-.75)}function Gt(n,e,t,s){const u=new Vt(n,e,t,s);return function(f){return u.solve(f)}}const xn=Gt(.25,.1,.25,1);function on(n,e,t){return Math.min(t,Math.max(e,n))}function vn(n,e,t){return(t=on((t-n)/(e-n),0,1))*t*(3-2*t)}function ki(n,e,t){const s=t-e,u=((n-e)%s+s)%s+e;return u===e?t:u}function At(n,e,t){if(!n.length)return t(null,[]);let s=n.length;const u=new Array(n.length);let f=null;n.forEach((g,b)=>{e(g,(E,M)=>{E&&(f=E),u[b]=M,0==--s&&t(f,u)})})}function St(n){const e=[];for(const t in n)e.push(n[t]);return e}function Zt(n,...e){for(const t of e)for(const s in t)n[s]=t[s];return n}let Qt=1;function tn(){return Qt++}function Rt(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Kt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function it(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function ct(n,e){n.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function It(n,e){return-1!==n.indexOf(e,n.length-e.length)}function dt(n,e,t){const s={};for(const u in n)s[u]=e.call(t||this,n[u],u,n);return s}function _n(n,e,t){const s={};for(const u in n)e.call(t||this,n[u],u,n)&&(s[u]=n[u]);return s}function rn(n){return Array.isArray(n)?n.map(rn):"object"==typeof n&&n?dt(n,rn):n}const Zn={};function An(n){Zn[n]||(typeof console<"u"&&console.warn(n),Zn[n]=!0)}function Di(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function Kn(n){let e=0;for(let t,s,u=0,f=n.length,g=f-1;u<f;g=u++)t=n[u],s=n[g],e+=(s.x-t.x)*(t.y+s.y);return e}function Ni(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function kr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,s,u,f)=>{const g=u||f;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let oi=null;function ei(n){if(null==oi){const e=n.navigator?n.navigator.userAgent:null;oi=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return oi}function ko(n){try{const e=ze[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Xi(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Ao=ze.performance;function vr(n){const e=n?n.url.toString():void 0;return Ao.getEntriesByName(e)}let ai,Ur,vi,cr;const Hi={now:()=>void 0!==vi?vi:ze.performance.now(),setNow(n){vi=n},restoreNow(){vi=void 0},frame(n){const e=ze.requestAnimationFrame(n);return{cancel:()=>ze.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:t,height:s}=n;cr||(cr=ze.document.createElement("canvas"));const u=cr.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return(t>cr.width||s>cr.height)&&(cr.width=t,cr.height=s),u.clearRect(-e,-e,t+2*e,s+2*e),u.drawImage(n,0,0,t,s),u.getImageData(-e,-e,t+2*e,s+2*e)},resolveURL:n=>(ai||(ai=ze.document.createElement("a")),ai.href=n,ai.href),get devicePixelRatio(){return ze.devicePixelRatio},get prefersReducedMotion(){return!!ze.matchMedia&&(null==Ur&&(Ur=ze.matchMedia("(prefers-reduced-motion: reduce)")),Ur.matches)}};let nr;const si={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==nr){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{nr=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{nr=n}}return nr},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ji={supported:!1,testSupport:function(n){!zi&&pr&&(zn?Ho(n):jr=n)}};let jr,pr,zi=!1,zn=!1;function Ho(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,pr),n.isContextLost())return;Ji.supported=!0}catch{}n.deleteTexture(e),zi=!0}ze.document&&(pr=ze.document.createElement("img"),pr.onload=function(){jr&&Ho(jr),jr=null,zn=!0},pr.onerror=function(){zi=!0,jr=null},pr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ts="01",Mt="NO_ACCESS_TOKEN";function Ve(n){return 0===n.indexOf("mapbox:")}function Oe(n){return si.API_URL_REGEX.test(n)}const Ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(n){const e=n.match(Ct);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Un(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function ni(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ze.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ui{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=ni(si.ACCESS_TOKEN);let s="";return s=t&&t.u?ze.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):si.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=ko("localStorage"),t=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=ze.localStorage.getItem(t);u&&(this.eventData=JSON.parse(u));const f=ze.localStorage.getItem(s);f&&(this.anonId=f)}catch{An("Unable to read from LocalStorage")}}saveEventData(){const e=ko("localStorage"),t=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{ze.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ze.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{An("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,s,u){if(!si.EVENTS_URL)return;const f=Nt(si.EVENTS_URL);f.params.push(`access_token=${u||si.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.10.0",skuId:ts,userId:this.anonId},b=t?Zt(g,t):g,E={url:Un(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=wt(E,M=>{this.pendingRequest=null,s(M),this.saveEventData(),this.processRequests(u)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Pn=new class extends ui{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){si.EVENTS_URL&&si.ACCESS_TOKEN&&Array.isArray(n)&&n.some(t=>Ve(t)||Oe(t))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ni(si.ACCESS_TOKEN),t=e?e.u:si.ACCESS_TOKEN;let s=t!==this.eventData.tokenU;it(this.anonId)||(this.anonId=Rt(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(u),b=(u-this.eventData.lastSuccess)/864e5;s=s||b>=1||b<-1||f.getDate()!==g.getDate()}else s=!0;s?this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=t)},n):this.processRequests()}},Ki=Pn.postTurnstileEvent.bind(Pn),Tn=new class extends ui{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,t,s){this.skuToken=e,this.errorCb=s,si.EVENTS_URL&&(t||si.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},t):this.errorCb(new Error(Mt)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=Rt()),this.postEvent(t,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},qi=Tn.postMapLoadEvent.bind(Tn),wn=new class extends ui{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,t,s){if(!si.API_URL||!si.SESSION_PATH)return;const u=Nt(si.API_URL+si.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||si.ACCESS_TOKEN||""}`);const f={url:Un(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ae(f,g=>{this.pendingRequest=null,t(g),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,t,s){this.skuToken=e,this.errorCb=s,si.SESSION_PATH&&si.API_URL&&(t||si.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},t):this.errorCb(new Error(Mt)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},di=wn.getSessionAPI.bind(wn),Ci=new Set;let br,Gr=500,Wi=50,dr={};function mo(n){const e=re(n);let t,s;e&&e.forEach(f=>{const g=f.split("=");"language"===g[0]?t=g[1]:"worldview"===g[0]&&(s=g[1])});let u="mapbox-tiles";return t&&(u+=`-${t}`),s&&(u+=`-${s}`),u}function _e(){try{return ze.caches}catch{}}function te(n){const e=_e();e&&!dr[n]&&(dr[n]=e.open(n))}function re(n){const e=n.indexOf("?");return e>0?n.slice(e+1).split("&"):[]}function xe(n){const e=n.indexOf("?");if(e<0)return n;const t=re(n).filter(s=>{const u=s.split("=");return"language"===u[0]||"worldview"===u[0]});return t.length?`${n.slice(0,e)}?${t.join("&")}`:n.slice(0,e)}let Se=1/0;const $e={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze($e);class nt extends Error{constructor(e,t,s){401===t&&Oe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const et=Ni()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ze.location.protocol?ze.parent:ze).location.href,We=function(n,e){if(!(/^file:/.test(t=n.url)||/^file:/.test(et())&&!/^\w+:/.test(t))){if(ze.fetch&&ze.Request&&ze.AbortController&&ze.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new ze.AbortController,g=new ze.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:et(),signal:f.signal});let b=!1,E=!1;const M=(N=g.url).indexOf("sku=")>0&&Oe(N);var N;"json"===s.type&&g.headers.set("Accept","application/json");const B=(X,K,oe)=>{if(E)return;if(X&&"SecurityError"!==X.message&&An(X),K&&oe)return z(K);const pe=Date.now();ze.fetch(g).then(Ce=>{if(Ce.ok){const Fe=M?Ce.clone():null;return z(Ce,Fe,pe)}return u(new nt(Ce.statusText,Ce.status,s.url))}).catch(Ce=>{20!==Ce.code&&u(new Error(Ce.message))})},z=(X,K,oe)=>{("arrayBuffer"===s.type?X.arrayBuffer():"json"===s.type?X.json():X.text()).then(pe=>{E||(K&&oe&&function(Ce,Fe,Ee){const Re=mo(Ce.url);if(te(Re),!dr[Re])return;const Ye={status:Fe.status,statusText:Fe.statusText,headers:new ze.Headers};Fe.headers.forEach((pt,Ot)=>Ye.headers.set(Ot,pt));const Be=kr(Fe.headers.get("Cache-Control")||"");if(Be["no-store"])return;Be["max-age"]&&Ye.headers.set("Expires",new Date(Ee+1e3*Be["max-age"]).toUTCString());const mt=Ye.headers.get("Expires");mt&&(new Date(mt).getTime()-Ee<42e4||function(pt,Ot){if(void 0===br)try{new Response(new ReadableStream),br=!0}catch{br=!1}br?Ot(pt.body):pt.blob().then(Ot)}(Fe,pt=>{const Ot=new ze.Response(pt,Ye);te(Re),dr[Re]&&dr[Re].then(an=>an.put(xe(Ce.url),Ot)).catch(an=>An(an.message))}))}(g,K,oe),b=!0,u(null,pe,X.headers.get("Cache-Control"),X.headers.get("Expires")))}).catch(pe=>{E||u(new Error(pe.message))})};return M?function(X,K){const oe=mo(X.url);if(te(oe),!dr[oe])return K(null);const pe=xe(X.url);dr[oe].then(Ce=>{Ce.match(pe).then(Fe=>{const Ee=function(Re){if(!Re)return!1;const Ye=new Date(Re.headers.get("Expires")||0),Be=kr(Re.headers.get("Cache-Control")||"");return Ye>Date.now()&&!Be["no-cache"]}(Fe);Ce.delete(pe),Ee&&Ce.put(pe,Fe.clone()),K(null,Fe,Ee)}).catch(K)}).catch(K)}(g,B):B(null,null),{cancel:()=>{E=!0,b||f.abort()}}}(n,e);if(Ni()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var t;return function(s,u){const f=new ze.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===s.type)try{g=JSON.parse(f.response)}catch(b){return u(b)}u(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new nt(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(n,e)},Ke=function(n,e){return We(Zt(n,{type:"arrayBuffer"}),e)},wt=function(n,e){return We(Zt(n,{method:"POST"}),e)},Ae=function(n,e){return We(Zt(n,{method:"GET"}),e)};function ye(n){const e=ze.document.createElement("a");return e.href=n,e.protocol===ze.document.location.protocol&&e.host===ze.document.location.host}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ze,Pe;Ze=[],Pe=0;const ft=function(n,e){if(Ji.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Pe>=si.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ze.push(f),f}Pe++;let t=!1;const s=()=>{if(!t)for(t=!0,Pe--;Ze.length&&Pe<si.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Ze.shift(),{requestParameters:g,callback:b,cancelled:E}=f;E||(f.cancel=ft(g,b).cancel)}},u=Ke(n,(f,g,b,E)=>{s(),f?e(f):g&&(ze.createImageBitmap?function(M,N){const B=new ze.Blob([new Uint8Array(M)],{type:"image/png"});ze.createImageBitmap(B).then(z=>{N(null,z)}).catch(z=>{N(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(M,N)=>e(M,N,b,E)):function(M,N){const B=new ze.Image,z=ze.URL;B.onload=()=>{N(null,B),z.revokeObjectURL(B.src),B.onload=null,ze.requestAnimationFrame(()=>{B.src=be})},B.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new ze.Blob([new Uint8Array(M)],{type:"image/png"});B.src=M.byteLength?z.createObjectURL(X):be}(g,(M,N)=>e(M,N,b,E)))});return{cancel:()=>{u.cancel(),s()}}};function qt(n,e,t){t[n]&&-1!==t[n].indexOf(e)||(t[n]=t[n]||[],t[n].push(e))}function Rn(n,e,t){if(t&&t[n]){const s=t[n].indexOf(e);-1!==s&&t[n].splice(s,1)}}class Vn{constructor(e,t={}){Zt(this,t),this.type=e}}class jn extends Vn{constructor(e,t={}){super("error",Zt({error:e},t))}}class In{on(e,t){return this._listeners=this._listeners||{},qt(e,t,this._listeners),this}off(e,t){return Rn(e,t,this._listeners),Rn(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},qt(e,t,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,t){"string"==typeof e&&(e=new Vn(e,t||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const b of u)b.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const b of f)Rn(s,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(Zt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof jn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var at=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function $r(n,...e){for(const t of e)for(const s in t)n[s]=t[s];return n}function $i(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Xn(n){if(Array.isArray(n))return n.map(Xn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const t in n)e[t]=Xn(n[t]);return e}return $i(n)}class xo extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Tr=xo;class go{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[s,u]of t)this.bindings[s]=u}concat(e){return new go(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var zs=go;const ir={kind:"null"},ln={kind:"number"},Qn={kind:"string"},Jn={kind:"boolean"},wr={kind:"color"},Fo={kind:"object"},Sn={kind:"value"},Wo={kind:"collator"},ps={kind:"formatted"},ms={kind:"resolvedImage"};function lo(n,e){return{kind:"array",itemType:n,N:e}}function Vi(n){if("array"===n.kind){const e=Vi(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const gs=[ir,ln,Qn,Jn,wr,ps,Fo,lo(Sn),ms];function Cr(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Cr(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const t of gs)if(!Cr(t,e))return null}return`Expected ${Vi(n)} but found ${Vi(e)} instead.`}function Dr(n,e){return e.some(t=>t.kind===n.kind)}function Er(n,e){return e.some(t=>"null"===t?null===n:"array"===t?Array.isArray(n):"object"===t?n&&!Array.isArray(n)&&"object"==typeof n:t===typeof n)}function qr(n){var e={exports:{}};return n(e,e.exports),e.exports}var eo=qr(function(n,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(b){return(b=Math.round(b))<0?0:b>255?255:b}function u(b){return s("%"===b[b.length-1]?parseFloat(b)/100*255:parseInt(b))}function f(b){return(E="%"===b[b.length-1]?parseFloat(b)/100:parseFloat(b))<0?0:E>1?1:E;var E}function g(b,E,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?b+(E-b)*M*6:2*M<1?E:3*M<2?b+(E-b)*(2/3-M)*6:b}try{e.parseCSSColor=function(b){var E,M=b.replace(/ /g,"").toLowerCase();if(M in t)return t[M].slice();if("#"===M[0])return 4===M.length?(E=parseInt(M.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===M.length&&(E=parseInt(M.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var N=M.indexOf("("),B=M.indexOf(")");if(-1!==N&&B+1===M.length){var z=M.substr(0,N),X=M.substr(N+1,B-(N+1)).split(","),K=1;switch(z){case"rgba":if(4!==X.length)return null;K=f(X.pop());case"rgb":return 3!==X.length?null:[u(X[0]),u(X[1]),u(X[2]),K];case"hsla":if(4!==X.length)return null;K=f(X.pop());case"hsl":if(3!==X.length)return null;var oe=(parseFloat(X[0])%360+360)%360/360,pe=f(X[1]),Ce=f(X[2]),Fe=Ce<=.5?Ce*(pe+1):Ce+pe-Ce*pe,Ee=2*Ce-Fe;return[s(255*g(Ee,Fe,oe+1/3)),s(255*g(Ee,Fe,oe)),s(255*g(Ee,Fe,oe-1/3)),K];default:return null}}return null}}catch{}});class Yr{constructor(e,t,s,u=1){this.r=e,this.g=t,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Yr)return e;if("string"!=typeof e)return;const t=eo.parseCSSColor(e);return t?new Yr(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(s)},${u})`}toArray(){const{r:e,g:t,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*t/u,255*s/u,u]}toArray01(){const{r:e,g:t,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,t/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:s,a:u}=this;return[e,t,s,u]}}Yr.black=new Yr(0,0,0,1),Yr.white=new Yr(1,1,1,1),Yr.transparent=new Yr(0,0,0,0),Yr.red=new Yr(1,0,0,1),Yr.blue=new Yr(0,0,1,1);var Ui=Yr;class fa{constructor(e,t,s){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _o{constructor(e,t,s,u,f){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=s,this.fontStack=u,this.textColor=f}}class Zo{constructor(e){this.sections=e}static fromString(e){return new Zo([new _o(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Zo?e:Zo.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const s={};t.fontStack&&(s["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(s["font-scale"]=t.scale),t.textColor&&(s["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(s)}return e}}class Mr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Mr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Wa(n,e,t,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,t,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,t,s]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vs(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Ui||n instanceof fa||n instanceof Zo||n instanceof Mr)return!0;if(Array.isArray(n)){for(const e of n)if(!Vs(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!Vs(n[e]))return!1;return!0}return!1}function Fr(n){if(null===n)return ir;if("string"==typeof n)return Qn;if("boolean"==typeof n)return Jn;if("number"==typeof n)return ln;if(n instanceof Ui)return wr;if(n instanceof fa)return Wo;if(n instanceof Zo)return ps;if(n instanceof Mr)return ms;if(Array.isArray(n)){const e=n.length;let t;for(const s of n){const u=Fr(s);if(t){if(t===u)continue;t=Sn;break}t=u}return lo(t||Sn,e)}return Fo}function Ms(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof Ui||n instanceof Zo||n instanceof Mr?n.toString():JSON.stringify(n)}class gl{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Vs(e[1]))return t.error("invalid value");const s=e[1];let u=Fr(s);const f=t.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new gl(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ui?["rgba"].concat(this.value.toArray()):this.value instanceof Zo?this.value.serialize():this.value}}var ta=gl,co=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Ma={string:Qn,number:ln,boolean:Jn,object:Fo};class _l{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let b,E;if(e.length>2){const M=e[1];if("string"!=typeof M||!(M in Ma)||"object"===M)return t.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ma[M],u++}else b=Sn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);E=e[2],u++}s=lo(b,E)}else s=Ma[f];const g=[];for(;u<e.length;u++){const b=t.parse(e[u],u,Sn);if(!b)return null;g.push(b)}return new _l(s,g)}evaluate(e){for(let t=0;t<this.args.length;t++){const s=this.args[t].evaluate(e);if(!Cr(this.type,Fr(s)))return s;if(t===this.args.length-1)throw new co(`Expected value to be of type ${Vi(this.type)}, but found ${Vi(Fr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){t.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&t.push(u)}}return t.concat(this.args.map(s=>s.serialize()))}}var Po=_l;class Lo{constructor(e){this.type=ps,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return t.error("First argument must be an image or text section.");const u=[];let f=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(f&&"object"==typeof b&&!Array.isArray(b)){f=!1;let E=null;if(b["font-scale"]&&(E=t.parse(b["font-scale"],1,ln),!E))return null;let M=null;if(b["text-font"]&&(M=t.parse(b["text-font"],1,lo(Qn)),!M))return null;let N=null;if(b["text-color"]&&(N=t.parse(b["text-color"],1,wr),!N))return null;const B=u[u.length-1];B.scale=E,B.font=M,B.textColor=N}else{const E=t.parse(e[g],1,Sn);if(!E)return null;const M=E.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:E,scale:null,font:null,textColor:null})}}return new Lo(u)}evaluate(e){return new Zo(this.sections.map(t=>{const s=t.content.evaluate(e);return Fr(s)===ms?new _o("",s,null,null,null):new _o(Ms(s),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const s={};t.scale&&(s["font-scale"]=t.scale.serialize()),t.font&&(s["text-font"]=t.font.serialize()),t.textColor&&(s["text-color"]=t.textColor.serialize()),e.push(s)}return e}}class _s{constructor(e){this.type=ms,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const s=t.parse(e[1],1,Qn);return s?new _s(s):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),s=Mr.fromString(t);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(t)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const dc={"to-boolean":Jn,"to-color":wr,"to-number":ln,"to-string":Qn};class Za{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return t.error("Expected one argument.");const u=dc[s],f=[];for(let g=1;g<e.length;g++){const b=t.parse(e[g],g,Sn);if(!b)return null;f.push(b)}return new Za(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,s;for(const u of this.args){if(t=u.evaluate(e),s=null,t instanceof Ui)return t;if("string"==typeof t){const f=e.parseColor(t);if(f)return f}else if(Array.isArray(t)&&(s=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Wa(t[0],t[1],t[2],t[3]),!s))return new Ui(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new co(s||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const s of this.args){if(t=s.evaluate(e),null===t)return 0;const u=Number(t);if(!isNaN(u))return u}throw new co(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Zo.fromString(Ms(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Mr.fromString(Ms(this.args[0].evaluate(e))):Ms(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Lo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new _s(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var na=Za;const pa=["Unknown","Point","LineString","Polygon"];var Sa=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?pa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Ui.parse(n)),e}};class ys{constructor(e,t,s,u){this.name=e,this.type=t,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const s=e[0],u=ys.definitions[s];if(!u)return t.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=g.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let E=null;for(const[M,N]of b){E=new xs(t.registry,t.path,null,t.scope);const B=[];let z=!1;for(let X=1;X<e.length;X++){const K=e[X],oe=Array.isArray(M)?M[X-1]:M.type,pe=E.parse(K,1+B.length,oe);if(!pe){z=!0;break}B.push(pe)}if(!z)if(Array.isArray(M)&&M.length!==B.length)E.error(`Expected ${M.length} arguments, but found ${B.length} instead.`);else{for(let X=0;X<B.length;X++){const K=Array.isArray(M)?M[X]:M.type,oe=B[X];E.concat(X+1).checkSubtype(K,oe.type)}if(0===E.errors.length)return new ys(s,f,N,B)}}if(1===b.length)t.errors.push(...E.errors);else{const M=(b.length?b:g).map(([B])=>{return z=B,Array.isArray(z)?`(${z.map(Vi).join(", ")})`:`(${Vi(z.type)}...)`;var z}).join(" | "),N=[];for(let B=1;B<e.length;B++){const z=t.parse(e[B],1+N.length);if(!z)return null;N.push(Vi(z.type))}t.error(`Expected arguments of type ${M}, but found (${N.join(", ")}) instead.`)}return null}static register(e,t){ys.definitions=t;for(const s in t)e[s]=ys}}var wo=ys;class qa{constructor(e,t,s){this.type=Wo,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return t.error("Collator options argument must be an object.");const u=t.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Jn);if(!u)return null;const f=t.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Jn);if(!f)return null;let g=null;return s.locale&&(g=t.parse(s.locale,1,Qn),!g)?null:new qa(u,f,g)}evaluate(e){return new fa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const vs=8192;function ns(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function is(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function ia(n,e){const t=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(t*u*vs),Math.round(s*u*vs)]}function hc(n,e,t){const s=n[0]-e[0],u=n[1]-e[1],f=n[0]-t[0],g=n[1]-t[1];return s*g-f*u==0&&s*f<=0&&u*g<=0}function Ss(n,e){let t=!1;for(let g=0,b=e.length;g<b;g++){const E=e[g];for(let M=0,N=E.length;M<N-1;M++){if(hc(n,E[M],E[M+1]))return!1;(u=E[M])[1]>(s=n)[1]!=(f=E[M+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(t=!t)}}var s,u,f;return t}function Us(n,e){for(let t=0;t<e.length;t++)if(Ss(n,e[t]))return!0;return!1}function Ya(n,e,t,s){const u=s[0]-t[0],f=s[1]-t[1],g=(n[0]-t[0])*f-u*(n[1]-t[1]),b=(e[0]-t[0])*f-u*(e[1]-t[1]);return g>0&&b<0||g<0&&b>0}function Xa(n,e,t){for(const M of t)for(let N=0;N<M.length-1;++N)if((b=[(g=M[N+1])[0]-(f=M[N])[0],g[1]-f[1]])[0]*(E=[(u=e)[0]-(s=n)[0],u[1]-s[1]])[1]-b[1]*E[0]!=0&&Ya(s,u,f,g)&&Ya(f,g,s,u))return!0;var s,u,f,g,b,E;return!1}function ma(n,e){for(let t=0;t<n.length;++t)if(!Ss(n[t],e))return!1;for(let t=0;t<n.length-1;++t)if(Xa(n[t],n[t+1],e))return!1;return!0}function Ia(n,e){for(let t=0;t<e.length;t++)if(ma(n,e[t]))return!0;return!1}function qo(n,e,t){const s=[];for(let u=0;u<n.length;u++){const f=[];for(let g=0;g<n[u].length;g++){const b=ia(n[u][g],t);ns(e,b),f.push(b)}s.push(f)}return s}function Co(n,e,t){const s=[];for(let u=0;u<n.length;u++){const f=qo(n[u],e,t);s.push(f)}return s}function Aa(n,e,t,s){if(n[0]<t[0]||n[0]>t[2]){const u=.5*s;let f=n[0]-t[0]>u?-s:t[0]-n[0]>u?s:0;0===f&&(f=n[0]-t[2]>u?-s:t[2]-n[0]>u?s:0),n[0]+=f}ns(e,n)}function Pa(n,e,t,s){const u=Math.pow(2,s.z)*vs,f=[s.x*vs,s.y*vs],g=[];if(!n)return g;for(const b of n)for(const E of b){const M=[E.x+f[0],E.y+f[1]];Aa(M,e,t,u),g.push(M)}return g}function bs(n,e,t,s){const u=Math.pow(2,s.z)*vs,f=[s.x*vs,s.y*vs],g=[];if(!n)return g;for(const E of n){const M=[];for(const N of E){const B=[N.x+f[0],N.y+f[1]];ns(e,B),M.push(B)}g.push(M)}if(e[2]-e[0]<=u/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of g)for(const M of E)Aa(M,e,t,u)}var b;return g}class Is{constructor(e,t){this.type=Jn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Vs(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Is(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new Is(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Is(s,s)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(t,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(!g)return!1;if("Polygon"===s.type){const b=qo(s.coordinates,f,g),E=Pa(t.geometry(),u,f,g);if(!is(u,f))return!1;for(const M of E)if(!Ss(M,b))return!1}if("MultiPolygon"===s.type){const b=Co(s.coordinates,f,g),E=Pa(t.geometry(),u,f,g);if(!is(u,f))return!1;for(const M of E)if(!Us(M,b))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(t,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(!g)return!1;if("Polygon"===s.type){const b=qo(s.coordinates,f,g),E=bs(t.geometry(),u,f,g);if(!is(u,f))return!1;for(const M of E)if(!ma(M,b))return!1}if("MultiPolygon"===s.type){const b=Co(s.coordinates,f,g),E=bs(t.geometry(),u,f,g);if(!is(u,f))return!1;for(const M of E)if(!Ia(M,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Oa=Is;function mr(n){if(n instanceof wo&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Oa)return!1;let e=!0;return n.eachChild(t=>{e&&!mr(t)&&(e=!1)}),e}function Eo(n){if(n instanceof wo&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(t=>{e&&!Eo(t)&&(e=!1)}),e}function Ra(n,e){if(n instanceof wo&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(s=>{t&&!Ra(s,e)&&(t=!1)}),t}class ga{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const s=e[1];return t.scope.has(s)?new ga(s,t.scope.get(s)):t.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var rr=ga;class yl{constructor(e,t=[],s,u=new zs,f=[]){this.registry=e,this.path=t,this.key=t.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,t,s,u,f={}){return t?this.concat(t,s,u)._parse(e,f):this._parse(e,f)}_parse(e,t){function s(u,f,g){return"assert"===g?new Po(f,[u]):"coerce"===g?new na(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,E=g.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==E.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(b,E))return null}else g=s(g,b,t.typeAnnotation||"coerce");else g=s(g,b,t.typeAnnotation||"assert")}if(!(g instanceof ta)&&"resolvedImage"!==g.type.kind&&_i(g)){const b=new Sa;try{g=new ta(g.type,g.evaluate(b))}catch(E){return this.error(E.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new yl(this.registry,u,t||null,f,this.errors)}error(e,...t){const s=`${this.key}${t.map(u=>`[${u}]`).join("")}`;this.errors.push(new Tr(s,e))}checkSubtype(e,t){const s=Cr(e,t);return s&&this.error(s),s}}var xs=yl;function _i(n){if(n instanceof rr)return _i(n.boundExpression);if(n instanceof wo&&"error"===n.name||n instanceof qa||n instanceof Oa)return!1;const e=n instanceof na||n instanceof Po;let t=!0;return n.eachChild(s=>{t=e?t&&_i(s):t&&s instanceof ta}),!!t&&mr(n)&&Ra(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function uo(n,e){const t=n.length-1;let s,u,f=0,g=t,b=0;for(;f<=g;)if(b=Math.floor((f+g)/2),s=n[b],u=n[b+1],s<=e){if(b===t||e<u)return b;f=b+1}else{if(!(s>e))throw new co("Input is not a number.");g=b-1}return 0}class Ja{constructor(e,t,s){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const s=t.parse(e[1],1,ln);if(!s)return null;const u=[];let f=null;t.expectedType&&"value"!==t.expectedType.kind&&(f=t.expectedType);for(let g=1;g<e.length;g+=2){const b=1===g?-1/0:e[g],E=e[g+1],M=g,N=g+1;if("number"!=typeof b)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=b)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const B=t.parse(E,N,f);if(!B)return null;f=f||B.type,u.push([b,B])}return new Ja(f,s,u)}evaluate(e){const t=this.labels,s=this.outputs;if(1===t.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=t[0])return s[0].evaluate(e);const f=t.length;return u>=t[f-1]?s[f-1].evaluate(e):s[uo(t,u)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var _a=Ja;function Ti(n,e,t){return n*(1-t)+e*t}function Sr(n,e,t){return n.map((s,u)=>Ti(s,e[u],t))}var ya=Object.freeze({__proto__:null,number:Ti,color:function(n,e,t){return new Ui(Ti(n.r,e.r,t),Ti(n.g,e.g,t),Ti(n.b,e.b,t),Ti(n.a,e.a,t))},array:Sr});const Ka=4/29,Yo=6/29,ra=3*Yo*Yo,$c=Math.PI/180,fc=180/Math.PI;function rs(n){return n>.008856451679035631?Math.pow(n,1/3):n/ra+Ka}function va(n){return n>Yo?n*n*n:ra*(n-Ka)}function Qa(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Jt(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ei(n){const e=Jt(n.r),t=Jt(n.g),s=Jt(n.b),u=rs((.4124564*e+.3575761*t+.1804375*s)/.95047),f=rs((.2126729*e+.7151522*t+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-rs((.0193339*e+.119192*t+.9503041*s)/1.08883)),alpha:n.a}}function ba(n){let e=(n.l+16)/116,t=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*va(e),t=.95047*va(t),s=1.08883*va(s),new Ui(Qa(3.2404542*t-1.5371385*e-.4985314*s),Qa(-.969266*t+1.8760108*e+.041556*s),Qa(.0556434*t-.2040259*e+1.0572252*s),n.alpha)}function el(n,e,t){const s=e-n;return n+t*(s>180||s<-180?s-360*Math.round(s/360):s)}const Lr={forward:Ei,reverse:ba,interpolate:function(n,e,t){return{l:Ti(n.l,e.l,t),a:Ti(n.a,e.a,t),b:Ti(n.b,e.b,t),alpha:Ti(n.alpha,e.alpha,t)}}},Na={forward:function(n){const{l:e,a:t,b:s}=Ei(n),u=Math.atan2(s,t)*fc;return{h:u<0?u+360:u,c:Math.sqrt(t*t+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*$c,t=n.c;return ba({l:n.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:n.alpha})},interpolate:function(n,e,t){return{h:el(n.h,e.h,t),c:Ti(n.c,e.c,t),l:Ti(n.l,e.l,t),alpha:Ti(n.alpha,e.alpha,t)}}};var xa=Object.freeze({__proto__:null,lab:Lr,hcl:Na});class Bo{constructor(e,t,s,u,f){this.type=e,this.operator=t,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[g,b]of f)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,t,s,u){let f=0;if("exponential"===e.name)f=J(t,e.base,s,u);else if("linear"===e.name)f=J(t,1,s,u);else if("cubic-bezier"===e.name){const g=e.controlPoints;f=new Vt(g[0],g[1],g[2],g[3]).solve(J(t,1,s,u))}return f}static parse(e,t){let[s,u,f,...g]=e;if(!Array.isArray(u)||0===u.length)return t.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const M=u[1];if("number"!=typeof M)return t.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if("cubic-bezier"!==u[0])return t.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(4!==M.length||M.some(N=>"number"!=typeof N||N<0||N>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(f=t.parse(f,2,ln),!f)return null;const b=[];let E=null;"interpolate-hcl"===s||"interpolate-lab"===s?E=wr:t.expectedType&&"value"!==t.expectedType.kind&&(E=t.expectedType);for(let M=0;M<g.length;M+=2){const N=g[M],B=g[M+1],z=M+3,X=M+4;if("number"!=typeof N)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(b.length&&b[b.length-1][0]>=N)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const K=t.parse(B,X,E);if(!K)return null;E=E||K.type,b.push([N,K])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Bo(E,s,u,f,b):t.error(`Type ${Vi(E)} is not interpolatable.`)}evaluate(e){const t=this.labels,s=this.outputs;if(1===t.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=t[0])return s[0].evaluate(e);const f=t.length;if(u>=t[f-1])return s[f-1].evaluate(e);const g=uo(t,u),b=Bo.interpolationFactor(this.interpolation,u,t[g],t[g+1]),E=s[g].evaluate(e),M=s[g+1].evaluate(e);return"interpolate"===this.operator?ya[this.type.kind.toLowerCase()](E,M,b):"interpolate-hcl"===this.operator?Na.reverse(Na.interpolate(Na.forward(E),Na.forward(M),b)):Lr.reverse(Lr.interpolate(Lr.forward(E),Lr.forward(M),b))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)t.push(this.labels[s],this.outputs[s].serialize());return t}}function J(n,e,t,s){const u=s-t,f=n-t;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var q=Bo;class G{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let s=null;const u=t.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const b of e.slice(1)){const E=t.parse(b,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!E)return null;s=s||E.type,f.push(E)}const g=u&&f.some(b=>Cr(u,b.type));return new G(g?Sn:s,f)}evaluate(e){let t,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof Mr&&!s.available&&(t||(t=s),s=null,u===this.args.length))return t;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var ue=G;class gt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if("string"!=typeof g)return t.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);const b=t.parse(e[f+1],f+1);if(!b)return null;s.push([g,b])}const u=t.parse(e[e.length-1],e.length-1,t.expectedType,s);return u?new gt(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,s]of this.bindings)e.push(t,s.serialize());return e.push(this.result.serialize()),e}}var On=gt;class Mi{constructor(e,t,s){this.type=e,this.index=t,this.input=s}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,ln),u=t.parse(e[2],2,lo(t.expectedType||Sn));return s&&u?new Mi(u.type.itemType,s,u):null}evaluate(e){const t=this.index.evaluate(e),s=this.input.evaluate(e);if(t<0)throw new co(`Array index out of bounds: ${t} < 0.`);if(t>=s.length)throw new co(`Array index out of bounds: ${t} > ${s.length-1}.`);if(t!==Math.floor(t))throw new co(`Array index must be an integer, but found ${t} instead.`);return s[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var to=Mi;class Ps{constructor(e,t){this.type=Jn,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,Sn),u=t.parse(e[2],2,Sn);return s&&u?Dr(s.type,[Jn,Qn,ln,ir,Sn])?new Ps(s,u):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(s.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Er(t,["boolean","string","number","null"]))throw new co(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(Fr(t))} instead.`);if(!Er(s,["string","array"]))throw new co(`Expected second argument to be of type array or string, but found ${Vi(Fr(s))} instead.`);return s.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ws=Ps;class Oo{constructor(e,t,s){this.type=ln,this.needle=e,this.haystack=t,this.fromIndex=s}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,Sn),u=t.parse(e[2],2,Sn);if(!s||!u)return null;if(!Dr(s.type,[Jn,Qn,ln,ir,Sn]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(s.type)} instead`);if(4===e.length){const f=t.parse(e[3],3,ln);return f?new Oo(s,u,f):null}return new Oo(s,u)}evaluate(e){const t=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Er(t,["boolean","string","number","null"]))throw new co(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(Fr(t))} instead.`);if(!Er(s,["string","array"]))throw new co(`Expected second argument to be of type array or string, but found ${Vi(Fr(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(t,u)}return s.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Rl=Oo;class ka{constructor(e,t,s,u,f,g){this.inputType=e,this.type=t,this.input=s,this.cases=u,this.outputs=f,this.otherwise=g}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let s,u;t.expectedType&&"value"!==t.expectedType.kind&&(u=t.expectedType);const f={},g=[];for(let M=2;M<e.length-1;M+=2){let N=e[M];const B=e[M+1];Array.isArray(N)||(N=[N]);const z=t.concat(M);if(0===N.length)return z.error("Expected at least one branch label.");for(const K of N){if("number"!=typeof K&&"string"!=typeof K)return z.error("Branch labels must be numbers or strings.");if("number"==typeof K&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof K&&Math.floor(K)!==K)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,Fr(K)))return null}else s=Fr(K);if(void 0!==f[String(K)])return z.error("Branch labels must be unique.");f[String(K)]=g.length}const X=t.parse(B,M,u);if(!X)return null;u=u||X.type,g.push(X)}const b=t.parse(e[1],1,Sn);if(!b)return null;const E=t.parse(e[e.length-1],e.length-1,u);return E?"value"!==b.type.kind&&t.concat(1).checkSubtype(s,b.type)?null:new ka(s,u,b,f,g,E):null}evaluate(e){const t=this.input.evaluate(e);return(Fr(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),s=[],u={};for(const g of t){const b=u[this.cases[g]];void 0===b?(u[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[b][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,b]of s)e.push(1===b.length?f(b[0]):b.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var _u=ka;class Nl{constructor(e,t,s){this.type=e,this.branches=t,this.otherwise=s}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let s;t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const b=t.parse(e[g],g,Jn);if(!b)return null;const E=t.parse(e[g+1],g+1,s);if(!E)return null;u.push([b,E]),s=s||E.type}const f=t.parse(e[e.length-1],e.length-1,s);return f?new Nl(s,u,f):null}evaluate(e){for(const[t,s]of this.branches)if(t.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,s]of this.branches)e(t),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var kl=Nl;class vl{constructor(e,t,s,u){this.type=e,this.input=t,this.beginIndex=s,this.endIndex=u}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,Sn),u=t.parse(e[2],2,ln);if(!s||!u)return null;if(!Dr(s.type,[lo(Sn),Qn,Sn]))return t.error(`Expected first argument to be of type array or string, but found ${Vi(s.type)} instead`);if(4===e.length){const f=t.parse(e[3],3,ln);return f?new vl(s.type,s,u,f):null}return new vl(s.type,s,u)}evaluate(e){const t=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Er(t,["string","array"]))throw new co(`Expected first argument to be of type array or string, but found ${Vi(Fr(t))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return t.slice(s,u)}return t.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Fl=vl;function bl(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ll(n,e,t,s){return 0===s.compare(e,t)}function oa(n,e,t){const s="=="!==n&&"!="!==n;return class w1{constructor(f,g,b){this.type=Jn,this.lhs=f,this.rhs=g,this.collator=b,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const b=f[0];let E=g.parse(f[1],1,Sn);if(!E)return null;if(!bl(b,E.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Vi(E.type)}'.`);let M=g.parse(f[2],2,Sn);if(!M)return null;if(!bl(b,M.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Vi(M.type)}'.`);if(E.type.kind!==M.type.kind&&"value"!==E.type.kind&&"value"!==M.type.kind)return g.error(`Cannot compare types '${Vi(E.type)}' and '${Vi(M.type)}'.`);s&&("value"===E.type.kind&&"value"!==M.type.kind?E=new Po(M.type,[E]):"value"!==E.type.kind&&"value"===M.type.kind&&(M=new Po(E.type,[M])));let N=null;if(4===f.length){if("string"!==E.type.kind&&"string"!==M.type.kind&&"value"!==E.type.kind&&"value"!==M.type.kind)return g.error("Cannot use collator to compare non-string types.");if(N=g.parse(f[3],3,Wo),!N)return null}return new w1(E,M,N)}evaluate(f){const g=this.lhs.evaluate(f),b=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const E=Fr(g),M=Fr(b);if(E.kind!==M.kind||"string"!==E.kind&&"number"!==E.kind)throw new co(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${E.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const E=Fr(g),M=Fr(b);if("string"!==E.kind||"string"!==M.kind)return e(f,g,b)}return this.collator?t(f,g,b,this.collator.evaluate(f)):e(f,g,b)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const j=oa("==",function(n,e,t){return e===t},Ll),ie=oa("!=",function(n,e,t){return e!==t},function(n,e,t,s){return!Ll(0,e,t,s)}),H=oa("<",function(n,e,t){return e<t},function(n,e,t,s){return s.compare(e,t)<0}),ce=oa(">",function(n,e,t){return e>t},function(n,e,t,s){return s.compare(e,t)>0}),He=oa("<=",function(n,e,t){return e<=t},function(n,e,t,s){return s.compare(e,t)<=0}),Dt=oa(">=",function(n,e,t){return e>=t},function(n,e,t,s){return s.compare(e,t)>=0});class Yt{constructor(e,t,s,u,f,g){this.type=Qn,this.number=e,this.locale=t,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const s=t.parse(e[1],1,ln);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return t.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=t.parse(u.locale,1,Qn),!f))return null;let g=null;if(u.currency&&(g=t.parse(u.currency,1,Qn),!g))return null;let b=null;if(u.unit&&(b=t.parse(u.unit,1,Qn),!b))return null;let E=null;if(u["min-fraction-digits"]&&(E=t.parse(u["min-fraction-digits"],1,ln),!E))return null;let M=null;return u["max-fraction-digits"]&&(M=t.parse(u["max-fraction-digits"],1,ln),!M)?null:new Yt(s,f,g,b,E,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ln{constructor(e){this.type=ln,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=t.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?t.error(`Expected argument of type string or array, but found ${Vi(s.type)} instead.`):new Ln(s):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t||Array.isArray(t))return t.length;throw new co(`Expected value to be of type string or array, but found ${Vi(Fr(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const fi={"==":j,"!=":ie,">":ce,"<":H,">=":Dt,"<=":He,array:Po,at:to,boolean:Po,case:kl,coalesce:ue,collator:qa,format:Lo,image:_s,in:ws,"index-of":Rl,interpolate:q,"interpolate-hcl":q,"interpolate-lab":q,length:Ln,let:On,literal:ta,match:_u,number:Po,"number-format":Yt,object:Po,slice:Fl,step:_a,string:Po,"to-boolean":na,"to-color":na,"to-number":na,"to-string":na,var:rr,within:Oa};function Si(n,[e,t,s,u]){e=e.evaluate(n),t=t.evaluate(n),s=s.evaluate(n);const f=u?u.evaluate(n):1,g=Wa(e,t,s,f);if(g)throw new co(g);return new Ui(e/255*f,t/255*f,s/255*f,f)}function qn(n,e){return n in e}function Ii(n,e){const t=e[n];return void 0===t?null:t}function xr(n){return{type:n}}wo.register(fi,{error:[{kind:"error"},[Qn],(n,[e])=>{throw new co(e.evaluate(n))}],typeof:[Qn,[Sn],(n,[e])=>Vi(Fr(e.evaluate(n)))],"to-rgba":[lo(ln,4),[wr],(n,[e])=>e.evaluate(n).toArray()],rgb:[wr,[ln,ln,ln],Si],rgba:[wr,[ln,ln,ln,ln],Si],has:{type:Jn,overloads:[[[Qn],(n,[e])=>qn(e.evaluate(n),n.properties())],[[Qn,Fo],(n,[e,t])=>qn(e.evaluate(n),t.evaluate(n))]]},get:{type:Sn,overloads:[[[Qn],(n,[e])=>Ii(e.evaluate(n),n.properties())],[[Qn,Fo],(n,[e,t])=>Ii(e.evaluate(n),t.evaluate(n))]]},"feature-state":[Sn,[Qn],(n,[e])=>Ii(e.evaluate(n),n.featureState||{})],properties:[Fo,[],n=>n.properties()],"geometry-type":[Qn,[],n=>n.geometryType()],id:[Sn,[],n=>n.id()],zoom:[ln,[],n=>n.globals.zoom],pitch:[ln,[],n=>n.globals.pitch||0],"distance-from-center":[ln,[],n=>n.distanceFromCenter()],"heatmap-density":[ln,[],n=>n.globals.heatmapDensity||0],"line-progress":[ln,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[ln,[],n=>n.globals.skyRadialProgress||0],accumulated:[Sn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[ln,xr(ln),(n,e)=>{let t=0;for(const s of e)t+=s.evaluate(n);return t}],"*":[ln,xr(ln),(n,e)=>{let t=1;for(const s of e)t*=s.evaluate(n);return t}],"-":{type:ln,overloads:[[[ln,ln],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[ln],(n,[e])=>-e.evaluate(n)]]},"/":[ln,[ln,ln],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[ln,[ln,ln],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[ln,[],()=>Math.LN2],pi:[ln,[],()=>Math.PI],e:[ln,[],()=>Math.E],"^":[ln,[ln,ln],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[ln,[ln],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[ln,[ln],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[ln,[ln],(n,[e])=>Math.log(e.evaluate(n))],log2:[ln,[ln],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[ln,[ln],(n,[e])=>Math.sin(e.evaluate(n))],cos:[ln,[ln],(n,[e])=>Math.cos(e.evaluate(n))],tan:[ln,[ln],(n,[e])=>Math.tan(e.evaluate(n))],asin:[ln,[ln],(n,[e])=>Math.asin(e.evaluate(n))],acos:[ln,[ln],(n,[e])=>Math.acos(e.evaluate(n))],atan:[ln,[ln],(n,[e])=>Math.atan(e.evaluate(n))],min:[ln,xr(ln),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[ln,xr(ln),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[ln,[ln],(n,[e])=>Math.abs(e.evaluate(n))],round:[ln,[ln],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[ln,[ln],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[ln,[ln],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Jn,[Qn,Sn],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[Jn,[Sn],(n,[e])=>n.id()===e.value],"filter-type-==":[Jn,[Qn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Jn,[Qn,Sn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Jn,[Sn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t<s}],"filter->":[Jn,[Qn,Sn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s>u}],"filter-id->":[Jn,[Sn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t>s}],"filter-<=":[Jn,[Qn,Sn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Jn,[Sn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t<=s}],"filter->=":[Jn,[Qn,Sn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Jn,[Sn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t>=s}],"filter-has":[Jn,[Sn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Jn,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Jn,[lo(Qn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Jn,[lo(Sn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Jn,[Qn,lo(Sn)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Jn,[Qn,lo(Sn)],(n,[e,t])=>function(s,u,f,g){for(;f<=g;){const b=f+g>>1;if(u[b]===s)return!0;u[b]>s?g=b-1:f=b+1}return!1}(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:Jn,overloads:[[[Jn,Jn],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[xr(Jn),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:Jn,overloads:[[[Jn,Jn],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[xr(Jn),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[Jn,[Jn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Jn,[Qn],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return!t||t(e.evaluate(n))}],upcase:[Qn,[Qn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Qn,[Qn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Qn,xr(Sn),(n,e)=>e.map(t=>Ms(t.evaluate(n))).join("")],"resolved-locale":[Qn,[Wo],(n,[e])=>e.evaluate(n).resolvedLocale()]});var or=fi;function Do(n){return{result:"success",value:n}}function Ds(n){return{result:"error",value:n}}function zo(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function Ro(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function os(n){return!!n.expression&&n.expression.interpolated}function Ai(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function sa(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function Bl(n){return n}function pc(n,e){const t="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],u=s||!(s||void 0!==n.property),f=n.type||(os(e)?"exponential":"interval");if(t&&((n=$r({},n)).stops&&(n.stops=n.stops.map(M=>[M[0],Ui.parse(M[1])])),n.default=Ui.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!xa[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,b,E;if("exponential"===f)g=yu;else if("interval"===f)g=Fa;else if("categorical"===f){g=mc,b=Object.create(null);for(const M of n.stops)b[M[0]]=M[1];E=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=aa}if(s){const M={},N=[];for(let X=0;X<n.stops.length;X++){const K=n.stops[X],oe=K[0].zoom;void 0===M[oe]&&(M[oe]={zoom:oe,type:n.type,property:n.property,default:n.default,stops:[]},N.push(oe)),M[oe].stops.push([K[0].value,K[1]])}const B=[];for(const X of N)B.push([M[X].zoom,pc(M[X],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:q.interpolationFactor.bind(void 0,z),zoomStops:B.map(X=>X[0]),evaluate:({zoom:X},K)=>yu({stops:B,base:n.base},e,X).evaluate(X,K)}}if(u){const M="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:q.interpolationFactor.bind(void 0,M),zoomStops:n.stops.map(N=>N[0]),evaluate:({zoom:N})=>g(n,e,N,b,E)}}return{kind:"source",evaluate(M,N){const B=N&&N.properties?N.properties[n.property]:void 0;return void 0===B?js(n.default,e.default):g(n,e,B,b,E)}}}function js(n,e,t){return void 0!==n?n:void 0!==e?e:void 0!==t?t:void 0}function mc(n,e,t,s,u){return js(typeof t===u?s[t]:void 0,n.default,e.default)}function Fa(n,e,t){if("number"!==Ai(t))return js(n.default,e.default);const s=n.stops.length;if(1===s||t<=n.stops[0][0])return n.stops[0][1];if(t>=n.stops[s-1][0])return n.stops[s-1][1];const u=uo(n.stops.map(f=>f[0]),t);return n.stops[u][1]}function yu(n,e,t){const s=void 0!==n.base?n.base:1;if("number"!==Ai(t))return js(n.default,e.default);const u=n.stops.length;if(1===u||t<=n.stops[0][0])return n.stops[0][1];if(t>=n.stops[u-1][0])return n.stops[u-1][1];const f=uo(n.stops.map(N=>N[0]),t),g=function(N,B,z,X){const K=X-z,oe=N-z;return 0===K?0:1===B?oe/K:(Math.pow(B,oe)-1)/(Math.pow(B,K)-1)}(t,s,n.stops[f][0],n.stops[f+1][0]),b=n.stops[f][1],E=n.stops[f+1][1];let M=ya[e.type]||Bl;if(n.colorSpace&&"rgb"!==n.colorSpace){const N=xa[n.colorSpace];M=(B,z)=>N.reverse(N.interpolate(N.forward(B),N.forward(z),g))}return"function"==typeof b.evaluate?{evaluate(...N){const B=b.evaluate.apply(void 0,N),z=E.evaluate.apply(void 0,N);if(void 0!==B&&void 0!==z)return M(B,z,g)}}:M(b,E,g)}function aa(n,e,t){return"color"===e.type?t=Ui.parse(t):"formatted"===e.type?t=Zo.fromString(t.toString()):"resolvedImage"===e.type?t=Mr.fromString(t.toString()):Ai(t)===e.type||"enum"===e.type&&e.values[t]||(t=void 0),js(t,n.default,e.default)}class zl{constructor(e,t){var s;this.expression=e,this._warningHistory={},this._evaluator=new Sa,this._defaultValue=t?"color"===(s=t).type&&(sa(s.default)||Array.isArray(s.default))?new Ui(0,0,0,0):"color"===s.type?Ui.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,s,u,f,g,b,E){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,s,u,f,g,b,E){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new co(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function gc(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in or}function Vl(n,e){const t=new xs(or,[],e?function(u){const f={color:wr,string:Qn,number:ln,enum:Qn,boolean:Jn,formatted:ps,resolvedImage:ms};return"array"===u.type?lo(f[u.value]||Sn,u.length):f[u.type]}(e):void 0),s=t.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Do(new zl(s,e)):Ds(t.errors)}class $u{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Eo(t.expression)}evaluateWithoutErrorHandling(e,t,s,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,s,u,f,g)}evaluate(e,t,s,u,f,g){return this._styleExpression.evaluate(e,t,s,u,f,g)}}class vu{constructor(e,t,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Eo(t.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,t,s,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,s,u,f,g)}evaluate(e,t,s,u,f,g){return this._styleExpression.evaluate(e,t,s,u,f,g)}interpolationFactor(e,t,s){return this.interpolationType?q.interpolationFactor(this.interpolationType,e,t,s):0}}function Ul(n,e){if("error"===(n=Vl(n,e)).result)return n;const t=n.value.expression,s=mr(t);if(!s&&!zo(e))return Ds([new Tr("","data expressions not supported")]);const u=Ra(t,["zoom","pitch","distance-from-center"]);if(!u&&!Ro(e))return Ds([new Tr("","zoom expressions not supported")]);const f=Gl(t);return f||u?f instanceof Tr?Ds([f]):f instanceof q&&!os(e)?Ds([new Tr("",'"interpolate" expressions cannot be used with this property')]):Do(f?new vu(s?"camera":"composite",n.value,f.labels,f instanceof q?f.interpolation:void 0):new $u(s?"constant":"source",n.value)):Ds([new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jl{constructor(e,t){this._parameters=e,this._specification=t,$r(this,pc(this._parameters,this._specification))}static deserialize(e){return new jl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gl(n){let e=null;if(n instanceof On)e=Gl(n.result);else if(n instanceof ue){for(const t of n.args)if(e=Gl(t),e)break}else(n instanceof _a||n instanceof q)&&n.input instanceof wo&&"zoom"===n.input.name&&(e=n);return e instanceof Tr||n.eachChild(t=>{const s=Gl(t);s instanceof Tr?e=s:!e&&s?e=new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class bn{constructor(e,t,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=t&&t.__line__&&(this.line=t.__line__)}}function Os(n){const e=n.key,t=n.value,s=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,g=n.styleSpec;let b=[];const E=Ai(t);if("object"!==E)return[new bn(e,t,`object expected, ${E} found`)];for(const M in t){const N=M.split(".")[0],B=s[N]||s["*"];let z;u[N]?z=u[N]:s[N]?z=Uo:u["*"]?z=u["*"]:s["*"]&&(z=Uo),z?b=b.concat(z({key:(e&&`${e}.`)+M,value:t[M],valueSpec:B,style:f,styleSpec:g,object:t,objectKey:M},t)):b.push(new bn(e,t[M],`unknown property "${M}"`))}for(const M in s)u[M]||s[M].required&&void 0===s[M].default&&void 0===t[M]&&b.push(new bn(e,t,`missing required property "${M}"`));return b}function Hc(n){const e=n.value,t=n.valueSpec,s=n.style,u=n.styleSpec,f=n.key,g=n.arrayElementValidator||Uo;if("array"!==Ai(e))return[new bn(f,e,`array expected, ${Ai(e)} found`)];if(t.length&&e.length!==t.length)return[new bn(f,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new bn(f,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let b={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};u.$version<7&&(b.function=t.function),"object"===Ai(t.value)&&(b=t.value);let E=[];for(let M=0;M<e.length;M++)E=E.concat(g({array:e,arrayIndex:M,value:e[M],valueSpec:b,style:s,styleSpec:u,key:`${f}[${M}]`}));return E}function La(n){const e=n.key,t=n.value,s=n.valueSpec;let u=Ai(t);if("number"===u&&t!=t&&(u="NaN"),"number"!==u)return[new bn(e,t,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===Ai(s.minimum)&&(f=s.minimum[n.arrayIndex]),t<f)return[new bn(e,t,`${t} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===Ai(s.maximum)&&(f=s.maximum[n.arrayIndex]),t>f)return[new bn(e,t,`${t} is greater than the maximum value ${f}`)]}return[]}function $l(n){const e=n.valueSpec,t=$i(n.value.type);let s,u,f,g={};const b="categorical"!==t&&void 0===n.value.property,E=!b,M="array"===Ai(n.value.stops)&&"array"===Ai(n.value.stops[0])&&"object"===Ai(n.value.stops[0][0]),N=Os({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(X){if("identity"===t)return[new bn(X.key,X.value,'identity function may not have a "stops" property')];let K=[];const oe=X.value;return K=K.concat(Hc({key:X.key,value:oe,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:B})),"array"===Ai(oe)&&0===oe.length&&K.push(new bn(X.key,oe,"array must have at least one stop")),K},default:function(X){return Uo({key:X.key,value:X.value,valueSpec:e,style:X.style,styleSpec:X.styleSpec})}}});return"identity"===t&&b&&N.push(new bn(n.key,n.value,'missing required property "property"')),"identity"===t||n.value.stops||N.push(new bn(n.key,n.value,'missing required property "stops"')),"exponential"===t&&n.valueSpec.expression&&!os(n.valueSpec)&&N.push(new bn(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(E&&!zo(n.valueSpec)?N.push(new bn(n.key,n.value,"property functions not supported")):b&&!Ro(n.valueSpec)&&N.push(new bn(n.key,n.value,"zoom functions not supported"))),"categorical"!==t&&!M||void 0!==n.value.property||N.push(new bn(n.key,n.value,'"property" property is required')),N;function B(X){let K=[];const oe=X.value,pe=X.key;if("array"!==Ai(oe))return[new bn(pe,oe,`array expected, ${Ai(oe)} found`)];if(2!==oe.length)return[new bn(pe,oe,`array length 2 expected, length ${oe.length} found`)];if(M){if("object"!==Ai(oe[0]))return[new bn(pe,oe,`object expected, ${Ai(oe[0])} found`)];if(void 0===oe[0].zoom)return[new bn(pe,oe,"object stop key must have zoom")];if(void 0===oe[0].value)return[new bn(pe,oe,"object stop key must have value")];const Ce=$i(oe[0].zoom);if("number"!=typeof Ce)return[new bn(pe,oe[0].zoom,"stop zoom values must be numbers")];if(f&&f>Ce)return[new bn(pe,oe[0].zoom,"stop zoom values must appear in ascending order")];Ce!==f&&(f=Ce,u=void 0,g={}),K=K.concat(Os({key:`${pe}[0]`,value:oe[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:La,value:z}}))}else K=K.concat(z({key:`${pe}[0]`,value:oe[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},oe));return gc(Xn(oe[1]))?K.concat([new bn(`${pe}[1]`,oe[1],"expressions are not allowed in function stops.")]):K.concat(Uo({key:`${pe}[1]`,value:oe[1],valueSpec:e,style:X.style,styleSpec:X.styleSpec}))}function z(X,K){const oe=Ai(X.value),pe=$i(X.value),Ce=null!==X.value?X.value:K;if(s){if(oe!==s)return[new bn(X.key,Ce,`${oe} stop domain type must match previous stop domain type ${s}`)]}else s=oe;if("number"!==oe&&"string"!==oe&&"boolean"!==oe&&"number"!=typeof pe&&"string"!=typeof pe&&"boolean"!=typeof pe)return[new bn(X.key,Ce,"stop domain value must be a number, string, or boolean")];if("number"!==oe&&"categorical"!==t){let Fe=`number expected, ${oe} found`;return zo(e)&&void 0===t&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bn(X.key,Ce,Fe)]}return"categorical"!==t||"number"!==oe||"number"==typeof pe&&isFinite(pe)&&Math.floor(pe)===pe?"categorical"!==t&&"number"===oe&&"number"==typeof pe&&"number"==typeof u&&void 0!==u&&pe<u?[new bn(X.key,Ce,"stop domain values must appear in ascending order")]:(u=pe,"categorical"===t&&pe in g?[new bn(X.key,Ce,"stop domain values must be unique")]:(g[pe]=!0,[])):[new bn(X.key,Ce,`integer expected, found ${String(pe)}`)]}}function Vo(n){const e=("property"===n.expressionContext?Ul:Vl)(Xn(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new bn(`${n.key}${s.key}`,n.value,s.message));const t=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!t.outputDefined())return[new bn(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!Eo(t))return[new bn(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return bu(t,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Ra(t,["zoom","feature-state"]))return[new bn(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!mr(t))return[new bn(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bu(n,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)t.delete(u);if(0===t.size)return[];const s=[];return n instanceof wo&&t.has(n.name)?[new bn(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{s.push(...bu(u,e))}),s)}function xl(n){const e=n.key,t=n.value,s=n.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf($i(t))&&u.push(new bn(e,t,`expected one of [${s.values.join(", ")}], ${JSON.stringify(t)} found`)):-1===Object.keys(s.values).indexOf($i(t))&&u.push(new bn(e,t,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(t)} found`)),u}function Wc(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Wc(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Hl(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wc(n)||(n=yc(n));const t=n;let s=!0;try{s=function(M){if(!Mo(M))return M;let N=Xn(M);return _c(N),N=Hu(N),N}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(t,null,2)}\n        `)}const u=at[`filter_${e}`],f=Vl(s,u);let g=null;if("error"===f.result)throw new Error(f.value.map(M=>`${M.key}: ${M.message}`).join(", "));g=(M,N,B)=>f.value.evaluate(M,N,{},B);let b=null,E=null;if(s!==t){const M=Vl(t,u);if("error"===M.result)throw new Error(M.value.map(N=>`${N.key}: ${N.message}`).join(", "));b=(N,B,z,X,K)=>M.value.evaluate(N,B,{},z,void 0,void 0,X,K),E=!mr(M.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:Zc(s),needFeature:!!E}}function Hu(n){if(!Array.isArray(n))return n;const e=function(t){if(Wu.has(t[0]))for(let s=1;s<t.length;s++)if(Mo(t[s]))return!0;return t}(n);return!0===e?e:e.map(t=>Hu(t))}function _c(n){let e=!1;const t=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||Mo(n[s]),t.push(n[s+1]);t.push(n[n.length-1])}else if("match"===n[0]){e=e||Mo(n[1]);for(let s=2;s<n.length-1;s+=2)t.push(n[s+1]);t.push(n[n.length-1])}else if("step"===n[0]){e=e||Mo(n[1]);for(let s=1;s<n.length-1;s+=2)t.push(n[s+1])}e&&(n.length=0,n.push("any",...t));for(let s=1;s<n.length;s++)_c(n[s])}function Mo(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let t=1;t<n.length;t++)if(Mo(n[t]))return!0;return!1}const Wu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wl(n,e){return n<e?-1:n>e?1:0}function Zc(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Zc(n[e]))return!0;return!1}function yc(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?tl(n[1],n[2],"=="):"!="===e?Xo(tl(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?tl(n[1],n[2],e):"any"===e?(t=n.slice(1),["any"].concat(t.map(yc))):"all"===e?["all"].concat(n.slice(1).map(yc)):"none"===e?["all"].concat(n.slice(1).map(yc).map(Xo)):"in"===e?nl(n[1],n.slice(2)):"!in"===e?Xo(nl(n[1],n.slice(2))):"has"===e?vc(n[1]):"!has"===e?Xo(vc(n[1])):"within"!==e||n;var t}function tl(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function nl(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(wl)]]:["filter-in-small",n,["literal",e]]}}function vc(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Xo(n){return["!",n]}function To(n){return Wc(Xn(n.value))?Vo($r({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Zu(n)}function Zu(n){const e=n.value,t=n.key;if("array"!==Ai(e))return[new bn(t,e,`array expected, ${Ai(e)} found`)];const s=n.styleSpec;let u,f=[];if(e.length<1)return[new bn(t,e,"filter array must have at least 1 element")];switch(f=f.concat(xl({key:`${t}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),$i(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===$i(e[1])&&f.push(new bn(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new bn(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Ai(e[1]),"string"!==u&&f.push(new bn(`${t}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=Ai(e[g]),"$type"===$i(e[1])?f=f.concat(xl({key:`${t}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new bn(`${t}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(Zu({key:`${t}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Ai(e[1]),2!==e.length?f.push(new bn(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new bn(`${t}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Ai(e[1]),2!==e.length?f.push(new bn(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new bn(`${t}[1]`,e[1],`object expected, ${u} found`))}return f}function qc(n,e){const t=n.key,s=n.style,u=n.styleSpec,f=n.value,g=n.objectKey,b=u[`${e}_${n.layerType}`];if(!b)return[];const E=g.match(/^(.*)-transition$/);if("paint"===e&&E&&b[E[1]]&&b[E[1]].transition)return Uo({key:t,value:f,valueSpec:u.transition,style:s,styleSpec:u});const M=n.valueSpec||b[g];if(!M)return[new bn(t,f,`unknown property "${g}"`)];let N;if("string"===Ai(f)&&zo(M)&&!M.tokens&&(N=/^{([^}]+)}$/.exec(f)))return[new bn(t,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const B=[];return"symbol"===n.layerType&&("text-field"===g&&s&&!s.glyphs&&B.push(new bn(t,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&sa(Xn(f))&&"identity"===$i(f.type)&&B.push(new bn(t,f,'"text-font" does not support identity functions'))),B.concat(Uo({key:n.key,value:f,valueSpec:M,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function no(n){return qc(n,"paint")}function yo(n){return qc(n,"layout")}function ho(n){let e=[];const t=n.value,s=n.key,u=n.style,f=n.styleSpec;t.type||t.ref||e.push(new bn(s,t,'either "type" or "ref" is required'));let g=$i(t.type);const b=$i(t.ref);if(t.id){const E=$i(t.id);for(let M=0;M<n.arrayIndex;M++){const N=u.layers[M];$i(N.id)===E&&e.push(new bn(s,t.id,`duplicate layer id "${t.id}", previously used at line ${N.id.__line__}`))}}if("ref"in t){let E;["type","source","source-layer","filter","layout"].forEach(M=>{M in t&&e.push(new bn(s,t[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{$i(M.id)===b&&(E=M)}),E?E.ref?e.push(new bn(s,t.ref,"ref cannot reference another ref layer")):g=$i(E.type):"string"==typeof b&&e.push(new bn(s,t.ref,`ref layer "${b}" not found`))}else if("background"!==g&&"sky"!==g)if(t.source){const E=u.sources&&u.sources[t.source],M=E&&$i(E.type);E?"vector"===M&&"raster"===g?e.push(new bn(s,t.source,`layer "${t.id}" requires a raster source`)):"raster"===M&&"raster"!==g?e.push(new bn(s,t.source,`layer "${t.id}" requires a vector source`)):"vector"!==M||t["source-layer"]?"raster-dem"===M&&"hillshade"!==g?e.push(new bn(s,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||"geojson"===M&&E.lineMetrics||e.push(new bn(s,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new bn(s,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new bn(s,t.source,`source "${t.source}" not found`))}else e.push(new bn(s,t,'missing required property "source"'));return e=e.concat(Os({key:s,value:t,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Uo({key:`${s}.type`,value:t.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:t,objectKey:"type"}),filter:E=>To($r({layerType:g},E)),layout:E=>Os({layer:t,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>yo($r({layerType:g},M))}}),paint:E=>Os({layer:t,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>no($r({layerType:g},M))}})}})),e}function ss(n){const e=n.value,t=n.key,s=Ai(e);return"string"!==s?[new bn(t,e,`string expected, ${s} found`)]:[]}const Ba={promoteId:function({key:n,value:e}){if("string"===Ai(e))return ss({key:n,value:e});{const t=[];for(const s in e)t.push(...ss({key:`${n}.${s}`,value:e[s]}));return t}}};function Yc(n){const e=n.value,t=n.key,s=n.styleSpec,u=n.style;if(!e.type)return[new bn(t,e,'"type" is required')];const f=$i(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=Os({key:t,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:Ba}),g;case"geojson":if(g=Os({key:t,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:Ba}),e.cluster)for(const b in e.clusterProperties){const[E,M]=e.clusterProperties[b],N="string"==typeof E?[E,["accumulated"],["get",b]]:E;g.push(...Vo({key:`${t}.${b}.map`,value:M,expressionContext:"cluster-map"})),g.push(...Vo({key:`${t}.${b}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return g;case"video":return Os({key:t,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Os({key:t,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new bn(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xl({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:s})}}function Wl(n){const e=n.value,t=n.styleSpec,s=t.light,u=n.style;let f=[];const g=Ai(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new bn("light",e,`object expected, ${g} found`)]),f;for(const b in e){const E=b.match(/^(.*)-transition$/);f=f.concat(E&&s[E[1]]&&s[E[1]].transition?Uo({key:b,value:e[b],valueSpec:t.transition,style:u,styleSpec:t}):s[b]?Uo({key:b,value:e[b],valueSpec:s[b],style:u,styleSpec:t}):[new bn(b,e[b],`unknown property "${b}"`)])}return f}function Zl(n){const e=n.value,t=n.key,s=n.style,u=n.styleSpec,f=u.terrain;let g=[];const b=Ai(e);if(void 0===e)return g;if("object"!==b)return g=g.concat([new bn("terrain",e,`object expected, ${b} found`)]),g;for(const E in e){const M=E.match(/^(.*)-transition$/);g=g.concat(M&&f[M[1]]&&f[M[1]].transition?Uo({key:E,value:e[E],valueSpec:u.transition,style:s,styleSpec:u}):f[E]?Uo({key:E,value:e[E],valueSpec:f[E],style:s,styleSpec:u}):[new bn(E,e[E],`unknown property "${E}"`)])}if(e.source){const E=s.sources&&s.sources[e.source],M=E&&$i(E.type);E?"raster-dem"!==M&&g.push(new bn(t,e.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):g.push(new bn(t,e.source,`source "${e.source}" not found`))}else g.push(new bn(t,e,'terrain is missing required property "source"'));return g}function qu(n){const e=n.value,t=n.style,s=n.styleSpec,u=s.fog;let f=[];const g=Ai(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new bn("fog",e,`object expected, ${g} found`)]),f;for(const b in e){const E=b.match(/^(.*)-transition$/);f=f.concat(E&&u[E[1]]&&u[E[1]].transition?Uo({key:b,value:e[b],valueSpec:s.transition,style:t,styleSpec:s}):u[b]?Uo({key:b,value:e[b],valueSpec:u[b],style:t,styleSpec:s}):[new bn(b,e[b],`unknown property "${b}"`)])}return f}const za={"*":()=>[],array:Hc,boolean:function(n){const e=n.value,t=n.key,s=Ai(e);return"boolean"!==s?[new bn(t,e,`boolean expected, ${s} found`)]:[]},number:La,color:function(n){const e=n.key,t=n.value,s=Ai(t);return"string"!==s?[new bn(e,t,`color expected, ${s} found`)]:null===eo.parseCSSColor(t)?[new bn(e,t,`color expected, "${t}" found`)]:[]},enum:xl,filter:To,function:$l,layer:ho,object:Os,source:Yc,light:Wl,terrain:Zl,fog:qu,string:ss,formatted:function(n){return 0===ss(n).length?[]:Vo(n)},resolvedImage:function(n){return 0===ss(n).length?[]:Vo(n)},projection:function(n){const e=n.value,t=n.styleSpec,s=t.projection,u=n.style;let f=[];const g=Ai(e);if("object"===g)for(const b in e)f=f.concat(Uo({key:b,value:e[b],valueSpec:s[b],style:u,styleSpec:t}));else"string"!==g&&(f=f.concat([new bn("projection",e,`object or string expected, ${g} found`)]));return f}};function Uo(n){const e=n.value,t=n.valueSpec,s=n.styleSpec;return t.expression&&sa($i(e))?$l(n):t.expression&&gc(Xn(e))?Vo(n):t.type&&za[t.type]?za[t.type](n):Os($r({},n,{valueSpec:t.type?s[t.type]:t}))}function xu(n){const e=n.value,t=n.key,s=ss(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new bn(t,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new bn(t,e,'"glyphs" url must include a "{range}" token'))),s}function Dl(n,e=at){return as(Uo({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:xu,"*":()=>[]}}))}const Rs=n=>as(no(n)),ql=n=>as(yo(n));function as(n){return n.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Ns(n,e){let t=!1;if(e&&e.length)for(const s of e)n.fire(new jn(new Error(s.message))),t=!0;return t}var Hr=Jo;function Jo(n,e,t){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(t=u[2]);for(var f=0;f<this.d*this.d;f++){var g=u[3+f],b=u[3+f+1];s.push(g===b?null:u.subarray(g,b))}var E=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],E),this.bboxes=u.subarray(E),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var M=0;M<this.d*this.d;M++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=t,this.scale=e/n,this.uid=0;var N=t/e*n;this.min=-N,this.max=n+N}Jo.prototype.insert=function(n,e,t,s,u){this._forEachCell(e,t,s,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(s),this.bboxes.push(u)},Jo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Jo.prototype._insertCell=function(n,e,t,s,u,f){this.cells[u].push(f)},Jo.prototype.query=function(n,e,t,s,u){var f=this.min,g=this.max;if(n<=f&&e<=f&&g<=t&&g<=s&&!u)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(n,e,t,s,this._queryCell,b,{},u),b},Jo.prototype._queryCell=function(n,e,t,s,u,f,g,b){var E=this.cells[u];if(null!==E)for(var M=this.keys,N=this.bboxes,B=0;B<E.length;B++){var z=E[B];if(void 0===g[z]){var X=4*z;(b?b(N[X+0],N[X+1],N[X+2],N[X+3]):n<=N[X+2]&&e<=N[X+3]&&t>=N[X+0]&&s>=N[X+1])?(g[z]=!0,f.push(M[z])):g[z]=!1}}},Jo.prototype._forEachCell=function(n,e,t,s,u,f,g,b){for(var E=this._convertToCellCoord(n),M=this._convertToCellCoord(e),N=this._convertToCellCoord(t),B=this._convertToCellCoord(s),z=E;z<=N;z++)for(var X=M;X<=B;X++){var K=this.d*X+z;if((!b||b(this._convertFromCellCoord(z),this._convertFromCellCoord(X),this._convertFromCellCoord(z+1),this._convertFromCellCoord(X+1)))&&u.call(this,n,e,t,s,K,f,g,b))return}},Jo.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Jo.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Jo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,t=0,s=0;s<this.cells.length;s++)t+=this.cells[s].length;var u=new Int32Array(e+t+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,g=0;g<n.length;g++){var b=n[g];u[3+g]=f,u.set(b,f),f+=b.length}return u[3+n.length]=f,u.set(this.keys,f),u[3+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const Xc={};function Dn(n,e,t={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Xc[e]={klass:n,omit:t.omit||[]}}Dn(Object,"Object"),Hr.serialize=function(n,e){const t=n.toArrayBuffer();return e&&e.push(t),{buffer:t}},Hr.deserialize=function(n){return new Hr(n.buffer)},Object.defineProperty(Hr,"name",{value:"Grid"}),Dn(Hr,"Grid"),Dn(Ui,"Color"),Dn(Error,"Error"),Dn(nt,"AJAXError"),Dn(Mr,"ResolvedImage"),Dn(jl,"StylePropertyFunction"),Dn(zl,"StyleExpression",{omit:["_evaluator"]}),Dn(vu,"ZoomDependentExpression"),Dn($u,"ZoomConstantExpression"),Dn(wo,"CompoundExpression",{omit:["_evaluate"]});for(const n in or)Xc[or[n]._classRegistryKey]||Dn(or[n],`Expression${n}`);function Qi(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function Td(n){return ze.ImageBitmap&&n instanceof ze.ImageBitmap}function bc(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Qi(n)||Td(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const t=n;return e&&e.push(t.buffer),t}if(n instanceof ze.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const t=[];for(const s of n)t.push(bc(s,e));return t}if("object"==typeof n){const t=n.constructor,s=t._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=t.serialize?t.serialize(n,e):{};if(!t.serialize){for(const f in n)n.hasOwnProperty(f)&&(Xc[s].omit.indexOf(f)>=0||(u[f]=bc(n[f],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof n)}function Yl(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Qi(n)||Td(n)||ArrayBuffer.isView(n)||n instanceof ze.ImageData)return n;if(Array.isArray(n))return n.map(Yl);if("object"==typeof n){const e=n.$name||"Object",{klass:t}=Xc[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(n);const s=Object.create(t.prototype);for(const u of Object.keys(n))"$name"!==u&&(s[u]=Yl(n[u]));return s}throw new Error("can't deserialize object of type "+typeof n)}class wu{constructor(){this.first=!0}update(e,t){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Yu=n=>n>=1536&&n<=1791,Xu=n=>n>=1872&&n<=1919,Jc=n=>n>=2208&&n<=2303,Xl=n=>n>=11904&&n<=12031,Du=n=>n>=12032&&n<=12255,Tu=n=>n>=12272&&n<=12287,io=n=>n>=12288&&n<=12351,Kc=n=>n>=12352&&n<=12447,wa=n=>n>=12448&&n<=12543,oh=n=>n>=12544&&n<=12591,Qc=n=>n>=12704&&n<=12735,vo=n=>n>=12736&&n<=12783,Gs=n=>n>=12784&&n<=12799,Va=n=>n>=12800&&n<=13055,Ua=n=>n>=13056&&n<=13311,Jl=n=>n>=13312&&n<=19903,O=n=>n>=19968&&n<=40959,k=n=>n>=40960&&n<=42127,A=n=>n>=42128&&n<=42191,U=n=>n>=44032&&n<=55215,Y=n=>n>=63744&&n<=64255,ae=n=>n>=64336&&n<=65023,Ie=n=>n>=65040&&n<=65055,ke=n=>n>=65072&&n<=65103,Tt=n=>n>=65104&&n<=65135,En=n=>n>=65136&&n<=65279,gi=n=>n>=65280&&n<=65519;function gn(n){for(const e of n)if($s(e.charCodeAt(0)))return!0;return!1}function er(n){for(const e of n)if(!ls(e.charCodeAt(0)))return!1;return!0}function ls(n){return!(Yu(n)||Xu(n)||Jc(n)||ae(n)||En(n))}function $s(n){return!(746!==n&&747!==n&&(n<4352||!(Qc(n)||oh(n)||ke(n)&&!(n>=65097&&n<=65103)||Y(n)||Ua(n)||Xl(n)||vo(n)||!(!io(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||Jl(n)||O(n)||Va(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||U(n)||Kc(n)||Tu(n)||(e=>e>=12688&&e<=12703)(n)||Du(n)||Gs(n)||wa(n)&&12540!==n||!(!gi(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Tt(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||Ie(n)||(e=>e>=19904&&e<=19967)(n)||k(n)||A(n))));var e}function la(n){return!($s(n)||(e=n,(t=e)>=128&&t<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(t=>t>=8192&&t<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&9251!==e||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||io(e)||wa(e)||(t=>t>=57344&&t<=63743)(e)||ke(e)||Tt(e)||gi(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,t}function d(n){return n>=1424&&n<=2303||ae(n)||En(n)}function i(n,e){return!(!e&&d(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(t=n,t>=6016&&t<=6143));var t}function l(n){for(const e of n)if(d(e.charCodeAt(0)))return!0;return!1}const m="deferred",x="loading",w="loaded";let S=null,P="unavailable",F=null;const $=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(P="error"),S&&S(n)};function Z(){ne.fire(new Vn("pluginStateChange",{pluginStatus:P,pluginURL:F}))}const ne=new In,se=function(){return P},ve=function(){if(P!==m||!F)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");P=x,Z(),F&&Ke({url:F},n=>{n?$(n):(P=w,Z())})},de={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>P===w||null!=de.applyArabicShaping,isLoading:()=>P===x,setState(n){P=n.pluginStatus,F=n.pluginURL},isParsed:()=>null!=de.applyArabicShaping&&null!=de.processBidirectionalText&&null!=de.processStyledBidirectionalText,getPluginURL:()=>F};class me{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wu,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,s){for(const u of t)if(!i(u.charCodeAt(0),s))return!1;return!0}(e,de.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*t}}}class ge{constructor(e,t){this.property=e,this.value=t,this.expression=function(s,u){if(sa(s))return new jl(s,u);if(gc(s)){const f=Ul(s,u);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=Ui.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,s){return this.property.possiblyEvaluate(this,e,t,s)}}class fe{constructor(e){this.property=e,this.value=new ge(e,void 0)}transitioned(e,t){return new we(this.property,this.value,t,Zt({},e.transition,this.transition),e.now)}untransitioned(){return new we(this.property,this.value,null,{},0)}}class De{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return rn(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new fe(this._values[e].property)),this._values[e].value=new ge(this._values[e].property,null===t?void 0:rn(t))}getTransition(e){return rn(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new fe(this._values[e].property)),this._values[e].transition=rn(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const s=this.getValue(t);void 0!==s&&(e[t]=s);const u=this.getTransition(t);void 0!==u&&(e[`${t}-transition`]=u)}return e}transitioned(e,t){const s=new qe(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,t._values[u]);return s}untransitioned(){const e=new qe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class we{constructor(e,t,s,u,f){const g=u.delay||0,b=u.duration||0;f=f||0,this.property=e,this.value=t,this.begin=f+g,this.end=this.begin+b,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,t,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,t,s),g=this.prior;if(g){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return g.possiblyEvaluate(e,t,s);{const b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,t,s),f,Xt(b))}}return f}}class qe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,s){const u=new je(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,t,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ue{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return rn(this._values[e].value)}setValue(e,t){this._values[e]=new ge(this._values[e].property,null===t?void 0:rn(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const s=this.getValue(t);void 0!==s&&(e[t]=s)}return e}possiblyEvaluate(e,t,s){const u=new je(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,t,s);return u}}class Ne{constructor(e,t,s){this.property=e,this.value=t,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,s,u){return this.property.evaluate(this.value,this.parameters,e,t,s,u)}}class je{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Le{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,s){const u=ya[this.specification.type];return u?u(e,t,s):e}}class Je{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,s,u){return new Ne(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},s,u)}:e.expression,t)}interpolate(e,t,s){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ne(this,{kind:"constant",value:void 0},e.parameters);const u=ya[this.specification.type];return u?new Ne(this,{kind:"constant",value:u(e.value.value,t.value.value,s)},e.parameters):e}evaluate(e,t,s,u,f,g){return"constant"===e.kind?e.value:e.evaluate(t,s,u,f,g)}}class tt extends Je{possiblyEvaluate(e,t,s,u){if(void 0===e.value)return new Ne(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const f=e.expression.evaluate(t,null,{},s,u),g="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,b=this._calculate(g,g,g,t);return new Ne(this,{kind:"constant",value:b},t)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Ne(this,{kind:"constant",value:f},t)}return new Ne(this,e.expression,t)}evaluate(e,t,s,u,f,g){if("source"===e.kind){const b=e.evaluate(t,s,u,f,g);return this._calculate(b,b,b,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},s,u),e.evaluate({zoom:Math.floor(t.zoom)},s,u),e.evaluate({zoom:Math.floor(t.zoom)+1},s,u),t):e.value}_calculate(e,t,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:t,other:s}:{from:s,to:t,other:e}}interpolate(e){return e}}class nn{constructor(e){this.specification=e}possiblyEvaluate(e,t,s,u){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(t,null,{},s,u);return this._calculate(f,f,f,t)}return this._calculate(e.expression.evaluate(new me(Math.floor(t.zoom-1),t)),e.expression.evaluate(new me(Math.floor(t.zoom),t)),e.expression.evaluate(new me(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:s,to:t}}interpolate(e){return e}}class rt{constructor(e){this.specification=e}possiblyEvaluate(e,t,s,u){return!!e.expression.evaluate(t,null,{},s,u)}interpolate(){return!1}}class Pt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new me(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new ge(u,void 0),g=this.defaultTransitionablePropertyValues[s]=new fe(u);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(t)}}}function Bt(n,e){return 256*(n=on(Math.floor(n),0,255))+on(Math.floor(e),0,255)}Dn(Je,"DataDrivenProperty"),Dn(Le,"DataConstantProperty"),Dn(tt,"CrossFadedDataDrivenProperty"),Dn(nn,"CrossFadedProperty"),Dn(rt,"ColorRampProperty");const un={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _t{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class en{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function kt(n,e=1){let t=0,s=0;return{members:n.map(u=>{const f=un[u.type].BYTES_PER_ELEMENT,g=t=yn(t,Math.max(e,f)),b=u.components||1;return s=Math.max(s,f),t+=f*b,{name:u.name,type:u.type,components:b,offset:g}}),size:yn(t,Math.max(s,e)),alignment:e}}function yn(n,e){return Math.ceil(n/e)*e}class fn extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const s=this.length;return this.resize(s+1),this.emplace(s,e,t)}emplace(e,t,s){const u=2*e;return this.int16[u+0]=t,this.int16[u+1]=s,e}}fn.prototype.bytesPerElement=4,Dn(fn,"StructArrayLayout2i4");class Fn extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,s)}emplace(e,t,s,u){const f=3*e;return this.int16[f+0]=t,this.int16[f+1]=s,this.int16[f+2]=u,e}}Fn.prototype.bytesPerElement=6,Dn(Fn,"StructArrayLayout3i6");class $n extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const g=4*e;return this.int16[g+0]=t,this.int16[g+1]=s,this.int16[g+2]=u,this.int16[g+3]=f,e}}$n.prototype.bytesPerElement=8,Dn($n,"StructArrayLayout4i8");class ci extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,t,s,u,f,g,b)}emplace(e,t,s,u,f,g,b,E){const M=6*e,N=12*e,B=3*e;return this.int16[M+0]=t,this.int16[M+1]=s,this.uint8[N+4]=u,this.uint8[N+5]=f,this.uint8[N+6]=g,this.uint8[N+7]=b,this.float32[B+2]=E,e}}ci.prototype.bytesPerElement=12,Dn(ci,"StructArrayLayout2i4ub1f12");class Fi extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const g=4*e;return this.float32[g+0]=t,this.float32[g+1]=s,this.float32[g+2]=u,this.float32[g+3]=f,e}}Fi.prototype.bytesPerElement=16,Dn(Fi,"StructArrayLayout4f16");class Bn extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b,E,M,N){const B=this.length;return this.resize(B+1),this.emplace(B,e,t,s,u,f,g,b,E,M,N)}emplace(e,t,s,u,f,g,b,E,M,N,B){const z=10*e;return this.uint16[z+0]=t,this.uint16[z+1]=s,this.uint16[z+2]=u,this.uint16[z+3]=f,this.uint16[z+4]=g,this.uint16[z+5]=b,this.uint16[z+6]=E,this.uint16[z+7]=M,this.uint16[z+8]=N,this.uint16[z+9]=B,e}}Bn.prototype.bytesPerElement=20,Dn(Bn,"StructArrayLayout10ui20");class mi extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,t,s,u,f,g,b,E)}emplace(e,t,s,u,f,g,b,E,M){const N=8*e;return this.uint16[N+0]=t,this.uint16[N+1]=s,this.uint16[N+2]=u,this.uint16[N+3]=f,this.uint16[N+4]=g,this.uint16[N+5]=b,this.uint16[N+6]=E,this.uint16[N+7]=M,e}}mi.prototype.bytesPerElement=16,Dn(mi,"StructArrayLayout8ui16");class ji extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,s,u,f,g)}emplace(e,t,s,u,f,g,b){const E=6*e;return this.int16[E+0]=t,this.int16[E+1]=s,this.int16[E+2]=u,this.int16[E+3]=f,this.int16[E+4]=g,this.int16[E+5]=b,e}}ji.prototype.bytesPerElement=12,Dn(ji,"StructArrayLayout6i12");class Br extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b,E,M,N,B,z){const X=this.length;return this.resize(X+1),this.emplace(X,e,t,s,u,f,g,b,E,M,N,B,z)}emplace(e,t,s,u,f,g,b,E,M,N,B,z,X){const K=12*e;return this.int16[K+0]=t,this.int16[K+1]=s,this.int16[K+2]=u,this.int16[K+3]=f,this.uint16[K+4]=g,this.uint16[K+5]=b,this.uint16[K+6]=E,this.uint16[K+7]=M,this.int16[K+8]=N,this.int16[K+9]=B,this.int16[K+10]=z,this.int16[K+11]=X,e}}Br.prototype.bytesPerElement=24,Dn(Br,"StructArrayLayout4i4ui4i24");class fo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,s,u,f,g)}emplace(e,t,s,u,f,g,b){const E=10*e,M=5*e;return this.int16[E+0]=t,this.int16[E+1]=s,this.int16[E+2]=u,this.float32[M+2]=f,this.float32[M+3]=g,this.float32[M+4]=b,e}}fo.prototype.bytesPerElement=20,Dn(fo,"StructArrayLayout3i3f20");class gr extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}gr.prototype.bytesPerElement=4,Dn(gr,"StructArrayLayout1ul4");class Ts extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b,E,M,N,B,z,X){const K=this.length;return this.resize(K+1),this.emplace(K,e,t,s,u,f,g,b,E,M,N,B,z,X)}emplace(e,t,s,u,f,g,b,E,M,N,B,z,X,K){const oe=20*e,pe=10*e;return this.int16[oe+0]=t,this.int16[oe+1]=s,this.int16[oe+2]=u,this.int16[oe+3]=f,this.int16[oe+4]=g,this.float32[pe+3]=b,this.float32[pe+4]=E,this.float32[pe+5]=M,this.float32[pe+6]=N,this.int16[oe+14]=B,this.uint32[pe+8]=z,this.uint16[oe+18]=X,this.uint16[oe+19]=K,e}}Ts.prototype.bytesPerElement=40,Dn(Ts,"StructArrayLayout5i4f1i1ul2ui40");class Da extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,t,s,u,f,g,b)}emplace(e,t,s,u,f,g,b,E){const M=8*e;return this.int16[M+0]=t,this.int16[M+1]=s,this.int16[M+2]=u,this.int16[M+4]=f,this.int16[M+5]=g,this.int16[M+6]=b,this.int16[M+7]=E,e}}Da.prototype.bytesPerElement=16,Dn(Da,"StructArrayLayout3i2i2i16");class Kl extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,s,u,f)}emplace(e,t,s,u,f,g){const b=4*e,E=8*e;return this.float32[b+0]=t,this.float32[b+1]=s,this.float32[b+2]=u,this.int16[E+6]=f,this.int16[E+7]=g,e}}Kl.prototype.bytesPerElement=16,Dn(Kl,"StructArrayLayout2f1f2i16");class Ir extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const g=12*e,b=3*e;return this.uint8[g+0]=t,this.uint8[g+1]=s,this.float32[b+1]=u,this.float32[b+2]=f,e}}Ir.prototype.bytesPerElement=12,Dn(Ir,"StructArrayLayout2ub2f12");class Wr extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,s)}emplace(e,t,s,u){const f=3*e;return this.float32[f+0]=t,this.float32[f+1]=s,this.float32[f+2]=u,e}}Wr.prototype.bytesPerElement=12,Dn(Wr,"StructArrayLayout3f12");class bi extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,s)}emplace(e,t,s,u){const f=3*e;return this.uint16[f+0]=t,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}bi.prototype.bytesPerElement=6,Dn(bi,"StructArrayLayout3ui6");class ro extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe,Ce,Fe,Ee,Re,Ye){const Be=this.length;return this.resize(Be+1),this.emplace(Be,e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe,Ce,Fe,Ee,Re,Ye)}emplace(e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe,Ce,Fe,Ee,Re,Ye,Be){const mt=30*e,pt=15*e,Ot=60*e;return this.int16[mt+0]=t,this.int16[mt+1]=s,this.int16[mt+2]=u,this.float32[pt+2]=f,this.float32[pt+3]=g,this.uint16[mt+8]=b,this.uint16[mt+9]=E,this.uint32[pt+5]=M,this.uint32[pt+6]=N,this.uint32[pt+7]=B,this.uint16[mt+16]=z,this.uint16[mt+17]=X,this.uint16[mt+18]=K,this.float32[pt+10]=oe,this.float32[pt+11]=pe,this.uint8[Ot+48]=Ce,this.uint8[Ot+49]=Fe,this.uint8[Ot+50]=Ee,this.uint32[pt+13]=Re,this.int16[mt+28]=Ye,this.uint8[Ot+58]=Be,e}}ro.prototype.bytesPerElement=60,Dn(ro,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe,Ce,Fe,Ee,Re,Ye,Be,mt,pt,Ot,an,vt,zt,Ht,Lt){const sn=this.length;return this.resize(sn+1),this.emplace(sn,e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe,Ce,Fe,Ee,Re,Ye,Be,mt,pt,Ot,an,vt,zt,Ht,Lt)}emplace(e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe,Ce,Fe,Ee,Re,Ye,Be,mt,pt,Ot,an,vt,zt,Ht,Lt,sn){const Wt=38*e,Cn=19*e;return this.int16[Wt+0]=t,this.int16[Wt+1]=s,this.int16[Wt+2]=u,this.float32[Cn+2]=f,this.float32[Cn+3]=g,this.int16[Wt+8]=b,this.int16[Wt+9]=E,this.int16[Wt+10]=M,this.int16[Wt+11]=N,this.int16[Wt+12]=B,this.int16[Wt+13]=z,this.uint16[Wt+14]=X,this.uint16[Wt+15]=K,this.uint16[Wt+16]=oe,this.uint16[Wt+17]=pe,this.uint16[Wt+18]=Ce,this.uint16[Wt+19]=Fe,this.uint16[Wt+20]=Ee,this.uint16[Wt+21]=Re,this.uint16[Wt+22]=Ye,this.uint16[Wt+23]=Be,this.uint16[Wt+24]=mt,this.uint16[Wt+25]=pt,this.uint16[Wt+26]=Ot,this.uint16[Wt+27]=an,this.uint16[Wt+28]=vt,this.uint32[Cn+15]=zt,this.float32[Cn+16]=Ht,this.float32[Cn+17]=Lt,this.float32[Cn+18]=sn,e}}jo.prototype.bytesPerElement=76,Dn(jo,"StructArrayLayout3i2f6i15ui1ul3f76");class sr extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}sr.prototype.bytesPerElement=4,Dn(sr,"StructArrayLayout1f4");class Cs extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,s,u,f)}emplace(e,t,s,u,f,g){const b=5*e;return this.float32[b+0]=t,this.float32[b+1]=s,this.float32[b+2]=u,this.float32[b+3]=f,this.float32[b+4]=g,e}}Cs.prototype.bytesPerElement=20,Dn(Cs,"StructArrayLayout5f20");class Tl extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const g=6*e;return this.uint32[3*e+0]=t,this.uint16[g+2]=s,this.uint16[g+3]=u,this.uint16[g+4]=f,e}}Tl.prototype.bytesPerElement=12,Dn(Tl,"StructArrayLayout1ul3ui12");class Hs extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const s=this.length;return this.resize(s+1),this.emplace(s,e,t)}emplace(e,t,s){const u=2*e;return this.uint16[u+0]=t,this.uint16[u+1]=s,e}}Hs.prototype.bytesPerElement=4,Dn(Hs,"StructArrayLayout2ui4");class il extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}il.prototype.bytesPerElement=2,Dn(il,"StructArrayLayout1ui2");class Ql extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const s=this.length;return this.resize(s+1),this.emplace(s,e,t)}emplace(e,t,s){const u=2*e;return this.float32[u+0]=t,this.float32[u+1]=s,e}}Ql.prototype.bytesPerElement=8,Dn(Ql,"StructArrayLayout2f8");class xc extends _t{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}xc.prototype.size=12;class ks extends ji{get(e){return new xc(this,e)}}Dn(ks,"FillExtrusionExtArray");class wc extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wc.prototype.size=40;class ec extends Ts{get(e){return new wc(this,e)}}Dn(ec,"CollisionBoxArray");class Ju extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ju.prototype.size=60;class Bp extends ro{get(e){return new Ju(this,e)}}Dn(Bp,"PlacedSymbolArray");class zp extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}zp.prototype.size=76;class Vp extends jo{get(e){return new zp(this,e)}}Dn(Vp,"SymbolInstanceArray");class Up extends sr{getoffsetX(e){return this.float32[1*e+0]}}Dn(Up,"GlyphOffsetArray");class eu extends Fn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Dn(eu,"SymbolLineVertexArray");class Cd extends _t{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Cd.prototype.size=12;class jp extends Tl{get(e){return new Cd(this,e)}}Dn(jp,"FeatureIndexArray");class Gp extends _t{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Gp.prototype.size=4;class Zm extends Hs{get(e){return new Gp(this,e)}}Dn(Zm,"FillExtrusionCentroidArray");class qm extends _t{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}qm.prototype.size=12;class Ym extends ji{get(e){return new qm(this,e)}}Dn(Ym,"CircleGlobeExtArray");const u_=kt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),$p=kt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Hp=qr(function(n){n.exports=function(e,t){var s,u,f,g,b,E,M,N;for(u=e.length-(s=3&e.length),f=t,b=3432918353,E=461845907,N=0;N<u;)M=255&e.charCodeAt(N)|(255&e.charCodeAt(++N))<<8|(255&e.charCodeAt(++N))<<16|(255&e.charCodeAt(++N))<<24,++N,f=27492+(65535&(g=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*b+(((M>>>16)*b&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&e.charCodeAt(N+2))<<16;case 2:M^=(255&e.charCodeAt(N+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&e.charCodeAt(N)))*b+(((M>>>16)*b&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Vf=qr(function(n){n.exports=function(e,t){for(var s,u=e.length,f=t^u,g=0;u>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:f^=(255&e.charCodeAt(g+2))<<16;case 2:f^=(255&e.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),sh=Hp,Cl=Vf;sh.murmur3=Hp,sh.murmur2=Cl;class Zr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,s,u){this.ids.push(rl(e)),this.positions.push(t,s,u)}getPositions(e){const t=rl(e);let s=0,u=this.ids.length-1;for(;s<u;){const g=s+u>>1;this.ids[g]>=t?u=g:s=g+1}const f=[];for(;this.ids[s]===t;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,t){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return tu(s,u,0,s.length-1),t&&t.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const t=new Zr;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function rl(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:sh(String(n))}function tu(n,e,t,s){for(;t<s;){const u=n[t+s>>1];let f=t-1,g=s+1;for(;;){do{f++}while(n[f]<u);do{g--}while(n[g]>u);if(f>=g)break;Cu(n,f,g),Cu(e,3*f,3*g),Cu(e,3*f+1,3*g+1),Cu(e,3*f+2,3*g+2)}g-t<s-g?(tu(n,e,t,g),t=g+1):(tu(n,e,g+1,s),s=g)}}function Cu(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}Dn(Zr,"FeaturePositionMap");class tc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Ed extends tc{constructor(e){super(e),this.current=0}set(e,t,s){this.fetchUniformLocation(e,t)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Vh extends tc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,s){this.fetchUniformLocation(e,t)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Xm extends tc{constructor(e){super(e),this.current=Ui.transparent}set(e,t,s){this.fetchUniformLocation(e,t)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const ah=new Float32Array(16),Ku=new Float32Array(9),lh=new Float32Array(4);function Uf(n){return[Bt(255*n.r,255*n.g),Bt(255*n.b,255*n.a)]}class ch{constructor(e,t,s){this.value=e,this.uniformNames=t.map(u=>`u_${u}`),this.type=s}setUniform(e,t,s,u,f){t.set(e,f,u.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Xm(e):new Ed(e)}}class Eu{constructor(e,t){this.uniformNames=t.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,s,u,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&t.set(e,f,g)}getBinding(e,t){return"u_pattern_from"===t||"u_pattern_to"===t||"u_dash_from"===t||"u_dash_to"===t?new Vh(e):new Ed(e)}}class Dc{constructor(e,t,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=t.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,t,s,u,f,g){const b=this.paintVertexArray.length,E=this.expression.evaluate(new me(0),t,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(b,e,E)}updatePaintArray(e,t,s,u,f){const g=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,t,g)}_setPaintValue(e,t,s){if("color"===this.type){const u=Uf(s);for(let f=e;f<t;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ws{constructor(e,t,s,u,f,g){this.expression=e,this.uniformNames=t.map(b=>`u_${b}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=t.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,t,s,u,f,g){const b=this.expression.evaluate(new me(this.zoom),t,{},f,u,g),E=this.expression.evaluate(new me(this.zoom+1),t,{},f,u,g),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,b,E)}updatePaintArray(e,t,s,u,f){const g=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),b=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,t,g,b)}_setPaintValue(e,t,s,u){if("color"===this.type){const f=Uf(s),g=Uf(u);for(let b=e;b<t;b++)this.paintVertexArray.emplace(b,f[0],f[1],g[0],g[1])}else{for(let f=e;f<t;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,s,u,f){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,b=on(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);t.set(e,f,b)}getBinding(e,t){return new Ed(e)}}class Ta{constructor(e,t,s,u,f,g,b){this.expression=e,this.type=s,this.useIntegerZoom=u,this.zoom=f,this.layerId=b,this.paintVertexAttributes=("array"===s?$p:u_).members;for(let E=0;E<t.length;++E);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,t,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,t.patterns&&t.patterns[this.layerId],s)}updatePaintArray(e,t,s,u,f,g){this._setPaintValues(e,t,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(e,t,s,u){if(!u||!s)return;const{min:f,mid:g,max:b}=s,E=u[f],M=u[g],N=u[b];if(E&&M&&N)for(let B=e;B<t;B++)this._setPaintValue(this.zoomInPaintVertexArray,B,M,E),this._setPaintValue(this.zoomOutPaintVertexArray,B,M,N)}_setPaintValue(e,t,s,u){e.emplace(t,s.tl[0],s.tl[1],s.br[0],s.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],s.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ol{constructor(e,t,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const g=e.paint.get(f);if(!(g instanceof Ne&&zo(g.property.specification)))continue;const b=uh(f,e.type),E=g.value,M=g.property.specification.type,N=g.property.useIntegerZoom,B=g.property.specification["property-type"],z="cross-faded"===B||"cross-faded-data-driven"===B,X="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==E.kind||X)if("source"===E.kind||X||z){const K=Ko(f,M,"source");this.binders[f]=z?new Ta(E,b,M,N,t,K,e.id):new Dc(E,b,M,K),u.push(`/a_${f}`)}else{const K=Ko(f,M,"composite");this.binders[f]=new Ws(E,b,M,N,t,K),u.push(`/z_${f}`)}else this.binders[f]=z?new Eu(E.value,b):new ch(E.value,b,M),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Dc||t instanceof Ws?t.maxValue:0}populatePaintArrays(e,t,s,u,f,g){for(const b in this.binders){const E=this.binders[b];(E instanceof Dc||E instanceof Ws||E instanceof Ta)&&E.populatePaintArray(e,t,s,u,f,g)}}setConstantPatternPositions(e,t){for(const s in this.binders){const u=this.binders[s];u instanceof Eu&&u.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,s,u,f,g){let b=!1;for(const E in e){const M=t.getPositions(E);for(const N of M){const B=s.feature(N.index);for(const z in this.binders){const X=this.binders[z];if((X instanceof Dc||X instanceof Ws||X instanceof Ta)&&!0===X.expression.isStateDependent){const K=u.paint.get(z);X.expression=K.value,X.updatePaintArray(N.start,N.end,B,e[E],f,g),b=!0}}}}return b}defines(){const e=[];for(const t in this.binders){const s=this.binders[t];(s instanceof ch||s instanceof Eu)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const s=this.binders[t];if(s instanceof Dc||s instanceof Ws||s instanceof Ta)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const s=this.binders[t];if(s instanceof ch||s instanceof Eu||s instanceof Ws)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof ch||u instanceof Eu||u instanceof Ws)for(const f of u.uniformNames)t.push({name:f,property:s,binding:u.getBinding(e,f)})}return t}setUniforms(e,t,s,u,f){for(const{name:g,property:b,binding:E}of s)this.binders[b].setUniform(e,E,f,u.get(b),g)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const s=this.binders[t];if(e&&s instanceof Ta){const u=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof Dc||s instanceof Ws)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const t in this.binders){const s=this.binders[t];(s instanceof Dc||s instanceof Ws||s instanceof Ta)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Dc||t instanceof Ws||t instanceof Ta)&&t.destroy()}}}class El{constructor(e,t,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ol(u,t,s);this.needsUpload=!1,this._featureMap=new Zr,this._bufferOffset=0}populatePaintArrays(e,t,s,u,f,g,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,t,u,f,g,b);void 0!==t.id&&this._featureMap.add(t.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,s,u,f){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,t,g,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Md={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function uh(n,e){return Md[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Tc={"line-pattern":{source:Bn,composite:Bn},"fill-pattern":{source:Bn,composite:Bn},"fill-extrusion-pattern":{source:Bn,composite:Bn},"line-dasharray":{source:mi,composite:mi}},jf={color:{source:Ql,composite:Fi},number:{source:sr,composite:Ql}};function Ko(n,e,t){const s=Tc[n];return s&&s[t]||jf[e][t]}Dn(ch,"ConstantBinder"),Dn(Eu,"CrossFadedConstantBinder"),Dn(Dc,"SourceExpressionBinder"),Dn(Ta,"CrossFadedCompositeBinder"),Dn(Ws,"CompositeExpressionBinder"),Dn(ol,"ProgramConfiguration",{omit:["_buffers"]}),Dn(El,"ProgramConfigurationSet");const Uh="-transition";class nc extends In{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Ue(t.layout)),t.paint)){this._transitionablePaint=new De(t.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new je(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,s={}){null!=t&&this._validate(ql,`layers.${this.id}.layout.${e}`,e,t,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return It(e,Uh)?this._transitionablePaint.getTransition(e.slice(0,-Uh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,s={}){if(null!=t&&this._validate(Rs,`layers.${this.id}.paint.${e}`,e,t,s))return!1;if(It(e,Uh))return this._transitionablePaint.setTransition(e.slice(0,-Uh.length),t||void 0),!1;{const u=this._transitionablePaint._values[e],f="cross-faded-data-driven"===u.property.specification["property-type"],g=u.value.isDataDriven(),b=u.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,b,E)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),_n(e,(t,s)=>!(void 0===t||"layout"===s&&!Object.keys(t).length||"paint"===s&&!Object.keys(t).length))}_validate(e,t,s,u,f={}){return(!f||!1!==f.validate)&&Ns(this,e.call(Dl,{key:t,layerType:this.type,objectKey:s,value:u,styleSpec:at,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Ne&&zo(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Hl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Gf=kt([{name:"a_pos",components:2,type:"Int16"}],4),Wp=kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Go{constructor(e=[]){this.segments=e}prepareSegment(e,t,s,u){let f=this.segments[this.segments.length-1];return e>Go.MAX_VERTEX_ARRAY_LENGTH&&An(`Max vertices per segment is ${Go.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Go.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:t.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,s,u){return new Go([{vertexOffset:e,primitiveOffset:t,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}Go.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dn(Go,"SegmentVector");var ii=8192;class Mu{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof _r?new _r(e.lng,e.lat):_r.convert(e),this}setSouthWest(e){return this._sw=e instanceof _r?new _r(e.lng,e.lat):_r.convert(e),this}extend(e){const t=this._sw,s=this._ne;let u,f;if(e instanceof _r)u=e,f=e;else{if(!(e instanceof Mu))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Mu.convert(e)):this.extend(_r.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return t||s?(t.lng=Math.min(u.lng,t.lng),t.lat=Math.min(u.lat,t.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new _r(u.lng,u.lat),this._ne=new _r(f.lng,f.lat)),this}getCenter(){return new _r((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _r(this.getWest(),this.getNorth())}getSouthEast(){return new _r(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:s}=_r.convert(e);let u=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof Mu?e:new Mu(e)}}const $f=6371008.8;class _r{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _r(ki(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,s=this.lat*t,u=e.lat*t,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*t);return $f*Math.acos(Math.min(f,1))}toBounds(e=0){const t=360*e/40075017,s=t/Math.cos(Math.PI/180*this.lat);return new Mu(new _r(this.lng-s,this.lat-t),new _r(this.lng+s,this.lat+t))}static convert(e){if(e instanceof _r)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new _r(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new _r(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Jm=2*Math.PI*$f;function Zp(n){return Jm*Math.cos(n*Math.PI/180)}function ja(n){return(180+n)/360}function ic(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function sl(n,e){return n/Zp(e)}function Ca(n){return 360*n-180}function cs(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function dh(n,e){return n*Zp(cs(e))}const Ga=85.051129;function Sd(n){return 1/Math.cos(n*Math.PI/180)}class Ml{constructor(e,t,s=0){this.x=+e,this.y=+t,this.z=+s}static fromLngLat(e,t=0){const s=_r.convert(e);return new Ml(ja(s.lng),ic(s.lat),sl(t,s.lat))}toLngLat(){return new _r(Ca(this.x),cs(this.y))}toAltitude(){return dh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jm*Sd(cs(this.y))}}function jh(n,e,t,s,u,f,g,b,E){const M=(e+s)/2,N=(t+u)/2,B=new st(M,N);b(B),function(z,X,K,oe,pe,Ce){const Fe=K-pe,Ee=oe-Ce;return Math.abs((oe-X)*Fe-(K-z)*Ee)/Math.hypot(Fe,Ee)}(B.x,B.y,f.x,f.y,g.x,g.y)>=E?(jh(n,e,t,M,N,f,B,b,E),jh(n,M,N,s,u,B,g,b,E)):n.push(g)}function Qu(n,e,t){let s=n[0],u=s.x,f=s.y;e(s);const g=[s];for(let b=1;b<n.length;b++){const E=n[b],{x:M,y:N}=E;e(E),jh(g,u,f,M,N,s,E,e,t),u=M,f=N,s=E}return g}function hh(n,e,t,s,u){if(u(e,t)){const f=e.add(t).mult(.5);s(f),hh(n,e,f,s,u),hh(n,f,t,s,u)}else n.push(t)}function Gh(n,e,t){let s=n[0];e(s);const u=[s];for(let f=1;f<n.length;f++){const g=n[f];e(g),hh(u,s,g,e,t),s=g}return u}const rc=Math.pow(2,14)-1,Su=-rc-1;function qp(n,e){const t=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=on(t,Su,rc),n.y=on(s,Su,rc),(t<n.x||t>n.x+1||s<n.y||s>n.y+1)&&An("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function al(n,e,t){const s=n.loadGeometry(),u=n.extent,f=ii/u;if(e&&t&&t.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:b,x:E,y:M,projection:N}=t,B=z=>{const X=Ca((e.x+z.x/u)/g),K=cs((e.y+z.y/u)/g),oe=N.project(X,K);z.x=(oe.x*b-E)*u,z.y=(oe.y*b-M)*u};for(let z=0;z<s.length;z++)if(1!==n.type)s[z]=Qu(s[z],B,1);else{const X=[];for(const K of s[z])K.x<0||K.x>=u||K.y<0||K.y>=u||(B(K),X.push(K));s[z]=X}}for(const g of s)for(const b of g)qp(b,f);return s}function oc(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?al(n):[]}}function nu(n,e,t,s,u){n.emplaceBack(2*e+(s+1)/2,2*t+(u+1)/2)}function ed(n,e,t){n.emplaceBack(e.x,e.y,e.z,16384*t[0],16384*t[1],16384*t[2])}class td{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new fn,this.indexArray=new bi,this.segments=new Go,this.programConfigurations=new El(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,s,u){const f=this.layers[0],g=[];let b=null;"circle"===f.type&&(b=f.layout.get("circle-sort-key"));for(const{feature:M,id:N,index:B,sourceLayerIndex:z}of e){const X=this.layers[0]._featureFilter.needGeometry,K=oc(M,X);if(!this.layers[0]._featureFilter.filter(new me(this.zoom),K,s))continue;const oe=b?b.evaluate(K,{},s):void 0,pe={id:N,properties:M.properties,type:M.type,sourceLayerIndex:z,index:B,geometry:X?K.geometry:al(M,s,u),patterns:{},sortKey:oe};g.push(pe)}b&&g.sort((M,N)=>M.sortKey-N.sortKey);let E=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Ym,E=u.projection);for(const M of g){const{geometry:N,index:B,sourceLayerIndex:z}=M,X=e[B].feature;this.addFeature(M,N,B,t.availableImages,s,E),t.featureIndex.insert(X,N,B,z,this.index)}}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Wp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,s,u,f,g){for(const b of t)for(const E of b){const M=E.x,N=E.y;if(M<0||M>=ii||N<0||N>=ii)continue;if(g){const X=g.projectTilePoint(M,N,f),K=g.upVector(f,M,N),oe=this.globeExtVertexArray;ed(oe,X,K),ed(oe,X,K),ed(oe,X,K),ed(oe,X,K)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=B.vertexLength;nu(this.layoutVertexArray,M,N,-1,-1),nu(this.layoutVertexArray,M,N,1,-1),nu(this.layoutVertexArray,M,N,1,1),nu(this.layoutVertexArray,M,N,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function iu(n,e){for(let t=0;t<n.length;t++)if(Cc(e,n[t]))return!0;for(let t=0;t<e.length;t++)if(Cc(n,e[t]))return!0;return!!$h(n,e)}function Hf(n,e,t){return!!Cc(n,e)||!!ru(e,n,t)}function fh(n,e){if(1===n.length)return ph(e,n[0]);for(let t=0;t<e.length;t++){const s=e[t];for(let u=0;u<s.length;u++)if(Cc(n,s[u]))return!0}for(let t=0;t<n.length;t++)if(ph(e,n[t]))return!0;for(let t=0;t<e.length;t++)if($h(n,e[t]))return!0;return!1}function Wf(n,e,t){if(n.length>1){if($h(n,e))return!0;for(let s=0;s<e.length;s++)if(ru(e[s],n,t))return!0}for(let s=0;s<n.length;s++)if(ru(n[s],e,t))return!0;return!1}function $h(n,e){if(0===n.length||0===e.length)return!1;for(let t=0;t<n.length-1;t++){const s=n[t],u=n[t+1];for(let f=0;f<e.length-1;f++)if(Hh(s,u,e[f],e[f+1]))return!0}return!1}function Hh(n,e,t,s){return Di(n,t,s)!==Di(e,t,s)&&Di(n,e,t)!==Di(n,e,s)}function ru(n,e,t){const s=t*t;if(1===e.length)return n.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Wh(n,e[u-1],e[u])<s)return!0;return!1}function Wh(n,e,t){const s=e.distSqr(t);if(0===s)return n.distSqr(e);const u=((n.x-e.x)*(t.x-e.x)+(n.y-e.y)*(t.y-e.y))/s;return n.distSqr(u<0?e:u>1?t:t.sub(e)._mult(u)._add(e))}function ph(n,e){let t,s,u,f=!1;for(let g=0;g<n.length;g++){t=n[g];for(let b=0,E=t.length-1;b<t.length;E=b++)s=t[b],u=t[E],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Cc(n,e){let t=!1;for(let s=0,u=n.length-1;s<n.length;u=s++){const f=n[s],g=n[u];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(t=!t)}return t}function Zh(n,e,t,s,u){for(const g of n)if(e<=g.x&&t<=g.y&&s>=g.x&&u>=g.y)return!0;const f=[new st(e,t),new st(e,u),new st(s,u),new st(s,t)];if(n.length>2)for(const g of f)if(Cc(n,g))return!0;for(let g=0;g<n.length-1;g++)if(qh(n[g],n[g+1],f))return!0;return!1}function qh(n,e,t){const s=t[0],u=t[2];if(n.x<s.x&&e.x<s.x||n.x>u.x&&e.x>u.x||n.y<s.y&&e.y<s.y||n.y>u.y&&e.y>u.y)return!1;const f=Di(n,e,t[0]);return f!==Di(n,e,t[1])||f!==Di(n,e,t[2])||f!==Di(n,e,t[3])}function nd(n,e,t){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:t.programConfigurations.get(e.id).getMaxValue(n)}function Iu(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Yp(n,e,t,s,u){if(!e[0]&&!e[1])return n;const f=st.convert(e)._mult(u);"viewport"===t&&f._rotate(-s);const g=[];for(let b=0;b<n.length;b++)g.push(n[b].sub(f));return g}function Zf(n,e,t,s){const u=st.convert(n)._mult(s);return"viewport"===e&&u._rotate(-t),u}Dn(td,"CircleBucket",{omit:["layers"]});const Xp=new Pt({"circle-sort-key":new Je(at.layout_circle["circle-sort-key"])});var Jp={paint:new Pt({"circle-radius":new Je(at.paint_circle["circle-radius"]),"circle-color":new Je(at.paint_circle["circle-color"]),"circle-blur":new Je(at.paint_circle["circle-blur"]),"circle-opacity":new Je(at.paint_circle["circle-opacity"]),"circle-translate":new Le(at.paint_circle["circle-translate"]),"circle-translate-anchor":new Le(at.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Le(at.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Le(at.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Je(at.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Je(at.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Je(at.paint_circle["circle-stroke-opacity"])}),layout:Xp},Ec=1e-6,ca=typeof Float32Array<"u"?Float32Array:Array;function ou(){var n=new ca(9);return ca!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ua(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function mh(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],g=e[4],b=e[5],E=e[6],M=e[7],N=e[8],B=e[9],z=e[10],X=e[11],K=e[12],oe=e[13],pe=e[14],Ce=e[15],Fe=t*b-s*g,Ee=t*E-u*g,Re=t*M-f*g,Ye=s*E-u*b,Be=s*M-f*b,mt=u*M-f*E,pt=N*oe-B*K,Ot=N*pe-z*K,an=N*Ce-X*K,vt=B*pe-z*oe,zt=B*Ce-X*oe,Ht=z*Ce-X*pe,Lt=Fe*Ht-Ee*zt+Re*vt+Ye*an-Be*Ot+mt*pt;return Lt?(n[0]=(b*Ht-E*zt+M*vt)*(Lt=1/Lt),n[1]=(u*zt-s*Ht-f*vt)*Lt,n[2]=(oe*mt-pe*Be+Ce*Ye)*Lt,n[3]=(z*Be-B*mt-X*Ye)*Lt,n[4]=(E*an-g*Ht-M*Ot)*Lt,n[5]=(t*Ht-u*an+f*Ot)*Lt,n[6]=(pe*Re-K*mt-Ce*Ee)*Lt,n[7]=(N*mt-z*Re+X*Ee)*Lt,n[8]=(g*zt-b*an+M*pt)*Lt,n[9]=(s*an-t*zt-f*pt)*Lt,n[10]=(K*Be-oe*Re+Ce*Fe)*Lt,n[11]=(B*Re-N*Be-X*Fe)*Lt,n[12]=(b*Ot-g*vt-E*pt)*Lt,n[13]=(t*vt-s*Ot+u*pt)*Lt,n[14]=(oe*Ee-K*Ye-pe*Fe)*Lt,n[15]=(N*Ye-B*Ee+z*Fe)*Lt,n):null}function id(n,e,t){var s=e[0],u=e[1],f=e[2],g=e[3],b=e[4],E=e[5],M=e[6],N=e[7],B=e[8],z=e[9],X=e[10],K=e[11],oe=e[12],pe=e[13],Ce=e[14],Fe=e[15],Ee=t[0],Re=t[1],Ye=t[2],Be=t[3];return n[0]=Ee*s+Re*b+Ye*B+Be*oe,n[1]=Ee*u+Re*E+Ye*z+Be*pe,n[2]=Ee*f+Re*M+Ye*X+Be*Ce,n[3]=Ee*g+Re*N+Ye*K+Be*Fe,n[4]=(Ee=t[4])*s+(Re=t[5])*b+(Ye=t[6])*B+(Be=t[7])*oe,n[5]=Ee*u+Re*E+Ye*z+Be*pe,n[6]=Ee*f+Re*M+Ye*X+Be*Ce,n[7]=Ee*g+Re*N+Ye*K+Be*Fe,n[8]=(Ee=t[8])*s+(Re=t[9])*b+(Ye=t[10])*B+(Be=t[11])*oe,n[9]=Ee*u+Re*E+Ye*z+Be*pe,n[10]=Ee*f+Re*M+Ye*X+Be*Ce,n[11]=Ee*g+Re*N+Ye*K+Be*Fe,n[12]=(Ee=t[12])*s+(Re=t[13])*b+(Ye=t[14])*B+(Be=t[15])*oe,n[13]=Ee*u+Re*E+Ye*z+Be*pe,n[14]=Ee*f+Re*M+Ye*X+Be*Ce,n[15]=Ee*g+Re*N+Ye*K+Be*Fe,n}function Au(n,e,t){var s,u,f,g,b,E,M,N,B,z,X,K,oe=t[0],pe=t[1],Ce=t[2];return e===n?(n[12]=e[0]*oe+e[4]*pe+e[8]*Ce+e[12],n[13]=e[1]*oe+e[5]*pe+e[9]*Ce+e[13],n[14]=e[2]*oe+e[6]*pe+e[10]*Ce+e[14],n[15]=e[3]*oe+e[7]*pe+e[11]*Ce+e[15]):(u=e[1],f=e[2],g=e[3],b=e[4],E=e[5],M=e[6],N=e[7],B=e[8],z=e[9],X=e[10],K=e[11],n[0]=s=e[0],n[1]=u,n[2]=f,n[3]=g,n[4]=b,n[5]=E,n[6]=M,n[7]=N,n[8]=B,n[9]=z,n[10]=X,n[11]=K,n[12]=s*oe+b*pe+B*Ce+e[12],n[13]=u*oe+E*pe+z*Ce+e[13],n[14]=f*oe+M*pe+X*Ce+e[14],n[15]=g*oe+N*pe+K*Ce+e[15]),n}function su(n,e,t){var s=t[0],u=t[1],f=t[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function qf(n,e,t){var s=Math.sin(t),u=Math.cos(t),f=e[4],g=e[5],b=e[6],E=e[7],M=e[8],N=e[9],B=e[10],z=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+M*s,n[5]=g*u+N*s,n[6]=b*u+B*s,n[7]=E*u+z*s,n[8]=M*u-f*s,n[9]=N*u-g*s,n[10]=B*u-b*s,n[11]=z*u-E*s,n}function Id(n,e,t){var s=Math.sin(t),u=Math.cos(t),f=e[0],g=e[1],b=e[2],E=e[3],M=e[8],N=e[9],B=e[10],z=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-M*s,n[1]=g*u-N*s,n[2]=b*u-B*s,n[3]=E*u-z*s,n[8]=f*s+M*u,n[9]=g*s+N*u,n[10]=b*s+B*u,n[11]=E*s+z*u,n}function Yh(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Yf(n,e,t){var s,u,f,g=t[0],b=t[1],E=t[2],M=Math.hypot(g,b,E);return M<Ec?null:(g*=M=1/M,b*=M,E*=M,s=Math.sin(e),u=Math.cos(e),n[0]=g*g*(f=1-u)+u,n[1]=b*g*f+E*s,n[2]=E*g*f-b*s,n[3]=0,n[4]=g*b*f-E*s,n[5]=b*b*f+u,n[6]=E*b*f+g*s,n[7]=0,n[8]=g*E*f+b*s,n[9]=b*E*f-g*s,n[10]=E*E*f+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Xh=id;function Jh(){var n=new ca(3);return ca!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Kh(n){var e=new ca(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Pu(n){return Math.hypot(n[0],n[1],n[2])}function gh(n,e,t){var s=new ca(3);return s[0]=n,s[1]=e,s[2]=t,s}function rd(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function _h(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function Km(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function Kp(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function Qh(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function Mc(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function Xf(n,e,t,s){return n[0]=e[0]+t[0]*s,n[1]=e[1]+t[1]*s,n[2]=e[2]+t[2]*s,n}function Fs(n,e){var t=e[0],s=e[1],u=e[2],f=t*t+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function ll(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function yh(n,e,t){var s=e[0],u=e[1],f=e[2],g=t[0],b=t[1],E=t[2];return n[0]=u*E-f*b,n[1]=f*g-s*E,n[2]=s*b-u*g,n}function So(n,e,t){var s=e[0],u=e[1],f=e[2],g=t[3]*s+t[7]*u+t[11]*f+t[15];return n[0]=(t[0]*s+t[4]*u+t[8]*f+t[12])/(g=g||1),n[1]=(t[1]*s+t[5]*u+t[9]*f+t[13])/g,n[2]=(t[2]*s+t[6]*u+t[10]*f+t[14])/g,n}function Jf(n,e,t){var s=t[0],u=t[1],f=t[2],g=e[0],b=e[1],E=e[2],M=u*E-f*b,N=f*g-s*E,B=s*b-u*g,z=u*B-f*N,X=f*M-s*B,K=s*N-u*M,oe=2*t[3];return N*=oe,B*=oe,X*=2,K*=2,n[0]=g+(M*=oe)+(z*=2),n[1]=b+N+X,n[2]=E+B+K,n}var Ad,cl=_h,Qm=Km,ef=Pu;function Pd(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function od(n,e,t){var s=e[0],u=e[1],f=e[2],g=e[3];return n[0]=t[0]*s+t[4]*u+t[8]*f+t[12]*g,n[1]=t[1]*s+t[5]*u+t[9]*f+t[13]*g,n[2]=t[2]*s+t[6]*u+t[10]*f+t[14]*g,n[3]=t[3]*s+t[7]*u+t[11]*f+t[15]*g,n}function Kf(){var n=new ca(4);return ca!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Qp(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Qf(n,e,t){t*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],b=Math.sin(t),E=Math.cos(t);return n[0]=s*E+g*b,n[1]=u*E+f*b,n[2]=f*E-u*b,n[3]=g*E-s*b,n}function tf(n,e,t){t*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],b=Math.sin(t),E=Math.cos(t);return n[0]=s*E-f*b,n[1]=u*E+g*b,n[2]=f*E+s*b,n[3]=g*E-u*b,n}Jh(),Ad=new ca(4),ca!=Float32Array&&(Ad[0]=0,Ad[1]=0,Ad[2]=0,Ad[3]=0),Jh(),gh(1,0,0),gh(0,1,0),Kf(),Kf(),ou();class ep{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,s){const u=ll(t,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,t,s){if(oe=(X=this.pos)[0],pe=X[1],Ce=X[2],Fe=(K=e)[0],Ee=K[1],Re=K[2],Math.abs(oe-Fe)<=Ec*Math.max(1,Math.abs(oe),Math.abs(Fe))&&Math.abs(pe-Ee)<=Ec*Math.max(1,Math.abs(pe),Math.abs(Ee))&&Math.abs(Ce-Re)<=Ec*Math.max(1,Math.abs(Ce),Math.abs(Re))||0===t)return s[0]=s[1]=s[2]=0,!1;var X,K,oe,pe,Ce,Fe,Ee,Re;const[u,f,g]=this.dir,b=this.pos[0]-e[0],E=this.pos[1]-e[1],M=this.pos[2]-e[2],N=u*u+f*f+g*g,B=2*(b*u+E*f+M*g),z=B*B-4*N*(b*b+E*E+M*M-t*t);if(z<0){const X=Math.max(-B/2,0),K=b+u*X,oe=E+f*X,pe=M+g*X,Ce=Math.hypot(K,oe,pe);return s[0]=K*t/Ce,s[1]=oe*t/Ce,s[2]=pe*t/Ce,!1}{const X=(-B-Math.sqrt(z))/(2*N);if(X<0){const K=Math.hypot(b,E,M);return s[0]=b*t/K,s[1]=E*t/K,s[2]=M*t/K,!1}return s[0]=b+u*X,s[1]=E+f*X,s[2]=M+g*X,!0}}}class tp{constructor(e,t,s,u,f){this.TL=e,this.TR=t,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,t,s){const u=[-1,1,1],f=[1,1,1],g=[1,-1,1],b=[-1,-1,1],E=So(u,u,e),M=So(f,f,e),N=So(g,g,e),B=So(b,b,e);return new tp(E,M,N,B,t/s)}}class np{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,s,u){const f=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const M=od([],E,e),N=1/M[3]/t*f;return(B=M)[0]=(z=M)[0]*(X=[N,N,u?1/M[3]:N,N])[0],B[1]=z[1]*X[1],B[2]=z[2]*X[2],B[3]=z[3]*X[3],B;var B,z,X}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const M=Fs([],yh([],cl([],g[E[0]],g[E[1]]),cl([],g[E[2]],g[E[1]]))),N=-ll(M,g[E[1]]);return M.concat(N)});return new np(g,b)}}class Zs{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],s=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const u of e)t[0]=Math.min(t[0],u[0]),t[1]=Math.min(t[1],u[1]),t[2]=Math.min(t[2],u[2]),s[0]=Math.max(s[0],u[0]),s[1]=Math.max(s[1],u[1]),s[2]=Math.max(s[2],u[2]);return new Zs(t,s)}constructor(e,t){this.min=e,this.max=t,this.center=Mc([],rd([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],s=Kh(this.min),u=Kh(this.max);for(let f=0;f<t.length;f++)s[f]=t[f]?this.min[f]:this.center[f],u[f]=t[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Zs(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let g=0;for(let b=0;b<t.length;b++)g+=ll(f,t[b])+f[3]>=0;if(0===g)return 0;g!==t.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const E=e.points[b][u]-this.min[u];f=Math.min(f,E),g=Math.max(g,E)}if(g<0||f>this.max[u]-this.min[u])return 0}return 1}}function em(n,e,t,s,u,f,g,b,E){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(E*=n.pixelToTileUnitsFactor);const M=n.tileID.canonical,N=t.projection.upVectorScale(M,t.center.lat,t.worldSize).metersToTile;for(const B of e)for(const z of B){const X=z.add(b),K=u&&t.elevation?t.elevation.exaggeration()*u.getElevationAt(X.x,X.y,!0):0,oe=t.projection.projectTilePoint(X.x,X.y,M);if(K>0){const Ee=t.projection.upVector(M,X.x,X.y);oe.x+=Ee[0]*N*K,oe.y+=Ee[1]*N*K,oe.z+=Ee[2]*N*K}const pe=f?X:ip(oe.x,oe.y,oe.z,s),Ce=f?n.tilespaceRays.map(Ee=>eg(Ee,K)):n.queryGeometry.screenGeometry,Fe=od([],[oe.x,oe.y,oe.z,1],s);if(!g&&f?E*=Fe[3]/t.cameraToCenterDistance:g&&!f&&(E*=t.cameraToCenterDistance/Fe[3]),f){const Ee=cs((z.y/ii+M.y)/(1<<M.z));E/=t.projection.pixelsPerMeter(Ee,1)/sl(1,Ee)}if(Hf(Ce,pe,E))return!0}return!1}function ip(n,e,t,s){const u=od([],[n,e,t,1],s);return new st(u[0]/u[3],u[1]/u[3])}const tm=gh(0,0,0),nm=gh(0,0,1);function eg(n,e){const t=Jh();return tm[2]=e,n.intersectsPlane(tm,nm,t),new st(t[0],t[1])}class im extends td{}function Ls(n,{width:e,height:t},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*t*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*t*s);return n.width=e,n.height=t,n.data=u,n}function nf(n,e,t){const{width:s,height:u}=e;s===n.width&&u===n.height||(rf(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,u)},t),n.width=s,n.height=u,n.data=e.data)}function rf(n,e,t,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||t.x>n.width-u.width||t.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,b=e.data;for(let E=0;E<u.height;E++){const M=((t.y+E)*n.width+t.x)*f,N=((s.y+E)*e.width+s.x)*f;for(let B=0;B<u.width*f;B++)b[N+B]=g[M+B]}return e}Dn(im,"HeatmapBucket",{omit:["layers"]});class sc{constructor(e,t){Ls(this,e,1,t)}resize(e){nf(this,new sc(e),1)}clone(){return new sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,s,u,f){rf(e,t,s,u,f,1)}}class Xr{constructor(e,t){Ls(this,e,4,t)}resize(e){nf(this,new Xr(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,s,u,f){rf(e,t,s,u,f,4)}}Dn(sc,"AlphaImage"),Dn(Xr,"RGBAImage");var Od={paint:new Pt({"heatmap-radius":new Je(at.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Je(at.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Le(at.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rt(at.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Le(at.paint_heatmap["heatmap-opacity"])})};function sf(n){const e={},t=n.resolution||256,s=n.clips?n.clips.length:1,u=n.image||new Xr({width:t,height:s}),f=(g,b,E)=>{e[n.evaluationKey]=E;const M=n.expression.evaluate(e);u.data[g+b+0]=Math.floor(255*M.r/M.a),u.data[g+b+1]=Math.floor(255*M.g/M.a),u.data[g+b+2]=Math.floor(255*M.b/M.a),u.data[g+b+3]=Math.floor(255*M.a)};if(n.clips)for(let g=0,b=0;g<s;++g,b+=4*t)for(let E=0,M=0;E<t;E++,M+=4){const N=E/(t-1),{start:B,end:z}=n.clips[g];f(b,M,B*(1-N)+z*N)}else for(let g=0,b=0;g<t;g++,b+=4)f(0,b,g/(t-1));return u}var tg={paint:new Pt({"hillshade-illumination-direction":new Le(at.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Le(at.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Le(at.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Le(at.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Le(at.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Le(at.paint_hillshade["hillshade-accent-color"])})};const ng=kt([{name:"a_pos",components:2,type:"Int16"}],4),{members:rm}=ng;var Rd=af,om=af;function af(n,e,t){t=t||2;var s,u,f,g,b,E,M,N=e&&e.length,B=N?e[0]*t:n.length,z=rp(n,0,B,t,!0),X=[];if(!z||z.next===z.prev)return X;if(N&&(z=function(oe,pe,Ce,Fe){var Ee,Re,Ye,Be=[];for(Ee=0,Re=pe.length;Ee<Re;Ee++)(Ye=rp(oe,pe[Ee]*Fe,Ee<Re-1?pe[Ee+1]*Fe:oe.length,Fe,!1))===Ye.next&&(Ye.steiner=!0),Be.push(p(Ye));for(Be.sort(Sc),Ee=0;Ee<Be.length;Ee++)Ce=sm(Be[Ee],Ce);return Ce}(n,e,z,t)),n.length>80*t){s=f=n[0],u=g=n[1];for(var K=t;K<B;K+=t)(b=n[K])<s&&(s=b),(E=n[K+1])<u&&(u=E),b>f&&(f=b),E>g&&(g=E);M=0!==(M=Math.max(f-s,g-u))?32767/M:0}return vh(z,X,t,s,u,M,0),X}function rp(n,e,t,s,u){var f,g;if(u===ri(n,e,t,s)>0)for(f=e;f<t;f+=s)g=pn(f,n[f],n[f+1],g);else for(f=t-s;f>=e;f-=s)g=pn(f,n[f],n[f+1],g);return g&&Te(g,g.next)&&(Gn(g),g=g.next),g}function sd(n,e){if(!n)return n;e||(e=n);var t,s=n;do{if(t=!1,s.steiner||!Te(s,s.next)&&0!==W(s.prev,s,s.next))s=s.next;else{if(Gn(s),(s=e=s.prev)===s.next)break;t=!0}}while(t||s!==e);return e}function vh(n,e,t,s,u,f,g){if(n){!g&&f&&function(N,B,z,X){var K=N;do{0===K.z&&(K.z=C(K.x,K.y,B,z,X)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next}while(K!==N);K.prevZ.nextZ=null,K.prevZ=null,function(oe){var pe,Ce,Fe,Ee,Re,Ye,Be,mt,pt=1;do{for(Ce=oe,oe=null,Re=null,Ye=0;Ce;){for(Ye++,Fe=Ce,Be=0,pe=0;pe<pt&&(Be++,Fe=Fe.nextZ);pe++);for(mt=pt;Be>0||mt>0&&Fe;)0!==Be&&(0===mt||!Fe||Ce.z<=Fe.z)?(Ee=Ce,Ce=Ce.nextZ,Be--):(Ee=Fe,Fe=Fe.nextZ,mt--),Re?Re.nextZ=Ee:oe=Ee,Ee.prevZ=Re,Re=Ee;Ce=Fe}Re.nextZ=null,pt*=2}while(Ye>1)}(K)}(n,s,u,f);for(var b,E,M=n;n.prev!==n.next;)if(b=n.prev,E=n.next,f?rg(n,s,u,f):ig(n))e.push(b.i/t|0),e.push(n.i/t|0),e.push(E.i/t|0),Gn(n),n=E.next,M=E.next;else if((n=E)===M){g?1===g?vh(n=og(sd(n),e,t),e,t,s,u,f,2):2===g&&Ou(n,e,t,s,u,f):vh(sd(n),e,t,s,u,f,1);break}}}function ig(n){var e=n.prev,t=n,s=n.next;if(W(e,t,s)>=0)return!1;for(var u=e.x,f=t.x,g=s.x,b=e.y,E=t.y,M=s.y,N=u<f?u<g?u:g:f<g?f:g,B=b<E?b<M?b:M:E<M?E:M,z=u>f?u>g?u:g:f>g?f:g,X=b>E?b>M?b:M:E>M?E:M,K=s.next;K!==e;){if(K.x>=N&&K.x<=z&&K.y>=B&&K.y<=X&&T(u,b,f,E,g,M,K.x,K.y)&&W(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function rg(n,e,t,s){var u=n.prev,f=n,g=n.next;if(W(u,f,g)>=0)return!1;for(var b=u.x,E=f.x,M=g.x,N=u.y,B=f.y,z=g.y,X=b<E?b<M?b:M:E<M?E:M,K=N<B?N<z?N:z:B<z?B:z,oe=b>E?b>M?b:M:E>M?E:M,pe=N>B?N>z?N:z:B>z?B:z,Ce=C(X,K,e,t,s),Fe=C(oe,pe,e,t,s),Ee=n.prevZ,Re=n.nextZ;Ee&&Ee.z>=Ce&&Re&&Re.z<=Fe;){if(Ee.x>=X&&Ee.x<=oe&&Ee.y>=K&&Ee.y<=pe&&Ee!==u&&Ee!==g&&T(b,N,E,B,M,z,Ee.x,Ee.y)&&W(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Re.x>=X&&Re.x<=oe&&Re.y>=K&&Re.y<=pe&&Re!==u&&Re!==g&&T(b,N,E,B,M,z,Re.x,Re.y)&&W(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Ee&&Ee.z>=Ce;){if(Ee.x>=X&&Ee.x<=oe&&Ee.y>=K&&Ee.y<=pe&&Ee!==u&&Ee!==g&&T(b,N,E,B,M,z,Ee.x,Ee.y)&&W(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Re&&Re.z<=Fe;){if(Re.x>=X&&Re.x<=oe&&Re.y>=K&&Re.y<=pe&&Re!==u&&Re!==g&&T(b,N,E,B,M,z,Re.x,Re.y)&&W(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function og(n,e,t){var s=n;do{var u=s.prev,f=s.next.next;!Te(u,f)&&Ge(u,s,s.next,f)&&bt(u,f)&&bt(f,u)&&(e.push(u.i/t|0),e.push(s.i/t|0),e.push(f.i/t|0),Gn(s),Gn(s.next),s=n=f),s=s.next}while(s!==n);return sd(s)}function Ou(n,e,t,s,u,f){var g=n;do{for(var b=g.next.next;b!==g.prev;){if(g.i!==b.i&&R(g,b)){var E=Nn(g,b);return g=sd(g,g.next),E=sd(E,E.next),vh(g,e,t,s,u,f,0),void vh(E,e,t,s,u,f,0)}b=b.next}g=g.next}while(g!==n)}function Sc(n,e){return n.x-e.x}function sm(n,e){var t=function(u,f){var g,b=f,E=u.x,M=u.y,N=-1/0;do{if(M<=b.y&&M>=b.next.y&&b.next.y!==b.y){var B=b.x+(M-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(B<=E&&B>N&&(N=B,g=b.x<b.next.x?b:b.next,B===E))return g}b=b.next}while(b!==f);if(!g)return null;var z,X=g,K=g.x,oe=g.y,pe=1/0;b=g;do{E>=b.x&&b.x>=K&&E!==b.x&&T(M<oe?E:N,M,K,oe,M<oe?N:E,M,b.x,b.y)&&(z=Math.abs(M-b.y)/(E-b.x),bt(b,u)&&(z<pe||z===pe&&(b.x>g.x||b.x===g.x&&y(g,b)))&&(g=b,pe=z)),b=b.next}while(b!==X);return g}(n,e);if(!t)return e;var s=Nn(t,n);return sd(s,s.next),sd(t,t.next)}function y(n,e){return W(n.prev,n,e.prev)<0&&W(e.next,n,n.next)<0}function C(n,e,t,s,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(n){var e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function T(n,e,t,s,u,f,g,b){return(u-g)*(e-b)>=(n-g)*(f-b)&&(n-g)*(s-b)>=(t-g)*(e-b)&&(t-g)*(f-b)>=(u-g)*(s-b)}function R(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(t,s){var u=t;do{if(u.i!==t.i&&u.next.i!==t.i&&u.i!==s.i&&u.next.i!==s.i&&Ge(u,u.next,t,s))return!0;u=u.next}while(u!==t);return!1}(n,e)&&(bt(n,e)&&bt(e,n)&&function(t,s){var u=t,f=!1,g=(t.x+s.x)/2,b=(t.y+s.y)/2;do{u.y>b!=u.next.y>b&&u.next.y!==u.y&&g<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==t);return f}(n,e)&&(W(n.prev,n,e.prev)||W(n,e.prev,e))||Te(n,e)&&W(n.prev,n,n.next)>0&&W(e.prev,e,e.next)>0)}function W(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Te(n,e){return n.x===e.x&&n.y===e.y}function Ge(n,e,t,s){var u=yt(W(n,e,t)),f=yt(W(n,e,s)),g=yt(W(t,s,n)),b=yt(W(t,s,e));return u!==f&&g!==b||!(0!==u||!Xe(n,t,e))||!(0!==f||!Xe(n,s,e))||!(0!==g||!Xe(t,n,s))||!(0!==b||!Xe(t,e,s))}function Xe(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function yt(n){return n>0?1:n<0?-1:0}function bt(n,e){return W(n.prev,n,n.next)<0?W(n,e,n.next)>=0&&W(n,n.prev,e)>=0:W(n,e,n.prev)<0||W(n,n.next,e)<0}function Nn(n,e){var t=new Zi(n.i,n.x,n.y),s=new Zi(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,t.next=u,u.prev=t,s.next=t,t.prev=s,f.next=s,s.prev=f,s}function pn(n,e,t,s){var u=new Zi(n,e,t);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Gn(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zi(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ri(n,e,t,s){for(var u=0,f=e,g=t-s;f<t;f+=s)u+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return u}function Li(n,e,t,s,u){ur(n,e,t||0,s||n.length-1,u||oo)}function ur(n,e,t,s,u){for(;s>t;){if(s-t>600){var f=s-t+1,g=e-t+1,b=Math.log(f),E=.5*Math.exp(2*b/3),M=.5*Math.sqrt(b*E*(f-E)/f)*(g-f/2<0?-1:1);ur(n,e,Math.max(t,Math.floor(e-g*E/f+M)),Math.min(s,Math.floor(e+(f-g)*E/f+M)),u)}var N=n[e],B=t,z=s;for(Pi(n,t,e),u(n[s],N)>0&&Pi(n,t,s);B<z;){for(Pi(n,B,z),B++,z--;u(n[B],N)<0;)B++;for(;u(n[z],N)>0;)z--}0===u(n[t],N)?Pi(n,t,z):Pi(n,++z,s),z<=e&&(t=z+1),e<=z&&(s=z-1)}}function Pi(n,e,t){var s=n[e];n[e]=n[t],n[t]=s}function oo(n,e){return n<e?-1:n>e?1:0}function ar(n,e){const t=n.length;if(t<=1)return[n];const s=[];let u,f;for(let g=0;g<t;g++){const b=Kn(n[g]);0!==b&&(n[g].area=Math.abs(b),void 0===f&&(f=b<0),f===b<0?(u&&s.push(u),u=[n[g]]):u.push(n[g]))}if(u&&s.push(u),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(Li(s[g],e,1,s[g].length-1,hr),s[g]=s[g].slice(0,e));return s}function hr(n,e){return e.area-n.area}function lr(n,e,t){const s=t.patternDependencies;let u=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(u=!0);const b=g.constantOr(null);b&&(u=!0,s[b.to]=!0,s[b.from]=!0)}return u}function Jr(n,e,t,s,u){const f=u.patternDependencies;for(const g of e){const b=g.paint.get(`${n}-pattern`).value;if("constant"!==b.kind){let E=b.evaluate({zoom:s-1},t,{},u.availableImages),M=b.evaluate({zoom:s},t,{},u.availableImages),N=b.evaluate({zoom:s+1},t,{},u.availableImages);E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,N=N&&N.name?N.name:N,f[E]=!0,f[M]=!0,f[N]=!0,t.patterns[g.id]={min:E,mid:M,max:N}}}return t}af.deviation=function(n,e,t,s){var u=e&&e.length,f=Math.abs(ri(n,0,u?e[0]*t:n.length,t));if(u)for(var g=0,b=e.length;g<b;g++)f-=Math.abs(ri(n,e[g]*t,g<b-1?e[g+1]*t:n.length,t));var E=0;for(g=0;g<s.length;g+=3){var M=s[g]*t,N=s[g+1]*t,B=s[g+2]*t;E+=Math.abs((n[M]-n[B])*(n[N+1]-n[M+1])-(n[M]-n[N])*(n[B+1]-n[M+1]))}return 0===f&&0===E?0:Math.abs((E-f)/f)},af.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},s=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var g=0;g<e;g++)t.vertices.push(n[u][f][g]);u>0&&t.holes.push(s+=n[u-1].length)}return t},Rd.default=om;class Ar{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fn,this.indexArray=new bi,this.indexArray2=new Hs,this.programConfigurations=new El(e.layers,e.zoom),this.segments=new Go,this.segments2=new Go,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,s,u){this.hasPattern=lr("fill",this.layers,t);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:E,index:M,sourceLayerIndex:N}of e){const B=this.layers[0]._featureFilter.needGeometry,z=oc(b,B);if(!this.layers[0]._featureFilter.filter(new me(this.zoom),z,s))continue;const X=f?f.evaluate(z,{},s,t.availableImages):void 0,K={id:E,properties:b.properties,type:b.type,sourceLayerIndex:N,index:M,geometry:B?z.geometry:al(b,s,u),patterns:{},sortKey:X};g.push(K)}f&&g.sort((b,E)=>b.sortKey-E.sortKey);for(const b of g){const{geometry:E,index:M,sourceLayerIndex:N}=b;if(this.hasPattern){const B=Jr("fill",this.layers,b,this.zoom,t);this.patternFeatures.push(B)}else this.addFeature(b,E,M,s,{},t.availableImages);t.featureIndex.insert(e[M].feature,E,M,N,this.index)}}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}addFeatures(e,t,s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,t,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,s,u,f,g=[]){for(const b of ar(t,500)){let E=0;for(const K of b)E+=K.length;const M=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),N=M.vertexLength,B=[],z=[];for(const K of b){if(0===K.length)continue;K!==b[0]&&z.push(B.length/2);const oe=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),pe=oe.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(pe+K.length-1,pe),B.push(K[0].x),B.push(K[0].y);for(let Ce=1;Ce<K.length;Ce++)this.layoutVertexArray.emplaceBack(K[Ce].x,K[Ce].y),this.indexArray2.emplaceBack(pe+Ce-1,pe+Ce),B.push(K[Ce].x),B.push(K[Ce].y);oe.vertexLength+=K.length,oe.primitiveLength+=K.length}const X=Rd(B,z);for(let K=0;K<X.length;K+=3)this.indexArray.emplaceBack(N+X[K],N+X[K+1],N+X[K+2]);M.vertexLength+=E,M.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}}Dn(Ar,"FillBucket",{omit:["layers","patternFeatures"]});const us=new Pt({"fill-sort-key":new Je(at.layout_fill["fill-sort-key"])});var ds={paint:new Pt({"fill-antialias":new Le(at.paint_fill["fill-antialias"]),"fill-opacity":new Je(at.paint_fill["fill-opacity"]),"fill-color":new Je(at.paint_fill["fill-color"]),"fill-outline-color":new Je(at.paint_fill["fill-outline-color"]),"fill-translate":new Le(at.paint_fill["fill-translate"]),"fill-translate-anchor":new Le(at.paint_fill["fill-translate-anchor"]),"fill-pattern":new tt(at.paint_fill["fill-pattern"])}),layout:us};const $o=kt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Sl=kt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),qs=kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ic}=$o;var Ac=Qo;function Qo(n,e,t,s,u){this.properties={},this.extent=t,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=u,n.readFields(Il,this,e)}function Il(n,e,t){1==n?e.id=t.readVarint():2==n?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var g=u._keys[s.readVarint()],b=u._values[s.readVarint()];u.properties[g]=b}}(t,e):3==n?e.type=t.readVarint():4==n&&(e._geometry=t.pos)}function bh(n){for(var e,t,s=0,u=0,f=n.length,g=f-1;u<f;g=u++)s+=((t=n[g]).x-(e=n[u]).x)*(e.y+t.y);return s}Qo.types=["Unknown","Point","LineString","Polygon"],Qo.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,t=n.readVarint()+n.pos,s=1,u=0,f=0,g=0,b=[];n.pos<t;){if(u<=0){var E=n.readVarint();s=7&E,u=E>>3}if(u--,1===s||2===s)f+=n.readSVarint(),g+=n.readSVarint(),1===s&&(e&&b.push(e),e=[]),e.push(new st(f,g));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Qo.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,t=1,s=0,u=0,f=0,g=1/0,b=-1/0,E=1/0,M=-1/0;n.pos<e;){if(s<=0){var N=n.readVarint();t=7&N,s=N>>3}if(s--,1===t||2===t)(u+=n.readSVarint())<g&&(g=u),u>b&&(b=u),(f+=n.readSVarint())<E&&(E=f),f>M&&(M=f);else if(7!==t)throw new Error("unknown command "+t)}return[g,E,b,M]},Qo.prototype.toGeoJSON=function(n,e,t){var s,u,f=this.extent*Math.pow(2,t),g=this.extent*n,b=this.extent*e,E=this.loadGeometry(),M=Qo.types[this.type];function N(X){for(var K=0;K<X.length;K++){var oe=X[K];X[K]=[360*(oe.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+b)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(s=0;s<E.length;s++)B[s]=E[s][0];N(E=B);break;case 2:for(s=0;s<E.length;s++)N(E[s]);break;case 3:for(E=function(X){var K=X.length;if(K<=1)return[X];for(var oe,pe,Ce=[],Fe=0;Fe<K;Fe++){var Ee=bh(X[Fe]);0!==Ee&&(void 0===pe&&(pe=Ee<0),pe===Ee<0?(oe&&Ce.push(oe),oe=[X[Fe]]):oe.push(X[Fe]))}return oe&&Ce.push(oe),Ce}(E),s=0;s<E.length;s++)for(u=0;u<E[s].length;u++)N(E[s][u])}1===E.length?E=E[0]:M="Multi"+M;var z={type:"Feature",geometry:{type:M,coordinates:E},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Pc=ad;function ad(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Oc,this,e),this.length=this._features.length}function Oc(n,e,t){15===n?e.version=t.readVarint():1===n?e.name=t.readString():5===n?e.extent=t.readVarint():2===n?e._features.push(t.pos):3===n?e._keys.push(t.readString()):4===n&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var g=s.readVarint()>>3;u=1===g?s.readString():2===g?s.readFloat():3===g?s.readDouble():4===g?s.readVarint64():5===g?s.readVarint():6===g?s.readSVarint():7===g?s.readBoolean():null}return u}(t))}function ld(n,e,t){if(3===n){var s=new Pc(t,t.readVarint()+t.pos);s.length&&(e[s.name]=s)}}ad.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Ac(this._pbf,e,this.extent,this._keys,this._values)};var Al={VectorTile:function(n,e){this.layers=n.readFields(ld,{},e)},VectorTileFeature:Ac,VectorTileLayer:Pc};function Rc(n,e,t,s){const u=[],f=0===s?(g,b,E,M,N,B)=>{g.push(new st(B,E+(B-b)/(M-b)*(N-E)))}:(g,b,E,M,N,B)=>{g.push(new st(b+(B-E)/(N-E)*(M-b),B))};for(const g of n){const b=[];for(const E of g){if(E.length<=2)continue;const M=[];for(let z=0;z<E.length-1;z++){const X=E[z].x,K=E[z].y,oe=E[z+1].x,pe=E[z+1].y,Ce=0===s?X:K,Fe=0===s?oe:pe;Ce<e?Fe>e&&f(M,X,K,oe,pe,e):Ce>t?Fe<t&&f(M,X,K,oe,pe,t):M.push(E[z]),Fe<e&&Ce>=e&&f(M,X,K,oe,pe,e),Fe>t&&Ce<=t&&f(M,X,K,oe,pe,t)}let N=E[E.length-1];const B=0===s?N.x:N.y;B>=e&&B<=t&&M.push(N),M.length&&(N=M[M.length-1],M[0].x===N.x&&M[0].y===N.y||M.push(M[0]),b.push(M))}b.length&&u.push(b)}return u}const Ru=Al.VectorTileFeature.types,au=Math.pow(2,13);function lu(n,e,t,s,u,f,g,b){n.emplaceBack((e<<1)+g,(t<<1)+f,(Math.floor(s*au)<<1)+u,Math.round(b))}function ul(n,e,t){n.emplaceBack(e.x,e.y,e.z,16384*t[0],16384*t[1],16384*t[2])}class Nd{constructor(){this.acc=new st(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new st(e.x,e.y),this.max=new st(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===ii)&&e.x===t.x)!=((0===e.y||e.y===ii)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Ti(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ii!=e.x>ii&&this.addBorderIntersection(1,Ti(t.y,e.y,(ii-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Ti(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ii!=e.y>ii&&this.addBorderIntersection(3,Ti(t.x,e.x,(ii-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];t<s[0]&&(s[0]=t),t>s[1]&&(s[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,t.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,t.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((t,s)=>t+s.edges,0);return 0!==e?this.acc.div(e)._round():new st(0,0)}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class cd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new $n,this.centroidVertexArray=new Zm,this.indexArray=new bi,this.programConfigurations=new El(e.layers,e.zoom),this.segments=new Go,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,s,u){this.features=[],this.hasPattern=lr("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/ii/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:b,sourceLayerIndex:E}of e){const M=this.layers[0]._featureFilter.needGeometry,N=oc(f,M);if(!this.layers[0]._featureFilter.filter(new me(this.zoom),N,s))continue;const B={id:g,sourceLayerIndex:E,index:b,geometry:M?N.geometry:al(f,s,u),properties:f.properties,type:f.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Jr("fill-extrusion",this.layers,B,this.zoom,t)):this.addFeature(B,B.geometry,b,s,{},t.availableImages,u),t.featureIndex.insert(f,B.geometry,b,E,this.index,z)}this.sortBorders()}addFeatures(e,t,s,u,f){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,t,s,u,f)}this.sortBorders()}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ic),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,qs.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Sl.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,s,u,f,g,b){const E=[new st(0,0),new st(ii,ii)],M=b.projection,N="globe"===M.name,B=this.enableTerrain&&!N?new Nd:null,z="Polygon"===Ru[e.type];N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ks);const X=ar(t,500);for(let Ce=X.length-1;Ce>=0;Ce--){const Fe=X[Ce];(0===Fe.length||(K=Fe[0]).every(Ee=>Ee.x<=0)||K.every(Ee=>Ee.x>=ii)||K.every(Ee=>Ee.y<=0)||K.every(Ee=>Ee.y>=ii))&&X.splice(Ce,1)}var K;let oe;if(N)oe=wh(X,E,u);else{oe=[];for(const Ce of X)oe.push({polygon:Ce,bounds:E})}const pe=z?this.edgeRadius:0;for(const{polygon:Ce,bounds:Fe}of oe){let Ee=0,Re=0;for(const Be of Ce)z&&!Be[0].equals(Be[Be.length-1])&&Be.push(Be[0]),Re+=z?Be.length-1:Be.length;const Ye=this.segments.prepareSegment((z?5:4)*Re,this.layoutVertexArray,this.indexArray);if(z){const Be=[],mt=[];Ee=Ye.vertexLength;for(const Ot of Ce){let an,vt;Ot.length&&Ot!==Ce[0]&&mt.push(Be.length/2),an=Ot[1].sub(Ot[0])._perp()._unit();for(let zt=1;zt<Ot.length;zt++){const Ht=Ot[zt],Lt=Ot[zt===Ot.length-1?1:zt+1];let{x:sn,y:Wt}=Ht;if(pe){vt=Lt.sub(Ht)._perp()._unit();const Cn=an.add(vt)._unit(),yi=pe*Math.min(4,1/(an.x*Cn.x+an.y*Cn.y));sn+=yi*Cn.x,Wt+=yi*Cn.y,an=vt}lu(this.layoutVertexArray,sn,Wt,0,0,1,1,0),Ye.vertexLength++,Be.push(Ht.x,Ht.y),N&&ul(this.layoutVertexExtArray,M.projectTilePoint(sn,Wt,u),M.upVector(u,sn,Wt))}}const pt=Rd(Be,mt);for(let Ot=0;Ot<pt.length;Ot+=3)this.indexArray.emplaceBack(Ee+pt[Ot],Ee+pt[Ot+2],Ee+pt[Ot+1]),Ye.primitiveLength++}for(const Be of Ce){B&&Be.length&&B.startRing(Be[0]);let mt,pt,Ot,an=Be.length>4&&lf(Be[Be.length-2],Be[0],Be[1]),vt=pe?op(Be[Be.length-2],Be[0],Be[1],pe):0;pt=Be[1].sub(Be[0])._perp()._unit();for(let zt=1,Ht=0;zt<Be.length;zt++){let Lt=Be[zt-1],sn=Be[zt];const Wt=Be[zt===Be.length-1?1:zt+1];if(B&&z&&B.currentPolyCount.top++,kd(sn,Lt,Fe)){pe&&(pt=Wt.sub(sn)._perp()._unit());continue}B&&B.append(sn,Lt);const Cn=sn.sub(Lt)._perp(),yi=Cn.x/(Math.abs(Cn.x)+Math.abs(Cn.y)),xi=Cn.y>0?1:0,Hn=Lt.dist(sn);if(Ht+Hn>32768&&(Ht=0),pe){Ot=Wt.sub(sn)._perp()._unit();let Mn=dd(Lt,sn,Wt,ud(pt,Ot),pe);isNaN(Mn)&&(Mn=0);const zr=sn.sub(Lt)._unit();Lt=Lt.add(zr.mult(vt))._round(),sn=sn.add(zr.mult(-Mn))._round(),vt=Mn,pt=Ot}const hn=Ye.vertexLength,Bi=Be.length>4&&lf(Lt,sn,Wt);let pi=Fd(Ht,an,!0);if(lu(this.layoutVertexArray,Lt.x,Lt.y,yi,xi,0,0,pi),lu(this.layoutVertexArray,Lt.x,Lt.y,yi,xi,0,1,pi),Ht+=Hn,pi=Fd(Ht,Bi,!1),an=Bi,lu(this.layoutVertexArray,sn.x,sn.y,yi,xi,0,0,pi),lu(this.layoutVertexArray,sn.x,sn.y,yi,xi,0,1,pi),Ye.vertexLength+=4,this.indexArray.emplaceBack(hn+0,hn+1,hn+2),this.indexArray.emplaceBack(hn+1,hn+3,hn+2),Ye.primitiveLength+=2,pe){const Mn=Ee+(1===zt?Be.length-2:zt-2),zr=1===zt?Ee:Mn+1;if(this.indexArray.emplaceBack(hn+1,Mn,hn+3),this.indexArray.emplaceBack(Mn,zr,hn+3),Ye.primitiveLength+=2,void 0===mt&&(mt=hn),!kd(Wt,Be[zt],Fe)){const Or=zt===Be.length-1?mt:Ye.vertexLength;this.indexArray.emplaceBack(hn+2,hn+3,Or),this.indexArray.emplaceBack(hn+3,Or+1,Or),this.indexArray.emplaceBack(hn+3,zr,Or+1),Ye.primitiveLength+=3}}if(N){const Mn=this.layoutVertexExtArray,zr=M.projectTilePoint(Lt.x,Lt.y,u),Or=M.projectTilePoint(sn.x,sn.y,u),so=M.upVector(u,Lt.x,Lt.y),Oi=M.upVector(u,sn.x,sn.y);ul(Mn,zr,so),ul(Mn,zr,so),ul(Mn,Or,Oi),ul(Mn,Or,Oi)}}z&&(Ee+=Be.length-1)}}if(B&&B.polyCount.length>0){if(B.borders){B.vertexArrayOffset=this.centroidVertexArray.length;const Ce=B.borders,Fe=this.featuresOnBorder.push(B)-1;for(let Ee=0;Ee<4;Ee++)Ce[Ee][0]!==Number.MAX_VALUE&&this.borders[Ee].push(Fe)}this.encodeCentroid(B.borders?void 0:B.centroid(),B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,s)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,t,s=!0){let u,f;if(e)if(0!==e.y){const b=t.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let g=s?this.centroidVertexArray.length:t.vertexArrayOffset;for(const b of t.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let E=0;E<b.top;E++)this.centroidVertexArray.emplace(g++,u,f);for(let E=0;E<2*b.edges;E++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,u,f)}}}function ud(n,e){const t=n.add(e)._unit();return n.x*t.x+n.y*t.y}function op(n,e,t,s){const u=e.sub(n)._perp()._unit(),f=t.sub(e)._perp()._unit();return dd(n,e,t,ud(u,f),s)}function dd(n,e,t,s,u){const f=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(t)/3,u*f/s)}function kd(n,e,t){return n.x<t[0].x&&e.x<t[0].x||n.x>t[1].x&&e.x>t[1].x||n.y<t[0].y&&e.y<t[0].y||n.y>t[1].y&&e.y>t[1].y}function lf(n,e,t){if(n.x<0||n.x>=ii||e.x<0||e.x>=ii||t.x<0||t.x>=ii)return!1;const s=t.sub(e),u=s.perp(),f=n.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function Fd(n,e,t){const s=e?2|n:-3&n;return t?1|s:-2&s}function xh(){const n=Math.PI/32,e=Math.tan(n),t=$f;return t*Math.sqrt(1+2*e*e)-t}function wh(n,e,t){const s=1<<t.z,u=Ca(t.x/s),f=Ca((t.x+1)/s),g=cs(t.y/s),b=cs((t.y+1)/s);return function(E,M,N,B,z=0,X){const K=[];if(!E.length||!N||!B)return K;const oe=(Be,mt)=>{for(const pt of Be)K.push({polygon:pt,bounds:mt})},pe=Math.ceil(Math.log2(N)),Ce=Math.ceil(Math.log2(B)),Fe=pe-Ce,Ee=[];for(let Be=0;Be<Math.abs(Fe);Be++)Ee.push(Fe>0?0:1);for(let Be=0;Be<Math.min(pe,Ce);Be++)Ee.push(0),Ee.push(1);let Re=E;if(Re=Rc(Re,M[0].y-z,M[1].y+z,1),Re=Rc(Re,M[0].x-z,M[1].x+z,0),!Re.length)return K;const Ye=[];for(Ee.length?Ye.push({polygons:Re,bounds:M,depth:0}):oe(Re,M);Ye.length;){const Be=Ye.pop(),mt=Be.depth,pt=Ee[mt],Ot=Be.bounds[0],an=Be.bounds[1],vt=0===pt?Ot.x:Ot.y,zt=0===pt?an.x:an.y,Ht=X?X(pt,vt,zt):.5*(vt+zt),Lt=Rc(Be.polygons,vt-z,Ht+z,pt),sn=Rc(Be.polygons,Ht-z,zt+z,pt);if(Lt.length){const Wt=[Ot,new st(0===pt?Ht:an.x,1===pt?Ht:an.y)];Ee.length>mt+1?Ye.push({polygons:Lt,bounds:Wt,depth:mt+1}):oe(Lt,Wt)}if(sn.length){const Wt=[new st(0===pt?Ht:Ot.x,1===pt?Ht:Ot.y),an];Ee.length>mt+1?Ye.push({polygons:sn,bounds:Wt,depth:mt+1}):oe(sn,Wt)}}return K}(n,e,Math.ceil((f-u)/11.25),Math.ceil((g-b)/11.25),1,(E,M,N)=>{if(0===E)return.5*(M+N);{const B=cs((t.y+M/ii)/s);return(ic(.5*(cs((t.y+N/ii)/s)+B))*s-t.y)*ii}})}Dn(cd,"FillExtrusionBucket",{omit:["layers","features"]}),Dn(Nd,"PartMetadata");const Ld=new Pt({"fill-extrusion-edge-radius":new Le(at["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Nu={paint:new Pt({"fill-extrusion-opacity":new Le(at["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Je(at["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Le(at["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Le(at["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tt(at["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Je(at["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Je(at["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Le(at["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Le(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Le(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Ld};function hd(n,e,t){var s=2*Math.PI*6378137/256/Math.pow(2,t);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Bd{constructor(e,t,s){this.z=e,this.x=t,this.y=s,this.key=cu(0,e,e,t,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const s=(g=this.y,b=this.z,E=hd(256*(f=this.x),256*(g=Math.pow(2,b)-g-1),b),M=hd(256*(f+1),256*(g+1),b),E[0]+","+E[1]+","+M[0]+","+M[1]),u=function(f,g,b){let E,M="";for(let N=f;N>0;N--)E=1<<N-1,M+=(g&E?1:0)+(b&E?2:0);return M}(this.z,this.x,this.y);var f,g,b,E,M;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cf{constructor(e,t){this.wrap=e,this.canonical=t,this.key=cu(e,t.z,t.z,t.x,t.y)}}class hs{constructor(e,t,s,u,f){this.overscaledZ=e,this.wrap=t,this.canonical=new Bd(s,+u,+f),this.key=0===t&&e===s?this.canonical.key:cu(t,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new hs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hs(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return cu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return cu(this.wrap*+t,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new hs(t,this.wrap,t,s,u),new hs(t,this.wrap,t,s+1,u),new hs(t,this.wrap,t,s,u+1),new hs(t,this.wrap,t,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function cu(n,e,t,s,u){const f=1<<Math.min(t,22);let g=f*(u%f)+s%f;return n&&t<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-t)))),16*(32*g+t)+(e-t)}function ku(n,e){return n.x*e.x+n.y*e.y}function sp(n,e){if(1===n.length){let t=0;const s=e[t++];let u;for(;!u||s.equals(u);)if(u=e[t++],!u)return 1/0;for(;t<e.length;t++){const f=e[t],g=n[0],b=u.sub(s),E=f.sub(s),M=g.sub(s),N=ku(b,b),B=ku(b,E),z=ku(E,E),X=ku(M,b),K=ku(M,E),oe=N*z-B*B,pe=(z*X-B*K)/oe,Ce=(N*K-B*X)/oe,Fe=s.z*(1-pe-Ce)+u.z*pe+f.z*Ce;if(isFinite(Fe))return Fe}return 1/0}{let t=1/0;for(const s of e)t=Math.min(t,s.z);return t}}function fd(n){const e=new st(n[0],n[1]);return e.z=n[2],e}function sg(n,e,t,s,u,f,g,b){const E=g*u.getElevationAt(n,e,!0,!0),M=0!==f[0],N=M?0===f[1]?g*(f[0]/7-450):g*function(B,z,X){const K=Math.floor(z[0]/8),oe=Math.floor(z[1]/8),pe=10*(z[0]-8*K),Ce=10*(z[1]-8*oe),Fe=B.getElevationAt(K,oe,!0,!0),Ee=B.getMeterToDEM(X),Re=Math.floor(.5*(pe*Ee-1)),Ye=Math.floor(.5*(Ce*Ee-1)),Be=B.tileCoordToPixel(K,oe),mt=2*Re+1,pt=2*Ye+1,Ot=(yi=mt,xi=pt,[(sn=B).getElevationAtPixel(Wt=Be.x-Re,Cn=Be.y-Ye,!0),sn.getElevationAtPixel(Wt+xi,Cn,!0),sn.getElevationAtPixel(Wt,Cn+xi,!0),sn.getElevationAtPixel(Wt+yi,Cn+xi,!0)]),an=Math.abs(Ot[0]-Ot[1]),vt=Math.abs(Ot[2]-Ot[3]),zt=Math.abs(Ot[0]-Ot[2])+Math.abs(Ot[1]-Ot[3]),Ht=Math.min(.25,.5*Ee*(an+vt)/mt),Lt=Math.min(.25,.5*Ee*zt/pt);var sn,Wt,Cn,yi,xi;return Fe+Math.max(Ht*pe,Lt*Ce)}(u,f,b):E;return{base:E+(0===t)?-1:t,top:M?Math.max(N+s,E+t+2):E+s}}Dn(Bd,"CanonicalTileID"),Dn(hs,"OverscaledTileID",{omit:["projMatrix"]});const ag=kt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:d_}=ag,h_=kt([{name:"a_packed",components:4,type:"Float32"}]),{members:Nc}=h_,f_=Al.VectorTileFeature.types,lg=Math.cos(Math.PI/180*37.5);class ap{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new ci,this.layoutVertexArray2=new Fi,this.indexArray=new bi,this.programConfigurations=new El(e.layers,e.zoom),this.segments=new Go,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,s,u){this.hasPattern=lr("line",this.layers,t);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:N,id:B,index:z,sourceLayerIndex:X}of e){const K=this.layers[0]._featureFilter.needGeometry,oe=oc(N,K);if(!this.layers[0]._featureFilter.filter(new me(this.zoom),oe,s))continue;const pe=f?f.evaluate(oe,{},s):void 0,Ce={id:B,properties:N.properties,type:N.type,sourceLayerIndex:X,index:z,geometry:K?oe.geometry:al(N,s,u),patterns:{},sortKey:pe};g.push(Ce)}f&&g.sort((N,B)=>N.sortKey-B.sortKey);const{lineAtlas:b,featureIndex:E}=t,M=this.addConstantDashes(b);for(const N of g){const{geometry:B,index:z,sourceLayerIndex:X}=N;if(M&&this.addFeatureDashes(N,b),this.hasPattern){const K=Jr("line",this.layers,N,this.zoom,t);this.patternFeatures.push(K)}else this.addFeature(N,B,z,s,b.positions,t.availableImages);E.insert(e[z].feature,B,z,X,this.index)}}addConstantDashes(e){let t=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)t=!0;else{const g=f.value,b=u.value;if(!b)continue;e.addDash(b.from,g),e.addDash(b.to,g),b.other&&e.addDash(b.other,g)}}return t}addFeatureDashes(e,t){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let b,E,M,N,B,z;if("constant"===f.kind){const pe=f.value;if(!pe)continue;b=pe.other||pe.to,E=pe.to,M=pe.from}else b=f.evaluate({zoom:s-1},e),E=f.evaluate({zoom:s},e),M=f.evaluate({zoom:s+1},e);"constant"===g.kind?N=B=z=g.value:(N=g.evaluate({zoom:s-1},e),B=g.evaluate({zoom:s},e),z=g.evaluate({zoom:s+1},e)),t.addDash(b,N),t.addDash(E,B),t.addDash(M,z);const X=t.getKey(b,N),K=t.getKey(E,B),oe=t.getKey(M,z);e.patterns[u.id]={min:X,mid:K,max:oe}}}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}addFeatures(e,t,s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,t,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Nc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,s,u,f,g){const b=this.layers[0].layout,E=b.get("line-join").evaluate(e,{}),M=b.get("line-cap").evaluate(e,{}),N=b.get("line-miter-limit"),B=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of t)this.addLine(z,e,E,M,N,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}addLine(e,t,s,u,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<e.length-1;Ce++)this.totalDistance+=e[Ce].dist(e[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===f_[t.type];let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let M=0;for(;M<E-1&&e[M].equals(e[M+1]);)M++;if(E<(b?3:2))return;"bevel"===s&&(f=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let z,X,K,oe,pe;this.e1=this.e2=-1,b&&(z=e[E-2],pe=e[M].sub(z)._unit()._perp());for(let Ce=M;Ce<E;Ce++){if(K=Ce===E-1?b?e[M+1]:void 0:e[Ce+1],K&&e[Ce].equals(K))continue;pe&&(oe=pe),z&&(X=z),z=e[Ce],pe=K?K.sub(z)._unit()._perp():oe,oe=oe||pe;let Fe=oe.add(pe);0===Fe.x&&0===Fe.y||Fe._unit();const Ee=oe.x*pe.x+oe.y*pe.y,Re=Fe.x*pe.x+Fe.y*pe.y,Ye=0!==Re?1/Re:1/0,Be=2*Math.sqrt(2-2*Re),mt=Re<lg&&X&&K,pt=oe.x*pe.y-oe.y*pe.x>0;if(mt&&Ce>M){const vt=z.dist(X);if(vt>2*N){const zt=z.sub(z.sub(X)._mult(N/vt)._round());this.updateDistance(X,zt),this.addCurrentVertex(zt,oe,0,0,B),X=zt}}const Ot=X&&K;let an=Ot?s:b?"butt":u;if(Ot&&"round"===an&&(Ye<g?an="miter":Ye<=2&&(an="fakeround")),"miter"===an&&Ye>f&&(an="bevel"),"bevel"===an&&(Ye>2&&(an="flipbevel"),Ye<f&&(an="miter")),X&&this.updateDistance(X,z),"miter"===an)Fe._mult(Ye),this.addCurrentVertex(z,Fe,0,0,B);else if("flipbevel"===an){if(Ye>100)Fe=pe.mult(-1);else{const vt=Ye*oe.add(pe).mag()/oe.sub(pe).mag();Fe._perp()._mult(vt*(pt?-1:1))}this.addCurrentVertex(z,Fe,0,0,B),this.addCurrentVertex(z,Fe.mult(-1),0,0,B)}else if("bevel"===an||"fakeround"===an){const vt=-Math.sqrt(Ye*Ye-1),zt=pt?vt:0,Ht=pt?0:vt;if(X&&this.addCurrentVertex(z,oe,zt,Ht,B),"fakeround"===an){const Lt=Math.round(180*Be/Math.PI/20);for(let sn=1;sn<Lt;sn++){let Wt=sn/Lt;if(.5!==Wt){const yi=Wt-.5;Wt+=Wt*yi*(Wt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*yi*yi+(.848013+Ee*(.215638*Ee-1.06021)))}const Cn=pe.sub(oe)._mult(Wt)._add(oe)._unit()._mult(pt?-1:1);this.addHalfVertex(z,Cn.x,Cn.y,!1,pt,0,B)}}K&&this.addCurrentVertex(z,pe,-zt,-Ht,B)}else if("butt"===an)this.addCurrentVertex(z,Fe,0,0,B);else if("square"===an){const vt=X?1:-1;X||this.addCurrentVertex(z,Fe,vt,vt,B),this.addCurrentVertex(z,Fe,0,0,B),X&&this.addCurrentVertex(z,Fe,vt,vt,B)}else"round"===an&&(X&&(this.addCurrentVertex(z,oe,0,0,B),this.addCurrentVertex(z,oe,1,1,B,!0)),K&&(this.addCurrentVertex(z,pe,-1,-1,B,!0),this.addCurrentVertex(z,pe,0,0,B)));if(mt&&Ce<E-1){const vt=z.dist(K);if(vt>2*N){const zt=z.add(K.sub(z)._mult(N/vt)._round());this.updateDistance(z,zt),this.addCurrentVertex(zt,pe,0,0,B),z=zt}}}}addCurrentVertex(e,t,s,u,f,g=!1){const b=t.y*u-t.x,E=-t.y-t.x*u;this.addHalfVertex(e,t.x+t.y*s,t.y-t.x*s,g,!1,s,f),this.addHalfVertex(e,b,E,g,!0,-u,f)}addHalfVertex({x:e,y:t},s,u,f,g,b,E){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(t<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),g?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Dn(ap,"LineBucket",{omit:["layers","patternFeatures"]});const p_=new Pt({"line-cap":new Je(at.layout_line["line-cap"]),"line-join":new Je(at.layout_line["line-join"]),"line-miter-limit":new Le(at.layout_line["line-miter-limit"]),"line-round-limit":new Le(at.layout_line["line-round-limit"]),"line-sort-key":new Je(at.layout_line["line-sort-key"])});var cg={paint:new Pt({"line-opacity":new Je(at.paint_line["line-opacity"]),"line-color":new Je(at.paint_line["line-color"]),"line-translate":new Le(at.paint_line["line-translate"]),"line-translate-anchor":new Le(at.paint_line["line-translate-anchor"]),"line-width":new Je(at.paint_line["line-width"]),"line-gap-width":new Je(at.paint_line["line-gap-width"]),"line-offset":new Je(at.paint_line["line-offset"]),"line-blur":new Je(at.paint_line["line-blur"]),"line-dasharray":new tt(at.paint_line["line-dasharray"]),"line-pattern":new tt(at.paint_line["line-pattern"]),"line-gradient":new rt(at.paint_line["line-gradient"]),"line-trim-offset":new Le(at.paint_line["line-trim-offset"])}),layout:p_};const ug=new class extends Je{possiblyEvaluate(n,e){return e=new me(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,t,s){return e=Zt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,t,s)}}(cg.paint.properties["line-width"].specification);function am(n,e){return e>0?e+2*n:n}ug.useIntegerZoom=!0;const m_=kt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),g_=kt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),__=kt([{name:"a_projected_pos",components:4,type:"Float32"}],4);kt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Gi=kt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),dg=kt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lm=kt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hg=kt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);kt([{name:"triangle",components:3,type:"Uint16"}]),kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),kt([{type:"Float32",name:"offsetX"}]),kt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const uu=128;function lp(n,e){const{expression:t}=e;if("constant"===t.kind)return{kind:"constant",layoutSize:t.evaluate(new me(n+1))};if("source"===t.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=t;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<s.length&&s[g]<n+1;)g++;g=Math.min(s.length-1,g);const b=s[f],E=s[g];return"composite"===t.kind?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:E,minSize:t.evaluate(new me(b)),maxSize:t.evaluate(new me(E)),interpolationType:u}}}function cp(n,{uSize:e,uSizeT:t},{lowerSize:s,upperSize:u}){return"source"===n.kind?s/uu:"composite"===n.kind?Ti(s/uu,u/uu,t):e}function zd(n,e){let t=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:g}=n,b=u?on(q.interpolationFactor(u,e,f,g),0,1):0;"camera"===n.kind?s=Ti(n.minSize,n.maxSize,b):t=b}return{uSizeT:t,uSize:s}}var y_=Object.freeze({__proto__:null,getSizeData:lp,evaluateSizeForFeature:cp,evaluateSizeForZoom:zd,SIZE_PACK_FACTOR:uu});function v_(n,e,t){return n.sections.forEach(s=>{s.text=function(u,f,g){const b=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===b?u=u.toLocaleUpperCase():"lowercase"===b&&(u=u.toLocaleLowerCase()),de.applyArabicShaping&&(u=de.applyArabicShaping(u)),u}(s.text,e,t)}),n}const up={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function fg(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function pg(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var pd=function(n,e,t,s,u){var f,g,b=8*u-s-1,E=(1<<b)-1,M=E>>1,N=-7,B=t?u-1:0,z=t?-1:1,X=n[e+B];for(B+=z,f=X&(1<<-N)-1,X>>=-N,N+=b;N>0;f=256*f+n[e+B],B+=z,N-=8);for(g=f&(1<<-N)-1,f>>=-N,N+=s;N>0;g=256*g+n[e+B],B+=z,N-=8);if(0===f)f=1-M;else{if(f===E)return g?NaN:1/0*(X?-1:1);g+=Math.pow(2,s),f-=M}return(X?-1:1)*g*Math.pow(2,f-s)},mg=function(n,e,t,s,u,f){var g,b,E,M=8*f-u-1,N=(1<<M)-1,B=N>>1,z=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,X=s?0:f-1,K=s?1:-1,oe=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=N):(g=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-g))<1&&(g--,E*=2),(e+=g+B>=1?z/E:z*Math.pow(2,1-B))*E>=2&&(g++,E/=2),g+B>=N?(b=0,g=N):g+B>=1?(b=(e*E-1)*Math.pow(2,u),g+=B):(b=e*Math.pow(2,B-1)*Math.pow(2,u),g=0));u>=8;n[t+X]=255&b,X+=K,b/=256,u-=8);for(g=g<<u|b,M+=u;M>0;n[t+X]=255&g,X+=K,g/=256,M-=8);n[t+X-K]|=128*oe},Vd=Pr;function Pr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Pr.Varint=0,Pr.Fixed64=1,Pr.Bytes=2,Pr.Fixed32=5;var cm=4294967296,b_=1/cm,x_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function md(n){return n.type===Pr.Bytes?n.readVarint()+n.pos:n.pos+1}function um(n,e,t){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(s);for(var u=t.pos-1;u>=n;u--)t.buf[u+s]=t.buf[u]}function Uy(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function w_(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Th(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function D_(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function gg(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function dp(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function T_(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function _g(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function C_(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function hp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Ch(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function yg(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function E_(n,e,t){e.glyphs=[],1===n&&t.readMessage(vg,e)}function vg(n,e,t){if(3===n){const{id:s,bitmap:u,width:f,height:g,left:b,top:E,advance:M}=t.readMessage(M_,{});e.glyphs.push({id:s,bitmap:new sc({width:f+6,height:g+6},u),metrics:{width:f,height:g,left:b,top:E,advance:M}})}else 4===n?e.ascender=t.readSVarint():5===n&&(e.descender=t.readSVarint())}function M_(n,e,t){1===n?e.id=t.readVarint():2===n?e.bitmap=t.readBytes():3===n?e.width=t.readVarint():4===n?e.height=t.readVarint():5===n?e.left=t.readSVarint():6===n?e.top=t.readSVarint():7===n&&(e.advance=t.readVarint())}function fp(n){let e=0,t=0;for(const g of n)e+=g.w*g.h,t=Math.max(t,g.w);n.sort((g,b)=>b.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let u=0,f=0;for(const g of n)for(let b=s.length-1;b>=0;b--){const E=s[b];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,f=Math.max(f,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===E.w&&g.h===E.h){const M=s.pop();b<s.length&&(s[b]=M)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(s.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Pr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,n(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=hp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=yg(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=hp(this.buf,this.pos)+hp(this.buf,this.pos+4)*cm;return this.pos+=8,n},readSFixed64:function(){var n=hp(this.buf,this.pos)+yg(this.buf,this.pos+4)*cm;return this.pos+=8,n},readFloat:function(){var n=pd(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=pd(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,t,s=this.buf;return e=127&(t=s[this.pos++]),t<128?e:(e|=(127&(t=s[this.pos++]))<<7,t<128?e:(e|=(127&(t=s[this.pos++]))<<14,t<128?e:(e|=(127&(t=s[this.pos++]))<<21,t<128?e:function(u,f,g){var b,E,M=g.buf;if(b=(112&(E=M[g.pos++]))>>4,E<128||(b|=(127&(E=M[g.pos++]))<<3,E<128)||(b|=(127&(E=M[g.pos++]))<<10,E<128)||(b|=(127&(E=M[g.pos++]))<<17,E<128)||(b|=(127&(E=M[g.pos++]))<<24,E<128)||(b|=(1&(E=M[g.pos++]))<<31,E<128))return function Dh(n,e,t){return t?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,b,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&x_?x_.decode(this.buf.subarray(e,n)):function(t,s,u){for(var f="",g=s;g<u;){var b,E,M,N=t[g],B=null,z=N>239?4:N>223?3:N>191?2:1;if(g+z>u)break;1===z?N<128&&(B=N):2===z?128==(192&(b=t[g+1]))&&(B=(31&N)<<6|63&b)<=127&&(B=null):3===z?(E=t[g+2],128==(192&(b=t[g+1]))&&128==(192&E)&&((B=(15&N)<<12|(63&b)<<6|63&E)<=2047||B>=55296&&B<=57343)&&(B=null)):4===z&&(E=t[g+2],M=t[g+3],128==(192&(b=t[g+1]))&&128==(192&E)&&128==(192&M)&&((B=(15&N)<<18|(63&b)<<12|(63&E)<<6|63&M)<=65535||B>=1114112)&&(B=null)),null===B?(B=65533,z=1):B>65535&&(B-=65536,f+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),f+=String.fromCharCode(B),g+=z}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Pr.Bytes)return n.push(this.readVarint(e));var t=md(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSVarint());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Pr.Bytes)return n.push(this.readBoolean());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFloat());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Pr.Bytes)return n.push(this.readDouble());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFixed32());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSFixed32());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFixed64());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSFixed64());var e=md(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Pr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pr.Fixed32)this.pos+=4;else{if(e!==Pr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Ch(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Ch(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Ch(this.buf,-1&n,this.pos),Ch(this.buf,Math.floor(n*b_),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Ch(this.buf,-1&n,this.pos),Ch(this.buf,Math.floor(n*b_),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,t){var s,u,f,b;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),f=s,(b=t).buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7),function(f,g){var b=(7&f)<<4;g.buf[g.pos++]|=b|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(u,t)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var g,b,E=0;E<u.length;E++){if((g=u.charCodeAt(E))>55295&&g<57344){if(!b){g>56319||E+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):b=g;continue}if(g<56320){s[f++]=239,s[f++]=191,s[f++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(s[f++]=239,s[f++]=191,s[f++]=189,b=null);g<128?s[f++]=g:(g<2048?s[f++]=g>>6|192:(g<65536?s[f++]=g>>12|224:(s[f++]=g>>18|240,s[f++]=g>>12&63|128),s[f++]=g>>6&63|128),s[f++]=63&g|128)}return f}(this.buf,n,this.pos);var t=this.pos-e;t>=128&&um(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),mg(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),mg(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var s=this.pos-t;s>=128&&um(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,t){this.writeTag(n,Pr.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Uy,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,w_,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,gg,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Th,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,D_,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,dp,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,T_,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,_g,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,C_,e)},writeBytesField:function(n,e){this.writeTag(n,Pr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Pr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Pr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Pr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class pp{constructor(e,{pixelRatio:t,version:s,stretchX:u,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=u,this.stretchY=f,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class mp{constructor(e,t){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(t,u,f);const{w:g,h:b}=fp(f),E=new Xr({width:g||1,height:b||1});for(const M in e){const N=e[M],B=s[M].paddedRect;Xr.copy(N.data,E,{x:0,y:0},{x:B.x+1,y:B.y+1},N.data)}for(const M in t){const N=t[M],B=u[M].paddedRect,z=B.x+1,X=B.y+1,K=N.data.width,oe=N.data.height;Xr.copy(N.data,E,{x:0,y:0},{x:z,y:X},N.data),Xr.copy(N.data,E,{x:0,y:oe-1},{x:z,y:X-1},{width:K,height:1}),Xr.copy(N.data,E,{x:0,y:0},{x:z,y:X+oe},{width:K,height:1}),Xr.copy(N.data,E,{x:K-1,y:0},{x:z-1,y:X},{width:1,height:oe}),Xr.copy(N.data,E,{x:0,y:0},{x:z+K,y:X},{width:1,height:oe})}this.image=E,this.iconPositions=s,this.patternPositions=u}addImages(e,t,s){for(const u in e){const f=e[u],g={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(g),t[u]=new pp(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),t),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),t)}patchUpdatedImage(e,t,s){if(!e||!t||e.version===t.version)return;e.version=t.version;const[u,f]=e.tl;s.update(t.data,void 0,{x:u,y:f})}}Dn(pp,"ImagePosition"),Dn(mp,"ImageAtlas");const ac={horizontal:1,vertical:2,horizontalOnly:3};class Ud{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const s=new Ud;return s.scale=e||1,s.fontStack=t,s}static forImage(e){const t=new Ud;return t.imageName=e,t}}class Eh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const s=new Eh;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,t)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,s){let u="";for(let f=0;f<t.length;f++){const g=t.charCodeAt(f+1)||null,b=t.charCodeAt(f-1)||null;u+=!s&&(g&&la(g)&&!up[t[f+1]]||b&&la(b)&&!up[t[f-1]])||!up[t[f]]?t[f]:up[t[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Fu[this.text.charCodeAt(s)];s++)e++;let t=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Fu[this.text.charCodeAt(s)];s--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const s=new Eh;return s.text=this.text.substring(e,t),s.sectionIndex=this.sectionIndex.slice(e,t),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Ud.forText(e.scale,e.fontStack||t));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void An("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Ud.forImage(t)),this.sectionIndex.push(this.sections.length-1)):An("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bg(n,e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe){const pe=Eh.fromFeature(n,u);let Ce;B===ac.vertical&&pe.verticalizePunctuation(z);const{processBidirectionalText:Fe,processStyledBidirectionalText:Ee}=de;if(Fe&&1===pe.sections.length){Ce=[];const Be=Fe(pe.toString(),df(pe,M,f,e,s,X,K));for(const mt of Be){const pt=new Eh;pt.text=mt,pt.sections=pe.sections;for(let Ot=0;Ot<mt.length;Ot++)pt.sectionIndex.push(0);Ce.push(pt)}}else if(Ee){Ce=[];const Be=Ee(pe.text,pe.sectionIndex,df(pe,M,f,e,s,X,K));for(const mt of Be){const pt=new Eh;pt.text=mt[0],pt.sectionIndex=mt[1],pt.sections=pe.sections,Ce.push(pt)}}else Ce=function(Be,mt){const pt=[],Ot=Be.text;let an=0;for(const vt of mt)pt.push(Be.substring(an,vt)),an=vt;return an<Ot.length&&pt.push(Be.substring(an,Ot.length)),pt}(pe,df(pe,M,f,e,s,X,K));const Re=[],Ye={positionedLines:Re,text:pe.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Be,mt,pt,Ot,an,vt,zt,Ht,Lt,sn,Wt,Cn){let yi=0,xi=0,Hn=0;const hn="right"===Ht?1:"left"===Ht?0:.5;let Bi=!1;for(const Oi of an){const tr=Oi.getSections();for(const Kr of tr){if(Kr.imageName)continue;const Vr=mt[Kr.fontStack];if(Vr&&(Bi=void 0!==Vr.ascender&&void 0!==Vr.descender,!Bi))break}if(!Bi)break}let pi=0;for(const Oi of an){Oi.trim();const tr=Oi.getMaxScale(),Kr=24*(tr-1),Vr={positionedGlyphs:[],lineOffset:0};Be.positionedLines[pi]=Vr;const Rr=Vr.positionedGlyphs;let Qr=0;if(!Oi.length()){xi+=vt,++pi;continue}let bo=0,fr=0;for(let Yi=0;Yi<Oi.length();Yi++){const Io=Oi.getSection(Yi),Ks=Oi.getSectionIndex(Yi),yr=Oi.getCharCode(Yi);let po=Io.scale,da=null,Nr=null,No=null,Bs=24,fs=0;const Qs=!(Lt===ac.horizontal||!Wt&&!$s(yr)||Wt&&(Fu[yr]||(Mn=yr,Yu(Mn)||Xu(Mn)||Jc(Mn)||ae(Mn)||En(Mn))));if(Io.imageName){const ha=Ot[Io.imageName];if(!ha)continue;No=Io.imageName,Be.iconsInText=Be.iconsInText||!0,Nr=ha.paddedRect;const ea=ha.displaySize;po=24*po/Cn,da={width:ea[0],height:ea[1],left:1,top:-3,advance:Qs?ea[1]:ea[0],localGlyph:!1},fs=Bi?-da.height*po:24*tr-17-ea[1]*po,Bs=da.advance;const Uc=(Qs?ea[0]:ea[1])*po-24*tr;Uc>0&&Uc>Qr&&(Qr=Uc)}else{const ha=pt[Io.fontStack];if(!ha)continue;ha[yr]&&(Nr=ha[yr]);const ea=mt[Io.fontStack];if(!ea)continue;const Uc=ea.glyphs[yr];if(!Uc)continue;if(da=Uc.metrics,Bs=8203!==yr?24:0,Bi){const wd=void 0!==ea.ascender?Math.abs(ea.ascender):0,pl=void 0!==ea.descender?Math.abs(ea.descender):0,kf=(wd+pl)*po;bo<kf&&(bo=kf,fr=(wd-pl)/2*po),fs=-wd*po}else fs=24*(tr-po)-17}Qs?(Be.verticalizable=!0,Rr.push({glyph:yr,imageName:No,x:yi,y:xi+fs,vertical:Qs,scale:po,localGlyph:da.localGlyph,fontStack:Io.fontStack,sectionIndex:Ks,metrics:da,rect:Nr}),yi+=Bs*po+sn):(Rr.push({glyph:yr,imageName:No,x:yi,y:xi+fs,vertical:Qs,scale:po,localGlyph:da.localGlyph,fontStack:Io.fontStack,sectionIndex:Ks,metrics:da,rect:Nr}),yi+=da.advance*po+sn)}0!==Rr.length&&(Hn=Math.max(yi-sn,Hn),Bi?gp(Rr,hn,Qr,fr,vt*tr/2):gp(Rr,hn,Qr,0,vt/2)),yi=0;const Ea=vt*tr+Qr;Vr.lineOffset=Math.max(Qr,Kr),xi+=Ea,++pi}var Mn;const zr=xi,{horizontalAlign:Or,verticalAlign:so}=Fc(zt);(function(Oi,tr,Kr,Vr,Rr,Qr){const bo=(tr-Kr)*Rr,fr=-Qr*Vr;for(const Ea of Oi)for(const Yi of Ea.positionedGlyphs)Yi.x+=bo,Yi.y+=fr})(Be.positionedLines,hn,Or,so,Hn,zr),Be.top+=-so*zr,Be.bottom=Be.top+zr,Be.left+=-Or*Hn,Be.right=Be.left+Hn,Be.hasBaseline=Bi}(Ye,e,t,s,Ce,g,b,E,B,M,z,oe),!function(Be){for(const mt of Be)if(0!==mt.positionedGlyphs.length)return!1;return!0}(Re)&&Ye}const Fu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function dm(n,e,t,s,u,f){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*24/f+u:0}{const g=t[e.fontStack],b=g&&g.glyphs[n];return b?b.metrics.advance*e.scale+u:0}}function uf(n,e,t,s){const u=Math.pow(n-e,2);return s?n<e?u/2:2*u:u+Math.abs(t)*t}function kc(n,e,t){let s=0;return 10===n&&(s-=1e4),t&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function hm(n,e,t,s,u,f){let g=null,b=uf(e,t,u,f);for(const E of s){const M=uf(e-E.x,t,u,f)+E.badness;M<=b&&(g=E,b=M)}return{index:n,x:e,priorBreak:g,badness:b}}function wg(n){return n?wg(n.priorBreak).concat(n.index):[]}function df(n,e,t,s,u,f,g){if("point"!==f)return[];if(!n)return[];const b=[],E=function(z,X,K,oe,pe,Ce){let Fe=0;for(let Ee=0;Ee<z.length();Ee++){const Re=z.getSection(Ee);Fe+=dm(z.getCharCode(Ee),Re,oe,pe,X,Ce)}return Fe/Math.max(1,Math.ceil(Fe/K))}(n,e,t,s,u,g),M=n.text.indexOf("\u200b")>=0;let N=0;for(let z=0;z<n.length();z++){const X=n.getSection(z),K=n.getCharCode(z);if(Fu[K]||(N+=dm(K,X,s,u,e,g)),z<n.length()-1){const oe=!((B=K)<11904||!(Qc(B)||oh(B)||ke(B)||Y(B)||Ua(B)||Xl(B)||vo(B)||io(B)||Jl(B)||O(B)||Va(B)||gi(B)||Kc(B)||Tu(B)||Du(B)||Gs(B)||wa(B)||Ie(B)||A(B)||k(B)));(xg[K]||oe||X.imageName)&&b.push(hm(z+1,N,E,b,kc(K,n.getCharCode(z+1),oe&&M),!1))}}var B;return wg(hm(n.length(),N,E,b,0,!0))}function Fc(n){let e=.5,t=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function gp(n,e,t,s,u){if(!(e||t||s||u))return;const f=n.length-1,g=n[f],b=(g.x+g.metrics.advance*g.scale)*e;for(let E=0;E<=f;E++)n[E].x-=b,n[E].y+=t+s+u}function Dg(n,e,t){const{horizontalAlign:s,verticalAlign:u}=Fc(t),f=e[0]-n.displaySize[0]*s,g=e[1]-n.displaySize[1]*u;return{image:n,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function _p(n,e,t,s,u,f){const g=n.image;let b;if(g.content){const pe=g.content,Ce=g.pixelRatio||1;b=[pe[0]/Ce,pe[1]/Ce,g.displaySize[0]-pe[2]/Ce,g.displaySize[1]-pe[3]/Ce]}const E=e.left*f,M=e.right*f;let N,B,z,X;"width"===t||"both"===t?(X=u[0]+E-s[3],B=u[0]+M+s[1]):(X=u[0]+(E+M-g.displaySize[0])/2,B=X+g.displaySize[0]);const K=e.top*f,oe=e.bottom*f;return"height"===t||"both"===t?(N=u[1]+K-s[0],z=u[1]+oe+s[2]):(N=u[1]+(K+oe-g.displaySize[1])/2,z=N+g.displaySize[1]),{image:g,top:N,right:B,bottom:z,left:X,collisionPadding:b}}class gd extends st{constructor(e,t,s,u,f){super(e,t),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new gd(this.x,this.y,this.z,this.angle,this.segment)}}function fm(n,e,t,s,u){if(void 0===e.segment)return!0;let f=e,g=e.segment+1,b=0;for(;b>-t/2;){if(g--,g<0)return!1;b-=n[g].dist(f),f=n[g]}b+=n[g].dist(n[g+1]),g++;const E=[];let M=0;for(;b<t/2;){const N=n[g],B=n[g+1];if(!B)return!1;let z=n[g-1].angleTo(N)-N.angleTo(B);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:z}),M+=z;b-E[0].distance>s;)M-=E.shift().angleDelta;if(M>u)return!1;g++,b+=N.dist(B)}return!0}function S_(n){let e=0;for(let t=0;t<n.length-1;t++)e+=n[t].dist(n[t+1]);return e}function hf(n,e,t){return n?.6*e*t:0}function ff(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function pm(n,e,t,s,u,f){const g=hf(t,u,f),b=ff(t,s)*f;let E=0;const M=S_(n)/2;for(let N=0;N<n.length-1;N++){const B=n[N],z=n[N+1],X=B.dist(z);if(E+X>M){const K=(M-E)/X,oe=Ti(B.x,z.x,K),pe=Ti(B.y,z.y,K),Ce=new gd(oe,pe,0,z.angleTo(B),N);return!g||fm(n,Ce,b,g,e)?Ce:void 0}E+=X}}function mm(n,e,t,s,u,f,g,b,E){const M=hf(s,f,g),N=ff(s,u),B=N*g,z=0===n[0].x||n[0].x===E||0===n[0].y||n[0].y===E;return e-B<e/4&&(e=B+e/4),yp(n,z?e/2*b%e:(N/2+2*f)*g*b%e,e,M,t,B,z,!1,E)}function yp(n,e,t,s,u,f,g,b,E){const M=f/2,N=S_(n);let B=0,z=e-t,X=[];for(let K=0;K<n.length-1;K++){const oe=n[K],pe=n[K+1],Ce=oe.dist(pe),Fe=pe.angleTo(oe);for(;z+t<B+Ce;){z+=t;const Ee=(z-B)/Ce,Re=Ti(oe.x,pe.x,Ee),Ye=Ti(oe.y,pe.y,Ee);if(Re>=0&&Re<E&&Ye>=0&&Ye<E&&z-M>=0&&z+M<=N){const Be=new gd(Re,Ye,0,Fe,K);Be._round(),s&&!fm(n,Be,f,s,u)||X.push(Be)}}B+=Ce}return b||X.length||g||(X=yp(n,B/2,t,s,u,f,g,!0,E)),X}function I_(n,e,t,s,u){const f=[];for(let g=0;g<n.length;g++){const b=n[g];let E;for(let M=0;M<b.length-1;M++){let N=b[M],B=b[M+1];N.x<e&&B.x<e||(N.x<e?N=new st(e,N.y+(e-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x<e&&(B=new st(e,N.y+(e-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y<t&&B.y<t||(N.y<t?N=new st(N.x+(t-N.y)/(B.y-N.y)*(B.x-N.x),t)._round():B.y<t&&(B=new st(N.x+(t-N.y)/(B.y-N.y)*(B.x-N.x),t)._round()),N.x>=s&&B.x>=s||(N.x>=s?N=new st(s,N.y+(s-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x>=s&&(B=new st(s,N.y+(s-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y>=u&&B.y>=u||(N.y>=u?N=new st(N.x+(u-N.y)/(B.y-N.y)*(B.x-N.x),u)._round():B.y>=u&&(B=new st(N.x+(u-N.y)/(B.y-N.y)*(B.x-N.x),u)._round()),E&&N.equals(E[E.length-1])||(E=[N],f.push(E)),E.push(B)))))}}return f}Dn(gd,"Anchor");const pf=1e20;function Tg(n,e,t,s,u,f,g,b,E){for(let M=e;M<e+s;M++)Cg(n,t*f+M,f,u,g,b,E);for(let M=t;M<t+u;M++)Cg(n,M*f+e,1,s,g,b,E)}function Cg(n,e,t,s,u,f,g){f[0]=0,g[0]=-pf,g[1]=pf,u[0]=n[e];for(let b=1,E=0,M=0;b<s;b++){u[b]=n[e+b*t];const N=b*b;do{const B=f[E];M=(u[b]-u[B]+N-B*B)/(b-B)/2}while(M<=g[E]&&--E>-1);E++,f[E]=b,g[E]=M,g[E+1]=pf}for(let b=0,E=0;b<s;b++){for(;g[E+1]<b;)E++;const M=f[E],N=b-M;n[e+b*t]=u[M]+N*N}}const gm={none:0,ideographs:1,all:2};class jd{constructor(e,t,s){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});At(s,({stack:u,id:f},g)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[f];if(void 0!==E)return void g(null,{stack:u,id:f,glyph:E});if(E=this._tinySDF(b,u,f),E)return b.glyphs[f]=E,void g(null,{stack:u,id:f,glyph:E});const M=Math.floor(f/256);if(256*M>65535)return void g(new Error("glyphs > 65535 not supported"));if(b.ranges[M])return void g(null,{stack:u,id:f,glyph:E});let N=b.requests[M];N||(N=b.requests[M]=[],jd.loadGlyphRange(u,M,this.url,this.requestManager,(B,z)=>{if(z){b.ascender=z.ascender,b.descender=z.descender;for(const X in z.glyphs)this._doesCharSupportLocalGlyph(+X)||(b.glyphs[+X]=z.glyphs[+X]);b.ranges[M]=!0}for(const X of N)X(B,z);delete b.requests[M]})),N.push((B,z)=>{B?g(B):z&&g(null,{stack:u,id:f,glyph:z.glyphs[f]||null})})},(u,f)=>{if(u)t(u);else if(f){const g={};for(const{stack:b,id:E,glyph:M}of f)void 0===g[b]&&(g[b]={}),void 0===g[b].glyphs&&(g[b].glyphs={}),g[b].glyphs[E]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},g[b].ascender=this.entries[b].ascender,g[b].descender=this.entries[b].descender;t(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==gm.none&&(this.localGlyphMode===gm.all?!!this.localFontFamily:!!this.localFontFamily&&(O(e)||U(e)||Kc(e)||wa(e)||io(e)))}_tinySDF(e,t,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let oe="400";/bold/i.test(t)?oe="900":/medium/i.test(t)?oe="500":/light/i.test(t)&&(oe="200"),f=e.tinySDF=new jd.TinySDF({fontFamily:u,fontWeight:oe,fontSize:48,buffer:6,radius:16}),f.fontWeight=oe}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const g=String.fromCharCode(s),{data:b,width:E,height:M,glyphWidth:N,glyphHeight:B,glyphLeft:z,glyphTop:X,glyphAdvance:K}=f.draw(g);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new sc({width:E,height:M},b),metrics:{width:N/2,height:B/2,left:z/2,top:X/2-27,advance:K/2,localGlyph:!0}}}}function A_(n,e,t,s){const u=[],f=n.image,g=f.pixelRatio,b=f.paddedRect.w-2,E=f.paddedRect.h-2,M=n.right-n.left,N=n.bottom-n.top,B=f.stretchX||[[0,b]],z=f.stretchY||[[0,E]],X=(vt,zt)=>vt+zt[1]-zt[0],K=B.reduce(X,0),oe=z.reduce(X,0),pe=b-K,Ce=E-oe;let Fe=0,Ee=K,Re=0,Ye=oe,Be=0,mt=pe,pt=0,Ot=Ce;if(f.content&&s){const vt=f.content;Fe=vp(B,0,vt[0]),Re=vp(z,0,vt[1]),Ee=vp(B,vt[0],vt[2]),Ye=vp(z,vt[1],vt[3]),Be=vt[0]-Fe,pt=vt[1]-Re,mt=vt[2]-vt[0]-Ee,Ot=vt[3]-vt[1]-Ye}const an=(vt,zt,Ht,Lt)=>{const sn=mf(vt.stretch-Fe,Ee,M,n.left),Wt=gf(vt.fixed-Be,mt,vt.stretch,K),Cn=mf(zt.stretch-Re,Ye,N,n.top),yi=gf(zt.fixed-pt,Ot,zt.stretch,oe),xi=mf(Ht.stretch-Fe,Ee,M,n.left),Hn=gf(Ht.fixed-Be,mt,Ht.stretch,K),hn=mf(Lt.stretch-Re,Ye,N,n.top),Bi=gf(Lt.fixed-pt,Ot,Lt.stretch,oe),pi=new st(sn,Cn),Mn=new st(xi,Cn),zr=new st(xi,hn),Or=new st(sn,hn),so=new st(Wt/g,yi/g),Oi=new st(Hn/g,Bi/g),tr=e*Math.PI/180;if(tr){const Rr=Math.sin(tr),Qr=Math.cos(tr),bo=[Qr,-Rr,Rr,Qr];pi._matMult(bo),Mn._matMult(bo),Or._matMult(bo),zr._matMult(bo)}const Kr=vt.stretch+vt.fixed,Vr=zt.stretch+zt.fixed;return{tl:pi,tr:Mn,bl:Or,br:zr,tex:{x:f.paddedRect.x+1+Kr,y:f.paddedRect.y+1+Vr,w:Ht.stretch+Ht.fixed-Kr,h:Lt.stretch+Lt.fixed-Vr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:so,pixelOffsetBR:Oi,minFontScaleX:mt/g/M,minFontScaleY:Ot/g/N,isSDF:t}};if(s&&(f.stretchX||f.stretchY)){const vt=P_(B,pe,K),zt=P_(z,Ce,oe);for(let Ht=0;Ht<vt.length-1;Ht++){const Lt=vt[Ht],sn=vt[Ht+1];for(let Wt=0;Wt<zt.length-1;Wt++)u.push(an(Lt,zt[Wt],sn,zt[Wt+1]))}}else u.push(an({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return u}function vp(n,e,t){let s=0;for(const u of n)s+=Math.max(e,Math.min(t,u[1]))-Math.max(e,Math.min(t,u[0]));return s}function P_(n,e,t){const s=[{fixed:-1,stretch:0}];for(const[u,f]of n){const g=s[s.length-1];s.push({fixed:u-g.stretch,stretch:g.stretch}),s.push({fixed:u-g.stretch,stretch:g.stretch+(f-u)})}return s.push({fixed:e+1,stretch:t}),s}function mf(n,e,t,s){return n/e*t+s}function gf(n,e,t,s){return n-e*t/s}function O_(n,e,t,s){const u=e+n.positionedLines[s].lineOffset;return 0===s?t+u/2:t+(u+(e+n.positionedLines[s-1].lineOffset))/2}jd.loadGlyphRange=function(n,e,t,s,u){const f=256*e,g=f+255,b=s.transformRequest(s.normalizeGlyphsURL(t).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),$e.Glyphs);Ke(b,(E,M)=>{if(E)u(E);else if(M){const N={},B=new Vd(M).readFields(E_,{});for(const z of B.glyphs)N[z.id]=z;u(null,{glyphs:N,ascender:B.ascender,descender:B.descender})}})},jd.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:t=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=t;const b=this.size=n+4*e,E=this._createCanvas(b),M=this.ctx=E.getContext("2d",{willReadFrequently:!0});M.font=`${g} ${f} ${n}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.ceil(t),b=Math.min(this.size-this.buffer,Math.ceil(f-u)),E=Math.min(this.size-this.buffer,g+Math.ceil(s)),M=b+2*this.buffer,N=E+2*this.buffer,B=Math.max(M*N,0),z=new Uint8ClampedArray(B),X={data:z,width:M,height:N,glyphWidth:b,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(0===b||0===E)return X;const{ctx:K,buffer:oe,gridInner:pe,gridOuter:Ce}=this;K.clearRect(oe,oe,b,E),K.fillText(n,oe,oe+g);const Fe=K.getImageData(oe,oe,b,E);Ce.fill(pf,0,B),pe.fill(0,0,B);for(let Ee=0;Ee<E;Ee++)for(let Re=0;Re<b;Re++){const Ye=Fe.data[4*(Ee*b+Re)+3]/255;if(0===Ye)continue;const Be=(Ee+oe)*M+Re+oe;if(1===Ye)Ce[Be]=0,pe[Be]=pf;else{const mt=.5-Ye;Ce[Be]=mt>0?mt*mt:0,pe[Be]=mt<0?mt*mt:0}}Tg(Ce,0,0,M,N,M,this.f,this.v,this.z),Tg(pe,oe,oe,b,E,M,this.f,this.v,this.z);for(let Ee=0;Ee<B;Ee++){const Re=Math.sqrt(Ce[Ee])-Math.sqrt(pe[Ee]);z[Ee]=Math.round(255-255*(Re/this.radius+this.cutoff))}return X}};class _m{constructor(e=[],t=jy){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:s}=this,u=t[e];for(;e>0;){const f=e-1>>1,g=t[f];if(s(u,g)>=0)break;t[e]=g,e=f}t[e]=u}_down(e){const{data:t,compare:s}=this,u=this.length>>1,f=t[e];for(;e<u;){let g=1+(e<<1),b=t[g];const E=g+1;if(E<this.length&&s(t[E],b)<0&&(g=E,b=t[E]),s(b,f)>=0)break;t[e]=b,e=g}t[e]=f}}function jy(n,e){return n<e?-1:n>e?1:0}function Gy(n,e=1,t=!1){let s=1/0,u=1/0,f=-1/0,g=-1/0;const b=n[0];for(let X=0;X<b.length;X++){const K=b[X];(!X||K.x<s)&&(s=K.x),(!X||K.y<u)&&(u=K.y),(!X||K.x>f)&&(f=K.x),(!X||K.y>g)&&(g=K.y)}const E=Math.min(f-s,g-u);let M=E/2;const N=new _m([],$y);if(0===E)return new st(s,u);for(let X=s;X<f;X+=E)for(let K=u;K<g;K+=E)N.push(new _f(X+M,K+M,M,n));let B=function(X){let K=0,oe=0,pe=0;const Ce=X[0];for(let Fe=0,Ee=Ce.length,Re=Ee-1;Fe<Ee;Re=Fe++){const Ye=Ce[Fe],Be=Ce[Re],mt=Ye.x*Be.y-Be.x*Ye.y;oe+=(Ye.x+Be.x)*mt,pe+=(Ye.y+Be.y)*mt,K+=3*mt}return new _f(oe/K,pe/K,0,X)}(n),z=N.length;for(;N.length;){const X=N.pop();(X.d>B.d||!B.d)&&(B=X,t&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,z)),X.max-B.d<=e||(M=X.h/2,N.push(new _f(X.p.x-M,X.p.y-M,M,n)),N.push(new _f(X.p.x+M,X.p.y-M,M,n)),N.push(new _f(X.p.x-M,X.p.y+M,M,n)),N.push(new _f(X.p.x+M,X.p.y+M,M,n)),z+=4)}return t&&(console.log(`num probes: ${z}`),console.log(`best distance: ${B.d}`)),B.p}function $y(n,e){return e.max-n.max}function _f(n,e,t,s){this.p=new st(n,e),this.h=t,this.d=function(u,f){let g=!1,b=1/0;for(let E=0;E<f.length;E++){const M=f[E];for(let N=0,B=M.length,z=B-1;N<B;z=N++){const X=M[N],K=M[z];X.y>u.y!=K.y>u.y&&u.x<(K.x-X.x)*(u.y-X.y)/(K.y-X.y)+X.x&&(g=!g),b=Math.min(b,Wh(u,X,K))}}return(g?1:-1)*Math.sqrt(b)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Eg=Number.POSITIVE_INFINITY,Hy=Math.sqrt(2);function R_(n,e){return e[1]!==Eg?function(t,s,u){let f=0,g=0;switch(s=Math.abs(s),u=Math.abs(u),t){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(t){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,g]}(n,e[0],e[1]):function(t,s){let u=0,f=0;s<0&&(s=0);const g=s/Hy;switch(t){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(t){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=s;break;case"right":u=-s}return[u,f]}(n,e[0])}function Wy(n,e,t,s,u,f,g,b,E,M){n.createArrays(),n.tilePixelRatio=ii/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const N=n.layers[0].layout,B=n.layers[0]._unevaluatedLayout._values,z={};if("composite"===n.textSizeData.kind){const{minZoom:oe,maxZoom:pe}=n.textSizeData;z.compositeTextSizes=[B["text-size"].possiblyEvaluate(new me(oe),b),B["text-size"].possiblyEvaluate(new me(pe),b)]}if("composite"===n.iconSizeData.kind){const{minZoom:oe,maxZoom:pe}=n.iconSizeData;z.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new me(oe),b),B["icon-size"].possiblyEvaluate(new me(pe),b)]}z.layoutTextSize=B["text-size"].possiblyEvaluate(new me(E+1),b),z.layoutIconSize=B["icon-size"].possiblyEvaluate(new me(E+1),b),z.textMaxSize=B["text-size"].possiblyEvaluate(new me(18),b);const X="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),K=N.get("text-size");for(const oe of n.features){const pe=N.get("text-font").evaluate(oe,{},b).join(","),Ce=K.evaluate(oe,{},b),Fe=z.layoutTextSize.evaluate(oe,{},b),Ee=(z.layoutIconSize.evaluate(oe,{},b),{horizontal:{},vertical:void 0}),Re=oe.text;let Ye,Be=[0,0];if(Re){const Ot=Re.toString(),an=24*N.get("text-letter-spacing").evaluate(oe,{},b),vt=24*N.get("text-line-height").evaluate(oe,{},b),zt=er(Ot)?an:0,Ht=N.get("text-anchor").evaluate(oe,{},b),Lt=N.get("text-variable-anchor");if(!Lt){const Hn=N.get("text-radial-offset").evaluate(oe,{},b);Be=Hn?R_(Ht,[24*Hn,Eg]):N.get("text-offset").evaluate(oe,{},b).map(hn=>24*hn)}let sn=X?"center":N.get("text-justify").evaluate(oe,{},b);const Wt=N.get("symbol-placement"),Cn="point"===Wt,yi="point"===Wt?24*N.get("text-max-width").evaluate(oe,{},b):0,xi=Hn=>{n.allowVerticalPlacement&&gn(Ot)&&(Ee.vertical=bg(Re,e,t,u,pe,yi,vt,Ht,Hn,zt,Be,ac.vertical,!0,Wt,Fe,Ce))};if(!X&&Lt){const Hn="auto"===sn?Lt.map(Bi=>Mg(Bi)):[sn];let hn=!1;for(let Bi=0;Bi<Hn.length;Bi++){const pi=Hn[Bi];if(!Ee.horizontal[pi])if(hn)Ee.horizontal[pi]=Ee.horizontal[0];else{const Mn=bg(Re,e,t,u,pe,yi,vt,"center",pi,zt,Be,ac.horizontal,!1,Wt,Fe,Ce);Mn&&(Ee.horizontal[pi]=Mn,hn=1===Mn.positionedLines.length)}}xi("left")}else{if("auto"===sn&&(sn=Mg(Ht)),Cn||N.get("text-writing-mode").indexOf("horizontal")>=0||!gn(Ot)){const Hn=bg(Re,e,t,u,pe,yi,vt,Ht,sn,zt,Be,ac.horizontal,!1,Wt,Fe,Ce);Hn&&(Ee.horizontal[sn]=Hn)}xi("point"===Wt?"left":sn)}}let mt=!1;if(oe.icon&&oe.icon.name){const Ot=s[oe.icon.name];Ot&&(Ye=Dg(u[oe.icon.name],N.get("icon-offset").evaluate(oe,{},b),N.get("icon-anchor").evaluate(oe,{},b)),mt=Ot.sdf,void 0===n.sdfIcons?n.sdfIcons=Ot.sdf:n.sdfIcons!==Ot.sdf&&An("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ot.pixelRatio!==n.pixelRatio||0!==N.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const pt=Sg(Ee.horizontal)||Ee.vertical;n.iconsInText||(n.iconsInText=!!pt&&pt.iconsInText),(pt||Ye)&&Zy(n,oe,Ee,Ye,s,z,Fe,0,Be,mt,g,b,M)}f&&n.generateCollisionDebugBuffers(E,n.collisionBoxArray)}function Mg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zy(n,e,t,s,u,f,g,b,E,M,N,B,z){let X=f.textMaxSize.evaluate(e,{},B);void 0===X&&(X=g);const K=n.layers[0].layout,oe=K.get("icon-offset").evaluate(e,{},B),pe=Sg(t.horizontal)||t.vertical,Ce="globe"===z.name,Fe=g/24,Ee=n.tilePixelRatio*X/24,Re=(zt=n.overscaling,n.zoom>18&&zt>2&&(zt>>=1),Math.max(ii/(512*zt),1)*K.get("symbol-spacing")),Ye=K.get("text-padding")*n.tilePixelRatio,Be=K.get("icon-padding")*n.tilePixelRatio,mt=lt(K.get("text-max-angle")),pt="map"===K.get("text-rotation-alignment")&&"point"!==K.get("symbol-placement"),Ot="map"===K.get("icon-rotation-alignment")&&"point"!==K.get("symbol-placement"),an=K.get("symbol-placement"),vt=Re/2;var zt;const Ht=K.get("icon-text-fit");let Lt;s&&"none"!==Ht&&(n.allowVerticalPlacement&&t.vertical&&(Lt=_p(s,t.vertical,Ht,K.get("icon-text-fit-padding"),oe,Fe)),pe&&(s=_p(s,pe,Ht,K.get("icon-text-fit-padding"),oe,Fe)));const sn=(Wt,Cn,yi)=>{if(Cn.x<0||Cn.x>=ii||Cn.y<0||Cn.y>=ii)return;let xi=null;if(Ce){const{x:Hn,y:hn,z:Bi}=z.projectTilePoint(Cn.x,Cn.y,yi);xi={anchor:new gd(Hn,hn,Bi,0,void 0),up:z.upVector(yi,Cn.x,Cn.y)}}!function(Hn,hn,Bi,pi,Mn,zr,Or,so,Oi,tr,Kr,Vr,Rr,Qr,bo,fr,Ea,Yi,Io,Ks,yr,po,da,Nr,No){const Bs=Hn.addToLineVertexArray(hn,pi);let fs,Qs,ha,ea,Uc,wd,pl,kf=0,km=0,jc=0,uc=0,Pl=-1,Pp=-1;const Gc={};let qg=sh("");const th=Bi?Bi.anchor:hn;let Fm=0,Lm=0;if(void 0===Oi._unevaluatedLayout.getValue("text-radial-offset")?[Fm,Lm]=Oi.layout.get("text-offset").evaluate(yr,{},No).map(Ha=>24*Ha):(Fm=24*Oi.layout.get("text-radial-offset").evaluate(yr,{},No),Lm=Eg),Hn.allowVerticalPlacement&&Mn.vertical){const Ha=Mn.vertical;if(bo)wd=vf(Ha),so&&(pl=vf(so));else{const ml=Oi.layout.get("text-rotate").evaluate(yr,{},No)+90;ha=yf(tr,th,hn,Kr,Vr,Rr,Ha,Qr,ml,fr),so&&(ea=yf(tr,th,hn,Kr,Vr,Rr,so,Yi,ml))}}if(zr){const Ha=Oi.layout.get("icon-rotate").evaluate(yr,{},No),ml="none"!==Oi.layout.get("icon-text-fit"),Bh=A_(zr,Ha,da,ml),Op=so?A_(so,Ha,da,ml):void 0;Qs=yf(tr,th,hn,Kr,Vr,Rr,zr,Yi,Ha),kf=4*Bh.length;const Ff=Hn.iconSizeData;let ih=null;"source"===Ff.kind?(ih=[uu*Oi.layout.get("icon-size").evaluate(yr,{},No)],ih[0]>$a&&An(`${Hn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Ff.kind&&(ih=[uu*po.compositeIconSizes[0].evaluate(yr,{},No),uu*po.compositeIconSizes[1].evaluate(yr,{},No)],(ih[0]>$a||ih[1]>$a)&&An(`${Hn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Hn.addSymbols(Hn.icon,Bh,ih,Ks,Io,yr,!1,Bi,hn,Bs.lineStartIndex,Bs.lineLength,-1,Nr,No),Pl=Hn.icon.placedSymbolArray.length-1,Op&&(km=4*Op.length,Hn.addSymbols(Hn.icon,Op,ih,Ks,Io,yr,ac.vertical,Bi,hn,Bs.lineStartIndex,Bs.lineLength,-1,Nr,No),Pp=Hn.icon.placedSymbolArray.length-1)}for(const Ha in Mn.horizontal){const ml=Mn.horizontal[Ha];fs||(qg=sh(ml.text),bo?Uc=vf(ml):fs=yf(tr,th,hn,Kr,Vr,Rr,ml,Qr,Oi.layout.get("text-rotate").evaluate(yr,{},No),fr));const Bh=1===ml.positionedLines.length;if(jc+=bp(Hn,Bi,hn,ml,Or,Oi,bo,yr,fr,Bs,Mn.vertical?ac.horizontal:ac.horizontalOnly,Bh?Object.keys(Mn.horizontal):[Ha],Gc,Pl,po,Nr,No),Bh)break}Mn.vertical&&(uc+=bp(Hn,Bi,hn,Mn.vertical,Or,Oi,bo,yr,fr,Bs,ac.vertical,["vertical"],Gc,Pp,po,Nr,No));let mu=-1;const nh=(Ha,ml)=>Ha?Math.max(Ha,ml):ml;mu=nh(Uc,mu),mu=nh(wd,mu),mu=nh(pl,mu);const W_=mu>-1?1:0;Hn.glyphOffsetArray.length>=du.MAX_GLYPHS&&An("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==yr.sortKey&&Hn.addToSortKeyRanges(Hn.symbolInstances.length,yr.sortKey),Hn.symbolInstances.emplaceBack(th.x,th.y,th.z,hn.x,hn.y,Gc.right>=0?Gc.right:-1,Gc.center>=0?Gc.center:-1,Gc.left>=0?Gc.left:-1,Gc.vertical>=0?Gc.vertical:-1,Pl,Pp,qg,void 0!==fs?fs:Hn.collisionBoxArray.length,void 0!==fs?fs+1:Hn.collisionBoxArray.length,void 0!==ha?ha:Hn.collisionBoxArray.length,void 0!==ha?ha+1:Hn.collisionBoxArray.length,void 0!==Qs?Qs:Hn.collisionBoxArray.length,void 0!==Qs?Qs+1:Hn.collisionBoxArray.length,ea||Hn.collisionBoxArray.length,ea?ea+1:Hn.collisionBoxArray.length,Kr,jc,uc,kf,km,W_,0,Fm,Lm,mu)}(n,Cn,xi,Wt,t,s,u,Lt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Ye,pt,E,0,Be,Ot,oe,e,f,M,N,B)};if("line"===an)for(const Wt of I_(e.geometry,0,0,ii,ii)){const Cn=mm(Wt,Re,mt,t.vertical||pe,s,24,Ee,n.overscaling,ii);for(const yi of Cn){const xi=pe;xi&&Ig(n,xi.text,vt,yi)||sn(Wt,yi,B)}}else if("line-center"===an){for(const Wt of e.geometry)if(Wt.length>1){const Cn=pm(Wt,mt,t.vertical||pe,s,24,Ee);Cn&&sn(Wt,Cn,B)}}else if("Polygon"===e.type)for(const Wt of ar(e.geometry,0)){const Cn=Gy(Wt,16);sn(Wt[0],new gd(Cn.x,Cn.y,0,0,void 0),B)}else if("LineString"===e.type)for(const Wt of e.geometry)sn(Wt,new gd(Wt[0].x,Wt[0].y,0,0,void 0),B);else if("Point"===e.type)for(const Wt of e.geometry)for(const Cn of Wt)sn([Cn],new gd(Cn.x,Cn.y,0,0,void 0),B)}const $a=32640;function bp(n,e,t,s,u,f,g,b,E,M,N,B,z,X,K,oe,pe){const Ce=function(Re,Ye,Be,mt,pt,Ot,an,vt){const zt=[];if(0===Ye.positionedLines.length)return zt;const Ht=mt.layout.get("text-rotate").evaluate(Ot,{})*Math.PI/180,Lt=function(xi){const Hn=xi[0],hn=xi[1],Bi=Hn*hn;return Bi>0?[Hn,-hn]:Bi<0?[-Hn,hn]:0===Hn?[hn,Hn]:[hn,-Hn]}(Be);let sn=Math.abs(Ye.top-Ye.bottom);for(const xi of Ye.positionedLines)sn-=xi.lineOffset;const Wt=Ye.positionedLines.length,Cn=sn/Wt;let yi=Ye.top-Be[1];for(let xi=0;xi<Wt;++xi){const Hn=Ye.positionedLines[xi];yi=O_(Ye,Cn,yi,xi);for(const hn of Hn.positionedGlyphs){if(!hn.rect)continue;const Bi=hn.rect||{};let pi=4,Mn=!0,zr=1,Or=0;if(hn.imageName){const Nr=an[hn.imageName];if(!Nr)continue;if(Nr.sdf){An("SDF images are not supported in formatted text and will be ignored.");continue}Mn=!1,zr=Nr.pixelRatio,pi=1/zr}const so=(pt||vt)&&hn.vertical,Oi=hn.metrics.advance*hn.scale/2,tr=hn.metrics,Kr=hn.rect;if(null===Kr)continue;vt&&Ye.verticalizable&&(Or=hn.imageName?Oi-hn.metrics.width*hn.scale/2:0);const Vr=pt?[hn.x+Oi,hn.y]:[0,0];let Rr=[0,0],Qr=[0,0],bo=!1;pt||(so?(Qr=[hn.x+Oi+Lt[0],hn.y+Lt[1]-Or],bo=!0):Rr=[hn.x+Oi+Be[0],hn.y+Be[1]-Or]);const fr=Kr.w*hn.scale/(zr*(hn.localGlyph?2:1)),Ea=Kr.h*hn.scale/(zr*(hn.localGlyph?2:1));let Yi,Io,Ks,yr;if(so){const Nr=hn.y-yi,No=new st(-Oi,Oi-Nr),Bs=-Math.PI/2,fs=new st(...Qr);Yi=new st(-Oi+Rr[0],Rr[1]),Yi._rotateAround(Bs,No)._add(fs),Yi.x+=-Nr+Oi,Yi.y-=(tr.left-pi)*hn.scale;const Qs=hn.imageName?tr.advance*hn.scale:24*hn.scale,ha=String.fromCharCode(hn.glyph);fg(ha)?Yi.x+=(1-pi)*hn.scale:pg(ha)?Yi.x+=Qs-tr.height*hn.scale+(-pi-1)*hn.scale:Yi.x+=hn.imageName||tr.width+2*pi===Kr.w&&tr.height+2*pi===Kr.h?(Qs-Ea)/2:(Qs-(tr.height+2*pi)*hn.scale)/2,Io=new st(Yi.x,Yi.y-fr),Ks=new st(Yi.x+Ea,Yi.y),yr=new st(Yi.x+Ea,Yi.y-fr)}else{const Nr=(tr.left-pi)*hn.scale-Oi+Rr[0],No=(-tr.top-pi)*hn.scale+Rr[1],Bs=Nr+fr,fs=No+Ea;Yi=new st(Nr,No),Io=new st(Bs,No),Ks=new st(Nr,fs),yr=new st(Bs,fs)}if(Ht){let Nr;Nr=pt?new st(0,0):bo?new st(Lt[0],Lt[1]):new st(Be[0],Be[1]),Yi._rotateAround(Ht,Nr),Io._rotateAround(Ht,Nr),Ks._rotateAround(Ht,Nr),yr._rotateAround(Ht,Nr)}const po=new st(0,0),da=new st(0,0);zt.push({tl:Yi,tr:Io,bl:Ks,br:yr,tex:Bi,writingMode:Ye.writingMode,glyphOffset:Vr,sectionIndex:hn.sectionIndex,isSDF:Mn,pixelOffsetTL:po,pixelOffsetBR:da,minFontScaleX:0,minFontScaleY:0})}}return zt}(0,s,E,f,g,b,u,n.allowVerticalPlacement),Fe=n.textSizeData;let Ee=null;"source"===Fe.kind?(Ee=[uu*f.layout.get("text-size").evaluate(b,{},pe)],Ee[0]>$a&&An(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Fe.kind&&(Ee=[uu*K.compositeTextSizes[0].evaluate(b,{},pe),uu*K.compositeTextSizes[1].evaluate(b,{},pe)],(Ee[0]>$a||Ee[1]>$a)&&An(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,Ce,Ee,E,g,b,N,e,t,M.lineStartIndex,M.lineLength,X,oe,pe);for(const Re of B)z[Re]=n.text.placedSymbolArray.length-1;return 4*Ce.length}function Sg(n){for(const e in n)return n[e];return null}function yf(n,e,t,s,u,f,g,b,E,M){let N=g.top,B=g.bottom,z=g.left,X=g.right;const K=g.collisionPadding;if(K&&(z-=K[0],N-=K[1],X+=K[2],B+=K[3]),E){const oe=new st(z,N),pe=new st(X,N),Ce=new st(z,B),Fe=new st(X,B),Ee=lt(E);let Re=new st(0,0);M&&(Re=new st(M[0],M[1])),oe._rotateAround(Ee,Re),pe._rotateAround(Ee,Re),Ce._rotateAround(Ee,Re),Fe._rotateAround(Ee,Re),z=Math.min(oe.x,pe.x,Ce.x,Fe.x),X=Math.max(oe.x,pe.x,Ce.x,Fe.x),N=Math.min(oe.y,pe.y,Ce.y,Fe.y),B=Math.max(oe.y,pe.y,Ce.y,Fe.y)}return n.emplaceBack(e.x,e.y,e.z,t.x,t.y,z,N,X,B,b,s,u,f),n.length-1}function vf(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function Ig(n,e,t,s){const u=n.compareText;if(e in u){const f=u[e];for(let g=f.length-1;g>=0;g--)if(s.dist(f[g])<t)return!0}else u[e]=[];return u[e].push(s),!1}const ym=kt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ag}=ym,Lu=kt([{name:"a_pos_3",components:3,type:"Int16"}]);var Mh=kt([{name:"a_pos",type:"Int16",components:2}]);const Bu=ii/Math.PI/2,vm=2*sl(1,0)*Bu*Math.PI,Gd=[64,32,16],Lc=-Bu,Bc=Bu,xp=[new Zs([Lc,Lc,Lc],[Bc,Bc,Bc]),new Zs([Lc,Lc,Lc],[0,0,Bc]),new Zs([0,Lc,Lc],[Bc,0,Bc]),new Zs([Lc,0,Lc],[0,Bc,Bc]),new Zs([0,0,Lc],[Bc,Bc,Bc])];function $d(n,e,t,s=!0){const u=Mc([],n._camera.position,n.worldSize),f=[e,t,1,1];od(f,f,n.pixelMatrixInverse),Pd(f,f,1/f[3]);const g=Fs([],cl([],f,u)),b=n.globeMatrix,E=[b[12],b[13],b[14]],M=cl([],E,u),N=Pu(M),B=Fs([],M),z=n.worldSize/(2*Math.PI),X=ll(B,g),K=Math.asin(z/N);if(K<Math.acos(X)){if(!s)return null;const an=[],vt=[];Mc(an,g,N/X),Fs(vt,cl(vt,an,M)),Fs(g,rd(g,M,Mc(g,vt,Math.tan(K)*N)))}const oe=[];new ep(u,g).closestPointOnSphere(E,z,oe);const pe=Fs([],Xi(b,0)),Ce=Fs([],Xi(b,1)),Fe=Fs([],Xi(b,2)),Ee=ll(pe,oe),Re=ll(Ce,oe),Ye=ll(Fe,oe),Be=dn(Math.asin(-Re/z));let mt=dn(Math.atan2(Ee,Ye));mt=n.center.lng+function(an,vt){const zt=(vt-an+180)%360-180;return zt<-180?zt+360:zt}(n.center.lng,mt);const pt=ja(mt),Ot=on(ic(Be),0,1);return new Ml(pt,Ot)}class bm{constructor(e,t,s){this.a=cl([],e,s),this.b=cl([],t,s),this.center=s;const u=Fs([],this.a),f=Fs([],this.b);this.angle=Math.acos(ll(u,f))}}function _d(n,e){if(0===n.angle)return null;let t;return t=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),t<0||t>1?null:function(s,u,f,g){const b=Math.sin(f);return s*(Math.sin((1-g)*f)/b)+u*(Math.sin(g*f)/b)}(n.a[e],n.b[e],n.angle,on(t,0,1))+n.center[e]}function lc(n){if(n.z<=1)return xp[n.z+2*n.y+n.x];const e=xf(Sh(n));return Zs.fromPoints(e)}function bf(n,e){const t=Ph(e.zoom);if(0===t)return lc(n);const s=Sh(n),u=xf(s),f=ja(s.getWest())*e.worldSize,g=ja(s.getEast())*e.worldSize,b=ic(s.getNorth())*e.worldSize,E=ic(s.getSouth())*e.worldSize,M=[f,b,0],N=[g,b,0],B=[f,E,0],z=[g,E,0],X=mh([],e.globeMatrix);return So(M,M,X),So(N,N,X),So(B,B,X),So(z,z,X),u[0]=Sr(u[0],B,t),u[1]=Sr(u[1],z,t),u[2]=Sr(u[2],N,t),u[3]=Sr(u[3],M,t),Zs.fromPoints(u)}function xm(n,e,t,s,u){for(const f of t)So(f,f,s),Mc(f,f,u),Kp(n,n,f),Qh(e,e,f)}function Sh({x:n,y:e,z:t}){const s=1/(1<<t),u=new _r(Ca(n*s),cs((e+1)*s)),f=new _r(Ca((n+1)*s),cs(e*s));return new Mu(u,f)}function xf(n){const e=lt(n.getNorth()),t=lt(n.getSouth()),s=Math.cos(e),u=Math.cos(t),f=Math.sin(e),g=Math.sin(t),b=n.getWest(),E=n.getEast();return[Hd(u,g,b),Hd(u,g,E),Hd(s,f,E),Hd(s,f,b)]}function Hd(n,e,t,s=Bu){return t=lt(t),[n*Math.sin(t)*s,-e*s,n*Math.cos(t)*s]}function Ih(n,e,t){return Hd(Math.cos(lt(n)),Math.sin(lt(n)),e,t)}function wf(n,e,t,s){const u=1<<t.z,f=(n/ii+t.x)/u;return Ih(cs((e/ii+t.y)/u),Ca(f),s)}function wm({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Og=new Float64Array(16);function Ah(n){const e=wm(n),t=Yh(Og,[e,e,e]);return Au(t,t,((s=[])[0]=-(u=n.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function Dm(n){const e=(s=n.min,(t=Og)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t);var t,s;const u=1/wm(n);return su(e,e,[u,u,u])}function Tm(n,e,t,s,u){const f=function(E){const M=ii/(2*Math.PI);return E/(2*Math.PI)/M}(t),g=[n,e,-t/(2*Math.PI)],b=ua(new Float64Array(16));return Au(b,b,g),su(b,b,[f,f,f]),qf(b,b,lt(-u)),Id(b,b,lt(-s)),b}function Ph(n){return vn(5,6,n)}function Rg(n,e){const t=Ih(e.lat,e.lng);return f=(s=_h([],function(X){const K=Ih(X._center.lat,X._center.lng);let oe=yh([],gh(0,1,0),K);const pe=Yf([],-X.angle,K);oe=So(oe,oe,pe),Yf(pe,-X._pitch,oe);const Ce=Fs([],K);return Mc(Ce,Ce,X.cameraToCenterDistance/X.pixelsPerMeter*vm),So(Ce,Ce,pe),rd([],K,Ce)}(n),t))[0],g=s[1],b=s[2],E=(u=t)[0],M=u[1],N=u[2],z=(B=Math.sqrt(f*f+g*g+b*b)*Math.sqrt(E*E+M*M+N*N))&&ll(s,u)/B,Math.acos(Math.min(Math.max(z,-1),1));var s,u,f,g,b,E,M,N,B,z}const dl=lt(85),Ng=Math.cos(dl),N_=Math.sin(dl);function k_(n,e){const t=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),f=Math.sin(t)*u/Math.sin(Math.max(Math.PI/2-n._pitch-t,.01)),g=Math.sin(n._pitch)*f+u;return Math.min(1.01*g,u*(1/n._horizonShift))}function Wd(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const t=Math.pow(2,-n.z),s=n.x*t,u=(n.x+1)*t,f=n.y*t,g=(n.y+1)*t,b=Ca(s),E=Ca(u),M=cs(f),N=cs(g),B=e.project(b,M),z=e.project(E,M),X=e.project(E,N),K=e.project(b,N);let oe=Math.min(B.x,z.x,X.x,K.x),pe=Math.min(B.y,z.y,X.y,K.y),Ce=Math.max(B.x,z.x,X.x,K.x),Fe=Math.max(B.y,z.y,X.y,K.y);const Ee=t/16;function Re(Be,mt,pt,Ot,an,vt){const zt=(pt+an)/2,Ht=(Ot+vt)/2,Lt=e.project(Ca(zt),cs(Ht)),sn=Math.max(0,oe-Lt.x,pe-Lt.y,Lt.x-Ce,Lt.y-Fe);oe=Math.min(oe,Lt.x),Ce=Math.max(Ce,Lt.x),pe=Math.min(pe,Lt.y),Fe=Math.max(Fe,Lt.y),sn>Ee&&(Re(Be,Lt,pt,Ot,zt,Ht),Re(Lt,mt,zt,Ht,an,vt))}Re(B,z,s,f,u,f),Re(z,X,u,f,u,g),Re(X,K,u,g,s,g),Re(K,B,s,g,s,f),oe-=Ee,pe-=Ee,Ce+=Ee,Fe+=Ee;const Ye=1/Math.max(Ce-oe,Fe-pe);return{scale:Ye,x:oe*Ye,y:pe*Ye,x2:Ce*Ye,y2:Fe*Ye,projection:e}}const Cm=ua(new Float32Array(16));class zu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new _r(0,0)}projectTilePoint(e,t,s){return{x:e,y:t,z:0}}locationPoint(e,t,s=!0){return e._coordinatePoint(e.locationCoordinate(t),s)}pixelsPerMeter(e,t){return sl(1,e)*t}pixelSpaceConversion(e,t,s){return 1}farthestPixelDistance(e){return k_(e,e.pixelsPerMeter)}pointCoordinate(e,t,s,u){const f=e.horizonLineFromTop(!1),g=new st(t,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,t,s){const u=new st(t,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const s=e.horizonLineFromTop();return t.y<s}createInversionMatrix(e,t){return Cm}createTileMatrix(e,t,s){let u,f,g;const b=s.canonical,E=ua(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Wd(b,this);u=1,f=M.x+s.wrap*M.scale,g=M.y,su(E,E,[u/M.scale,u/M.scale,e.pixelsPerMeter/t])}else u=t/e.zoomScale(b.z),f=(b.x+Math.pow(2,b.z)*s.wrap)*u,g=b.y*u;return Au(E,E,[f,g,0]),su(E,E,[u/ii,u/ii,1]),E}upVector(e,t,s){return[0,0,1]}upVectorScale(e,t,s){return{metersToTile:1}}}class F_ extends zu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(lt(t));this.n=(u+Math.sin(lt(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:s,c:u,r0:f}=this,g=lt(e-this.center[0]),b=lt(t),E=Math.sqrt(u-2*s*Math.sin(b))/s;return{x:E*Math.sin(g*s),y:E*Math.cos(g*s)-f,z:0}}unproject(e,t){const{n:s,c:u,r0:f}=this,g=f+t;let b=Math.atan2(e,Math.abs(g))*Math.sign(g);g*s<0&&(b-=Math.PI*Math.sign(e)*Math.sign(g));const E=lt(this.center[0])*s;b=ki(b,-Math.PI-E,Math.PI-E);const M=dn(b/s)+this.center[0],N=Math.asin(on((u-(e*e+g*g)*s*s)/(2*s),-1,1)),B=on(dn(N),-85.051129,Ga);return new _r(M,B)}}const Df=1.340264,Tf=-.081106,Oh=893e-6,Cf=.003796,Ef=Math.sqrt(3)/2;class L_ extends zu{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Ef*Math.sin(t)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(Ef*(Df+3*Tf*u+f*(7*Oh+9*Cf*u)))/Math.PI+.5),y:1-.5*(s*(Df+Tf*u+f*(Oh+Cf*u))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let s=t=(2*(1-t)-1)*Math.PI,u=s*s,f=u*u*u;for(let N,B,z,X=0;X<12&&(B=s*(Df+Tf*u+f*(Oh+Cf*u))-t,z=Df+3*Tf*u+f*(7*Oh+9*Cf*u),N=B/z,s=on(s-N,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(N)<1e-12));++X);const g=Ef*e*(Df+3*Tf*u+f*(7*Oh+9*Cf*u))/Math.cos(s),b=Math.asin(Math.sin(s)/Ef),E=on(180*g/Math.PI,-180,180),M=on(180*b/Math.PI,-85.051129,Ga);return new _r(E,M)}}class B_ extends zu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const s=360*(e-.5),u=on(360*(.5-t),-85.051129,Ga);return new _r(s,u)}}const Zd=Math.PI/2;function Mf(n){return Math.tan((Zd+n)/2)}class z_ extends zu{constructor(e){super(e),this.center=e.center||[0,30];const[t,s]=this.parallels=e.parallels||[30,30],u=lt(t),f=lt(s),g=Math.cos(u);this.n=u===f?Math.sin(u):Math.log(g/Math.cos(f))/Math.log(Mf(f)/Mf(u)),this.f=g*Math.pow(Mf(u),this.n)/this.n}project(e,t){t=lt(t),e=lt(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?t<-Zd+s&&(t=-Zd+s):t>Zd-s&&(t=Zd-s);const g=f/Math.pow(Mf(t),u),b=g*Math.sin(u*e),E=f-g*Math.cos(u*e);return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:s,f:u}=this,f=u-t,g=Math.sign(f),b=Math.sign(s)*Math.sqrt(e*e+f*f);let E=Math.atan2(e,Math.abs(f))*g;f*s<0&&(E-=Math.PI*Math.sign(e)*g);const M=on(dn(E/s)+this.center[0],-180,180),N=on(dn(2*Math.atan(Math.pow(u/b,1/s))-Zd),-85.051129,Ga);return new _r(M,N)}}class zc extends zu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:ja(e),y:ic(t),z:0}}unproject(e,t){const s=Ca(e),u=cs(t);return new _r(s,u)}}const wp=lt(Ga);class V_ extends zu{project(e,t){const s=(t=lt(t))*t,u=s*s;return{x:.5*((e=lt(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let s=t=(2*(1-t)-1)*Math.PI,u=25,f=0,g=s*s;do{g=s*s;const M=g*g;f=(s*(1.007226+g*(.015085+M*(.028874*g-.044475-.005916*M)))-t)/(1.007226+g*(.045255+M*(.259866*g-.311325-.005916*11*M))),s=on(s-f,-wp,wp)}while(Math.abs(f)>1e-6&&--u>0);g=s*s;const b=on(dn(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=dn(s);return new _r(b,E)}}const kg=lt(Ga);class qy extends zu{project(e,t){t=lt(t),e=lt(e);const s=Math.cos(t),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),g=Math.sin(f)/f,b=.5*(e*u+2*s*Math.sin(e/2)/g)||0,E=.5*(t+Math.sin(t)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,t){let s=e=(2*e-.5)*Math.PI,u=t=(2*(1-t)-1)*Math.PI,f=25;const g=1e-6;let b=0,E=0;do{const M=Math.cos(u),N=Math.sin(u),B=2*N*M,z=N*N,X=M*M,K=Math.cos(s/2),oe=Math.sin(s/2),pe=2*K*oe,Ce=oe*oe,Fe=1-X*K*K,Ee=Fe?1/Fe:0,Re=Fe?Math.acos(M*K)*Math.sqrt(1/Fe):0,Ye=.5*(2*Re*M*oe+2*s/Math.PI)-e,Be=.5*(Re*N+u)-t,mt=.5*Ee*(X*Ce+Re*M*K*z)+1/Math.PI,pt=Ee*(pe*B/4-Re*N*oe),Ot=.125*Ee*(B*oe-Re*N*X*pe),an=.5*Ee*(z*K+Re*Ce*M)+.5,vt=pt*Ot-an*mt;b=(Be*pt-Ye*an)/vt,E=(Ye*Ot-Be*mt)/vt,s=on(s-b,-Math.PI,Math.PI),u=on(u-E,-kg,kg)}while((Math.abs(b)>g||Math.abs(E)>g)&&--f>0);return new _r(dn(s),dn(u))}}class Em extends zu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(lt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:s,cosPhi:u}=this;return{x:lt(e)*u*s+.5,y:-Math.sin(lt(t))/u*s+.5,z:0}}unproject(e,t){const{scale:s,cosPhi:u}=this,f=-(t-.5)/s,g=on(dn((e-.5)/s)/u,-180,180),b=Math.asin(on(f*u,-1,1)),E=on(dn(b),-85.051129,Ga);return new _r(g,E)}}class U_ extends zc{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,s){const u=wf(e,t,s);return So(u,u,Ah(lc(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,t){const s=Ih(t.lat,t.lng),u=Fs([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Xf(s,s,u,sl(1,0)*ii*f);const g=ua(new Float64Array(16));return id(g,e.pixelMatrix,e.globeMatrix),So(s,s,g),new st(s[0],s[1])}pixelsPerMeter(e,t){return sl(1,0)*t}pixelSpaceConversion(e,t,s){const u=Ti(sl(1,45)*t,sl(1,e)*t,s);return this.pixelsPerMeter(e,t)/u}createTileMatrix(e,t,s){const u=Dm(lc(s.canonical));return id(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,t){const{center:s}=e,u=Ah(lc(t));return Id(u,u,lt(s.lng)),qf(u,u,lt(s.lat)),su(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,t,s,u){return $d(e,t,s,!0)||new Ml(0,0)}pointCoordinate3D(e,t,s){const u=this.pointCoordinate(e,t,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,t){return!$d(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(u,f){const g=u.cameraToCenterDistance,b=u._centerAltitude*f,E=u._camera,M=u._camera.forward(),N=rd([],Mc([],M,-g),[0,0,b]),B=u.worldSize/(2*Math.PI),z=[0,0,-B],X=u.width/u.height,K=Math.tan(u.fovAboveCenter),oe=Mc([],E.up(),K),pe=Mc([],E.right(),K*X),Ce=Fs([],rd([],rd([],M,oe),pe)),Fe=[];let Ee;if(new ep(N,Ce).closestPointOnSphere(z,B,Fe)){const Re=rd([],Fe,z),Ye=cl([],Re,N);Ee=Math.cos(u.fovAboveCenter)*Pu(Ye)}else{const Re=cl([],N,z),Ye=cl([],z,N);Fs(Ye,Ye);const Be=Pu(Re)-B;Ee=Math.sqrt(Be*(Be+2*B));const mt=Math.acos(Ee/(B+Be))-Math.acos(ll(M,Ye));Ee*=Math.cos(mt)}return 1.01*Ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Ph(e.zoom);if(s>0){const u=k_(e,sl(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ti(t,u+f*(1-Math.cos(g)),Math.pow(s,10))}return t}upVector(e,t,s){return wf(t,s,e,1)}upVectorScale(e){return{metersToTile:vm*wm(lc(e))}}}function Fg(n){const e=n.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new zc(n);case"equirectangular":return new B_(n);case"naturalEarth":return new V_(n);case"equalEarth":return new L_(n);case"winkelTripel":return new qy(n);case"albers":return t?new Em(n):new F_(n);case"lambertConformalConic":return t?new Em(n):new z_(n);case"globe":return new U_(n)}throw new Error(`Invalid projection name: ${n.name}`)}const j_=Al.VectorTileFeature.types,Mm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dp(n,e,t,s,u,f,g,b,E,M,N,B,z){const X=b?Math.min($a,Math.round(b[0])):0,K=b?Math.min($a,Math.round(b[1])):0;n.emplaceBack(e,t,Math.round(32*s),Math.round(32*u),f,g,(X<<1)+(E?1:0),K,16*M,16*N,256*B,256*z)}function Tp(n,e,t,s,u,f,g){n.emplaceBack(e,t,s,u,f,g)}function qd(n,e,t,s,u){n.emplaceBack(e,t,s,u),n.emplaceBack(e,t,s,u),n.emplaceBack(e,t,s,u),n.emplaceBack(e,t,s,u)}function Sm(n){for(const e of n.sections)if(l(e.text))return!0;return!1}class Rh{constructor(e){this.layoutVertexArray=new Br,this.indexArray=new bi,this.programConfigurations=e,this.segments=new Go,this.dynamicLayoutVertexArray=new Fi,this.opacityVertexArray=new gr,this.placedSymbolArray=new Bp,this.globeExtVertexArray=new fo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,m_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,__.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Mm,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,g_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Dn(Rh,"SymbolBuffers");class Lg{constructor(e,t,s){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new s,this.segments=new Go,this.collisionVertexArray=new Ir,this.collisionVertexArrayExt=new Wr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Gi.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,dg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Dn(Lg,"CollisionBuffers");class du{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ua([]),this.placementViewportMatrix=ua([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lp(this.zoom,t["text-size"]),this.iconSizeData=lp(this.zoom,t["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>ac[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Rh(new El(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rh(new El(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Up,this.lineVertexArray=new eu,this.symbolInstances=new Vp}calculateGlyphDependencies(e,t,s,u,f){for(let g=0;g<e.length;g++)if(t[e.charCodeAt(g)]=!0,u&&f){const b=up[e.charAt(g)];b&&(t[b.charCodeAt(0)]=!0)}}populate(e,t,s,u){const f=this.layers[0],g=f.layout,b="globe"===this.projection.name,E=g.get("text-font"),M=g.get("text-field"),N=g.get("icon-image"),B=("constant"!==M.value.kind||M.value.value instanceof Zo&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),z="constant"!==N.value.kind||!!N.value.value||Object.keys(N.parameters).length>0,X=g.get("symbol-sort-key");if(this.features=[],!B&&!z)return;const K=t.iconDependencies,oe=t.glyphDependencies,pe=t.availableImages,Ce=new me(this.zoom);for(const{feature:Fe,id:Ee,index:Re,sourceLayerIndex:Ye}of e){const Be=f._featureFilter.needGeometry,mt=oc(Fe,Be);if(!f._featureFilter.filter(Ce,mt,s))continue;if(Be||(mt.geometry=al(Fe,s,u)),b&&1!==Fe.type&&s.z<=5){const vt=mt.geometry,zt=.98078528056;for(let Ht=0;Ht<vt.length;Ht++)vt[Ht]=Gh(vt[Ht],Lt=>Lt,(Lt,sn)=>ll(wf(Lt.x,Lt.y,s,1),wf(sn.x,sn.y,s,1))<zt)}let pt,Ot;if(B){const vt=f.getValueAndResolveTokens("text-field",mt,s,pe),zt=Zo.factory(vt);Sm(zt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===se()||this.hasRTLText&&de.isParsed())&&(pt=v_(zt,f,mt))}if(z){const vt=f.getValueAndResolveTokens("icon-image",mt,s,pe);Ot=vt instanceof Mr?vt:Mr.fromString(vt)}if(!pt&&!Ot)continue;const an=this.sortFeaturesByKey?X.evaluate(mt,{},s):void 0;if(this.features.push({id:Ee,text:pt,icon:Ot,index:Re,sourceLayerIndex:Ye,geometry:mt.geometry,properties:Fe.properties,type:j_[Fe.type],sortKey:an}),Ot&&(K[Ot.name]=!0),pt){const vt=E.evaluate(mt,{},s).join(","),zt="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ac.vertical)>=0;for(const Ht of pt.sections)if(Ht.image)K[Ht.image.name]=!0;else{const Lt=gn(pt.toString()),sn=Ht.fontStack||vt,Wt=oe[sn]=oe[sn]||{};this.calculateGlyphDependencies(Ht.text,Wt,zt,this.allowVerticalPlacement,Lt)}}}"line"===g.get("symbol-placement")&&(this.features=function(Fe){const Ee={},Re={},Ye=[];let Be=0;function mt(vt){Ye.push(Fe[vt]),Be++}function pt(vt,zt,Ht){const Lt=Re[vt];return delete Re[vt],Re[zt]=Lt,Ye[Lt].geometry[0].pop(),Ye[Lt].geometry[0]=Ye[Lt].geometry[0].concat(Ht[0]),Lt}function Ot(vt,zt,Ht){const Lt=Ee[zt];return delete Ee[zt],Ee[vt]=Lt,Ye[Lt].geometry[0].shift(),Ye[Lt].geometry[0]=Ht[0].concat(Ye[Lt].geometry[0]),Lt}function an(vt,zt,Ht){const Lt=Ht?zt[0][zt[0].length-1]:zt[0][0];return`${vt}:${Lt.x}:${Lt.y}`}for(let vt=0;vt<Fe.length;vt++){const zt=Fe[vt],Ht=zt.geometry,Lt=zt.text?zt.text.toString():null;if(!Lt){mt(vt);continue}const sn=an(Lt,Ht),Wt=an(Lt,Ht,!0);if(sn in Re&&Wt in Ee&&Re[sn]!==Ee[Wt]){const Cn=Ot(sn,Wt,Ht),yi=pt(sn,Wt,Ye[Cn].geometry);delete Ee[sn],delete Re[Wt],Re[an(Lt,Ye[yi].geometry,!0)]=yi,Ye[Cn].geometry=null}else sn in Re?pt(sn,Wt,Ht):Wt in Ee?Ot(sn,Wt,Ht):(mt(vt),Ee[sn]=Be-1,Re[Wt]=Be-1)}return Ye.filter(vt=>vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Fe,Ee)=>Fe.sortKey-Ee.sortKey)}update(e,t,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Fg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const s=this.lineVertexArray.length,u=e.segment;if(void 0!==u){let f=e.dist(t[u+1]),g=e.dist(t[u]);const b={};for(let E=u+1;E<t.length;E++)b[E]={x:t[E].x,y:t[E].y,tileUnitDistanceFromAnchor:f},E<t.length-1&&(f+=t[E+1].dist(t[E]));for(let E=u||0;E>=0;E--)b[E]={x:t[E].x,y:t[E].y,tileUnitDistanceFromAnchor:g},E>0&&(g+=t[E-1].dist(t[E]));for(let E=0;E<t.length;E++){const M=b[E];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,t,s,u,f,g,b,E,M,N,B,z,X,K){const oe=e.indexArray,pe=e.layoutVertexArray,Ce=e.globeExtVertexArray,Fe=e.segments.prepareSegment(4*t.length,pe,oe,this.canOverlap?g.sortKey:void 0),Ee=this.glyphOffsetArray.length,Re=Fe.vertexLength,Ye=this.allowVerticalPlacement&&b===ac.vertical?Math.PI/2:0,Be=g.text&&g.text.sections;for(let pt=0;pt<t.length;pt++){const{tl:Ot,tr:an,bl:vt,br:zt,tex:Ht,pixelOffsetTL:Lt,pixelOffsetBR:sn,minFontScaleX:Wt,minFontScaleY:Cn,glyphOffset:yi,isSDF:xi,sectionIndex:Hn}=t[pt],hn=Fe.vertexLength,Bi=yi[1];if(Dp(pe,M.x,M.y,Ot.x,Bi+Ot.y,Ht.x,Ht.y,s,xi,Lt.x,Lt.y,Wt,Cn),Dp(pe,M.x,M.y,an.x,Bi+an.y,Ht.x+Ht.w,Ht.y,s,xi,sn.x,Lt.y,Wt,Cn),Dp(pe,M.x,M.y,vt.x,Bi+vt.y,Ht.x,Ht.y+Ht.h,s,xi,Lt.x,sn.y,Wt,Cn),Dp(pe,M.x,M.y,zt.x,Bi+zt.y,Ht.x+Ht.w,Ht.y+Ht.h,s,xi,sn.x,sn.y,Wt,Cn),E){const pi=E.anchor,Mn=E.up;Tp(Ce,pi.x,pi.y,pi.z,Mn[0],Mn[1],Mn[2]),Tp(Ce,pi.x,pi.y,pi.z,Mn[0],Mn[1],Mn[2]),Tp(Ce,pi.x,pi.y,pi.z,Mn[0],Mn[1],Mn[2]),Tp(Ce,pi.x,pi.y,pi.z,Mn[0],Mn[1],Mn[2]),qd(e.dynamicLayoutVertexArray,pi.x,pi.y,pi.z,Ye)}else qd(e.dynamicLayoutVertexArray,M.x,M.y,M.z,Ye);oe.emplaceBack(hn,hn+1,hn+2),oe.emplaceBack(hn+1,hn+2,hn+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yi[0]),pt!==t.length-1&&Hn===t[pt+1].sectionIndex||e.programConfigurations.populatePaintArrays(pe.length,g,g.index,{},X,K,Be&&Be[Hn])}const mt=E?E.anchor:M;e.placedSymbolArray.emplaceBack(mt.x,mt.y,mt.z,M.x,M.y,Ee,this.glyphOffsetArray.length-Ee,Re,N,B,M.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],b,0,!1,0,z,0)}_commitLayoutVertex(e,t,s,u,f,g,b){e.emplaceBack(t,s,u,f,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,t,s,u,f,g,b){const E=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),M=E.vertexLength,N=b.tileAnchorX,B=b.tileAnchorY;for(let X=0;X<4;X++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,N,B,new st(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,N,B,new st(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,N,B,new st(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,N,B,new st(e.x1,e.y2)),E.vertexLength+=4;const z=s.indexArray;z.emplaceBack(M,M+1),z.emplaceBack(M+1,M+2),z.emplaceBack(M+2,M+3),z.emplaceBack(M+3,M),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,s,u,f,g){for(let b=u;b<f;b++){const E=s.get(b),M=this.getSymbolInstanceTextSize(e,g,t,b);this._addCollisionDebugVertices(E,M,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,t,s,u,f,g){for(let b=u;b<f;b++){const E=s.get(b),M=this.getSymbolInstanceIconSize(e,t,b);this._addCollisionDebugVertices(E,M,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lg(Da,lm.members,Hs),this.iconCollisionBox=new Lg(Da,lm.members,Hs);const s=zd(this.iconSizeData,e),u=zd(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,t,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,t,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,t,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,t,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,t,s,u){const f=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:u),g=cp(this.textSizeData,e,f)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,t,s){const u=this.icon.placedSymbolArray.get(s),f=cp(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,t,s){e.emplaceBack(t,-s,-s),e.emplaceBack(t,s,-s),e.emplaceBack(t,s,s),e.emplaceBack(t,-s,s)}_updateTextDebugCollisionBoxes(e,t,s,u,f,g){for(let b=u;b<f;b++){const E=s.get(b),M=this.getSymbolInstanceTextSize(e,g,t,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,E.padding)}}_updateIconDebugCollisionBoxes(e,t,s,u,f){for(let g=u;g<f;g++){const b=s.get(g),E=this.getSymbolInstanceIconSize(e,t,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=zd(this.iconSizeData,e),u=zd(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,t,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,t,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,e,t,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,t,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,s,u,f,g,b,E,M){const N={};for(let B=t;B<s;B++){const z=e.get(B);N.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},N.textFeatureIndex=z.featureIndex;break}for(let B=u;B<f;B++){const z=e.get(B);N.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},N.verticalTextFeatureIndex=z.featureIndex;break}for(let B=g;B<b;B++){const z=e.get(B);N.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},N.iconFeatureIndex=z.featureIndex;break}for(let B=E;B<M;B++){const z=e.get(B);N.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},N.verticalIconFeatureIndex=z.featureIndex;break}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const s=e.placedSymbolArray.get(t),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),s=Math.cos(e),u=[],f=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const E=this.symbolInstances.get(b);u.push(0|Math.round(t*E.tileAnchorX+s*E.tileAnchorY)),f.push(E.featureIndex)}return g.sort((b,E)=>u[b]-u[E]||f[E]-f[b]),g}addToSortKeyRanges(e,t){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===t?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const s=this.symbolInstances.get(t);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((u,f,g)=>{u>=0&&g.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Dn(du,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),du.MAX_GLYPHS=65535,du.addDynamicAttributes=qd;const Yy=new Pt({"symbol-placement":new Le(at.layout_symbol["symbol-placement"]),"symbol-spacing":new Le(at.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Le(at.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Je(at.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Le(at.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Le(at.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Le(at.layout_symbol["icon-ignore-placement"]),"icon-optional":new Le(at.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Le(at.layout_symbol["icon-rotation-alignment"]),"icon-size":new Je(at.layout_symbol["icon-size"]),"icon-text-fit":new Le(at.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Le(at.layout_symbol["icon-text-fit-padding"]),"icon-image":new Je(at.layout_symbol["icon-image"]),"icon-rotate":new Je(at.layout_symbol["icon-rotate"]),"icon-padding":new Le(at.layout_symbol["icon-padding"]),"icon-keep-upright":new Le(at.layout_symbol["icon-keep-upright"]),"icon-offset":new Je(at.layout_symbol["icon-offset"]),"icon-anchor":new Je(at.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Le(at.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Le(at.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Le(at.layout_symbol["text-rotation-alignment"]),"text-field":new Je(at.layout_symbol["text-field"]),"text-font":new Je(at.layout_symbol["text-font"]),"text-size":new Je(at.layout_symbol["text-size"]),"text-max-width":new Je(at.layout_symbol["text-max-width"]),"text-line-height":new Je(at.layout_symbol["text-line-height"]),"text-letter-spacing":new Je(at.layout_symbol["text-letter-spacing"]),"text-justify":new Je(at.layout_symbol["text-justify"]),"text-radial-offset":new Je(at.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Le(at.layout_symbol["text-variable-anchor"]),"text-anchor":new Je(at.layout_symbol["text-anchor"]),"text-max-angle":new Le(at.layout_symbol["text-max-angle"]),"text-writing-mode":new Le(at.layout_symbol["text-writing-mode"]),"text-rotate":new Je(at.layout_symbol["text-rotate"]),"text-padding":new Le(at.layout_symbol["text-padding"]),"text-keep-upright":new Le(at.layout_symbol["text-keep-upright"]),"text-transform":new Je(at.layout_symbol["text-transform"]),"text-offset":new Je(at.layout_symbol["text-offset"]),"text-allow-overlap":new Le(at.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Le(at.layout_symbol["text-ignore-placement"]),"text-optional":new Le(at.layout_symbol["text-optional"])});var Cp={paint:new Pt({"icon-opacity":new Je(at.paint_symbol["icon-opacity"]),"icon-color":new Je(at.paint_symbol["icon-color"]),"icon-halo-color":new Je(at.paint_symbol["icon-halo-color"]),"icon-halo-width":new Je(at.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Je(at.paint_symbol["icon-halo-blur"]),"icon-translate":new Le(at.paint_symbol["icon-translate"]),"icon-translate-anchor":new Le(at.paint_symbol["icon-translate-anchor"]),"text-opacity":new Je(at.paint_symbol["text-opacity"]),"text-color":new Je(at.paint_symbol["text-color"],{runtimeType:wr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Je(at.paint_symbol["text-halo-color"]),"text-halo-width":new Je(at.paint_symbol["text-halo-width"]),"text-halo-blur":new Je(at.paint_symbol["text-halo-blur"]),"text-translate":new Le(at.paint_symbol["text-translate"]),"text-translate-anchor":new Le(at.paint_symbol["text-translate-anchor"])}),layout:Yy};class Im{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ir,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dn(Im,"FormatSectionOverride",{omit:["defaultValue"]});class Sf extends nc{constructor(e){super(e,Cp)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,s,u){const f=this.layout.get(e).evaluate(t,{},s,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||gc(g.value)||!f?f:(b=t.properties,f.replace(/{([^{}]+)}/g,(M,N)=>N in b?String(b[N]):""));var b}createBucket(e){return new du(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Cp.paint.overridableProperties){if(!Sf.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),s=new Im(t),u=new zl(s,t.property.specification);let f=null;f="constant"===t.value.kind||"source"===t.value.kind?new $u("source",u):new vu("composite",u,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Ne(t.property,f,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven())&&Sf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const s=e.get("text-field"),u=Cp.paint.properties[t];let f=!1;const g=b=>{for(const E of b)if(u.overrides&&u.overrides.hasOverride(E))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Zo)g(s.value.value.sections);else if("source"===s.value.kind){const b=M=>{f||(M instanceof ta&&Fr(M.value)===ps?g(M.value.sections):M instanceof Lo?g(M.sections):M.eachChild(b))},E=s.value;E._styleExpression&&b(E._styleExpression.expression)}return f}getProgramConfiguration(e){return new ol(this,e)}}var Bg={paint:new Pt({"background-color":new Le(at.paint_background["background-color"]),"background-pattern":new nn(at.paint_background["background-pattern"]),"background-opacity":new Le(at.paint_background["background-opacity"])})},Am={paint:new Pt({"raster-opacity":new Le(at.paint_raster["raster-opacity"]),"raster-hue-rotate":new Le(at.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Le(at.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Le(at.paint_raster["raster-brightness-max"]),"raster-saturation":new Le(at.paint_raster["raster-saturation"]),"raster-contrast":new Le(at.paint_raster["raster-contrast"]),"raster-resampling":new Le(at.paint_raster["raster-resampling"]),"raster-fade-duration":new Le(at.paint_raster["raster-fade-duration"])})};class Vu extends nc{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Ep={paint:new Pt({"sky-type":new Le(at.paint_sky["sky-type"]),"sky-atmosphere-sun":new Le(at.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Le(at.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Le(at.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Le(at.paint_sky["sky-gradient-radius"]),"sky-gradient":new rt(at.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Le(at.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Le(at.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Le(at.paint_sky["sky-opacity"])})};function Nh(n,e,t){const s=[0,0,1],u=Qp([]);return tf(u,u,t?-lt(n)+Math.PI:lt(n)),Qf(u,u,-lt(e)),Jf(s,s,u),Fs(s,s)}const If={circle:class extends nc{constructor(n){super(n,Jp)}createBucket(n){return new td(n)}queryRadius(n){const e=n;return nd("circle-radius",this,e)+nd("circle-stroke-width",this,e)+Iu(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,t,s,u,f,g,b){const E=Zf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return em(n,s,f,g,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,M)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new ol(this,n)}},heatmap:class extends nc{createBucket(n){return new im(n)}constructor(n){super(n,Od),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return nd("heatmap-radius",this,n)}queryIntersectsFeature(n,e,t,s,u,f,g,b){const E=this.paint.get("heatmap-radius").evaluate(e,t);return em(n,s,f,g,b,!0,!0,new st(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new ol(this,n)}},hillshade:class extends nc{constructor(n){super(n,tg)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends nc{constructor(n){super(n,ds)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(n){return new ol(this,n)}recalculate(n,e){super.recalculate(n,e);const t=this.paint._values["fill-outline-color"];"constant"===t.value.kind&&void 0===t.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Ar(n)}queryRadius(){return Iu(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,t,s,u,f){return!n.queryGeometry.isAboveHorizon&&fh(Yp(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends nc{constructor(n){super(n,Nu)}createBucket(n){return new cd(n)}queryRadius(){return Iu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new ol(this,n)}queryIntersectsFeature(n,e,t,s,u,f,g,b,E){const M=Zf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(e,t),B=this.paint.get("fill-extrusion-base").evaluate(e,t),z=[0,0],X=b&&f.elevation,K=f.elevation?f.elevation.exaggeration():1,oe=n.tile.getBucket(this);if(X&&oe instanceof cd){const Fe=oe.centroidVertexArray,Ee=E+1;if(Ee<Fe.length){const Re=Fe.get(Ee);z[0]=Re.a_centroid_pos0,z[1]=Re.a_centroid_pos1}}if(0===z[0]&&1===z[1])return!1;"globe"===f.projection.name&&(s=wh([s],[new st(0,0),new st(ii,ii)],n.tileID.canonical).map(Fe=>Fe.polygon).flat());const pe=(Ee=s,Re=B,Ye=N,Be=M,mt=g,pt=X?b:null,Ot=z,an=K,vt=f.center.lat,"globe"===(Fe=f).projection.name?function(Ht,Lt,sn,Wt,Cn,yi,xi,Hn,hn,Bi,pi){const Mn=[],zr=[],Or=Ht.projection.upVectorScale(pi,Ht.center.lat,Ht.worldSize).metersToTile,so=[0,0,0,1],Oi=[0,0,0,1],tr=(Vr,Rr,Qr,bo)=>{Vr[0]=Rr,Vr[1]=Qr,Vr[2]=bo,Vr[3]=1},Kr=xh();sn>0&&(sn+=Kr),Wt+=Kr;for(const Vr of Lt){const Rr=[],Qr=[];for(const bo of Vr){const fr=bo.x+Cn.x,Ea=bo.y+Cn.y,Yi=Ht.projection.projectTilePoint(fr,Ea,pi),Io=Ht.projection.upVector(pi,bo.x,bo.y);let Ks=sn,yr=Wt;if(xi){const po=sg(fr,Ea,sn,Wt,xi,Hn,hn,Bi);Ks+=po.base,yr+=po.top}0!==sn?tr(so,Yi.x+Io[0]*Or*Ks,Yi.y+Io[1]*Or*Ks,Yi.z+Io[2]*Or*Ks):tr(so,Yi.x,Yi.y,Yi.z),tr(Oi,Yi.x+Io[0]*Or*yr,Yi.y+Io[1]*Or*yr,Yi.z+Io[2]*Or*yr),So(so,so,yi),So(Oi,Oi,yi),Rr.push(fd(so)),Qr.push(fd(Oi))}Mn.push(Rr),zr.push(Qr)}return[Mn,zr]}(Fe,Ee,Re,Ye,Be,mt,pt,Ot,an,vt,n.tileID.canonical):pt?function(Ht,Lt,sn,Wt,Cn,yi,xi,Hn,hn){const Bi=[],pi=[],Mn=[0,0,0,1];for(const zr of Ht){const Or=[],so=[];for(const Oi of zr){const tr=Oi.x+Wt.x,Kr=Oi.y+Wt.y,Vr=sg(tr,Kr,Lt,sn,yi,xi,Hn,hn);Mn[0]=tr,Mn[1]=Kr,Mn[2]=Vr.base,Mn[3]=1,od(Mn,Mn,Cn),Mn[3]=Math.max(Mn[3],1e-5);const Rr=fd([Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]]);Mn[0]=tr,Mn[1]=Kr,Mn[2]=Vr.top,Mn[3]=1,od(Mn,Mn,Cn),Mn[3]=Math.max(Mn[3],1e-5);const Qr=fd([Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]]);Or.push(Rr),so.push(Qr)}Bi.push(Or),pi.push(so)}return[Bi,pi]}(Ee,Re,Ye,Be,mt,pt,Ot,an,vt):function(Ht,Lt,sn,Wt,Cn){const yi=[],xi=[],Hn=Cn[8]*Lt,hn=Cn[9]*Lt,Bi=Cn[10]*Lt,pi=Cn[11]*Lt,Mn=Cn[8]*sn,zr=Cn[9]*sn,Or=Cn[10]*sn,so=Cn[11]*sn;for(const Oi of Ht){const tr=[],Kr=[];for(const Vr of Oi){const Rr=Vr.x+Wt.x,Qr=Vr.y+Wt.y,bo=Cn[0]*Rr+Cn[4]*Qr+Cn[12],fr=Cn[1]*Rr+Cn[5]*Qr+Cn[13],Ea=Cn[2]*Rr+Cn[6]*Qr+Cn[14],Yi=Cn[3]*Rr+Cn[7]*Qr+Cn[15],Io=bo+Hn,Ks=fr+hn,yr=Ea+Bi,po=Math.max(Yi+pi,1e-5),da=bo+Mn,Nr=fr+zr,No=Ea+Or,Bs=Math.max(Yi+so,1e-5),fs=new st(Io/po,Ks/po);fs.z=yr/po,tr.push(fs);const Qs=new st(da/Bs,Nr/Bs);Qs.z=No/Bs,Kr.push(Qs)}yi.push(tr),xi.push(Kr)}return[yi,xi]}(Ee,Re,Ye,Be,mt)),Ce=n.queryGeometry;var Fe,Ee,Re,Ye,Be,mt,pt,Ot,an,vt;return function(Fe,Ee,Re){let Ye=1/0;fh(Re,Ee)&&(Ye=sp(Re,Ee[0]));for(let Be=0;Be<Ee.length;Be++){const mt=Ee[Be],pt=Fe[Be];for(let Ot=0;Ot<mt.length-1;Ot++){const an=mt[Ot],vt=[an,mt[Ot+1],pt[Ot+1],pt[Ot],an];iu(Re,vt)&&(Ye=Math.min(Ye,sp(Re,vt)))}}return Ye!==1/0&&Ye}(pe[0],pe[1],Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry)}},line:class extends nc{constructor(n){super(n,cg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof _a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=ug.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new ap(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new ol(this,n)}queryRadius(n){const e=n,t=am(nd("line-width",this,e),nd("line-gap-width",this,e)),s=nd("line-offset",this,e);return t/2+Math.abs(s)+Iu(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,t,s,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=Yp(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),b=n.pixelToTileUnitsFactor/2*am(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),E=this.paint.get("line-offset").evaluate(e,t);return E&&(s=function(M,N){const B=[],z=new st(0,0);for(let X=0;X<M.length;X++){const K=M[X],oe=[];for(let pe=0;pe<K.length;pe++){const Ce=K[pe-1],Fe=K[pe],Ee=K[pe+1],Re=0===pe?z:Fe.sub(Ce)._unit()._perp(),Ye=pe===K.length-1?z:Ee.sub(Fe)._unit()._perp(),Be=Re._add(Ye)._unit();Be._mult(1/(Be.x*Ye.x+Be.y*Ye.y)),oe.push(Be._mult(N)._add(Fe))}B.push(oe)}return B}(s,E*n.pixelToTileUnitsFactor)),function(M,N,B){for(let z=0;z<N.length;z++){const X=N[z];if(M.length>=3)for(let K=0;K<X.length;K++)if(Cc(M,X[K]))return!0;if(Wf(M,X,B))return!0}return!1}(g,s,b)}isTileClipped(){return!0}},symbol:Sf,background:class extends nc{constructor(n){super(n,Bg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends nc{constructor(n){super(n,Am)}getProgramIds(){return["raster"]}},sky:class extends nc{constructor(n){super(n,Ep),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=sf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=n.style.light,g=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&An("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Nh(g.azimuthal,90-g.polar,e):Nh(s[0],90-s[1],e)}const t=this.paint.get("sky-gradient-center");return Nh(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class Af{constructor(e,t,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(t,u)}update(e,t,s){const{width:u,height:f}=e,{context:g}=this,{gl:b}=g,{HTMLImageElement:E,HTMLCanvasElement:M,HTMLVideoElement:N,ImageData:B,ImageBitmap:z}=ze;if(b.bindTexture(b.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!t||!1!==t.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:X,y:K}=s||{x:0,y:0};e instanceof E||e instanceof M||e instanceof N||e instanceof B||z&&e instanceof z?b.texSubImage2D(b.TEXTURE_2D,0,X,K,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,X,K,u,f,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof E||e instanceof M||e instanceof N||e instanceof B||z&&e instanceof z?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,u,f,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,t){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Pf{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new sc({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const s=this.getKey(e,t);return this.positions[s]}trim(){const e=this.width,t=this.height=Kt(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,g=e[0]*s,b=!0;u.push({left:f,right:g,isDash:b,zeroLength:0===e[0]});let E=e[0];for(let M=1;M<e.length;M++){b=!b;const N=e[M];f=E*s,E+=N,g=E*s,u.push({left:f,right:g,isDash:b,zeroLength:0===N})}return u}addRoundDash(e,t,s){const u=t/2;for(let f=-s;f<=s;f++){const g=this.width*(this.nextRow+s+f);let b=0,E=e[b];for(let M=0;M<this.width;M++){M/E.right>1&&(E=e[++b]);const N=Math.abs(M-E.left),B=Math.abs(M-E.right),z=Math.min(N,B);let X;const K=f/s*(u+1);if(E.isDash){const oe=u-Math.abs(K);X=Math.sqrt(z*z+oe*oe)}else X=u-Math.sqrt(z*z+K*K);this.image.data[g+M]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(e,t){for(let E=e.length-1;E>=0;--E){const M=e[E],N=e[E+1];M.zeroLength?e.splice(E,1):N&&N.isDash===M.isDash&&(N.left=M.left,e.splice(E,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let g=0,b=e[g];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++g]);const M=Math.abs(E-b.left),N=Math.abs(E-b.right),B=Math.min(M,N);this.image.data[f+E]=Math.max(0,Math.min(255,(b.isDash?B:-B)+t+128))}}addDash(e,t){const s=this.getKey(e,t);if(this.positions[s])return this.positions[s];const u="round"===t,f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return An("LineAtlas out of space"),null;0===e.length&&e.push(1);let b=0;for(let N=0;N<e.length;N++)e[N]<0&&(An("Negative value is found in line dasharray, replacing values with 0"),e[N]=0),b+=e[N];if(0!==b){const N=this.width/b,B=this.getDashRanges(e,this.width,N);u?this.addRoundDash(B,N,f):this.addRegularDash(B,"square"===t?.5*N:0)}const E=this.nextRow+f;this.nextRow+=g;const M={tl:[E,f],br:[b,0]};return this.positions[s]=M,M}}Dn(Pf,"LineAtlas");class zg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class G_{constructor(){this.tasks={},this.taskQueue=[],ct(["process"],this),this.invoker=new zg(this.process),this.nextId=0}add(e,t){const s=this.nextId++,u=function({type:f,isSymbolTile:g,zoom:b}){return b=b||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-b:"maybePrepare"===f&&g?400-b:500:200-b:100-b}(t);if(0===u){Ni();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:t,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Ni();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<t&&(t=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Vg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const s=e[t];this._stringToNumber[s]=t,this._numberToString[t]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Of=["tile","layer","source","sourceLayer","state"];class Ug{constructor(e,t,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Of)void 0!==this[t]&&(e[t]=this[t]);return e}}const Yd=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,t=0,s=0,u=0,f=0,g=0,b=0;for(1&e?u=f=g=32:t=s=b=32;(e>>=1)>1;){const M=t+u>>1,N=s+f>>1;1&e?(u=t,f=s,t=g,s=b):(t=u,s=f,u=g,f=b),g=M,b=N}const E=4*n;Yd[E+0]=t,Yd[E+1]=s,Yd[E+2]=u,Yd[E+3]=f}const fu=new Uint16Array(2178),yd=new Uint8Array(1089),Mp=new Uint16Array(1089);function Pm(n){return 0===n?-.03125:32===n?.03125:0}var Sp=kt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const jg={type:2,extent:ii,loadGeometry:()=>[[new st(0,0),new st(8193,0),new st(8193,8193),new st(0,8193),new st(0,0)]]};class Rf{constructor(e,t,s,u,f){this.tileID=e,this.uid=tn(),this.uses=0,this.tileSize=t,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Hi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Wd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const g={};if(!f)return g;for(const b of u){const E=b.layerIds.map(M=>f.getLayer(M)).filter(Boolean);if(0!==E.length){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>E.filter(N=>N.id===M)[0]));for(const M of E)g[M.id]=b}}return g}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof du){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof du&&f.hasRTLText){this.hasRTLText=!0,de.isLoading()||de.isLoaded()||"deferred"!==se()||ve();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ec}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Af(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Af(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Af(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,s,u,f,g,b,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:b,transform:g,params:f,tileTransform:this.tileTransform},e,t,s):{}}querySourceFeatures(e,t){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=t?t.sourceLayer:"",g=u._geojsonTileLayer||u[f];if(!g)return;const b=Hl(t&&t.filter),{z:E,x:M,y:N}=this.tileID.canonical,B={z:E,x:M,y:N};for(let z=0;z<g.length;z++){const X=g.feature(z);if(b.needGeometry){const pe=oc(X,!0);if(!b.filter(new me(this.tileID.overscaledZ),pe,this.tileID.canonical))continue}else if(!b.filter(new me(this.tileID.overscaledZ),X))continue;const K=s.getId(X,f),oe=new Ug(X,E,M,N,K);oe.tile=B,e.push(oe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const s=kr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(t)if(this.expirationTime<t)u=!0;else{const f=this.expirationTime-t;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const s=this.latestFeatureIndex.loadVTLayers(),u=t.style.listImages();for(const f in this.buckets){if(!t.style.hasLayer(f))continue;const g=this.buckets[f],b=g.layers[0].sourceLayer||"_geojsonTileLayer",E=s[b],M=e[b];if(!E||!M||0===Object.keys(M).length)continue;if(g.update(M,E,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof ap||g instanceof Ar){const B=t.style._getSourceCache(g.layers[0].source);t._terrain&&t._terrain.enabled&&B&&g.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(B.id,this.tileID)}const N=t&&t.style&&t.style.getLayer(f);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Hi.now()+e}setTexture(e,t){const s=t.context,u=s.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Af(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,t){const s={};for(const u of t)s[u]=!0;this.dependencies[e]=s}hasDependency(e,t){for(const s of e){const u=this.dependencies[s];if(u)for(const f of t)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const s=al(jg,this.tileID.canonical,this.tileTransform)[0],u=new fn,f=new il;for(let g=0;g<s.length;g++){const{x:b,y:E}=s[g];u.emplaceBack(b,E),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Mh.members),this._tileDebugSegments=Go.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const s=al(jg,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const g=function(b,E){const M=Wd(b,E),N=Math.pow(2,b.z);for(let pe=0;pe<33;pe++)for(let Ce=0;Ce<33;Ce++){const Fe=Ca((b.x+(Ce+Pm(Ce))/32)/N),Ee=cs((b.y+(pe+Pm(pe))/32)/N),Re=E.project(Fe,Ee),Ye=33*pe+Ce;fu[2*Ye+0]=Math.round((Re.x*M.scale-M.x)*ii),fu[2*Ye+1]=Math.round((Re.y*M.scale-M.y)*ii)}yd.fill(0),Mp.fill(0);for(let pe=2045;pe>=0;pe--){const Ce=4*pe,Fe=Yd[Ce+0],Ee=Yd[Ce+1],Re=Yd[Ce+2],Ye=Yd[Ce+3],Be=Fe+Re>>1,mt=Ee+Ye>>1,pt=Be+mt-Ee,Ot=mt+Fe-Be,an=33*Ee+Fe,vt=33*Ye+Re,zt=33*mt+Be,Ht=Math.hypot((fu[2*an+0]+fu[2*vt+0])/2-fu[2*zt+0],(fu[2*an+1]+fu[2*vt+1])/2-fu[2*zt+1])>=16;if(yd[zt]=yd[zt]||(Ht?1:0),pe<1022){const Lt=33*(Ee+Ot>>1)+(Fe+pt>>1),sn=33*(Ye+Ot>>1)+(Re+pt>>1);yd[zt]=yd[zt]||yd[Lt]||yd[sn]}}const B=new $n,z=new bi;let X=0;function K(pe,Ce){const Fe=33*Ce+pe;return 0===Mp[Fe]&&(B.emplaceBack(fu[2*Fe+0],fu[2*Fe+1],pe*ii/32,Ce*ii/32),Mp[Fe]=++X),Mp[Fe]-1}function oe(pe,Ce,Fe,Ee,Re,Ye){const Be=pe+Fe>>1,mt=Ce+Ee>>1;if(Math.abs(pe-Re)+Math.abs(Ce-Ye)>1&&yd[33*mt+Be])oe(Re,Ye,pe,Ce,Be,mt),oe(Fe,Ee,Re,Ye,Be,mt);else{const pt=K(pe,Ce),Ot=K(Fe,Ee),an=K(Re,Ye);z.emplaceBack(pt,Ot,an)}}return oe(0,0,32,32,32,0),oe(32,32,0,0,0,32),{vertices:B,indices:z}}(this.tileID.canonical,t);u=g.vertices,f=g.indices}else{u=new $n,f=new bi;for(const{x:b,y:E}of s)u.emplaceBack(b,E,0,0);const g=Rd(u.int16,void 0,4);for(let b=0;b<g.length;b+=3)f.emplaceBack(g[b],g[b+1],g[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Sp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Go.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,t){const s=t.projection;if(!s||"globe"!==s.name||t.freezeTileCoverage)return;const u=this.tileID.canonical,f=Ah(bf(u,t)),g=Ph(t.zoom);let b;g>0&&(b=mh(new Float64Array(16),t.globeMatrix));const E=(u.x+.5)/(1<<u.z)-ja(t.center.lng);let M=0;E>.5?M=-1:E<-.5&&(M=1),this._makeGlobeTileDebugBorderBuffer(e,u,t,f,b,g,M),this._makeGlobeTileDebugTextBuffer(e,u,t,f,b,g,M)}_globePoint(e,t,s,u,f,g,b,E){let M=wf(e,t,s);if(g){const N=1<<s.z,B=[((e/ii+s.x)/N+E)*u,(t/ii+s.y)/N*u,0];So(B,B,g),M=Sr(M,B,b)}return So(M,M,f)}_makeGlobeTileDebugBorderBuffer(e,t,s,u,f,g,b){const E=new fn,M=new il,N=new Fn,B=(X,K,oe,pe,Ce)=>{const Fe=(oe-X)/(Ce-1),Ee=(pe-K)/(Ce-1),Re=E.length;for(let Ye=0;Ye<Ce;Ye++){const Be=X+Ye*Fe,mt=K+Ye*Ee;E.emplaceBack(Be,mt);const pt=this._globePoint(Be,mt,t,s.worldSize,u,f,g,b);N.emplaceBack(pt[0],pt[1],pt[2]),M.emplaceBack(Re+Ye)}},z=ii;B(0,0,z,0,16),B(z,0,z,z,16),B(z,z,0,z,16),B(0,z,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(M),this._tileDebugBuffer=e.createVertexBuffer(E,Mh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(N,Lu.members),this._tileDebugSegments=Go.simpleSegment(0,0,E.length,M.length)}_makeGlobeTileDebugTextBuffer(e,t,s,u,f,g,b){const E=new fn,M=new bi,N=new Fn,B=25;M.reserve(32),E.reserve(B),N.reserve(B);const z=(X,K)=>B*X+K;for(let X=0;X<B;X++){const K=2048*X;for(let oe=0;oe<B;oe++){const pe=2048*oe;E.emplaceBack(pe,K);const Ce=this._globePoint(pe,K,t,s.worldSize,u,f,g,b);N.emplaceBack(Ce[0],Ce[1],Ce[2])}}for(let X=0;X<4;X++)for(let K=0;K<4;K++){const oe=z(X,K),pe=z(X,K+1),Ce=z(X+1,K),Fe=z(X+1,K+1);M.emplaceBack(oe,pe,Ce),M.emplaceBack(Ce,pe,Fe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(M),this._tileDebugTextBuffer=e.createVertexBuffer(E,Mh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(N,Lu.members),this._tileDebugTextSegments=Go.simpleSegment(0,0,B,32)}}class $_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,s){const u=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Zt(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,t,s){if(null===this.deletedStates[e])return;const u=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==t)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,t){const s=String(t),u=Zt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][t];if(null===f)return{};for(const g in f)delete u[g]}return u}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Zt(this.state[u][g],this.stateChanges[u][g]),f[g]=this.state[u][g];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const g in this.state[u])f[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else for(const b of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][b];f[g]=this.state[u][g]}s[u]=s[u]||{},Zt(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,t)}}class Gg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const s=this.toIdx(e,t);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function $g(n,e,t,s){let u=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(t[g]<n[g]||t[g]>e[g])return null}else{const b=1/s[g];let E=(n[g]-t[g])*b,M=(e[g]-t[g])*b;if(E>M){const N=E;E=M,M=N}if(E>u&&(u=E),M<f&&(f=M),u>f)return null}return u}function Hg(n,e,t,s,u,f,g,b,E,M,N){const B=s-n,z=u-e,X=f-t,K=g-n,oe=b-e,pe=E-t,Ce=N[1]*pe-N[2]*oe,Fe=N[2]*K-N[0]*pe,Ee=N[0]*oe-N[1]*K,Re=B*Ce+z*Fe+X*Ee;if(Math.abs(Re)<1e-15)return null;const Ye=1/Re,Be=M[0]-n,mt=M[1]-e,pt=M[2]-t,Ot=(Be*Ce+mt*Fe+pt*Ee)*Ye;if(Ot<0||Ot>1)return null;const an=mt*X-pt*z,vt=pt*B-Be*X,zt=Be*z-mt*B,Ht=(N[0]*an+N[1]*vt+N[2]*zt)*Ye;return Ht<0||Ot+Ht>1?null:(K*an+oe*vt+pe*zt)*Ye}function Wg(n,e,t){return(n-e)/(t-e)}function Zg(n,e,t,s,u,f,g,b,E){const M=1<<t,N=f-s,B=g-u,z=(n+1)/M*N+s,X=(e+0)/M*B+u,K=(e+1)/M*B+u;b[0]=(n+0)/M*N+s,b[1]=X,E[0]=z,E[1]=K}class Nf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(f){const g=Math.ceil(Math.log2(f.dim/8)),b=[];let E=Math.ceil(Math.pow(2,g));const M=1/E,N=(X,K,oe,pe,Ce)=>{const Fe=pe?1:0,Ee=(X+1)*oe-Fe,Re=K*oe,Ye=(K+1)*oe-Fe;Ce[0]=X*oe,Ce[1]=Re,Ce[2]=Ee,Ce[3]=Ye};let B=new Gg(E);const z=[];for(let X=0;X<E*E;X++){N(X%E,Math.floor(X/E),M,!1,z);const K=Xd(z[0],z[1],f),oe=Xd(z[2],z[1],f),pe=Xd(z[2],z[3],f),Ce=Xd(z[0],z[3],f);B.minimums.push(Math.min(K,oe,pe,Ce)),B.maximums.push(Math.max(K,oe,pe,Ce)),B.leaves.push(1)}for(b.push(B),E/=2;E>=1;E/=2){const X=b[b.length-1];B=new Gg(E);for(let K=0;K<E*E;K++){N(K%E,Math.floor(K/E),2,!0,z);const oe=X.getElevation(z[0],z[1]),pe=X.getElevation(z[2],z[1]),Ce=X.getElevation(z[2],z[3]),Fe=X.getElevation(z[0],z[3]),Ee=X.isLeaf(z[0],z[1]),Re=X.isLeaf(z[2],z[1]),Ye=X.isLeaf(z[2],z[3]),Be=X.isLeaf(z[0],z[3]),mt=Math.min(oe.min,pe.min,Ce.min,Fe.min),pt=Math.max(oe.max,pe.max,Ce.max,Fe.max),Ot=Ee&&Re&&Ye&&Be;B.maximums.push(pt),B.minimums.push(mt),B.leaves.push(pt-mt<=5&&Ot?1:0)}b.push(B)}return b}(this.dem),s=t.length-1,u=t[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(t,0,0,s,0)}raycastRoot(e,t,s,u,f,g,b=1){return $g([e,t,-100],[s,u,this.maximums[0]*b],f,g)}raycast(e,t,s,u,f,g,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,t,s,u,f,g,b);if(null==E)return null;const M=[],N=[],B=[],z=[],X=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;X.length>0;){const{idx:K,t:oe,nodex:pe,nodey:Ce,depth:Fe}=X.pop();if(this.leaves[K]){Zg(pe,Ce,Fe,e,t,s,u,B,z);const Re=1<<Fe,Ye=(pe+0)/Re,Be=(pe+1)/Re,mt=(Ce+0)/Re,pt=(Ce+1)/Re,Ot=Xd(Ye,mt,this.dem)*b,an=Xd(Be,mt,this.dem)*b,vt=Xd(Be,pt,this.dem)*b,zt=Xd(Ye,pt,this.dem)*b,Ht=Hg(B[0],B[1],Ot,z[0],B[1],an,z[0],z[1],vt,f,g),Lt=Hg(z[0],z[1],vt,B[0],z[1],zt,B[0],B[1],Ot,f,g),sn=Math.min(null!==Ht?Ht:Number.MAX_VALUE,null!==Lt?Lt:Number.MAX_VALUE);if(sn!==Number.MAX_VALUE)return sn;{const Wt=Xf([],f,g,oe);if(vd(Ot,an,zt,vt,Wg(Wt[0],B[0],z[0]),Wg(Wt[1],B[1],z[1]))>=Wt[2])return oe}continue}let Ee=0;for(let Re=0;Re<this._siblingOffset.length;Re++){Zg((pe<<1)+this._siblingOffset[Re][0],(Ce<<1)+this._siblingOffset[Re][1],Fe+1,e,t,s,u,B,z),B[2]=-100,z[2]=this.maximums[this.childOffsets[K]+Re]*b;const Ye=$g(B,z,f,g);if(null!=Ye){const Be=Ye;M[Re]=Be;let mt=!1;for(let pt=0;pt<Ee&&!mt;pt++)Be>=M[N[pt]]&&(N.splice(pt,0,Re),mt=!0);mt||(N[Ee]=Re),Ee++}}for(let Re=0;Re<Ee;Re++){const Ye=N[Re];X.push({idx:this.childOffsets[K]+Ye,t:M[Ye],nodex:(pe<<1)+this._siblingOffset[Ye][0],nodey:(Ce<<1)+this._siblingOffset[Ye][1],depth:Fe+1})}}return null}_addNode(e,t,s){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,s,u,f){if(1===e[u].isLeaf(t,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=u-1,b=e[g];let E=0,M=0;for(let N=0;N<this._siblingOffset.length;N++){const B=2*t+this._siblingOffset[N][0],z=2*s+this._siblingOffset[N][1],X=b.getElevation(B,z),K=b.isLeaf(B,z),oe=this._addNode(X.min,X.max,K);K&&(E|=1<<N),M||(M=oe)}for(let N=0;N<this._siblingOffset.length;N++)E&1<<N||this._construct(e,2*t+this._siblingOffset[N][0],2*s+this._siblingOffset[N][1],g,M+N)}}function vd(n,e,t,s,u,f){return Ti(Ti(n,t,f),Ti(e,s,f),u)}function Xd(n,e,t){const s=t.dim,u=on(n*s-.5,0,s-1),f=on(e*s-.5,0,s-1),g=Math.floor(u),b=Math.floor(f),E=Math.min(g+1,s-1),M=Math.min(b+1,s-1);return vd(t.get(g,b),t.get(E,b),t.get(g,M),t.get(E,M),u-g,f-b)}const kh={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ip{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,s,u=!1,f=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return An(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const g=this.dim=t.height-2,b=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let E=0;E<g;E++)b[this._idx(-1,E)]=b[this._idx(0,E)],b[this._idx(g,E)]=b[this._idx(g-1,E)],b[this._idx(E,-1)]=b[this._idx(E,0)],b[this._idx(E,g)]=b[this._idx(E,g-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(g,-1)]=b[this._idx(g-1,0)],b[this._idx(-1,g)]=b[this._idx(0,g-1)],b[this._idx(g,g)]=b[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Nf(this)}get(e,t,s=!1){s&&(e=on(e,-1,this.dim),t=on(t,-1,this.dim));const u=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return kh[e]}get unpackVector(){return kh[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,s){return(256*e*256+256*t+s)/10-1e4}_unpackTerrarium(e,t,s){return 256*e+t+s/256-32768}static pack(e,t){const s=[0,0,0,0],u=Ip.getUnpackVector(t);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Xr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=t*this.dim,f=t*this.dim+this.dim,g=s*this.dim,b=s*this.dim+this.dim;switch(t){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:g=b-1;break;case 1:b=g+1}const E=-t*this.dim,M=-s*this.dim;for(let N=g;N<b;N++)for(let B=u;B<f;B++){const z=4*this._idx(B,N),X=4*this._idx(B+E,N+M);this.pixels[z+0]=e.pixels[X+0],this.pixels[z+1]=e.pixels[X+1],this.pixels[z+2]=e.pixels[X+2],this.pixels[z+3]=e.pixels[X+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Dn(Ip,"DEMData"),Dn(Nf,"DemMinMaxQuadTree",{omit:["dem"]});class H_{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:t,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===t?0:this.data[s].indexOf(t),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||t.push(u);for(const s of t)this.remove(s.value.tileID,s)}}class bd{constructor(e,t,s){this.func=e,this.mask=t,this.range=s}}bd.ReadOnly=!1,bd.ReadWrite=!0,bd.disabled=new bd(519,bd.ReadOnly,[0,1]);class cc{constructor(e,t,s,u,f,g){this.test=e,this.ref=t,this.mask=s,this.fail=u,this.depthFail=f,this.pass=g}}cc.disabled=new cc({func:519,mask:0},0,0,7680,7680,7680);class hl{constructor(e,t,s){this.blendFunction=e,this.blendColor=t,this.mask=s}}hl.Replace=[1,0],hl.disabled=new hl(hl.Replace,Ui.transparent,[!1,!1,!1,!1]),hl.unblended=new hl(hl.Replace,Ui.transparent,[!0,!0,!0,!0]),hl.alphaBlended=new hl([1,771],Ui.transparent,[!0,!0,!0,!0]);class fl{constructor(e,t,s){this.enable=e,this.mode=t,this.frontFace=s}}fl.disabled=new fl(!1,1029,2305),fl.backCCW=new fl(!0,1029,2305),fl.backCW=new fl(!0,1029,2304),fl.frontCW=new fl(!0,1028,2304),fl.frontCCW=new fl(!0,1028,2305);class Js extends In{constructor(e,t,s){super(),this.id=e,this._onlySymbols=s,t.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new H_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new $_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const s=this._tiles[t];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(e),s.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const s=this._tiles[t];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return St(this._tiles).map(e=>e.tileID).sort(Ap).map(e=>e.key)}getRenderableIds(e){const t=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&t.push(this._tiles[s]);return e?t.sort((s,u)=>{const f=s.tileID,g=u.tileID,b=new st(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new st(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||E.y-b.y||E.x-b.x}).map(s=>s.tileID.key):t.map(s=>s.tileID).sort(Ap).map(s=>s.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=t),this._loadTile(s,this._tileLoaded.bind(this,s,e,t)))}_tileLoaded(e,t,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new jn(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Hi.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Vn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let u=0;u<t.length;u++){const f=t[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);s(e,g),s(g,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-u.tileID.canonical.x;const b=f.tileID.canonical.y-u.tileID.canonical.y,E=Math.pow(2,u.tileID.canonical.z),M=f.tileID.key;0===g&&0===b||Math.abs(b)>1||(Math.abs(g)>1&&(1===Math.abs(g+E)?g+=E:1===Math.abs(g-E)&&(g-=E)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,g,b),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,s,u){for(const f in this._tiles){let g=this._tiles[f];if(u[f]||!g.hasData()||g.tileID.overscaledZ<=t||g.tileID.overscaledZ>s)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>t+1;){const M=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[M.key],g&&g.hasData()&&(b=M)}let E=b;for(;E.overscaledZ>t;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){u[b.key]=b;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=t?s:null}for(let s=e.overscaledZ-1;s>=t;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const s=Math.ceil(e.width/t)+1,u=Math.ceil(e.height/t)+1,f=Math.floor(s*u*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,t,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new hs(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(u=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(b=>this._source.hasTile(b)))):u=[];const f=this._updateRetainedTiles(u);if(Jd(this._source.type)&&0!==u.length){const b={},E={},M=Object.keys(f);for(const B of M){const z=f[B],X=this._tiles[B];if(!X||X.fadeEndTime&&X.fadeEndTime<=Hi.now())continue;const K=this.findLoadedParent(z,Math.max(z.overscaledZ-Js.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),b[K.tileID.key]=K.tileID),E[B]=z}const N=u[u.length-1].overscaledZ;for(const B in this._tiles){const z=this._tiles[B];if(f[B]||!z.hasData())continue;let X=z.tileID;for(;X.overscaledZ>N;){X=X.scaledTo(X.overscaledZ-1);const K=this._tiles[X.key];if(K&&K.hasData()&&E[X.key]){f[B]=z.tileID;break}}}for(const B in b)f[B]||(this._coveredTiles[B]=!0,f[B]=b[B])}for(const b in f)this._tiles[b].clearFadeHold();const g=function(b,E){const M=[];for(const N in b)N in E||M.push(N);return M}(this._tiles,f);for(const b of g){const E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const s={},u=e.reduce((M,N)=>Math.min(M,N.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-Js.maxOverzooming,this._source.minzoom),b=Math.max(f+Js.maxUnderzooming,this._source.minzoom),E={};for(const M of e){const N=this._addTile(M);t[M.key]=M,N.hasData()||u<this._source.maxzoom&&(E[M.key]=M)}this._retainLoadedChildren(E,u,b,t);for(const M of e){let N=this._tiles[M.key];if(N.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],X=this.getTile(z);if(X&&X.hasData()){t[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(t[z[0].key]&&t[z[1].key]&&t[z[2].key]&&t[z[3].key])continue}let B=N.wasRequested();for(let z=M.overscaledZ-1;z>=g;--z){const X=M.scaledTo(z);if(s[X.key]||(s[X.key]=!0,N=this.getTile(X),!N&&B&&(N=this._addTile(X)),N&&(t[X.key]=X,B=N.wasRequested(),N.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}t.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of t)this._loadedParentTiles[f]=s}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const s=Boolean(t);if(!s){const u=this.map?this.map.painter:null;t=new Rf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,s||this._source.fire(new Vn("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=t.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,s){const u=[],f=this.transform;if(!f)return u;const g="globe"===f.projection.name,b=ja(f.center.lng);for(const E in this._tiles){const M=this._tiles[E];if(s&&M.clearQueryDebugViz(),M.holdingForFade())continue;let N;if(g){const B=M.tileID.canonical;if(0===B.z){const z=[Math.abs(on(b,...pu(B,-1))-b),Math.abs(on(b,...pu(B,1))-b)];N=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(on(b,...pu(B,-1))-b),Math.abs(on(b,...pu(B,0))-b),Math.abs(on(b,...pu(B,1))-b)];N=[z.indexOf(Math.min(...z))-1]}}else N=[0];for(const B of N){const z=e.containsTile(M,f,t,B);z&&u.push(z)}}return u}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of t)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Jd(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=Hi.now())return!0}return!1}setFeatureState(e,t,s){this._state.updateState(e=e||"_geojsonTileLayer",t,s)}removeFeatureState(e,t,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,s)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,s){const u=this._tiles[e];u&&u.setDependencies(t,s)}reloadTilesForDependencies(e,t){for(const s in this._tiles)this._tiles[s].hasDependency(e,t)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,t))}_preloadTiles(e,t){const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const b of u){const E=b.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of E)s.set(M.key,M);this.usedForTerrain&&b.updateElevation(!1)}At(Array.from(s.values()),(b,E)=>{const M=new Rf(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,N=>{"raster-dem"===this._source.type&&M.dem&&this._backfillDEM(M),E(N,M)})},t)}}function Ap(n,e){const t=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-t||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function Jd(n){return"raster"===n||"image"===n||"video"===n}function pu(n,e){const t=1<<n.z;return[n.x/t+e,(n.x+1)/t+e]}Js.maxOverzooming=10,Js.maxUnderzooming=3;class ju{constructor(e,t,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=s}static create(e,t,s){const u=s||e.findDEMTileFor(t);if(!u||!u.dem)return;const f=u.dem,g=u.tileID,b=1<<t.canonical.z-g.canonical.z;return new ju(u,u.tileSize/ii/b,[(t.canonical.x/b-g.canonical.x)*f.dim,(t.canonical.y/b-g.canonical.y)*f.dim])}tileCoordToPixel(e,t){const s=t*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new st(u,f)}getElevationAt(e,t,s,u){const f=e*this._scale+this._offset[0],g=t*this._scale+this._offset[1],b=Math.floor(f),E=Math.floor(g),M=this._dem;return u=!!u,s?Ti(Ti(M.get(b,E,u),M.get(b,E+1,u),g-E),Ti(M.get(b+1,E,u),M.get(b+1,E+1,u),g-E),f-b):M.get(b,E,u)}getElevationAtPixel(e,t,s){return this._dem.get(e,t,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*sl(1,e)*this._dem.stride}}class Kd{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Hr(ii,16,0),this.featureIndexArray=new jp,this.promoteId=t}insert(e,t,s,u,f,g=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,g);const E=this.grid;for(let M=0;M<t.length;M++){const N=t[M],B=[1/0,1/0,-1/0,-1/0];for(let z=0;z<N.length;z++){const X=N[z];B[0]=Math.min(B[0],X.x),B[1]=Math.min(B[1],X.y),B[2]=Math.max(B[2],X.x),B[3]=Math.max(B[3],X.y)}B[0]<ii&&B[1]<ii&&B[2]>=0&&B[3]>=0&&E.insert(b,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Al.VectorTile(new Vd(this.rawTileData)).layers,this.sourceLayerCoder=new Vg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,s,u){this.loadVTLayers();const f=e.params||{},g=Hl(f.filter),b=e.tileResult,E=e.transform,M=b.bufferedTilespaceBounds,N=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(K,oe,pe,Ce)=>Zh(b.bufferedTilespaceGeometry,K,oe,pe,Ce));N.sort(Fh);let B=null;E.elevation&&N.length>0&&(B=ju.create(E.elevation,this.tileID));const z={};let X;for(let K=0;K<N.length;K++){const oe=N[K];if(oe===X)continue;X=oe;const pe=this.featureIndexArray.get(oe);let Ce=null;this.loadMatchingFeature(z,pe,g,f.layers,f.availableImages,t,s,u,(Fe,Ee,Re,Ye=0)=>(Ce||(Ce=al(Fe,this.tileID.canonical,e.tileTransform)),Ee.queryIntersectsFeature(b,Fe,Re,Ce,this.z,e.transform,e.pixelPosMatrix,B,Ye)))}return z}loadMatchingFeature(e,t,s,u,f,g,b,E,M){const{featureIndex:N,bucketIndex:B,sourceLayerIndex:z,layoutVertexArrayOffset:X}=t,K=this.bucketLayerIDs[B];if(u&&!function(Fe,Ee){for(let Re=0;Re<Fe.length;Re++)if(Ee.indexOf(Fe[Re])>=0)return!0;return!1}(u,K))return;const oe=this.sourceLayerCoder.decode(z),pe=this.vtLayers[oe].feature(N);if(s.needGeometry){const Fe=oc(pe,!0);if(!s.filter(new me(this.tileID.overscaledZ),Fe,this.tileID.canonical))return}else if(!s.filter(new me(this.tileID.overscaledZ),pe))return;const Ce=this.getId(pe,oe);for(let Fe=0;Fe<K.length;Fe++){const Ee=K[Fe];if(u&&u.indexOf(Ee)<0)continue;const Re=g[Ee];if(!Re)continue;let Ye={};void 0!==Ce&&E&&(Ye=E.getState(Re.sourceLayer||"_geojsonTileLayer",Ce));const Be=Zt({},b[Ee]);Be.paint=Qd(Be.paint,Re.paint,pe,Ye,f),Be.layout=Qd(Be.layout,Re.layout,pe,Ye,f);const mt=!M||M(pe,Re,Ye,X);if(!mt)continue;const pt=new Ug(pe,this.z,this.x,this.y,Ce);pt.layer=Be;let Ot=e[Ee];void 0===Ot&&(Ot=e[Ee]=[]),Ot.push({featureIndex:N,feature:pt,intersectionZ:mt})}}lookupSymbolFeatures(e,t,s,u,f,g,b,E){const M={};this.loadVTLayers();const N=Hl(f);for(const B of e)this.loadMatchingFeature(M,{bucketIndex:s,sourceLayerIndex:u,featureIndex:B,layoutVertexArrayOffset:0},N,g,b,E,t);return M}loadFeature(e){const{featureIndex:t,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[t])return f[t];const g=this.vtLayers[u].feature(t);return f[t]=g,g}hasLayer(e){for(const t of this.bucketLayerIDs)for(const s of t)if(e===s)return!0;return!1}getId(e,t){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof s&&(s=Number(s))),s}}function Qd(n,e,t,s,u){return dt(n,(f,g)=>{const b=e instanceof je?e.get(g):null;return b&&b.evaluate?b.evaluate(t,s,u):b})}function Fh(n,e){return e-n}Dn(Kd,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class eh{constructor(e){const t={},s=[];for(const b in e){const E=e[b],M=t[b]={};for(const N in E.glyphs){const B=E.glyphs[+N];if(!B||0===B.bitmap.width||0===B.bitmap.height)continue;const z=B.metrics.localGlyph?2:1,X={x:0,y:0,w:B.bitmap.width+2*z,h:B.bitmap.height+2*z};s.push(X),M[N]=X}}const{w:u,h:f}=fp(s),g=new sc({width:u||1,height:f||1});for(const b in e){const E=e[b];for(const M in E.glyphs){const N=E.glyphs[+M];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const B=t[b][M],z=N.metrics.localGlyph?2:1;sc.copy(N.bitmap,g,{x:0,y:0},{x:B.x+z,y:B.y+z},N.bitmap)}}this.image=g,this.positions=t}}Dn(eh,"GlyphAtlas");class Lh{constructor(e){this.tileID=new hs(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Wd(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new ec;const g=new Vg(Object.keys(e.layers).sort()),b=new Kd(this.tileID,this.promoteId);b.bucketLayerIDs=[];const E={},M=new Pf(256,256),N={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:s},B=t.familiesBySource[this.source];for(const Ye in B){const Be=e.layers[Ye];if(!Be)continue;let mt=!1,pt=!1;for(const vt of B[Ye])"symbol"===vt[0].type?mt=!0:pt=!0;if(!0===this.isSymbolTile&&!mt||!1===this.isSymbolTile&&!pt)continue;1===Be.version&&An(`Vector tile source "${this.source}" layer "${Ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ot=g.encode(Ye),an=[];for(let vt=0;vt<Be.length;vt++){const zt=Be.feature(vt),Ht=b.getId(zt,Ye);an.push({feature:zt,id:Ht,index:vt,sourceLayerIndex:Ot})}for(const vt of B[Ye]){const zt=vt[0];void 0!==this.isSymbolTile&&"symbol"===zt.type!==this.isSymbolTile||zt.minzoom&&this.zoom<Math.floor(zt.minzoom)||zt.maxzoom&&this.zoom>=zt.maxzoom||"none"!==zt.visibility&&(xd(vt,this.zoom,s),(E[zt.id]=zt.createBucket({index:b.bucketLayerIDs.length,layers:vt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ot,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(an,N,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(vt.map(Ht=>Ht.id)))}}let z,X,K,oe;M.trim();const pe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ce=dt(N.glyphDependencies,Ye=>Object.keys(Ye).map(Number));Object.keys(Ce).length?u.send("getGlyphs",{uid:this.uid,stacks:Ce},(Ye,Be)=>{z||(z=Ye,X=Be,Re.call(this))},void 0,!1,pe):X={};const Fe=Object.keys(N.iconDependencies);Fe.length?u.send("getImages",{icons:Fe,source:this.source,tileID:this.tileID,type:"icons"},(Ye,Be)=>{z||(z=Ye,K=Be,Re.call(this))},void 0,!1,pe):K={};const Ee=Object.keys(N.patternDependencies);function Re(){if(z)return f(z);if(X&&K&&oe){const Ye=new eh(X),Be=new mp(K,oe);for(const mt in E){const pt=E[mt];pt instanceof du?(xd(pt.layers,this.zoom,s),Wy(pt,X,Ye.positions,K,Be.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):pt.hasPattern&&(pt instanceof ap||pt instanceof Ar||pt instanceof cd)&&(xd(pt.layers,this.zoom,s),pt.addFeatures(N,this.tileID.canonical,Be.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:St(E).filter(mt=>!mt.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ye.image,lineAtlas:M,imageAtlas:Be,glyphMap:this.returnDependencies?X:null,iconMap:this.returnDependencies?K:null,glyphPositions:this.returnDependencies?Ye.positions:null})}}Ee.length?u.send("getImages",{icons:Ee,source:this.source,tileID:this.tileID,type:"patterns"},(Ye,Be)=>{z||(z=Ye,oe=Be,Re.call(this))},void 0,!1,pe):oe={},Re.call(this)}}function xd(n,e,t){const s=new me(e);for(const u of n)u.recalculate(s,t)}class Rm{constructor(e){this.entries={},this.scheduler=e}request(e,t,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,b]=f.result;return this.scheduler?this.scheduler.add(()=>{u(g,b)},t):u(g,b),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((g,b)=>{f.result=[g,b];for(const E of f.callbacks)this.scheduler?this.scheduler.add(()=>{E(g,b)},t):E(g,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Nm(n,e,t){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=Ke(n.request,(g,b,E,M)=>{g?u(g):b&&u(null,{vectorTile:t?void 0:new Al.VectorTile(new Vd(b)),rawData:b,cacheControl:E,expires:M})});return()=>{f.cancel(),u()}},e)}c.ARRAY_TYPE=ca,c.AUTH_ERR_MSG=Mt,c.Aabb=Zs,c.Actor=class{constructor(n,e,t){this.target=n,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},ct(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ni()?n:ze,this.scheduler=new G_}send(n,e,t,s,u=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=f,this.callbacks[g]=t);const b=ei(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!t,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:bc(e,b)},b),{cancel:()=>{t&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[t];delete this.cancelCallbacks[t],s&&s.cancel()}else if(e.mustQueue||Ni()){const s=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),s&&s.metadata||{type:"message"})}else this.processTask(t,e)}processTask(n,e){if("<response>"===e.type){const t=this.callbacks[n];delete this.callbacks[n],t&&(e.error?t(Yl(e.error)):t(null,Yl(e.data)))}else{const t=ei(this.globalScope)?void 0:[],s=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?bc(f):null,data:bc(g,t)},t)}:f=>{},u=Yl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=Bd,c.Color=Ui,c.ColorMode=hl,c.CullFaceMode=fl,c.DEMData=Ip,c.DataConstantProperty=Le,c.DedupedRequest=Rm,c.DepthMode=bd,c.EXTENT=ii,c.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(!e||n.y<0||n.y>1)return!1;const t=e.getSource().maxzoom,s=1<<t,u=Math.floor(n.x),f=Math.floor((n.x-u)*s),g=Math.floor(n.y*s),b=this.findDEMTileFor(new hs(t,u,t,f,g));return!(!b||!b.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,t=!0){null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,g=Math.floor(n.x),b=n.x-g,E=new hs(u,g,u,Math.floor(b*f),Math.floor(n.y*f)),M=this.findDEMTileFor(E);if(!M||!M.dem)return e;const N=M.dem,B=1<<M.tileID.canonical.z,z=(b*B-M.tileID.canonical.x)*N.dim,X=(n.y*B-M.tileID.canonical.y)*N.dim,K=Math.floor(z),oe=Math.floor(X);return(t?this.exaggeration():1)*Ti(Ti(N.get(K,oe),N.get(K,oe+1),X-oe),Ti(N.get(K+1,oe),N.get(K+1,oe+1),X-oe),z-K)}getAtTileOffset(n,e,t){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Ml(n.wrap+(n.canonical.x+e/ii)/s,(n.canonical.y+t/ii)/s))}getAtTileOffsetFunc(n,e,t,s){return u=>{const f=this.getAtTileOffset(n,u.x,u.y),g=s.upVector(n.canonical,u.x,u.y);return Mc(g,g,f*s.upVectorScale(n.canonical,e,t).metersToTile),g}}getForTilePoints(n,e,t,s){const u=ju.create(this,n,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],t)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const t=e.dem.tree,s=e.tileID,u=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/u-s.canonical.x,g=n.canonical.y/u-s.canonical.y,b=0;for(let E=0;E<n.canonical.z-s.canonical.z&&!t.leaves[b];E++){f*=2,g*=2;const M=2*Math.floor(g)+Math.floor(f);b=t.childOffsets[b]+M,f%=1,g%=1}return{min:this.exaggeration()*t.minimums[b],max:this.exaggeration()*t.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=jn,c.EvaluationParameters=me,c.Event=Vn,c.Evented=In,c.FillExtrusionBucket=cd,c.Frustum=np,c.FrustumCorners=tp,c.GLOBE_METERS_TO_ECEF=vm,c.GLOBE_RADIUS=Bu,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const e=new fn,t=new bi,s=65;for(let u=0;u<s;u++)for(let f=0;f<s;f++)e.emplaceBack(f,u);this._gridSegments=[];for(let u=0,f=0;u<Gd.length;u++){const g=Gd[u];for(let E=0;E<g;E++)for(let M=0;M<64;M++){const N=E*s+M;t.emplaceBack(N+1,N,N+s),t.emplaceBack(N+s,N+s+1,N+1)}const b=64*g*2;this._gridSegments.push(Go.simpleSegment(0,f,(g+1)*s,b)),f+=b}this._gridBuffer=n.createVertexBuffer(e,Mh.members),this._gridIndexBuffer=n.createIndexBuffer(t,!0)}_createPoles(n){const e=new bi;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const t=new Cs,s=new Cs;this._poleSegments=[];for(let u=0,f=0;u<5;u++){const g=360/(1<<u);t.emplaceBack(0,-Bu,0,.5,0),s.emplaceBack(0,-Bu,0,.5,1);for(let b=0;b<=64;b++){const E=b/64,M=Ti(0,g,E),[N,B,z]=Hd(Ng,N_,M,Bu);t.emplaceBack(N,B,z,E,0),s.emplaceBack(N,B,z,E,1)}this._poleSegments.push(Go.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(t,Ag,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Ag,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const t=new Hs,s=64,u=s+1;this._wireframeSegments=[];for(let f=0,g=0;f<Gd.length;f++){const b=Gd[f];for(let M=0;M<b;M++)for(let N=0;N<s;N++){const B=M*u+N;t.emplaceBack(B,B+1),t.emplaceBack(B,B+u),t.emplaceBack(B,B+u+1)}const E=b*s*3;this._wireframeSegments.push(Go.simpleSegment(0,g,(b+1)*u,E)),g+=E}this._wireframeIndexBuffer=n.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=jd,c.ImagePosition=pp,c.LineAtlas=Pf,c.LngLat=_r,c.LngLatBounds=Mu,c.LocalGlyphMode=gm,c.MAX_MERCATOR_LATITUDE=Ga,c.MercatorCoordinate=Ml,c.ONE_EM=24,c.OverscaledTileID=hs,c.Properties=Pt,c.RGBAImage=Xr,c.Ray=ep,c.RequestManager=class{constructor(n,e,t){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ts,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!Ve(n))return n;const t=Nt(n);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!Ve(n))return n;const t=Nt(n);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(n,e,t,s){if(!Ve(n))return n;const u=Nt(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),t&&u.params.push(`language=${t}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,t,s){const u=Nt(n);return Ve(n)?(u.path=`/styles/v1${u.path}/sprite${e}${t}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${t}`,Un(u))}normalizeTileURL(n,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Ve(n))return n;const s=Nt(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&"raster"!==s.authority&&512===t?"@2x":""}${Ji.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${si.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${si.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const g of f){const b=g.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(s.params)||si.ACCESS_TOKEN;return si.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(n,e){const t=Nt(n);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return n;let s="mapbox://";t.path.match(/^\/raster\/v1\//)?s+=`raster/${t.path.replace(`/${si.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${t.path.replace(`/${si.TILE_URL_VERSION}/`,"")}`;let u=t.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(n,e){const t=!!e&&Ve(e),s=[];for(const u of n.tiles||[])Oe(u)?s.push(this.canonicalizeTileURL(u,t)):s.push(u);return s}_makeAPIURL(n,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=Nt(si.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!si.REQUIRE_ACCESS_TOKEN)return Un(n);if(e=e||si.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),Un(n)}},c.ResourceType=$e,c.SegmentVector=Go,c.SourceCache=Js,c.StencilMode=cc,c.StructArrayLayout1ui2=il,c.StructArrayLayout2f1f2i16=Kl,c.StructArrayLayout2i4=fn,c.StructArrayLayout2ui4=Hs,c.StructArrayLayout3f12=Wr,c.StructArrayLayout3ui6=bi,c.StructArrayLayout4i8=$n,c.StructArrayLayout5f20=Cs,c.Texture=Af,c.Tile=Rf,c.Transitionable=De,c.Uniform1f=Ed,c.Uniform1i=class extends tc{constructor(n){super(n),this.current=0}set(n,e,t){this.fetchUniformLocation(n,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},c.Uniform2f=class extends tc{constructor(n){super(n),this.current=[0,0]}set(n,e,t){this.fetchUniformLocation(n,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},c.Uniform3f=class extends tc{constructor(n){super(n),this.current=[0,0,0]}set(n,e,t){this.fetchUniformLocation(n,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},c.Uniform4f=Vh,c.UniformColor=Xm,c.UniformMatrix2f=class extends tc{constructor(n){super(n),this.current=lh}set(n,e,t){if(this.fetchUniformLocation(n,e))for(let s=0;s<4;s++)if(t[s]!==this.current[s]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},c.UniformMatrix3f=class extends tc{constructor(n){super(n),this.current=Ku}set(n,e,t){if(this.fetchUniformLocation(n,e))for(let s=0;s<9;s++)if(t[s]!==this.current[s]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},c.UniformMatrix4f=class extends tc{constructor(n){super(n),this.current=ah}set(n,e,t){if(this.fetchUniformLocation(n,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let s=1;s<16;s++)if(t[s]!==this.current[s]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},c.UnwrappedTileID=cf,c.ValidationError=bn,c.VectorTileWorkerSource=class extends In{constructor(n,e,t,s,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=t,this.loadVectorData=u||Nm,this.loading={},this.loaded={},this.deduped=new Rm(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const t=n.uid,s=n&&n.request,u=s&&s.collectResourceTiming,f=this.loading[t]=new Lh(n);f.abort=this.loadVectorData(n,(g,b)=>{const E=!this.loading[t];if(delete this.loading[t],E||g||!b)return f.status="done",E||(this.loaded[t]=f),e(g);const M=b.rawData,N={};b.expires&&(N.expires=b.expires),b.cacheControl&&(N.cacheControl=b.cacheControl),f.vectorTile=b.vectorTile||new Al.VectorTile(new Vd(M));const B=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,X)=>{if(z||!X)return e(z);const K={};if(u){const oe=vr(s);oe.length>0&&(K.resourceTiming=JSON.parse(JSON.stringify(oe)))}e(null,Zt({rawTileData:M.slice(0)},X,N,K))})};this.isSpriteLoaded?B():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(B,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):B()}),this.loaded=this.loaded||{},this.loaded[t]=f})}reloadTile(n,e){const t=this.loaded,s=n.uid,u=this;if(t&&t[s]){const f=t[s];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=Wd(n.tileID.canonical,n.projection);const g=(b,E)=>{const M=f.reloadCallback;M&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,M)),e(b,E)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const t=n.uid,s=this.loading[t];s&&(s.abort&&s.abort(),delete this.loading[t]),e()}removeTile(n,e){const t=this.loaded,s=n.uid;t&&t[s]&&delete t[s],e()}},c.WritingMode=ac,c.ZoomHistory=wu,c.add=rd,c.addDynamicAttributes=qd,c.adjoint=function(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],g=e[4],b=e[5],E=e[6],M=e[7],N=e[8];return n[0]=g*N-b*M,n[1]=u*M-s*N,n[2]=s*b-u*g,n[3]=b*E-f*N,n[4]=t*N-u*E,n[5]=u*f-t*b,n[6]=f*M-g*E,n[7]=s*E-t*M,n[8]=t*g-s*f,n},c.asyncAll=At,c.bezier=Gt,c.bindAll=ct,c.boundsAttributes=Sp,c.bufferConvexPolygon=function(n,e){const t=[];for(let s=0;s<n.length;s++){const u=ki(s-1,-1,n.length-1),f=ki(s+1,-1,n.length-1),g=n[s],b=n[f],E=n[u].sub(g).unit(),M=b.sub(g).unit(),N=M.angleWithSep(E.x,E.y),B=E.add(M).unit().mult(-1*e/Math.sin(N/2));t.push(g.add(B))}return t},c.cacheEntryPossiblyAdded=function(n){Se++,Se>Wi&&(n.getActor().send("enforceCacheSizeLimit",Gr),Se=0)},c.calculateGlobeLabelMatrix=function(n,e){const{x:t,y:s}=n.point,u=Tm(t,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return id(u,u,Dm(lc(e)))},c.calculateGlobeMatrix=function(n){const{x:e,y:t}=n.point,{lng:s,lat:u}=n._center;return Tm(e,t,n.worldSize,s,u)},c.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,t=e/sl(1,n.center.lat),s=ua(new Float64Array(16));return Au(s,s,[n.point.x,n.point.y,0]),su(s,s,[t,t,e]),Float32Array.from(s)},c.circumferenceAtLatitude=Zp,c.clamp=on,c.clearTileCache=function(n){const e=_e(),t=[];for(const s in dr)e&&t.push(e.delete(s)),delete dr[s];n&&Promise.all(t).catch(n).then(()=>n())},c.clipLine=I_,c.clone=function(n){var e=new ca(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},c.clone$1=rn,c.collisionCircleLayout=hg,c.config=si,c.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},c.create=function(){var n=new ca(16);return ca!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},c.create$1=ou,c.createExpression=Vl,c.createLayout=kt,c.createStyleLayer=function(n){return"custom"===n.type?new Vu(n):new If[n.type](n)},c.cross=yh,c.degToRad=lt,c.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},c.div=function(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n},c.dot=ll,c.ease=xn,c.easeCubicInOut=Xt,c.emitValidationErrors=Ns,c.endsWith=It,c.enforceCacheSizeLimit=function(n){for(const e in dr)te(e),dr[e].then(t=>{t.keys().then(s=>{for(let u=0;u<s.length-n;u++)t.delete(s[u])})})},c.evaluateSizeForFeature=cp,c.evaluateSizeForZoom=zd,c.evaluateVariableOffset=R_,c.evented=ne,c.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},c.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},c.exported=Hi,c.exported$1=Ji,c.extend=Zt,c.extend$1=$r,c.fillExtrusionHeightLift=xh,c.filterObject=_n,c.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},c.fromQuat=function(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],g=t+t,b=s+s,E=u+u,M=t*g,N=s*g,B=s*b,z=u*g,X=u*b,K=u*E,oe=f*g,pe=f*b,Ce=f*E;return n[0]=1-B-K,n[1]=N+Ce,n[2]=z-pe,n[3]=0,n[4]=N-Ce,n[5]=1-M-K,n[6]=X+oe,n[7]=0,n[8]=z+pe,n[9]=X-oe,n[10]=1-M-B,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.fromRotation=function(n,e){var t=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=t,n[2]=0,n[3]=-t,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},c.fromScaling=Yh,c.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return jt[e]},c.getAABBPointSquareDist=function(n,e,t){let s=0;for(let u=0;u<2;++u){const f=t?t[u]:0;n[u]>f&&(s+=(n[u]-f)*(n[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},c.getAnchorAlignment=Fc,c.getAnchorJustification=Mg,c.getBounds=function(n){let e=1/0,t=1/0,s=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),t=Math.min(t,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new st(e,t),max:new st(s,u)}},c.getColumn=Xi,c.getGridMatrix=function(n,e,t){const s=e.getNorth(),u=e.getSouth(),f=e.getWest(),g=.015625;return[0,(e.getEast()-f)*g,1<<n.z,(u-s)/Gd[t],0,n.y,s,f,g]},c.getImage=ft,c.getJSON=function(n,e){return We(Zt(n,{type:"json"}),e)},c.getLatitudinalLod=function(n){const e=80.051129;n=on(n,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(lt(n))),3);return Math.round(t*(Gd.length-1))},c.getMapSessionAPI=di,c.getPerformanceMeasurement=vr,c.getProjection=Fg,c.getRTLTextPluginStatus=se,c.getReferrer=et,c.getTilePoint=function(n,{x:e,y:t},s=0){return new st(((e-s)*n.scale-n.x)*ii,(t*n.scale-n.y)*ii)},c.getTileVec3=function(n,e,t=0){return gh(((e.x-t)*n.scale-n.x)*ii,(e.y*n.scale-n.y)*ii,dh(e.z,e.y))},c.getVideo=function(n,e){const t=ze.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let s=0;s<n.length;s++){const u=ze.document.createElement("source");ye(n[s])||(t.crossOrigin="Anonymous"),u.src=n[s],t.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(n){const e=[0,0,0],t=ua(new Float64Array(16));return id(t,n.pixelMatrix,n.globeMatrix),So(e,e,t),new st(e[0],e[1])},c.globeDenormalizeECEF=Dm,c.globeECEFOrigin=function(n,e){const t=[0,0,0];return So(t,t,Ah(lc(e.canonical))),So(t,t,n),t},c.globeNormalizeECEF=Ah,c.globePixelsToTileUnits=function(n,e){return ii/(512*Math.pow(2,n))*wm(lc(e))},c.globePoleMatrixForTile=function(n,e,t){const s=ua(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return Id(s,t.globeMatrix,u),Float32Array.from(s)},c.globeTileBounds=lc,c.globeTiltAtLngLat=Rg,c.globeToMercatorTransition=Ph,c.globeUseCustomAntiAliasing=function(n,e,t){const s=Ph(t.zoom),u=n.style.map._antialias,f=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!u&&!g&&f},c.identity=ua,c.identity$1=Qp,c.invert=mh,c.isFullscreen=function(){return!!ze.document.fullscreenElement||!!ze.document.webkitFullscreenElement},c.isLngLatBehindGlobe=function(n,e){return Rg(n,e)>Math.PI/2*1.01},c.isMapAuthenticated=function(n){return Ci.has(n)},c.isMapboxURL=Ve,c.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!ei(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=cs,c.len=ef,c.length=Pu,c.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},c.loadVectorTile=Nm,c.makeRequest=We,c.mapValue=function(n,e,t,s,u){return on((n-e)/(t-e)*(u-s)+s,s,u)},c.mercatorScale=Sd,c.mercatorXfromLng=ja,c.mercatorYfromLat=ic,c.mercatorZfromAltitude=sl,c.mul=Xh,c.mul$1=Qm,c.multiply=id,c.multiply$1=function(n,e,t){var s=e[0],u=e[1],f=e[2],g=e[3],b=e[4],E=e[5],M=e[6],N=e[7],B=e[8],z=t[0],X=t[1],K=t[2],oe=t[3],pe=t[4],Ce=t[5],Fe=t[6],Ee=t[7],Re=t[8];return n[0]=z*s+X*g+K*M,n[1]=z*u+X*b+K*N,n[2]=z*f+X*E+K*B,n[3]=oe*s+pe*g+Ce*M,n[4]=oe*u+pe*b+Ce*N,n[5]=oe*f+pe*E+Ce*B,n[6]=Fe*s+Ee*g+Re*M,n[7]=Fe*u+Ee*b+Re*N,n[8]=Fe*f+Ee*E+Re*B,n},c.multiply$2=Km,c.nextPowerOfTwo=Kt,c.normalize=Fs,c.normalize$1=function(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],g=t*t+s*s+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=t*g,n[1]=s*g,n[2]=u*g,n[3]=f*g,n},c.number=Ti,c.ortho=function(n,e,t,s,u,f,g){var b=1/(e-t),E=1/(s-u),M=1/(f-g);return n[0]=-2*b,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*E,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*M,n[11]=0,n[12]=(e+t)*b,n[13]=(u+s)*E,n[14]=(g+f)*M,n[15]=1,n},c.pbf=Vd,c.perspective=function(n,e,t,s,u){var f,g=1/Math.tan(e/2);return n[0]=g/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+s)*(f=1/(s-u)),n[14]=2*u*s*f):(n[10]=-1,n[14]=-2*s),n},c.pick=function(n,e){const t={};for(let s=0;s<e.length;s++){const u=e[s];u in n&&(t[u]=n[u])}return t},c.plugin=de,c.pointGeometry=st,c.polygonContainsPoint=Cc,c.polygonIntersectsBox=Zh,c.polygonIntersectsPolygon=iu,c.polygonizeBounds=function(n,e,t=0,s=!0){const u=new st(t,t),f=n.sub(u),g=e.add(u),b=[f,new st(g.x,f.y),g,new st(f.x,g.y)];return s&&b.push(f.clone()),b},c.posAttributes=Mh,c.postMapLoadEvent=qi,c.postTurnstileEvent=Ki,c.potpack=fp,c.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},c.radToDeg=dn,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(n){return n({pluginStatus:P,pluginURL:F}),ne.on("pluginStateChange",n),n},c.removeAuthState=function(n){Ci.delete(n)},c.renderColorRamp=sf,c.resample=Qu,c.rotateX=qf,c.rotateX$1=Qf,c.rotateY=Id,c.rotateY$1=tf,c.rotateZ=function(n,e,t){var s=Math.sin(t),u=Math.cos(t),f=e[0],g=e[1],b=e[2],E=e[3],M=e[4],N=e[5],B=e[6],z=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+M*s,n[1]=g*u+N*s,n[2]=b*u+B*s,n[3]=E*u+z*s,n[4]=M*u-f*s,n[5]=N*u-g*s,n[6]=B*u-b*s,n[7]=z*u-E*s,n},c.rotateZ$1=function(n,e,t){t*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],b=Math.sin(t),E=Math.cos(t);return n[0]=s*E+u*b,n[1]=u*E-s*b,n[2]=f*E+g*b,n[3]=g*E-f*b,n},c.scale=su,c.scale$1=Pd,c.scale$2=Mc,c.scaleAndAdd=Xf,c.setCacheLimits=function(n,e){Gr=n,Wi=e},c.setColumn=function(n,e,t){n[4*e+0]=t[0],n[4*e+1]=t[1],n[4*e+2]=t[2],n[4*e+3]=t[3]},c.setRTLTextPlugin=function(n,e,t=!1){if(P===m||P===x||P===w)throw new Error("setRTLTextPlugin cannot be called multiple times.");F=Hi.resolveURL(n),P=m,S=e,Z(),t||ve()},c.smoothstep=vn,c.spec=at,c.storeAuthState=function(n,e){e?Ci.add(n):Ci.delete(n)},c.sub=cl,c.subtract=_h,c.symbolSize=y_,c.tileAABB=function(n,e,t,s,u,f,g,b,E){if("globe"===E.name)return function Pg(n,e,t){const s=e/n.worldSize,u=Number.MAX_VALUE,f=[-u,-u,-u],g=[u,u,u],b=n.globeMatrix;if(t.z<=1)return xm(g,f,lc(t).getCorners(),b,s),new Zs(g,f);const E=Sh(t),M=xf(E);if(xm(g,f,M,b,s),E.contains(n.center)){f[2]=0;const mt=n.point,pt=[mt.x*s,mt.y*s,0];return Kp(g,g,pt),Qh(f,f,pt),new Zs(g,f)}const N=[b[12]*s,b[13]*s,b[14]*s],B=E.getCenter(),z=on(n.center.lat,-85.051129,Ga),X=on(B.lat,-85.051129,Ga),K=ja(n.center.lng),oe=ic(z);let pe=K-ja(B.lng);const Ce=oe-ic(X);pe>.5?pe-=1:pe<-.5&&(pe+=1);let Fe=0;Math.abs(pe)>Math.abs(Ce)?Fe=pe>=0?1:3:(Fe=Ce>=0?0:2,Xf(N,N,[b[4]*s,b[5]*s,b[6]*s],-Math.sin(lt(Ce>=0?E.getSouth():E.getNorth()))*Bu));const Ee=M[Fe],Re=M[(Fe+1)%4],Ye=new bm(Ee,Re,N),Be=[_d(Ye,0)||Ee[0],_d(Ye,1)||Ee[1],_d(Ye,2)||Ee[2]];return g[2]=Math.min(Ee[2],Re[2]),Kp(g,g,Be),Qh(f,f,Be),new Zs(g,f)}(n,e,new Bd(t,s,u));const M=Wd({z:t,x:s,y:u},E);return new Zs([(f+M.x/M.scale)*e,e*(M.y/M.scale),g],[(f+M.x2/M.scale)*e,e*(M.y2/M.scale),b])},c.tileCornersToBounds=Sh,c.tileTransform=Wd,c.transformMat3=function(n,e,t){var s=e[0],u=e[1],f=e[2];return n[0]=s*t[0]+u*t[3]+f*t[6],n[1]=s*t[1]+u*t[4]+f*t[7],n[2]=s*t[2]+u*t[5]+f*t[8],n},c.transformMat4=So,c.transformMat4$1=od,c.transformQuat=Jf,c.transitionTileAABBinECEF=bf,c.translate=Au,c.transpose=function(n,e){if(n===e){var t=e[1],s=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=s,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},c.triggerPluginCompletionEvent=$,c.uniqueId=tn,c.updateGlobeVertexNormal=function(n,e,t,s,u){const f=5*e+2;n.float32[f+0]=t,n.float32[f+1]=s,n.float32[f+2]=u},c.validateCustomStyleLayer=function(n){const e=[],t=n.id;return void 0===t&&e.push({message:`layers.${t}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${t}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=n=>as(To(n)),c.validateFog=n=>as(qu(n)),c.validateLayer=n=>as(ho(n)),c.validateLight=n=>as(Wl(n)),c.validateSource=n=>as(Yc(n)),c.validateStyle=Dl,c.validateTerrain=n=>as(Zl(n)),c.values=St,c.vectorTile=Al,c.version="2.10.0",c.warnOnce=An,c.window=ze,c.wrap=ki}),Q(0,function(c){function ze(_e){if("number"==typeof _e||"boolean"==typeof _e||"string"==typeof _e||null==_e)return JSON.stringify(_e);if(Array.isArray(_e)){let re="[";for(const xe of _e)re+=`${ze(xe)},`;return`${re}]`}let te="{";for(const re of Object.keys(_e).sort())te+=`${re}:${ze(_e[re])},`;return`${te}}`}function Vt(_e){let te="";for(const re of c.refProperties)te+=`/${ze(_e[re])}`;return te}class Ft{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,re){for(const Se of te)this._layerConfigs[Se.id]=Se,(this._layers[Se.id]=c.createStyleLayer(Se)).compileFilter(),this.keyCache[Se.id]&&delete this.keyCache[Se.id];for(const Se of re)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const xe=function(Se,$e){const nt={};for(let We=0;We<Se.length;We++){const Ke=$e&&$e[Se[We].id]||Vt(Se[We]);$e&&($e[Se[We].id]=Ke);let wt=nt[Ke];wt||(wt=nt[Ke]=[]),wt.push(Se[We])}const et=[];for(const We in nt)et.push(nt[We]);return et}(c.values(this._layerConfigs),this.keyCache);for(const Se of xe){const $e=Se.map(Ae=>this._layers[Ae.id]),nt=$e[0];if("none"===nt.visibility)continue;const et=nt.source||"";let We=this.familiesBySource[et];We||(We=this.familiesBySource[et]={});const Ke=nt.sourceLayer||"_geojsonTileLayer";let wt=We[Ke];wt||(wt=We[Ke]=[]),wt.push($e)}}}class st{loadTile(te,re){const{uid:xe,encoding:Se,rawImageData:$e,padding:nt,buildQuadTree:et}=te,We=c.window.ImageBitmap&&$e instanceof c.window.ImageBitmap?this.getImageData($e,nt):$e;re(null,new c.DEMData(xe,We,Se,nt<1,et))}getImageData(te,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const xe=this.offscreenCanvasContext.getImageData(-re,-re,te.width+2*re,te.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}var xt=function _e(te,re){var xe,Se=te&&te.type;if("FeatureCollection"===Se)for(xe=0;xe<te.features.length;xe++)_e(te.features[xe],re);else if("GeometryCollection"===Se)for(xe=0;xe<te.geometries.length;xe++)_e(te.geometries[xe],re);else if("Feature"===Se)_e(te.geometry,re);else if("Polygon"===Se)ut(te.coordinates,re);else if("MultiPolygon"===Se)for(xe=0;xe<te.coordinates.length;xe++)ut(te.coordinates[xe],re);return te};function ut(_e,te){if(0!==_e.length){Et(_e[0],te);for(var re=1;re<_e.length;re++)Et(_e[re],!te)}}function Et(_e,te){for(var re=0,xe=0,Se=0,$e=_e.length,nt=$e-1;Se<$e;nt=Se++){var et=(_e[Se][0]-_e[nt][0])*(_e[nt][1]+_e[Se][1]),We=re+et;xe+=Math.abs(re)>=Math.abs(et)?re-We+et:et-We+re,re=We}re+xe>=0!=!!te&&_e.reverse()}const lt=c.vectorTile.VectorTileFeature.prototype.toGeoJSON;class dn{constructor(te){this._feature=te,this.extent=c.EXTENT,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(1===this._feature.type){const te=[];for(const re of this._feature.geometry)te.push([new c.pointGeometry(re[0],re[1])]);return te}{const te=[];for(const re of this._feature.geometry){const xe=[];for(const Se of re)xe.push(new c.pointGeometry(Se[0],Se[1]));te.push(xe)}return te}}toGeoJSON(te,re,xe){return lt.call(this,te,re,xe)}}class jt{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=te.length,this._features=te}feature(te){return new dn(this._features[te])}}var Xt=c.vectorTile.VectorTileFeature,Gt=xn;function xn(_e,te){this.options=te||{},this.features=_e,this.length=_e.length}function on(_e,te){this.id="number"==typeof _e.id?_e.id:void 0,this.type=_e.type,this.rawGeometry=1===_e.type?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=te||4096}xn.prototype.feature=function(_e){return new on(this.features[_e],this.options.extent)},on.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var te=0;te<_e.length;te++){for(var re=_e[te],xe=[],Se=0;Se<re.length;Se++)xe.push(new c.pointGeometry(re[Se][0],re[Se][1]));this.geometry.push(xe)}return this.geometry},on.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,te=1/0,re=-1/0,xe=1/0,Se=-1/0,$e=0;$e<_e.length;$e++)for(var nt=_e[$e],et=0;et<nt.length;et++){var We=nt[et];te=Math.min(te,We.x),re=Math.max(re,We.x),xe=Math.min(xe,We.y),Se=Math.max(Se,We.y)}return[te,xe,re,Se]},on.prototype.toGeoJSON=Xt.prototype.toGeoJSON;var vn=At,ki=Gt;function At(_e){var te=new c.pbf;return function(re,xe){for(var Se in re.layers)xe.writeMessage(3,St,re.layers[Se])}(_e,te),te.finish()}function St(_e,te){var re;te.writeVarintField(15,_e.version||1),te.writeStringField(1,_e.name||""),te.writeVarintField(5,_e.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<_e.length;re++)xe.feature=_e.feature(re),te.writeMessage(2,Zt,xe);var Se=xe.keys;for(re=0;re<Se.length;re++)te.writeStringField(3,Se[re]);var $e=xe.values;for(re=0;re<$e.length;re++)te.writeMessage(4,it,$e[re])}function Zt(_e,te){var re=_e.feature;void 0!==re.id&&te.writeVarintField(1,re.id),te.writeMessage(2,Qt,_e),te.writeVarintField(3,re.type),te.writeMessage(4,Kt,re)}function Qt(_e,te){var re=_e.feature,xe=_e.keys,Se=_e.values,$e=_e.keycache,nt=_e.valuecache;for(var et in re.properties){var We=re.properties[et],Ke=$e[et];if(null!==We){void 0===Ke&&(xe.push(et),$e[et]=Ke=xe.length-1),te.writeVarint(Ke);var wt=typeof We;"string"!==wt&&"boolean"!==wt&&"number"!==wt&&(We=JSON.stringify(We));var Ae=wt+":"+We,ye=nt[Ae];void 0===ye&&(Se.push(We),nt[Ae]=ye=Se.length-1),te.writeVarint(ye)}}}function tn(_e,te){return(te<<3)+(7&_e)}function Rt(_e){return _e<<1^_e>>31}function Kt(_e,te){for(var re=_e.loadGeometry(),xe=_e.type,Se=0,$e=0,nt=re.length,et=0;et<nt;et++){var We=re[et],Ke=1;1===xe&&(Ke=We.length),te.writeVarint(tn(1,Ke));for(var wt=3===xe?We.length-1:We.length,Ae=0;Ae<wt;Ae++){1===Ae&&1!==xe&&te.writeVarint(tn(2,wt-1));var ye=We[Ae].x-Se,be=We[Ae].y-$e;te.writeVarint(Rt(ye)),te.writeVarint(Rt(be)),Se+=ye,$e+=be}3===xe&&te.writeVarint(tn(7,1))}}function it(_e,te){var re=typeof _e;"string"===re?te.writeStringField(1,_e):"boolean"===re?te.writeBooleanField(7,_e):"number"===re&&(_e%1!=0?te.writeDoubleField(3,_e):_e<0?te.writeSVarintField(6,_e):te.writeVarintField(5,_e))}function ct(_e,te,re,xe,Se,$e){if(Se-xe<=re)return;const nt=xe+Se>>1;It(_e,te,nt,xe,Se,$e%2),ct(_e,te,re,xe,nt-1,$e+1),ct(_e,te,re,nt+1,Se,$e+1)}function It(_e,te,re,xe,Se,$e){for(;Se>xe;){if(Se-xe>600){const Ke=Se-xe+1,wt=re-xe+1,Ae=Math.log(Ke),ye=.5*Math.exp(2*Ae/3),be=.5*Math.sqrt(Ae*ye*(Ke-ye)/Ke)*(wt-Ke/2<0?-1:1);It(_e,te,re,Math.max(xe,Math.floor(re-wt*ye/Ke+be)),Math.min(Se,Math.floor(re+(Ke-wt)*ye/Ke+be)),$e)}const nt=te[2*re+$e];let et=xe,We=Se;for(dt(_e,te,xe,re),te[2*Se+$e]>nt&&dt(_e,te,xe,Se);et<We;){for(dt(_e,te,et,We),et++,We--;te[2*et+$e]<nt;)et++;for(;te[2*We+$e]>nt;)We--}te[2*xe+$e]===nt?dt(_e,te,xe,We):(We++,dt(_e,te,We,Se)),We<=re&&(xe=We+1),re<=We&&(Se=We-1)}}function dt(_e,te,re,xe){_n(_e,re,xe),_n(te,2*re,2*xe),_n(te,2*re+1,2*xe+1)}function _n(_e,te,re){const xe=_e[te];_e[te]=_e[re],_e[re]=xe}function rn(_e,te,re,xe){const Se=_e-re,$e=te-xe;return Se*Se+$e*$e}vn.fromVectorTileJs=At,vn.fromGeojsonVt=function(_e,te){te=te||{};var re={};for(var xe in _e)re[xe]=new Gt(_e[xe].features,te),re[xe].name=xe,re[xe].version=te.version,re[xe].extent=te.extent;return At({layers:re})},vn.GeoJSONWrapper=ki;const Zn=_e=>_e[0],An=_e=>_e[1];class Di{constructor(te,re=Zn,xe=An,Se=64,$e=Float64Array){this.nodeSize=Se,this.points=te;const nt=te.length<65536?Uint16Array:Uint32Array,et=this.ids=new nt(te.length),We=this.coords=new $e(2*te.length);for(let Ke=0;Ke<te.length;Ke++)et[Ke]=Ke,We[2*Ke]=re(te[Ke]),We[2*Ke+1]=xe(te[Ke]);ct(et,We,Se,0,et.length-1,0)}range(te,re,xe,Se){return function($e,nt,et,We,Ke,wt,Ae){const ye=[0,$e.length-1,0],be=[];let Ze,Pe;for(;ye.length;){const ft=ye.pop(),qt=ye.pop(),Rn=ye.pop();if(qt-Rn<=Ae){for(let In=Rn;In<=qt;In++)Ze=nt[2*In],Pe=nt[2*In+1],Ze>=et&&Ze<=Ke&&Pe>=We&&Pe<=wt&&be.push($e[In]);continue}const Vn=Math.floor((Rn+qt)/2);Ze=nt[2*Vn],Pe=nt[2*Vn+1],Ze>=et&&Ze<=Ke&&Pe>=We&&Pe<=wt&&be.push($e[Vn]);const jn=(ft+1)%2;(0===ft?et<=Ze:We<=Pe)&&(ye.push(Rn),ye.push(Vn-1),ye.push(jn)),(0===ft?Ke>=Ze:wt>=Pe)&&(ye.push(Vn+1),ye.push(qt),ye.push(jn))}return be}(this.ids,this.coords,te,re,xe,Se,this.nodeSize)}within(te,re,xe){return function(Se,$e,nt,et,We,Ke){const wt=[0,Se.length-1,0],Ae=[],ye=We*We;for(;wt.length;){const be=wt.pop(),Ze=wt.pop(),Pe=wt.pop();if(Ze-Pe<=Ke){for(let jn=Pe;jn<=Ze;jn++)rn($e[2*jn],$e[2*jn+1],nt,et)<=ye&&Ae.push(Se[jn]);continue}const ft=Math.floor((Pe+Ze)/2),qt=$e[2*ft],Rn=$e[2*ft+1];rn(qt,Rn,nt,et)<=ye&&Ae.push(Se[ft]);const Vn=(be+1)%2;(0===be?nt-We<=qt:et-We<=Rn)&&(wt.push(Pe),wt.push(ft-1),wt.push(Vn)),(0===be?nt+We>=qt:et+We>=Rn)&&(wt.push(ft+1),wt.push(Ze),wt.push(Vn))}return Ae}(this.ids,this.coords,te,re,xe,this.nodeSize)}}const Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},Ni=Math.fround||(kr=new Float32Array(1),_e=>(kr[0]=+_e,kr[0]));var kr;class oi{constructor(te){this.options=Ur(Object.create(Kn),te),this.trees=new Array(this.options.maxZoom+1)}load(te){const{log:re,minZoom:xe,maxZoom:Se,nodeSize:$e}=this.options;re&&console.time("total time");const nt=`prepare ${te.length} points`;re&&console.time(nt),this.points=te;let et=[];for(let We=0;We<te.length;We++)te[We].geometry&&et.push(ko(te[We],We));this.trees[Se+1]=new Di(et,vi,cr,$e,Float32Array),re&&console.timeEnd(nt);for(let We=Se;We>=xe;We--){const Ke=+Date.now();et=this._cluster(et,We),this.trees[We]=new Di(et,vi,cr,$e,Float32Array),re&&console.log("z%d: %d clusters in %dms",We,et.length,+Date.now()-Ke)}return re&&console.timeEnd("total time"),this}getClusters(te,re){let xe=((te[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,te[1]));let $e=180===te[2]?180:((te[2]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)xe=-180,$e=180;else if(xe>$e){const wt=this.getClusters([xe,Se,180,nt],re),Ae=this.getClusters([-180,Se,$e,nt],re);return wt.concat(Ae)}const et=this.trees[this._limitZoom(re)],We=et.range(vr(xe),ti(nt),vr($e),ti(Se)),Ke=[];for(const wt of We){const Ae=et.points[wt];Ke.push(Ae.numPoints?Xi(Ae):this.points[Ae.index])}return Ke}getChildren(te){const re=this._getOriginId(te),xe=this._getOriginZoom(te),Se="No cluster with the specified id.",$e=this.trees[xe];if(!$e)throw new Error(Se);const nt=$e.points[re];if(!nt)throw new Error(Se);const et=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),We=$e.within(nt.x,nt.y,et),Ke=[];for(const wt of We){const Ae=$e.points[wt];Ae.parentId===te&&Ke.push(Ae.numPoints?Xi(Ae):this.points[Ae.index])}if(0===Ke.length)throw new Error(Se);return Ke}getLeaves(te,re,xe){const Se=[];return this._appendLeaves(Se,te,re=re||10,xe=xe||0,0),Se}getTile(te,re,xe){const Se=this.trees[this._limitZoom(te)],$e=Math.pow(2,te),{extent:nt,radius:et}=this.options,We=et/nt,Ke=(xe-We)/$e,wt=(xe+1+We)/$e,Ae={features:[]};return this._addTileFeatures(Se.range((re-We)/$e,Ke,(re+1+We)/$e,wt),Se.points,re,xe,$e,Ae),0===re&&this._addTileFeatures(Se.range(1-We/$e,Ke,1,wt),Se.points,$e,xe,$e,Ae),re===$e-1&&this._addTileFeatures(Se.range(0,Ke,We/$e,wt),Se.points,-1,xe,$e,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(te){let re=this._getOriginZoom(te)-1;for(;re<=this.options.maxZoom;){const xe=this.getChildren(te);if(re++,1!==xe.length)break;te=xe[0].properties.cluster_id}return re}_appendLeaves(te,re,xe,Se,$e){const nt=this.getChildren(re);for(const et of nt){const We=et.properties;if(We&&We.cluster?$e+We.point_count<=Se?$e+=We.point_count:$e=this._appendLeaves(te,We.cluster_id,xe,Se,$e):$e<Se?$e++:te.push(et),te.length===xe)break}return $e}_addTileFeatures(te,re,xe,Se,$e,nt){for(const et of te){const We=re[et],Ke=We.numPoints;let wt,Ae,ye;if(Ke)wt=Ao(We),Ae=We.x,ye=We.y;else{const Pe=this.points[We.index];wt=Pe.properties,Ae=vr(Pe.geometry.coordinates[0]),ye=ti(Pe.geometry.coordinates[1])}const be={type:1,geometry:[[Math.round(this.options.extent*(Ae*$e-xe)),Math.round(this.options.extent*(ye*$e-Se))]],tags:wt};let Ze;Ke?Ze=We.id:this.options.generateId?Ze=We.index:this.points[We.index].id&&(Ze=this.points[We.index].id),void 0!==Ze&&(be.id=Ze),nt.features.push(be)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(+te,this.options.maxZoom+1))}_cluster(te,re){const xe=[],{radius:Se,extent:$e,reduce:nt,minPoints:et}=this.options,We=Se/($e*Math.pow(2,re));for(let Ke=0;Ke<te.length;Ke++){const wt=te[Ke];if(wt.zoom<=re)continue;wt.zoom=re;const Ae=this.trees[re+1],ye=Ae.within(wt.x,wt.y,We),be=wt.numPoints||1;let Ze=be;for(const Pe of ye){const ft=Ae.points[Pe];ft.zoom>re&&(Ze+=ft.numPoints||1)}if(Ze>be&&Ze>=et){let Pe=wt.x*be,ft=wt.y*be,qt=nt&&be>1?this._map(wt,!0):null;const Rn=(Ke<<5)+(re+1)+this.points.length;for(const Vn of ye){const jn=Ae.points[Vn];if(jn.zoom<=re)continue;jn.zoom=re;const In=jn.numPoints||1;Pe+=jn.x*In,ft+=jn.y*In,jn.parentId=Rn,nt&&(qt||(qt=this._map(wt,!0)),nt(qt,this._map(jn)))}wt.parentId=Rn,xe.push(ei(Pe/Ze,ft/Ze,Rn,Ze,qt))}else if(xe.push(wt),Ze>1)for(const Pe of ye){const ft=Ae.points[Pe];ft.zoom<=re||(ft.zoom=re,xe.push(ft))}}return xe}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,re){if(te.numPoints)return re?Ur({},te.properties):te.properties;const xe=this.points[te.index].properties,Se=this.options.map(xe);return re&&Se===xe?Ur({},Se):Se}}function ei(_e,te,re,xe,Se){return{x:Ni(_e),y:Ni(te),zoom:1/0,id:re,parentId:-1,numPoints:xe,properties:Se}}function ko(_e,te){const[re,xe]=_e.geometry.coordinates;return{x:Ni(vr(re)),y:Ni(ti(xe)),zoom:1/0,index:te,parentId:-1}}function Xi(_e){return{type:"Feature",id:_e.id,properties:Ao(_e),geometry:{type:"Point",coordinates:[(te=_e.x,360*(te-.5)),ai(_e.y)]}};var te}function Ao(_e){const te=_e.numPoints,re=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te;return Ur(Ur({},_e.properties),{cluster:!0,cluster_id:_e.id,point_count:te,point_count_abbreviated:re})}function vr(_e){return _e/360+.5}function ti(_e){const te=Math.sin(_e*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function ai(_e){const te=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Ur(_e,te){for(const re in te)_e[re]=te[re];return _e}function vi(_e){return _e.x}function cr(_e){return _e.y}function Hi(_e,te,re,xe){for(var Se,$e=xe,nt=re-te>>1,et=re-te,We=_e[te],Ke=_e[te+1],wt=_e[re],Ae=_e[re+1],ye=te+3;ye<re;ye+=3){var be=nr(_e[ye],_e[ye+1],We,Ke,wt,Ae);if(be>$e)Se=ye,$e=be;else if(be===$e){var Ze=Math.abs(ye-nt);Ze<et&&(Se=ye,et=Ze)}}$e>xe&&(Se-te>3&&Hi(_e,te,Se,xe),_e[Se+2]=$e,re-Se>3&&Hi(_e,Se,re,xe))}function nr(_e,te,re,xe,Se,$e){var nt=Se-re,et=$e-xe;if(0!==nt||0!==et){var We=((_e-re)*nt+(te-xe)*et)/(nt*nt+et*et);We>1?(re=Se,xe=$e):We>0&&(re+=nt*We,xe+=et*We)}return(nt=_e-re)*nt+(et=te-xe)*et}function si(_e,te,re,xe){var Se={id:void 0===_e?null:_e,type:te,geometry:re,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($e){var nt=$e.geometry,et=$e.type;if("Point"===et||"MultiPoint"===et||"LineString"===et)Ji($e,nt);else if("Polygon"===et||"MultiLineString"===et)for(var We=0;We<nt.length;We++)Ji($e,nt[We]);else if("MultiPolygon"===et)for(We=0;We<nt.length;We++)for(var Ke=0;Ke<nt[We].length;Ke++)Ji($e,nt[We][Ke])}(Se),Se}function Ji(_e,te){for(var re=0;re<te.length;re+=3)_e.minX=Math.min(_e.minX,te[re]),_e.minY=Math.min(_e.minY,te[re+1]),_e.maxX=Math.max(_e.maxX,te[re]),_e.maxY=Math.max(_e.maxY,te[re+1])}function jr(_e,te,re,xe){if(te.geometry){var Se=te.geometry.coordinates,$e=te.geometry.type,nt=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),et=[],We=te.id;if(re.promoteId?We=te.properties[re.promoteId]:re.generateId&&(We=xe||0),"Point"===$e)pr(Se,et);else if("MultiPoint"===$e)for(var Ke=0;Ke<Se.length;Ke++)pr(Se[Ke],et);else if("LineString"===$e)zi(Se,et,nt,!1);else if("MultiLineString"===$e){if(re.lineMetrics){for(Ke=0;Ke<Se.length;Ke++)zi(Se[Ke],et=[],nt,!1),_e.push(si(We,"LineString",et,te.properties));return}zn(Se,et,nt,!1)}else if("Polygon"===$e)zn(Se,et,nt,!0);else{if("MultiPolygon"!==$e){if("GeometryCollection"===$e){for(Ke=0;Ke<te.geometry.geometries.length;Ke++)jr(_e,{id:We,geometry:te.geometry.geometries[Ke],properties:te.properties},re,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ke=0;Ke<Se.length;Ke++){var wt=[];zn(Se[Ke],wt,nt,!0),et.push(wt)}}_e.push(si(We,$e,et,te.properties))}}function pr(_e,te){te.push(Ho(_e[0])),te.push(ts(_e[1])),te.push(0)}function zi(_e,te,re,xe){for(var Se,$e,nt=0,et=0;et<_e.length;et++){var We=Ho(_e[et][0]),Ke=ts(_e[et][1]);te.push(We),te.push(Ke),te.push(0),et>0&&(nt+=xe?(Se*Ke-We*$e)/2:Math.sqrt(Math.pow(We-Se,2)+Math.pow(Ke-$e,2))),Se=We,$e=Ke}var wt=te.length-3;te[2]=1,Hi(te,0,wt,re),te[wt+2]=1,te.size=Math.abs(nt),te.start=0,te.end=te.size}function zn(_e,te,re,xe){for(var Se=0;Se<_e.length;Se++){var $e=[];zi(_e[Se],$e,re,xe),te.push($e)}}function Ho(_e){return _e/360+.5}function ts(_e){var te=Math.sin(_e*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function Mt(_e,te,re,xe,Se,$e,nt,et){if(xe/=te,$e>=(re/=te)&&nt<xe)return _e;if(nt<re||$e>=xe)return null;for(var We=[],Ke=0;Ke<_e.length;Ke++){var wt=_e[Ke],Ae=wt.geometry,ye=wt.type,be=0===Se?wt.minX:wt.minY,Ze=0===Se?wt.maxX:wt.maxY;if(be>=re&&Ze<xe)We.push(wt);else if(!(Ze<re||be>=xe)){var Pe=[];if("Point"===ye||"MultiPoint"===ye)Ve(Ae,Pe,re,xe,Se);else if("LineString"===ye)Oe(Ae,Pe,re,xe,Se,!1,et.lineMetrics);else if("MultiLineString"===ye)Nt(Ae,Pe,re,xe,Se,!1);else if("Polygon"===ye)Nt(Ae,Pe,re,xe,Se,!0);else if("MultiPolygon"===ye)for(var ft=0;ft<Ae.length;ft++){var qt=[];Nt(Ae[ft],qt,re,xe,Se,!0),qt.length&&Pe.push(qt)}if(Pe.length){if(et.lineMetrics&&"LineString"===ye){for(ft=0;ft<Pe.length;ft++)We.push(si(wt.id,ye,Pe[ft],wt.tags));continue}"LineString"!==ye&&"MultiLineString"!==ye||(1===Pe.length?(ye="LineString",Pe=Pe[0]):ye="MultiLineString"),"Point"!==ye&&"MultiPoint"!==ye||(ye=3===Pe.length?"Point":"MultiPoint"),We.push(si(wt.id,ye,Pe,wt.tags))}}}return We.length?We:null}function Ve(_e,te,re,xe,Se){for(var $e=0;$e<_e.length;$e+=3){var nt=_e[$e+Se];nt>=re&&nt<=xe&&(te.push(_e[$e]),te.push(_e[$e+1]),te.push(_e[$e+2]))}}function Oe(_e,te,re,xe,Se,$e,nt){for(var et,We,Ke=Ct(_e),wt=0===Se?ni:ui,Ae=_e.start,ye=0;ye<_e.length-3;ye+=3){var be=_e[ye],Ze=_e[ye+1],Pe=_e[ye+2],ft=_e[ye+3],qt=_e[ye+4],Rn=0===Se?be:Ze,Vn=0===Se?ft:qt,jn=!1;nt&&(et=Math.sqrt(Math.pow(be-ft,2)+Math.pow(Ze-qt,2))),Rn<re?Vn>re&&(We=wt(Ke,be,Ze,ft,qt,re),nt&&(Ke.start=Ae+et*We)):Rn>xe?Vn<xe&&(We=wt(Ke,be,Ze,ft,qt,xe),nt&&(Ke.start=Ae+et*We)):Un(Ke,be,Ze,Pe),Vn<re&&Rn>=re&&(We=wt(Ke,be,Ze,ft,qt,re),jn=!0),Vn>xe&&Rn<=xe&&(We=wt(Ke,be,Ze,ft,qt,xe),jn=!0),!$e&&jn&&(nt&&(Ke.end=Ae+et*We),te.push(Ke),Ke=Ct(_e)),nt&&(Ae+=et)}var In=_e.length-3;be=_e[In],Ze=_e[In+1],Pe=_e[In+2],(Rn=0===Se?be:Ze)>=re&&Rn<=xe&&Un(Ke,be,Ze,Pe),In=Ke.length-3,$e&&In>=3&&(Ke[In]!==Ke[0]||Ke[In+1]!==Ke[1])&&Un(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&te.push(Ke)}function Ct(_e){var te=[];return te.size=_e.size,te.start=_e.start,te.end=_e.end,te}function Nt(_e,te,re,xe,Se,$e){for(var nt=0;nt<_e.length;nt++)Oe(_e[nt],te,re,xe,Se,$e,!1)}function Un(_e,te,re,xe){_e.push(te),_e.push(re),_e.push(xe)}function ni(_e,te,re,xe,Se,$e){var nt=($e-te)/(xe-te);return _e.push($e),_e.push(re+(Se-re)*nt),_e.push(1),nt}function ui(_e,te,re,xe,Se,$e){var nt=($e-re)/(Se-re);return _e.push(te+(xe-te)*nt),_e.push($e),_e.push(1),nt}function Pn(_e,te){for(var re=[],xe=0;xe<_e.length;xe++){var Se,$e=_e[xe],nt=$e.type;if("Point"===nt||"MultiPoint"===nt||"LineString"===nt)Se=Ki($e.geometry,te);else if("MultiLineString"===nt||"Polygon"===nt){Se=[];for(var et=0;et<$e.geometry.length;et++)Se.push(Ki($e.geometry[et],te))}else if("MultiPolygon"===nt)for(Se=[],et=0;et<$e.geometry.length;et++){for(var We=[],Ke=0;Ke<$e.geometry[et].length;Ke++)We.push(Ki($e.geometry[et][Ke],te));Se.push(We)}re.push(si($e.id,nt,Se,$e.tags))}return re}function Ki(_e,te){var re=[];re.size=_e.size,void 0!==_e.start&&(re.start=_e.start,re.end=_e.end);for(var xe=0;xe<_e.length;xe+=3)re.push(_e[xe]+te,_e[xe+1],_e[xe+2]);return re}function Tn(_e,te){if(_e.transformed)return _e;var re,xe,Se,$e=1<<_e.z,nt=_e.x,et=_e.y;for(re=0;re<_e.features.length;re++){var We=_e.features[re],Ke=We.geometry,wt=We.type;if(We.geometry=[],1===wt)for(xe=0;xe<Ke.length;xe+=2)We.geometry.push(qi(Ke[xe],Ke[xe+1],te,$e,nt,et));else for(xe=0;xe<Ke.length;xe++){var Ae=[];for(Se=0;Se<Ke[xe].length;Se+=2)Ae.push(qi(Ke[xe][Se],Ke[xe][Se+1],te,$e,nt,et));We.geometry.push(Ae)}}return _e.transformed=!0,_e}function qi(_e,te,re,xe,Se,$e){return[Math.round(re*(_e*xe-Se)),Math.round(re*(te*xe-$e))]}function wn(_e,te,re,xe,Se){for(var $e=te===Se.maxZoom?0:Se.tolerance/((1<<te)*Se.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:xe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},et=0;et<_e.length;et++){nt.numFeatures++,di(nt,_e[et],$e,Se);var We=_e[et].minX,Ke=_e[et].minY,wt=_e[et].maxX,Ae=_e[et].maxY;We<nt.minX&&(nt.minX=We),Ke<nt.minY&&(nt.minY=Ke),wt>nt.maxX&&(nt.maxX=wt),Ae>nt.maxY&&(nt.maxY=Ae)}return nt}function di(_e,te,re,xe){var Se=te.geometry,$e=te.type,nt=[];if("Point"===$e||"MultiPoint"===$e)for(var et=0;et<Se.length;et+=3)nt.push(Se[et]),nt.push(Se[et+1]),_e.numPoints++,_e.numSimplified++;else if("LineString"===$e)Ci(nt,Se,_e,re,!1,!1);else if("MultiLineString"===$e||"Polygon"===$e)for(et=0;et<Se.length;et++)Ci(nt,Se[et],_e,re,"Polygon"===$e,0===et);else if("MultiPolygon"===$e)for(var We=0;We<Se.length;We++){var Ke=Se[We];for(et=0;et<Ke.length;et++)Ci(nt,Ke[et],_e,re,!0,0===et)}if(nt.length){var wt=te.tags||null;if("LineString"===$e&&xe.lineMetrics){for(var Ae in wt={},te.tags)wt[Ae]=te.tags[Ae];wt.mapbox_clip_start=Se.start/Se.size,wt.mapbox_clip_end=Se.end/Se.size}var ye={geometry:nt,type:"Polygon"===$e||"MultiPolygon"===$e?3:"LineString"===$e||"MultiLineString"===$e?2:1,tags:wt};null!==te.id&&(ye.id=te.id),_e.features.push(ye)}}function Ci(_e,te,re,xe,Se,$e){var nt=xe*xe;if(xe>0&&te.size<(Se?nt:xe))re.numPoints+=te.length/3;else{for(var et=[],We=0;We<te.length;We+=3)(0===xe||te[We+2]>nt)&&(re.numSimplified++,et.push(te[We]),et.push(te[We+1])),re.numPoints++;Se&&function(Ke,wt){for(var Ae=0,ye=0,be=Ke.length,Ze=be-2;ye<be;Ze=ye,ye+=2)Ae+=(Ke[ye]-Ke[Ze])*(Ke[ye+1]+Ke[Ze+1]);if(Ae>0===wt)for(ye=0,be=Ke.length;ye<be/2;ye+=2){var Pe=Ke[ye],ft=Ke[ye+1];Ke[ye]=Ke[be-2-ye],Ke[ye+1]=Ke[be-1-ye],Ke[be-2-ye]=Pe,Ke[be-1-ye]=ft}}(et,$e),_e.push(et)}}function br(_e,te){var re=(te=this.options=function(Se,$e){for(var nt in $e)Se[nt]=$e[nt];return Se}(Object.create(this.options),te)).debug;if(re&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var Se,$e,nt,et,We,Ke,xe=function(Se,$e){var nt=[];if("FeatureCollection"===Se.type)for(var et=0;et<Se.features.length;et++)jr(nt,Se.features[et],$e,et);else jr(nt,"Feature"===Se.type?Se:{geometry:Se},$e);return nt}(_e,te);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Se=xe,$e=te,nt=$e.buffer/$e.extent,et=Se,We=Mt(Se,1,-1-nt,nt,0,-1,2,$e),Ke=Mt(Se,1,1-nt,2+nt,0,-1,2,$e),(We||Ke)&&(et=Mt(Se,1,-nt,1+nt,0,-1,2,$e)||[],We&&(et=Pn(We,1).concat(et)),Ke&&(et=et.concat(Pn(Ke,-1)))),xe=et).length&&this.splitTile(xe,0,0,0),re&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gr(_e,te,re){return 32*((1<<_e)*re+te)+_e}function Wi(_e,te){const re=_e.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const xe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!xe)return te(null,null);const Se=new jt(xe.features);let $e=vn(Se);0===$e.byteOffset&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),te(null,{vectorTile:Se,rawData:$e.buffer})}br.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},br.prototype.splitTile=function(_e,te,re,xe,Se,$e,nt){for(var et=[_e,te,re,xe],We=this.options,Ke=We.debug;et.length;){xe=et.pop(),re=et.pop(),te=et.pop(),_e=et.pop();var wt=1<<te,Ae=Gr(te,re,xe),ye=this.tiles[Ae];if(!ye&&(Ke>1&&console.time("creation"),ye=this.tiles[Ae]=wn(_e,te,re,xe,We),this.tileCoords.push({z:te,x:re,y:xe}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,re,xe,ye.numFeatures,ye.numPoints,ye.numSimplified),console.timeEnd("creation"));var be="z"+te;this.stats[be]=(this.stats[be]||0)+1,this.total++}if(ye.source=_e,Se){if(te===We.maxZoom||te===Se)continue;var Ze=1<<Se-te;if(re!==Math.floor($e/Ze)||xe!==Math.floor(nt/Ze))continue}else if(te===We.indexMaxZoom||ye.numPoints<=We.indexMaxPoints)continue;if(ye.source=null,0!==_e.length){Ke>1&&console.time("clipping");var Pe,ft,qt,Rn,Vn,jn,In=.5*We.buffer/We.extent,at=.5-In,$r=.5+In,$i=1+In;Pe=ft=qt=Rn=null,Vn=Mt(_e,wt,re-In,re+$r,0,ye.minX,ye.maxX,We),jn=Mt(_e,wt,re+at,re+$i,0,ye.minX,ye.maxX,We),_e=null,Vn&&(Pe=Mt(Vn,wt,xe-In,xe+$r,1,ye.minY,ye.maxY,We),ft=Mt(Vn,wt,xe+at,xe+$i,1,ye.minY,ye.maxY,We),Vn=null),jn&&(qt=Mt(jn,wt,xe-In,xe+$r,1,ye.minY,ye.maxY,We),Rn=Mt(jn,wt,xe+at,xe+$i,1,ye.minY,ye.maxY,We),jn=null),Ke>1&&console.timeEnd("clipping"),et.push(Pe||[],te+1,2*re,2*xe),et.push(ft||[],te+1,2*re,2*xe+1),et.push(qt||[],te+1,2*re+1,2*xe),et.push(Rn||[],te+1,2*re+1,2*xe+1)}}},br.prototype.getTile=function(_e,te,re){var xe=this.options,Se=xe.extent,$e=xe.debug;if(_e<0||_e>24)return null;var nt=1<<_e,et=Gr(_e,te=(te%nt+nt)%nt,re);if(this.tiles[et])return Tn(this.tiles[et],Se);$e>1&&console.log("drilling down to z%d-%d-%d",_e,te,re);for(var We,Ke=_e,wt=te,Ae=re;!We&&Ke>0;)Ke--,wt=Math.floor(wt/2),Ae=Math.floor(Ae/2),We=this.tiles[Gr(Ke,wt,Ae)];return We&&We.source?($e>1&&console.log("found parent tile z%d-%d-%d",Ke,wt,Ae),$e>1&&console.time("drilling down"),this.splitTile(We.source,Ke,wt,Ae,_e,te,re),$e>1&&console.timeEnd("drilling down"),this.tiles[et]?Tn(this.tiles[et],Se):null):null};class dr extends c.VectorTileWorkerSource{constructor(te,re,xe,Se,$e){super(te,re,xe,Se,Wi),$e&&(this.loadGeoJSON=$e)}loadData(te,re){const xe=te&&te.request,Se=xe&&xe.collectResourceTiming;this.loadGeoJSON(te,($e,nt)=>{if($e||!nt)return re($e);if("object"!=typeof nt)return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{xt(nt,!0);try{if(te.filter){const We=c.createExpression(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===We.result)throw new Error(We.value.map(wt=>`${wt.key}: ${wt.message}`).join(", "));const Ke=nt.features.filter(wt=>We.value.evaluate({zoom:0},wt));nt={type:"FeatureCollection",features:Ke}}this._geoJSONIndex=te.cluster?new oi(function({superclusterOptions:We,clusterProperties:Ke}){if(!Ke||!We)return We;const wt={},Ae={},ye={accumulated:null,zoom:0},be={properties:null},Ze=Object.keys(Ke);for(const Pe of Ze){const[ft,qt]=Ke[Pe],Rn=c.createExpression(qt),Vn=c.createExpression("string"==typeof ft?[ft,["accumulated"],["get",Pe]]:ft);wt[Pe]=Rn.value,Ae[Pe]=Vn.value}return We.map=Pe=>{be.properties=Pe;const ft={};for(const qt of Ze)ft[qt]=wt[qt].evaluate(ye,be);return ft},We.reduce=(Pe,ft)=>{be.properties=ft;for(const qt of Ze)ye.accumulated=Pe[qt],Pe[qt]=Ae[qt].evaluate(ye,be)},We}(te)).load(nt.features):new br(We=nt,te.geojsonVtOptions)}catch(We){return re(We)}this.loaded={};const et={};if(Se){const We=c.getPerformanceMeasurement(xe);We&&(et.resourceTiming={},et.resourceTiming[te.source]=JSON.parse(JSON.stringify(We)))}re(null,et)}var We})}reloadTile(te,re){const xe=this.loaded;return xe&&xe[te.uid]?super.reloadTile(te,re):this.loadTile(te,re)}loadGeoJSON(te,re){if(te.request)c.getJSON(te.request,re);else{if("string"!=typeof te.data)return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(te.data))}catch{return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(xe){re(xe)}}getClusterChildren(te,re){try{re(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(xe){re(xe)}}getClusterLeaves(te,re){try{re(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(xe){re(xe)}}}class mo{constructor(te){this.self=te,this.actor=new c.Actor(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:dr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,xe)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=xe},this.self.registerRTLTextPlugin=re=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=re.applyArabicShaping,c.plugin.processBidirectionalText=re.processBidirectionalText,c.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(te,re,xe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],xe()}checkIfReady(te,re,xe){xe()}setReferrer(te,re){this.referrer=re}spriteLoaded(te,re){this.isSpriteLoaded[te]=re;for(const xe in this.workerSources[te]){const Se=this.workerSources[te][xe];for(const $e in Se)Se[$e]instanceof c.VectorTileWorkerSource&&(Se[$e].isSpriteLoaded=re,Se[$e].fire(new c.Event("isSpriteLoaded")))}}setImages(te,re,xe){this.availableImages[te]=re;for(const Se in this.workerSources[te]){const $e=this.workerSources[te][Se];for(const nt in $e)$e[nt].availableImages=re}xe()}enableTerrain(te,re,xe){this.terrain=re,xe()}setProjection(te,re){this.projections[te]=c.getProjection(re)}setLayers(te,re,xe){this.getLayerIndex(te).replace(re),xe()}updateLayers(te,re,xe){this.getLayerIndex(te).update(re.layers,re.removedIds),xe()}loadTile(te,re,xe){const Se=this.enableTerrain?c.extend({enableTerrain:this.terrain},re):re;Se.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source).loadTile(Se,xe)}loadDEMTile(te,re,xe){const Se=this.enableTerrain?c.extend({buildQuadTree:this.terrain},re):re;this.getDEMWorkerSource(te,re.source).loadTile(Se,xe)}reloadTile(te,re,xe){const Se=this.enableTerrain?c.extend({enableTerrain:this.terrain},re):re;Se.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source).reloadTile(Se,xe)}abortTile(te,re,xe){this.getWorkerSource(te,re.type,re.source).abortTile(re,xe)}removeTile(te,re,xe){this.getWorkerSource(te,re.type,re.source).removeTile(re,xe)}removeSource(te,re,xe){if(!this.workerSources[te]||!this.workerSources[te][re.type]||!this.workerSources[te][re.type][re.source])return;const Se=this.workerSources[te][re.type][re.source];delete this.workerSources[te][re.type][re.source],void 0!==Se.removeSource?Se.removeSource(re,xe):xe()}loadWorkerSource(te,re,xe){try{this.self.importScripts(re.url),xe()}catch(Se){xe(Se.toString())}}syncRTLPluginState(te,re,xe){try{c.plugin.setState(re);const Se=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=Se){this.self.importScripts(Se);const $e=c.plugin.isParsed();xe($e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Se}`),$e)}}catch(Se){xe(Se.toString())}}getAvailableImages(te){let re=this.availableImages[te];return re||(re=[]),re}getLayerIndex(te){let re=this.layerIndexes[te];return re||(re=this.layerIndexes[te]=new Ft),re}getWorkerSource(te,re,xe){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][re]||(this.workerSources[te][re]={}),this.workerSources[te][re][xe]||(this.workerSources[te][re][xe]=new this.workerSourceTypes[re]({send:(Se,$e,nt,et,We,Ke)=>{this.actor.send(Se,$e,nt,te,We,Ke)},scheduler:this.actor.scheduler},this.getLayerIndex(te),this.getAvailableImages(te),this.isSpriteLoaded[te])),this.workerSources[te][re][xe]}getDEMWorkerSource(te,re){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][re]||(this.demWorkerSources[te][re]=new st),this.demWorkerSources[te][re]}enforceCacheSizeLimit(te,re){c.enforceCacheSizeLimit(re)}getWorkerPerformanceMetrics(te,re,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new mo(self)),mo}),Q(0,function(c){function ze(d,i){if(Array.isArray(d)){if(!Array.isArray(i)||d.length!==i.length)return!1;for(let l=0;l<d.length;l++)if(!ze(d[l],i[l]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==i){if("object"!=typeof i||Object.keys(d).length!==Object.keys(i).length)return!1;for(const l in d)if(!ze(d[l],i[l]))return!1;return!0}return d===i}var Vt=Ft;function Ft(d){return i=d,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(S),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===m.width}()||(void 0===st[l=i&&i.failIfMajorPerformanceCaveat]&&(st[l]=function(m){var x,S,P,F,w=(S=m,P=document.createElement("canvas"),(F=Object.create(Ft.webGLContextAttributes)).failIfMajorPerformanceCaveat=S,P.getContext("webgl",F)||P.getContext("experimental-webgl",F));if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),!0===w.getShaderParameter(x,w.COMPILE_STATUS))}(l)),!st[l]||document.documentMode));var i,l}var st={};function xt(d,i,l){const m=c.window.document.createElement(d);return void 0!==i&&(m.className=i),l&&l.appendChild(m),m}function ut(d,i,l){const m=c.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const x of Object.keys(i))m.setAttributeNS(null,x,i[x]);return l&&l.appendChild(m),m}Ft.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Et=c.window.document&&c.window.document.documentElement.style,lt=Et&&void 0!==Et.userSelect?"userSelect":"WebkitUserSelect";let dn;function jt(){Et&&lt&&(dn=Et[lt],Et[lt]="none")}function Xt(){Et&&lt&&(Et[lt]=dn)}function Gt(d){d.preventDefault(),d.stopPropagation(),c.window.removeEventListener("click",Gt,!0)}function xn(){c.window.addEventListener("click",Gt,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",Gt,!0)},0)}function on(d,i){const l=d.getBoundingClientRect();return At(d,l,i)}function vn(d,i){const l=d.getBoundingClientRect(),m=[];for(let x=0;x<i.length;x++)m.push(At(d,l,i[x]));return m}function ki(d){return void 0!==c.window.InstallTrigger&&2===d.button&&d.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function At(d,i,l){const m=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new c.pointGeometry((l.clientX-i.left)*m,(l.clientY-i.top)*m)}function St(d,i){var l=i[0],m=i[1],x=i[2],w=i[3],S=l*w-x*m;return S?(d[0]=w*(S=1/S),d[1]=-m*S,d[2]=-x*S,d[3]=l*S,d):null}function Zt(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class Qt extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:l,callback:m}of this.requestors)this._notify(l,m);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,l){this._validate(i,l)&&(this.images[i]=l)}_validate(i,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,l){if(!i)return!0;let m=0;for(const x of i){if(x[0]<m||x[1]<x[0]||l<x[1])return!1;m=x[1]}return!0}_validateContent(i,l){return!(i&&(4!==i.length||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l){l.version=this.images[i].version+1,this.images[i]=l,this.updatedImages[i]=!0}removeImage(i){const l=this.images[i];delete this.images[i],delete this.patterns[i],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,l){let m=!0;if(!this.isLoaded())for(const x of i)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(i,l):this.requestors.push({ids:i,callback:l})}_notify(i,l){const m={};for(const x of i){this.images[x]||this.fire(new c.Event("styleimagemissing",{id:x}));const w=this.images[x];w?m[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:c.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,m)}getPixelSize(){const{width:i,height:l}=this.atlasImage;return{width:i,height:l}}getPattern(i){const l=this.patterns[i],m=this.getImage(i);if(!m)return null;if(l&&l.position.version===m.version)return l.position;if(l)l.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},w=new c.ImagePosition(x,m);this.patterns[i]={bin:x,position:w}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const l=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(i,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const w in this.patterns)i.push(this.patterns[w].bin);const{w:l,h:m}=c.potpack(i),x=this.atlasImage;x.resize({width:l||1,height:m||1});for(const w in this.patterns){const{bin:S}=this.patterns[w],P=S.x+1,F=S.y+1,$=this.images[w].data,Z=$.width,ne=$.height;c.RGBAImage.copy($,x,{x:0,y:0},{x:P,y:F},{width:Z,height:ne}),c.RGBAImage.copy($,x,{x:0,y:ne-1},{x:P,y:F-1},{width:Z,height:1}),c.RGBAImage.copy($,x,{x:0,y:0},{x:P,y:F+ne},{width:Z,height:1}),c.RGBAImage.copy($,x,{x:Z-1,y:0},{x:P-1,y:F},{width:1,height:ne}),c.RGBAImage.copy($,x,{x:0,y:0},{x:P+Z,y:F},{width:1,height:ne})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const l of i){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const m=this.images[l];Zt(m)&&this.updateImage(l,m)}}}const tn=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(d,i){return function([l,m,x]){const w=c.degToRad(m+90),S=c.degToRad(x);return{x:l*Math.cos(w)*Math.sin(S),y:l*Math.sin(w)*Math.sin(S),z:l*Math.cos(S),azimuthal:m,polar:x}}(d.expression.evaluate(i))}interpolate(d,i,l){return{x:c.number(d.x,i.x,l),y:c.number(d.y,i.y,l),z:c.number(d.z,i.z,l),azimuthal:c.number(d.azimuthal,i.azimuthal,l),polar:c.number(d.polar,i.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Rt="-transition";class Kt extends c.Evented{constructor(i){super(),this._transitionable=new c.Transitionable(tn),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l={}){if(!this._validate(c.validateLight,i,l))for(const m in i){const x=i[m];c.endsWith(m,Rt)?this._transitionable.setTransition(m.slice(0,-Rt.length),x):this._transitionable.setValue(m,x)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,m){return(!m||!1!==m.validate)&&c.emitValidationErrors(this,i.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const it=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),ct="-transition";class It extends c.Evented{constructor(i,l){super(),this._transitionable=new c.Transitionable(it),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(i){for(const l in i){const m=i[l];c.endsWith(l,ct)?this._transitionable.setTransition(l.slice(0,-ct.length),m):this._transitionable.setValue(l,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function dt(d,i,l,m){const x=c.smoothstep(45,65,l),[w,S]=_n(d,m),P=c.length(i);let F=1-Math.min(1,Math.exp((P-w)/(S-w)*-6));return F*=F*F,F=Math.min(1,1.00747*F),F*x*d.alpha}function _n(d,i){const l=.5/Math.tan(.5*i);return[d.range[0]+l,d.range[1]+l]}const rn=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),Zn="-transition";class An extends c.Evented{constructor(i,l){super(),this._transitionable=new c.Transitionable(rn),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const i=this._transform,l="globe"===i.projection.name,m=c.globeToMercatorTransition(i.zoom),x=this.properties.get("range"),w=[.5,3];return{range:l?[c.number(w[0],x[0],m),c.number(w[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l={}){if(!this._validate(c.validateFog,i,l)){for(const m of Object.keys(c.spec.fog))i&&void 0===i[m]&&(i[m]=c.spec.fog[m].default);for(const m in i){const x=i[m];c.endsWith(m,Zn)?this._transitionable.setTransition(m.slice(0,-Zn.length),x):this._transitionable.setValue(m,x)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(m,x,w){const S=c.MercatorCoordinate.fromLngLat(x),P=w.elevation?w.elevation.getAtPointOrZero(S):0,F=[S.x,S.y,P];return c.transformMat4(F,F,w.mercatorFogMatrix),dt(m,F,w.pitch,w._fov)}(this.state,i,l):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?_n(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,m){return(!m||!1!==m.validate)&&c.emitValidationErrors(this,i.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Di{constructor(i,l){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const w=new Di.Actor(m[x],l,this.id);w.name=`Worker ${x}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,m){c.asyncAll(this.actors,(x,w)=>{x.send(i,l,w)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Kn(d,i,l){return i*(c.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}Di.Actor=c.Actor;class Ni{constructor(i,l,m,x){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,l){let m,x;if(i instanceof c.pointGeometry||"number"==typeof i[0]){const w=c.pointGeometry.convert(i);m=[c.pointGeometry.convert(i)],x=l.isPointAboveHorizon(w)}else{const w=c.pointGeometry.convert(i[0]),S=c.pointGeometry.convert(i[1]);m=[w,S],x=c.polygonizeBounds(w,S).every(P=>l.isPointAboveHorizon(P))}return new Ni(m,l.getCameraPoint(),x,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],x=c.polygonizeBounds(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(x[3]=this.cameraPoint)),c.bufferConvexPolygon(x,i)}bufferedCameraGeometryGlobe(i){const l=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],x=c.polygonizeBounds(l,m,i),w=this.cameraPoint.clone();switch(3*((w.y>l.y)+(w.y>m.y))+((w.x>l.x)+(w.x>m.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(i,l,m,x=0){const w=i.queryPadding/l._pixelsPerMercatorPixel+1,S=m?this._bufferedCameraMercator(w,l):this._bufferedScreenMercator(w,l);let P=i.tileID.wrap+(S.unwrapped?x:0);const F=S.polygon.map(ge=>c.getTilePoint(i.tileTransform,ge,P));if(!c.polygonIntersectsBox(F,0,0,c.EXTENT,c.EXTENT))return;P=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const $=this.screenGeometryMercator.polygon.map(ge=>c.getTileVec3(i.tileTransform,ge,P)),Z=$.map(ge=>new c.pointGeometry(ge[0],ge[1])),ne=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),se=c.getTileVec3(i.tileTransform,ne,P),ve=$.map(ge=>{const fe=c.sub(ge,ge,se);return c.normalize(fe,fe),new c.Ray(se,fe)}),de=Kn(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Z,tilespaceRays:ve,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(me=c.getBounds(F),me.min.x=c.clamp(me.min.x,0,c.EXTENT),me.min.y=c.clamp(me.min.y,0,c.EXTENT),me.max.x=c.clamp(me.max.x,0,c.EXTENT),me.max.y=c.clamp(me.max.y,0,c.EXTENT),me),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:de};var me}_bufferedScreenMercator(i,l){const m=ei(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(i,l){const m=ei(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(i,l){const m=function(w,S){const P=c.multiply([],S.pixelMatrix,S.globeMatrix),F=[0,-c.GLOBE_RADIUS,0,1],$=[0,c.GLOBE_RADIUS,0,1],Z=[0,0,0,1];c.transformMat4$1(F,F,P),c.transformMat4$1($,$,P),c.transformMat4$1(Z,Z,P);const ne=new c.pointGeometry(F[0]/F[3],F[1]/F[3]),se=new c.pointGeometry($[0]/$[3],$[1]/$[3]),ve=c.polygonContainsPoint(w,ne)&&F[3]<Z[3],de=c.polygonContainsPoint(w,se)&&$[3]<Z[3];if(!ve&&!de)return null;const me=function(je,Le,Je){for(let tt=1;tt<je.length;tt++){const nn=oi(Le.pointCoordinate3D(je[tt-1]).x),rt=oi(Le.pointCoordinate3D(je[tt]).x);if(Je<0){if(nn<rt)return{idx:tt,t:-nn/(rt-1-nn)}}else if(rt<nn)return{idx:tt,t:(1-nn)/(rt+1-nn)}}return null}(w,S,ve?-1:1);if(!me)return null;const{idx:ge,t:fe}=me;let De=ge>1?kr(w.slice(0,ge),S):[],we=ge<w.length?kr(w.slice(ge),S):[];De=De.map(je=>new c.pointGeometry(oi(je.x),je.y)),we=we.map(je=>new c.pointGeometry(oi(je.x),je.y));const qe=[...De];0===qe.length&&qe.push(we[we.length-1]);const Ue=c.number(qe[qe.length-1].y,(0===we.length?De[0]:we[0]).y,fe);let Ne;return Ne=ve?[new c.pointGeometry(0,Ue),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,Ue)]:[new c.pointGeometry(1,Ue),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,Ue)],qe.push(...Ne),0===we.length?qe.push(De[0]):qe.push(...we),{polygon:qe.map(je=>new c.MercatorCoordinate(je.x,je.y)),unwrapped:!1}}(i,l);if(m)return m;const x=function(w,S){let P=!1,F=-1/0,$=0;for(let ne=0;ne<w.length-1;ne++)w[ne].x>F&&(F=w[ne].x,$=ne);for(let ne=0;ne<w.length-1;ne++){const se=($+ne)%(w.length-1),ve=w[se],de=w[se+1];Math.abs(ve.x-de.x)>.5&&(ve.x<de.x?(ve.x+=1,0===se&&(w[w.length-1].x+=1)):(de.x+=1,se+1===w.length-1&&(w[0].x+=1)),P=!0)}const Z=c.mercatorXfromLng(S.center.lng);return P&&Z<Math.abs(Z-1)&&w.forEach(ne=>{ne.x-=1}),{polygon:w,unwrapped:P}}(kr(i,l).map(w=>new c.pointGeometry(oi(w.x),w.y)),l);return{polygon:x.polygon.map(w=>new c.MercatorCoordinate(w.x,w.y)),unwrapped:x.unwrapped}}}function kr(d,i){return c.resample(d,l=>{const m=i.pointCoordinate3D(l);l.x=m.x,l.y=m.y},1/256)}function oi(d){return d<0?1+d%1:d%1}function ei(d){return 100*d|0}function ko(d,i,l,m,x){const w=function(S,P){if(S)return x(S);if(P){const F=c.pick(c.extend(P,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(F.vectorLayers=P.vector_layers,F.vectorLayerIds=F.vectorLayers.map($=>$.id)),P.language_options&&(F.languageOptions=P.language_options),P.language&&P.language[P.id]&&(F.language=P.language[P.id]),P.worldview_options&&(F.worldviewOptions=P.worldview_options),P.worldview?F.worldview=P.worldview[P.id]:P.worldview_default&&(F.worldview=P.worldview_default),F.tiles=i.canonicalizeTileset(F,d.url),x(null,F)}};return d.url?c.getJSON(i.transformRequest(i.normalizeSourceURL(d.url,null,l,m),c.ResourceType.Source),w):c.exported.frame(()=>w(null,d))}class Xi{constructor(i,l,m){this.bounds=c.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),m=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),x=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),w=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),S=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return i.x>=m&&i.x<w&&i.y>=x&&i.y<S}}class Ao{constructor(i,l,m){this.context=i;const x=i.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ti{constructor(i,l,m,x){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=x,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),i.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let m=0;m<this.attributes.length;m++){const x=l.attributes[this.attributes[m].name];void 0!==x&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,l,m){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],S=l.attributes[w.name];void 0!==S&&i.vertexAttribPointer(S,w.components,i[vr[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ai{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ur extends ai{getDefault(){return c.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vi extends ai{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class cr extends ai{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Hi extends ai{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class nr extends ai{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class si extends ai{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Ji extends ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class jr extends ai{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class pr extends ai{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class zi extends ai{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class zn extends ai{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class Ho extends ai{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class ts extends ai{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class Mt extends ai{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ve extends ai{getDefault(){return c.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Oe extends ai{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ct extends ai{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class Nt extends ai{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Un extends ai{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class ni extends ai{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class ui extends ai{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Pn extends ai{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ki extends ai{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Tn extends ai{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class qi extends ai{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class wn extends ai{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class di extends ai{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ci extends ai{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class br extends ai{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Gr extends ai{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Wi extends ai{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class dr extends ai{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class mo extends dr{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class _e extends dr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class te extends _e{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class re{constructor(i,l,m,x){this.context=i,this.width=l,this.height=m;const w=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new mo(i,w),x&&(this.depthAttachment=new _e(i,w))}destroy(){const i=this.context.gl,l=this.colorAttachment.get();if(l&&i.deleteTexture(l),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class xe{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ur(this),this.clearDepth=new vi(this),this.clearStencil=new cr(this),this.colorMask=new Hi(this),this.depthMask=new nr(this),this.stencilMask=new si(this),this.stencilFunc=new Ji(this),this.stencilOp=new jr(this),this.stencilTest=new pr(this),this.depthRange=new zi(this),this.depthTest=new zn(this),this.depthFunc=new Ho(this),this.blend=new ts(this),this.blendFunc=new Mt(this),this.blendColor=new Ve(this),this.blendEquation=new Oe(this),this.cullFace=new Ct(this),this.cullFaceSide=new Nt(this),this.frontFace=new Un(this),this.program=new ni(this),this.activeTexture=new ui(this),this.viewport=new Pn(this),this.bindFramebuffer=new Ki(this),this.bindRenderbuffer=new Tn(this),this.bindTexture=new qi(this),this.bindVertexBuffer=new wn(this),this.bindElementBuffer=new di(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ci(this),this.pixelStoreUnpack=new br(this),this.pixelStoreUnpackPremultiplyAlpha=new Gr(this),this.pixelStoreUnpackFlipY=new Wi(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l){return new Ao(this,i,l)}createVertexBuffer(i,l,m){return new ti(this,i,l,m)}createRenderbuffer(i,l,m){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,i,l,m),this.bindRenderbuffer.set(null),w}createFramebuffer(i,l,m){return new re(this,i,l,m)}clear({color:i,depth:l,stencil:m}){const x=this.gl;let w=0;i&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==m&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(w)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){ze(i.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Se extends c.Evented{constructor(i,l,m,x){super(),this.id=i,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ko(this._options,this.map._requestManager,null,null,(i,l)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new c.ErrorEvent(i)):l&&(c.extend(this,l),l.bounds&&(this.tileBounds=new Xi(l.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(l.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const m=c.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=c.getImage(this.map._requestManager.transformRequest(x,c.ResourceType.Tile),(w,S,P,F)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):w?(i.state="errored",l(w)):S?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:P,expires:F}),i.setTexture(S,this.map.painter),i.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(i,l,m){i.setTexture(l,m)}static unloadTileData(i,l){i.texture&&l.saveTileTexture(i.texture)}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&this.map.painter.saveTileTexture(i.texture),l()}hasTransition(){return!1}}let $e;function nt(d,i,l,m,x,w,S,P){const F=[d,l,x,i,m,w,1,1,1],$=[S,P,1],Z=c.adjoint([],F),[ne,se,ve]=c.transformMat3($,$,c.transpose(Z,Z));return c.multiply$1(F,[ne,0,0,0,se,0,0,0,ve],F)}class et extends c.Evented{constructor(i,l,m,x){super(),this.id=i,this.dispatcher=m,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=l}load(i,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(m,x)=>{if(this._loaded=!0,m)this.fire(new c.ErrorEvent(m));else if(x){const{HTMLImageElement:w}=c.window;this.image=x instanceof w?c.exported.getImageData(x):x,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const l=i.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,w=1/0,S=-1/0,P=-1/0;for(const ne of m)x=Math.min(x,ne.x),w=Math.min(w,ne.y),S=Math.max(S,ne.x),P=Math.max(P,ne.y);const F=Math.max(S-x,P-w),$=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),Z=Math.pow(2,$);return new c.CanonicalTileID($,Math.floor((x+S)/2*Z),Math.floor((w+P)/2*Z))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const F in this.tiles){const $=this.tiles[F];"loaded"!==$.state&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[m,x,w,S]=this.coordinates.map(F=>{const $=l.projection.project(F[0],F[1]);return c.getTilePoint(l,$)._round()});this.perspectiveTransform=function(F,$,Z,ne,se,ve,de,me,ge,fe){const De=nt(0,0,F,0,0,$,F,$),we=nt(Z,ne,se,ve,de,me,ge,fe);return c.multiply$1(we,c.adjoint(De,De),we),[we[6]/we[8]*F/c.EXTENT,we[7]/we[8]*$/c.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,S.x,S.y,w.x,w.y);const P=this._boundsArray=new c.StructArrayLayout4i8;P.emplaceBack(m.x,m.y,0,0),P.emplaceBack(x.x,x.y,c.EXTENT,0),P.emplaceBack(S.x,S.y,0,c.EXTENT),P.emplaceBack(w.x,w.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(P,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,l=i.gl;this.texture?this.texture.update(this.image):(this.texture=new c.Texture(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._prepareData(i)}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const We={vector:class extends c.Evented{constructor(d,i,l,m){if(super(),this.id=d,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(i,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(d){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const i=this.language||this.map._language,l=this.worldview||this.map._worldview;this._tileJSONRequest=ko(this._options,this.map._requestManager,i,l,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${i}`),l&&2!==l.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new c.ErrorEvent(m))):x&&(c.extend(this,x),x.bounds&&(this.tileBounds=new Xi(x.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),d&&d(m)})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.load(()=>{const i=this.map.style._getSourceCaches(this.id);for(const l of i)l.clearTiles()})}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}_setLanguage(d){return d===this.language||this.setSourceProperty(()=>{this.language=d}),this}_setWorldview(d){return d===this.worldview?this:this.worldviewOptions&&d&&!this.worldviewOptions[d]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${d}".`),this):(this.setSourceProperty(()=>{this.worldview=d}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}loadTile(d,i){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(l,c.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,d.actor&&"expired"!==d.state)"loading"===d.state?d.reloadCallback=i:d.request=d.actor.send("reloadTile",m,x.bind(this));else if(d.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",m,x.bind(this),void 0,!0);else{const w=c.loadVectorTile.call({deduped:this._deduped},m,(S,P)=>{S||!P?x.call(this,S):(m.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},d.actor&&d.actor.send("loadTile",m,x.bind(this),void 0,!0))},!0);d.request={cancel:w}}function x(w,S){return delete d.request,d.aborted?i(null):w&&404!==w.status?i(w):(S&&S.resourceTiming&&(d.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&d.setExpiryData(S),d.loadVectorData(S,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Se,"raster-dem":class extends Se{constructor(d,i,l,m){super(d,i,l,m),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,w){x&&(d.state="errored",i(x)),w&&(d.dem=w,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(x,w,S,P){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(x)d.state="errored",i(x);else if(w){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:S,expires:P});const F=c.window.ImageBitmap&&w instanceof c.window.ImageBitmap&&(null==$e&&($e=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),$e),$=1-(w.width-c.prevPowerOfTwo(w.width))/2;$<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const Z=F?w:c.exported.getImageData(w,$),ne={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:Z,encoding:this.encoding,padding:$};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",ne,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const i=d.canonical,l=Math.pow(2,i.z),m=(i.x-1+l)%l,x=0===i.x?d.wrap-1:d.wrap,w=(i.x+1+l)%l,S=i.x+1===l?d.wrap+1:d.wrap,P={};return P[new c.OverscaledTileID(d.overscaledZ,x,i.z,m,i.y).key]={backfilled:!1},P[new c.OverscaledTileID(d.overscaledZ,S,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(P[new c.OverscaledTileID(d.overscaledZ,x,i.z,m,i.y-1).key]={backfilled:!1},P[new c.OverscaledTileID(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},P[new c.OverscaledTileID(d.overscaledZ,S,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<l&&(P[new c.OverscaledTileID(d.overscaledZ,x,i.z,m,i.y+1).key]={backfilled:!1},P[new c.OverscaledTileID(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},P[new c.OverscaledTileID(d.overscaledZ,S,i.z,w,i.y+1).key]={backfilled:!1}),P}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends c.Evented{constructor(d,i,l,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=i.data,this._options=c.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*x,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*x,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},i),this}getClusterLeaves(d,i,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:i,offset:l},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=c.extend({},this.workerOptions),i=this._data;"string"==typeof i?(d.request=this.map._requestManager.transformRequest(c.exported.resolveURL(i),c.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,m)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new c.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,i){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete d.request,d.unloadVectorData(),d.aborted?i(null):m?i(m):(d.loadVectorData(x,this.map.painter,"reloadTile"===l),i(null))),void 0,"loadTile"===l)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends et{constructor(d,i,l,m){super(d,i,l,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,c.ResourceType.Source).url);c.getVideo(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new c.ErrorEvent(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(d,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:et,canvas:class extends et{constructor(d,i,l,m){super(d,i,l,m),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(w=>"number"!=typeof w))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends c.Evented{constructor(d,i,l,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Xi(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:i,y:l,z:m}=d.canonical;return this._implementation.hasTile({x:i,y:l,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){const{x:l,y:m,z:x}=d.tileID.canonical,w=new c.window.AbortController,S=this._implementation.loadTile({x:l,y:m,z:x},{signal:w.signal});if(!S)return this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null);S.cancel=()=>w.abort(),d.request=S.then(function(P){return delete d.request,d.aborted?(d.state="unloaded",i(null)):P?(F=P)instanceof c.window.ImageData||F instanceof c.window.ImageBitmap||F instanceof c.window.HTMLCanvasElement?(this.loadTileData(d,P),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null));var F}.bind(this)).catch(P=>{20!==P.code&&(d.state="errored",i(P))})}loadTileData(d,i){Se.loadTileData(d,i,this._map.painter)}unloadTileData(d){Se.unloadTileData(d,this._map.painter)}prepareTile(d){if(!this._implementation.prepareTile)return null;const{x:i,y:l,z:m}=d.tileID.canonical,x=this._implementation.prepareTile({x:i,y:l,z:m});return x?(this.loadTileData(d,x),d.state="loaded",x):null}unloadTile(d,i){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:l,y:m,z:x}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:m,z:x})}i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ke=function(d,i,l,m){const x=new We[i.type](d,i,l,m);if(x.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${x.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],x),x};function wt(d,i){const l=c.identity([]);return c.scale(l,l,[.5*d.width,.5*-d.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,d.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(l)}function Ae(d,i,l,m,x,w,S,P=!1){const F=d.tilesIn(m,S,P);F.sort(be);const $=[];for(const ne of F)$.push({wrappedTileID:ne.tile.tileID.wrapped().key,queryResults:ne.tile.queryRenderedFeatures(i,l,d._state,ne,x,w,wt(d.transform,ne.tile.tileID),P)});const Z=function(ne){const se={},ve={};for(const de of ne){const me=de.queryResults,ge=de.wrappedTileID,fe=ve[ge]=ve[ge]||{};for(const De in me){const we=me[De],qe=fe[De]=fe[De]||{},Ue=se[De]=se[De]||[];for(const Ne of we)qe[Ne.featureIndex]||(qe[Ne.featureIndex]=!0,Ue.push(Ne))}}return se}($);for(const ne in Z)Z[ne].forEach(se=>{const ve=se.feature,de=ve.layer;de&&"background"!==de.type&&"sky"!==de.type&&(ve.source=de.source,de["source-layer"]&&(ve.sourceLayer=de["source-layer"]),ve.state=void 0!==ve.id?d.getFeatureState(de["source-layer"],ve.id):{})});return Z}function ye(d,i){const l=d.getRenderableIds().map(w=>d.getTileByID(w)),m=[],x={};for(let w=0;w<l.length;w++){const S=l[w],P=S.tileID.canonical.key;x[P]||(x[P]=!0,S.querySourceFeatures(m,i))}return m}function be(d,i){const l=d.tileID,m=i.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function Ze(){return null!=la.workerClass?new la.workerClass:new c.window.Worker(la.workerUrl)}const Pe="mapboxgl_preloaded_worker_pool";class ft{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<ft.workerCount;)this.workers.push(new Ze);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pe]}numActive(){return Object.keys(this.active).length}}let qt;function Rn(){return qt||(qt=new ft),qt}function Vn(d,i){const l={};for(const m in d)"ref"!==m&&(l[m]=d[m]);return c.refProperties.forEach(m=>{m in i&&(l[m]=i[m])}),l}function jn(d){d=d.slice();const i=Object.create(null);for(let l=0;l<d.length;l++)i[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Vn(d[l],i[d[l].ref]));return d}ft.workerCount=2;const In={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function at(d,i,l){l.push({command:In.addSource,args:[d,i[d]]})}function $r(d,i,l){i.push({command:In.removeSource,args:[d]}),l[d]=!0}function $i(d,i,l,m){$r(d,l,m),at(d,i,l)}function Xn(d,i,l){let m;for(m in d[l])if(d[l].hasOwnProperty(m)&&"data"!==m&&!ze(d[l][m],i[l][m]))return!1;for(m in i[l])if(i[l].hasOwnProperty(m)&&"data"!==m&&!ze(d[l][m],i[l][m]))return!1;return!0}function xo(d,i,l,m,x,w){let S;for(S in i=i||{},d=d||{})d.hasOwnProperty(S)&&(ze(d[S],i[S])||l.push({command:w,args:[m,S,i[S],x]}));for(S in i)i.hasOwnProperty(S)&&!d.hasOwnProperty(S)&&(ze(d[S],i[S])||l.push({command:w,args:[m,S,i[S],x]}))}function Tr(d){return d.id}function go(d,i){return d[i.id]=i,d}class zs{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=c.clamp(i,0,1);let l=1,m=this._distances[l];const x=i*this.paddedLength+this.padding;for(;m<x&&l<this._distances.length;)m=this._distances[++l];const w=l-1,S=this._distances[w],P=m-S,F=P>0?(x-S)/P:0;return this.points[w].mult(1-F).add(this.points[l].mult(F))}}class ir{constructor(i,l,m){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(l/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,m,x,w){this._forEachCell(l,m,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(i,l,m,x){this._forEachCell(l-x,m-x,l+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(m),this.circles.push(x)}_insertBoxCell(i,l,m,x,w,S){this.boxCells[w].push(S)}_insertCircleCell(i,l,m,x,w,S){this.circleCells[w].push(S)}_query(i,l,m,x,w,S){if(m<0||i>this.width||x<0||l>this.height)return!w&&[];const P=[];if(i<=0&&l<=0&&this.width<=m&&this.height<=x){if(w)return!0;for(let F=0;F<this.boxKeys.length;F++)P.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const $=this.circles[3*F],Z=this.circles[3*F+1],ne=this.circles[3*F+2];P.push({key:this.circleKeys[F],x1:$-ne,y1:Z-ne,x2:$+ne,y2:Z+ne})}return S?P.filter(S):P}return this._forEachCell(i,l,m,x,this._queryCell,P,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?P.length>0:P}_queryCircle(i,l,m,x,w){const S=i-m,P=i+m,F=l-m,$=l+m;if(P<0||S>this.width||$<0||F>this.height)return!x&&[];const Z=[];return this._forEachCell(S,F,P,$,this._queryCellCircle,Z,{hitTest:x,circle:{x:i,y:l,radius:m},seenUids:{box:{},circle:{}}},w),x?Z.length>0:Z}query(i,l,m,x,w){return this._query(i,l,m,x,!1,w)}hitTest(i,l,m,x,w){return this._query(i,l,m,x,!0,w)}hitTestCircle(i,l,m,x){return this._queryCircle(i,l,m,!0,x)}_queryCell(i,l,m,x,w,S,P,F){const $=P.seenUids,Z=this.boxCells[w];if(null!==Z){const se=this.bboxes;for(const ve of Z)if(!$.box[ve]){$.box[ve]=!0;const de=4*ve;if(i<=se[de+2]&&l<=se[de+3]&&m>=se[de+0]&&x>=se[de+1]&&(!F||F(this.boxKeys[ve]))){if(P.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[ve],x1:se[de],y1:se[de+1],x2:se[de+2],y2:se[de+3]})}}}const ne=this.circleCells[w];if(null!==ne){const se=this.circles;for(const ve of ne)if(!$.circle[ve]){$.circle[ve]=!0;const de=3*ve;if(this._circleAndRectCollide(se[de],se[de+1],se[de+2],i,l,m,x)&&(!F||F(this.circleKeys[ve]))){if(P.hitTest)return S.push(!0),!0;{const me=se[de],ge=se[de+1],fe=se[de+2];S.push({key:this.circleKeys[ve],x1:me-fe,y1:ge-fe,x2:me+fe,y2:ge+fe})}}}}}_queryCellCircle(i,l,m,x,w,S,P,F){const $=P.circle,Z=P.seenUids,ne=this.boxCells[w];if(null!==ne){const ve=this.bboxes;for(const de of ne)if(!Z.box[de]){Z.box[de]=!0;const me=4*de;if(this._circleAndRectCollide($.x,$.y,$.radius,ve[me+0],ve[me+1],ve[me+2],ve[me+3])&&(!F||F(this.boxKeys[de])))return S.push(!0),!0}}const se=this.circleCells[w];if(null!==se){const ve=this.circles;for(const de of se)if(!Z.circle[de]){Z.circle[de]=!0;const me=3*de;if(this._circlesCollide(ve[me],ve[me+1],ve[me+2],$.x,$.y,$.radius)&&(!F||F(this.circleKeys[de])))return S.push(!0),!0}}}_forEachCell(i,l,m,x,w,S,P,F){const $=this._convertToXCellCoord(i),Z=this._convertToYCellCoord(l),ne=this._convertToXCellCoord(m),se=this._convertToYCellCoord(x);for(let ve=$;ve<=ne;ve++)for(let de=Z;de<=se;de++)if(w.call(this,i,l,m,x,this.xCellCount*de+ve,S,P,F))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,m,x,w,S){const P=x-i,F=w-l,$=m+S;return $*$>P*P+F*F}_circleAndRectCollide(i,l,m,x,w,S,P){const F=(S-x)/2,$=Math.abs(i-(x+F));if($>F+m)return!1;const Z=(P-w)/2,ne=Math.abs(l-(w+Z));if(ne>Z+m)return!1;if($<=F||ne<=Z)return!0;const se=$-F,ve=ne-Z;return se*se+ve*ve<=m*m}}const ln=Math.tan(85*Math.PI/180);function Qn(d,i,l,m,x,w,S){const P=c.create();if(l)if("globe"===w.name){const F=c.calculateGlobeLabelMatrix(x,i);c.multiply(P,P,F)}else{const F=St([],S);P[0]=F[0],P[1]=F[1],P[4]=F[2],P[5]=F[3],m||c.rotateZ(P,P,x.angle)}else c.multiply(P,x.labelPlaneMatrix,d);return P}function Jn(d,i,l,m,x,w,S){const P=Qn(d,i,l,m,x,w,S);return"globe"===w.name&&l||(P[2]=P[6]=P[10]=P[14]=0),P}function wr(d,i,l,m,x,w,S){if(l){if("globe"===w.name){const P=Qn(d,i,l,m,x,w,S);return c.invert(P,P),c.multiply(P,d,P),P}{const P=c.clone(d),F=c.identity([]);return F[0]=S[0],F[1]=S[1],F[4]=S[2],F[5]=S[3],c.multiply(P,P,F),m||c.rotateZ(P,P,-x.angle),P}}return x.glCoordMatrix}function Fo(d,i,l=0){const m=[d.x,d.y,l,1];l?c.transformMat4$1(m,m,i):Yr(m,m,i);const x=m[3];return{point:[m[0]/x,m[1]/x,m[2]/x],signedDistanceFromCamera:x}}function Sn(d,i){const l=[d[0],d[1],d[2],1];c.transformMat4$1(l,l,i);const m=l[3];return{point:[l[0]/m,l[1]/m,l[2]/m],signedDistanceFromCamera:m}}function Wo(d,i){return Math.min(.5+d/i*.5,1.5)}function ps(d,i){const l=d[0]/d[3],m=d[1]/d[3];return l>=-i[0]&&l<=i[0]&&m>=-i[1]&&m<=i[1]}function ms(d,i,l,m,x,w,S,P,F,$){const Z=l.transform,ne=m?d.textSizeData:d.iconSizeData,se=c.evaluateSizeForZoom(ne,l.transform.zoom),ve="globe"===Z.projection.name,de=[256/l.width*2+1,256/l.height*2+1],me=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;me.clear();let ge=null;ve&&(ge=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const fe=d.lineVertexArray,De=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,we=l.transform.width/l.transform.height;let qe=!1;for(let Ue=0;Ue<De.length;Ue++){const Ne=De.get(Ue);if(Ne.writingMode!==c.WritingMode.vertical||qe||0!==Ue&&De.get(Ue-1).writingMode===c.WritingMode.horizontal||(qe=!0),(Ne.hidden||Ne.writingMode===c.WritingMode.vertical)&&!qe){eo(Ne.numGlyphs,me);continue}qe=!1;const je=new c.pointGeometry(Ne.tileAnchorX,Ne.tileAnchorY),Le=F?F(je):[0,0,0],Je=Z.projection.projectTilePoint(je.x,je.y,$.canonical),tt=[Je.x+Le[0],Je.y+Le[1],Je.z+Le[2]],nn=[...tt,1];if(c.transformMat4$1(nn,nn,i),!ps(nn,de)){eo(Ne.numGlyphs,me);continue}const rt=Wo(l.transform.cameraToCenterDistance,nn[3]),Pt=c.evaluateSizeForFeature(ne,se,Ne),Bt=S?Pt/rt:Pt*rt,un=Fo(new c.pointGeometry(tt[0],tt[1]),x,tt[2]);if(un.signedDistanceFromCamera<=0){eo(Ne.numGlyphs,me);continue}let _t={};const en=S?null:F,kt=gs(Ne,Bt,!1,P,i,x,w,d.glyphOffsetArray,fe,me,ge,un.point,je,_t,we,en,Z.projection,$,S);qe=kt.useVertical,en&&kt.needsFlipping&&(_t={}),(kt.notEnoughRoom||qe||kt.needsFlipping&&gs(Ne,Bt,!0,P,i,x,w,d.glyphOffsetArray,fe,me,ge,un.point,je,_t,we,en,Z.projection,$,S).notEnoughRoom)&&eo(Ne.numGlyphs,me)}m?(d.text.dynamicLayoutVertexBuffer.updateData(me),ge&&d.text.globeExtVertexBuffer.updateData(ge)):(d.icon.dynamicLayoutVertexBuffer.updateData(me),ge&&d.icon.globeExtVertexBuffer.updateData(ge))}function lo(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me){const ge=P.glyphStartIndex+P.numGlyphs,fe=P.lineStartIndex,De=P.lineStartIndex+P.lineLength,we=i.getoffsetX(P.glyphStartIndex),qe=i.getoffsetX(ge-1),Ue=Er(d*we,l,m,x,w,S,P.segment,fe,De,F,$,Z,ne,se,!0,ve,de,me);if(!Ue)return null;const Ne=Er(d*qe,l,m,x,w,S,P.segment,fe,De,F,$,Z,ne,se,!0,ve,de,me);return Ne?{first:Ue,last:Ne}:null}function Vi(d,i,l,m){return d.writingMode===c.WritingMode.horizontal&&Math.abs(l.y-i.y)>Math.abs(l.x-i.x)*m?{useVertical:!0}:d.writingMode===c.WritingMode.vertical?i.y<l.y?{needsFlipping:!0}:null:0!==d.flipState&&function(x,w,S){const P=(w.x-x.x)*S;return 0===P||Math.abs((w.y-x.y)/P)>ln}(i,l,m)?1===d.flipState?{needsFlipping:!0}:null:i.x>l.x?{needsFlipping:!0}:null}function gs(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me,ge,fe,De){const we=i/24,qe=d.lineOffsetX*we,Ue=d.lineOffsetY*we;let Ne;if(d.numGlyphs>1){const je=d.glyphStartIndex+d.numGlyphs,Le=d.lineStartIndex,Je=d.lineStartIndex+d.lineLength,tt=lo(we,P,qe,Ue,l,ne,se,d,F,w,ve,me,!1,ge,fe,De);if(!tt)return{notEnoughRoom:!0};const nn=Sn(tt.first.point,S).point,rt=Sn(tt.last.point,S).point,Pt=new c.pointGeometry(nn[0],nn[1]),Bt=new c.pointGeometry(rt[0],rt[1]);if(m&&!l){const un=Vi(d,Pt,Bt,de);if(d.flipState=un&&un.needsFlipping?1:2,un)return un}Ne=[tt.first];for(let un=d.glyphStartIndex+1;un<je-1;un++)Ne.push(Er(we*P.getoffsetX(un),qe,Ue,l,ne,se,d.segment,Le,Je,F,w,ve,me,!1,!1,ge,fe,De));Ne.push(tt.last)}else{if(m&&!l){const Le=Fo(se,x).point,Je=d.lineStartIndex+d.segment+1,tt=new c.pointGeometry(F.getx(Je),F.gety(Je)),nn=Fo(tt,x),rt=nn.signedDistanceFromCamera>0?nn.point:Dr(se,tt,Le,1,x,void 0,ge,fe.canonical),Pt=Vi(d,new c.pointGeometry(Le[0],Le[1]),new c.pointGeometry(rt[0],rt[1]),de);if(d.flipState=Pt&&Pt.needsFlipping?1:2,Pt)return Pt}const je=Er(we*P.getoffsetX(d.glyphStartIndex),qe,Ue,l,ne,se,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,F,w,ve,me,!1,!1,ge,fe,De);if(!je)return{notEnoughRoom:!0};Ne=[je]}if(Z)for(const je of Ne)c.updateGlobeVertexNormal(Z,$.length+0,je.up[0],je.up[1],je.up[2]),c.updateGlobeVertexNormal(Z,$.length+1,je.up[0],je.up[1],je.up[2]),c.updateGlobeVertexNormal(Z,$.length+2,je.up[0],je.up[1],je.up[2]),c.updateGlobeVertexNormal(Z,$.length+3,je.up[0],je.up[1],je.up[2]),c.addDynamicAttributes($,je.point[0],je.point[1],je.point[2],je.angle);else for(const je of Ne)c.addDynamicAttributes($,je.point[0],je.point[1],je.point[2],je.angle);return{}}function Cr(d,i,l,m,x){const w=m.projectTilePoint(d.x,d.y,i);if(!x)return Fo(w,l,w.z);const S=x(d);return Fo(new c.pointGeometry(w.x+S[0],w.y+S[1]),l,w.z+S[2])}function Dr(d,i,l,m,x,w,S,P){const F=Cr(d.add(d.sub(i)._unit()),P,x,S,w).point,$=c.sub([],l,F);return c.scaleAndAdd([],l,$,m/c.length($))}function Er(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me,ge,fe){const De=m?d-i:d+i;let we=De>0?1:-1,qe=0;m&&(we*=-1,qe=Math.PI),we<0&&(qe+=Math.PI);let Ue=we>0?P+S:P+S+1,Ne=x,je=x,Le=0,Je=0;const tt=Math.abs(De),nn=[],rt=[];let Pt=w;const Bt=()=>{const Bn=Ue-we;return 0===Le?w:new c.pointGeometry($.getx(Bn),$.gety(Bn))},un=()=>Dr(Bt(),Pt,je,tt-Le+1,Z,se,me,ge.canonical);for(;Le+Je<=tt;){if(Ue+=we,Ue<P||Ue>=F)return null;if(je=Ne,nn.push(Ne),ve&&rt.push(Pt||Bt()),Ne=ne[Ue],void 0===Ne){Pt=new c.pointGeometry($.getx(Ue),$.gety(Ue));const Bn=Cr(Pt,ge.canonical,Z,me,se);Ne=Bn.signedDistanceFromCamera>0?ne[Ue]=Bn.point:un()}else Pt=null;Le+=Je,Je=c.distance(je,Ne)}Pt=Pt||new c.pointGeometry($.getx(Ue),$.gety(Ue));const _t=Bt();de&&se&&(ne[Ue]=Ne=void 0===ne[Ue]?Ne:un(),Je=c.distance(je,Ne));const en=(tt-Le)/Je,kt=Pt.sub(_t).mult(en)._add(_t),yn=c.sub([],Ne,je),fn=c.scaleAndAdd([],je,yn,en);let Fn=[0,0,1],$n=yn[0],ci=yn[1];if(fe&&(Fn=me.upVector(ge.canonical,kt.x,kt.y),0!==Fn[0]||0!==Fn[1]||1!==Fn[2])){const Bn=[1,0,0],mi=[0,1,0];Bn[0]=Fn[2],Bn[1]=0,Bn[2]=-Fn[0],c.cross(mi,Fn,Bn),c.normalize(Bn,Bn),c.normalize(mi,mi),$n=c.dot(yn,Bn),ci=c.dot(yn,mi)}if(l){const Bn=c.cross([],Fn,yn);c.normalize(Bn,Bn),c.scaleAndAdd(fn,fn,Bn,l*we)}const Fi=qe+Math.atan2(ci,$n);return nn.push(fn),ve&&rt.push(kt),{point:fn,angle:Fi,path:nn,tilePath:rt,up:Fn}}const qr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function eo(d,i){for(let l=0;l<d;l++){const m=i.length;i.resize(m+4),i.float32.set(qr,4*m)}}function Yr(d,i,l){const m=i[0],x=i[1];return d[0]=l[0]*m+l[4]*x+l[12],d[1]=l[1]*m+l[5]*x+l[13],d[3]=l[3]*m+l[7]*x+l[15],d}const Ui=100;class fa{constructor(i,l,m=new ir(i.width+200,i.height+200,25),x=new ir(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ui,this.screenBottomBoundary=i.height+Ui,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,m,x,w,S,P,F){let $=m.projectedAnchorX,Z=m.projectedAnchorY,ne=m.projectedAnchorZ;const se=m.elevation,ve=m.tileID;if(se&&ve){const Ue=i.getProjection().upVector(ve.canonical,m.tileAnchorX,m.tileAnchorY),Ne=i.getProjection().upVectorScale(ve.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=Ue[0]*se*Ne,Z+=Ue[1]*se*Ne,ne+=Ue[2]*se*Ne}const de=this.projectAndGetPerspectiveRatio(P,[$,Z,ne],m.tileID,"globe"===i.projection.name||!!se||this.transform.pitch>0,i.getProjection()),me=S*de.perspectiveRatio,ge=(m.x1*l+x.x-m.padding)*me+de.point.x,fe=(m.y1*l+x.y-m.padding)*me+de.point.y,De=(m.x2*l+x.x+m.padding)*me+de.point.x,we=(m.y2*l+x.y+m.padding)*me+de.point.y,qe=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(ge,fe,De,we)||!w&&this.grid.hitTest(ge,fe,De,we,F)||qe?{box:[],offscreen:!1,occluded:de.occluded}:{box:[ge,fe,De,we],offscreen:this.isOffscreen(ge,fe,De,we),occluded:!1}}placeCollisionCircles(i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me){const ge=[],fe=this.transform.elevation,De=fe?fe.getAtTileOffsetFunc(me,this.transform.center.lat,this.transform.worldSize,i.getProjection()):_t=>[0,0,0],we=new c.pointGeometry(m.tileAnchorX,m.tileAnchorY),qe=i.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,me.canonical),Ue=De(we),Ne=[qe.x+Ue[0],qe.y+Ue[1],qe.z+Ue[2]],je="globe"===i.projection.name,Le=this.projectAndGetPerspectiveRatio(P,[Ne[0],Ne[1],Ne[2]],me,je||!!fe||this.transform.pitch>0,i.getProjection()),{perspectiveRatio:Je}=Le,tt=(ne?S/Je:S*Je)/c.ONE_EM,nn=Fo(new c.pointGeometry(Ne[0],Ne[1]),F,Ne[2]).point,rt=Le.signedDistanceFromCamera>0?lo(tt,w,m.lineOffsetX*tt,m.lineOffsetY*tt,!1,nn,we,m,x,F,{},fe&&!ne?De:null,ne&&!!fe,i.getProjection(),me,ne):null;let Pt=!1,Bt=!1,un=!0;if(rt&&!Le.occluded){const _t=.5*ve*Je+de,en=new c.pointGeometry(-100,-100),kt=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),yn=new zs,fn=rt.first,Fn=rt.last;let $n=[];for(let Bn=fn.path.length-1;Bn>=1;Bn--)$n.push(fn.path[Bn]);for(let Bn=1;Bn<Fn.path.length;Bn++)$n.push(Fn.path[Bn]);const ci=2.5*_t;if($){const Bn=$n.map(fe&&!je?(mi,ji)=>{const Br=De(ji<fn.path.length-1?fn.tilePath[fn.path.length-1-ji]:Fn.tilePath[ji-fn.path.length+2]);return mi[2]=Br[2],Sn(mi,$)}:mi=>Sn(mi,$));$n=Bn.some(mi=>mi.signedDistanceFromCamera<=0)?[]:Bn.map(mi=>mi.point)}let Fi=[];if($n.length>0){const Bn=$n.map(gr=>new c.pointGeometry(gr[0],gr[1]));let mi=1/0,ji=-1/0,Br=1/0,fo=-1/0;for(let gr=0;gr<Bn.length;gr++)mi=Math.min(mi,Bn[gr].x),Br=Math.min(Br,Bn[gr].y),ji=Math.max(ji,Bn[gr].x),fo=Math.max(fo,Bn[gr].y);Fi=mi>=en.x&&ji<=kt.x&&Br>=en.y&&fo<=kt.y?[Bn]:ji<en.x||mi>kt.x||fo<en.y||Br>kt.y?[]:c.clipLine([Bn],en.x,en.y,kt.x,kt.y)}for(const Bn of Fi){yn.reset(Bn,.25*_t);let mi=0;mi=yn.length<=.5*_t?1:Math.ceil(yn.paddedLength/ci)+1;for(let ji=0;ji<mi;ji++){const Br=ji/Math.max(mi-1,1),fo=yn.lerp(Br),gr=fo.x+Ui,Ts=fo.y+Ui;ge.push(gr,Ts,_t,0);const Da=gr-_t,Kl=Ts-_t,Ir=gr+_t,Wr=Ts+_t;if(un=un&&this.isOffscreen(Da,Kl,Ir,Wr),Bt=Bt||this.isInsideGrid(Da,Kl,Ir,Wr),!l&&this.grid.hitTestCircle(gr,Ts,_t,se)&&(Pt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Pt,occluded:!1}}}}return{circles:!Z&&Pt||!Bt?[]:ge,offscreen:un,collisionDetected:Pt,occluded:Le.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let m=1/0,x=1/0,w=-1/0,S=-1/0;for(const Z of i){const ne=new c.pointGeometry(Z.x+Ui,Z.y+Ui);m=Math.min(m,ne.x),x=Math.min(x,ne.y),w=Math.max(w,ne.x),S=Math.max(S,ne.y),l.push(ne)}const P=this.grid.query(m,x,w,S).concat(this.ignoredGrid.query(m,x,w,S)),F={},$={};for(const Z of P){const ne=Z.key;if(void 0===F[ne.bucketInstanceId]&&(F[ne.bucketInstanceId]={}),F[ne.bucketInstanceId][ne.featureIndex])continue;const se=[new c.pointGeometry(Z.x1,Z.y1),new c.pointGeometry(Z.x2,Z.y1),new c.pointGeometry(Z.x2,Z.y2),new c.pointGeometry(Z.x1,Z.y2)];c.polygonIntersectsPolygon(l,se)&&(F[ne.bucketInstanceId][ne.featureIndex]=!0,void 0===$[ne.bucketInstanceId]&&($[ne.bucketInstanceId]=[]),$[ne.bucketInstanceId].push(ne.featureIndex))}return $}insertCollisionBox(i,l,m,x,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,m,x,w){const S=l?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:x,collisionGroupID:w};for(let F=0;F<i.length;F+=4)S.insertCircle(P,i[F],i[F+1],i[F+2])}projectAndGetPerspectiveRatio(i,l,m,x,w){const S=[l[0],l[1],l[2],1];let P=!1;if(l[2]||this.transform.pitch>0){c.transformMat4$1(S,S,i);const F="globe"===w.name;this.fogState&&m&&!F&&(P=function($,Z,ne,se,ve,de){const me=de.calculateFogTileMatrix(ve),ge=[Z,ne,se];return c.transformMat4(ge,ge,me),dt($,ge,de.pitch,de._fov)}(this.fogState,l[0],l[1],l[2],m.toUnwrapped(),this.transform)>.9)}else Yr(S,S,i);return{point:new c.pointGeometry((S[0]/S[3]+1)/2*this.transform.width+Ui,(-S[1]/S[3]+1)/2*this.transform.height+Ui),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/S[3]*.5,1.5),signedDistanceFromCamera:S[3],occluded:x&&S[2]>S[3]||P}}isOffscreen(i,l,m,x){return m<Ui||i>=this.screenRightBoundary||x<Ui||l>this.screenBottomBoundary}isInsideGrid(i,l,m,x){return m>=0&&i<this.gridRightBoundary&&x>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=c.identity([]);return c.translate(i,i,[-100,-100,0]),i}}function _o(d,i,l){const m=i.createTileMatrix(d,d.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),d.projMatrix,m)}function Zo(d,i,l){if(i.projection.name===l.projection.name)return d.projMatrix;const m=l.clone();return m.setProjection(i.projection),_o(m,i.getProjection(),d)}function Mr(d,i,l){return i.name===l.projection.name?d.projMatrix:_o(l,i,d)}class Wa{constructor(i,l,m,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):x&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class Vs{constructor(i,l,m,x,w,S=!1){this.text=new Wa(i?i.text:null,l,m,w),this.icon=new Wa(i?i.icon:null,l,x,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fr{constructor(i,l,m,x=!1){this.text=i,this.icon=l,this.skipFade=m,this.clipped=x}}class Ms{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class gl{constructor(i,l,m,x,w){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=w}}class ta{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[i]}}function co(d,i,l,m,x){const{horizontalAlign:w,verticalAlign:S}=c.getAnchorAlignment(d),P=-(w-.5)*i,F=-(S-.5)*l,$=c.evaluateVariableOffset(d,m);return new c.pointGeometry(P+$[0]*x,F+$[1]*x)}function Ma(d,i,l,m,x){const w=new c.pointGeometry(d,i);return l&&w._rotate(m?x:-x),w}class _l{constructor(i,l,m,x,w){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new fa(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ta(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,m,x){const w=m.getBucket(l),S=m.latestFeatureIndex;if(!w||!S||l.id!==w.layerIds[0])return;const P=w.layers[0].layout,F=m.collisionBoxArray,$=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),Z=m.tileSize/c.EXTENT,ne=m.tileID.toUnwrapped();this.transform.setProjection(w.projection);const se=(ve=m.tileID,de=w.getProjection(),me=this.transform,de.name===this.projection?me.calculateProjMatrix(ve.toUnwrapped()):_o(me,de,ve));var ve,de,me;const ge="map"===P.get("text-pitch-alignment"),fe="map"===P.get("text-rotation-alignment");l.compileFilter();const De=l.dynamicFilter(),we=l.dynamicFilterNeedsFeature(),qe=this.transform.calculatePixelsToTileUnitsMatrix(m),Ue=Jn(se,m.tileID.canonical,ge,fe,this.transform,w.getProjection(),qe);let Ne=null;if(ge){const Je=wr(se,m.tileID.canonical,ge,fe,this.transform,w.getProjection(),qe);Ne=c.multiply([],this.transform.labelPlaneMatrix,Je)}let je=null;De&&m.latestFeatureIndex&&(je={unwrappedTileID:ne,dynamicFilter:De,dynamicFilterNeedsFeature:we,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new gl(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,m.tileID);const Le={bucket:w,layout:P,posMatrix:se,textLabelPlaneMatrix:Ue,labelToScreenMatrix:Ne,clippingData:je,scale:$,textPixelRatio:Z,holdingForFade:m.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const Je of w.sortKeyRanges){const{sortKey:tt,symbolInstanceStart:nn,symbolInstanceEnd:rt}=Je;i.push({sortKey:tt,symbolInstanceStart:nn,symbolInstanceEnd:rt,parameters:Le})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me,ge,fe,De){const we=[se.textOffset0,se.textOffset1],qe=co(i,m,x,we,w),Ue=this.collisionIndex.placeCollisionBox(de,w,l,Ma(qe.x,qe.y,S,P,this.transform.angle),ne,F,$,Z.predicate);if((!ge||0!==this.collisionIndex.placeCollisionBox(de,de.getSymbolInstanceIconSize(De,this.transform.zoom,ve),ge,Ma(qe.x,qe.y,S,P,this.transform.angle),ne,F,$,Z.predicate).box.length)&&Ue.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:we,width:m,height:x,anchor:i,textScale:w,prevAnchor:Ne},this.markUsedJustification(de,i,se,me),de.allowVerticalPlacement&&(this.markUsedOrientation(de,me,se),this.placedOrientations[se.crossTileID]=me),{shift:qe,placedGlyphBoxes:Ue}}}placeLayerBucketPart(i,l,m,x){const{bucket:w,layout:S,posMatrix:P,textLabelPlaneMatrix:F,labelToScreenMatrix:$,clippingData:Z,textPixelRatio:ne,holdingForFade:se,collisionBoxArray:ve,partiallyEvaluatedTextSize:de,partiallyEvaluatedIconSize:me,collisionGroup:ge}=i.parameters,fe=S.get("text-optional"),De=S.get("icon-optional"),we=S.get("text-allow-overlap"),qe=S.get("icon-allow-overlap"),Ue="map"===S.get("text-rotation-alignment"),Ne="map"===S.get("text-pitch-alignment"),je="none"!==S.get("icon-text-fit"),Le="viewport-y"===S.get("symbol-z-order");this.transform.setProjection(w.projection);let Je=we&&(qe||!w.hasIconData()||De),tt=qe&&(we||!w.hasTextData()||fe);!w.collisionArrays&&ve&&w.deserializeCollisionBoxes(ve),m&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,ve);const nn=(rt,Pt,Bt)=>{if(Z){const Ir={zoom:this.transform.zoom,pitch:this.transform.pitch};let Wr=null;if(Z.dynamicFilterNeedsFeature){const bi=this.retainedQueryData[w.bucketInstanceId];Wr=Z.featureIndex.loadFeature({featureIndex:rt.featureIndex,bucketIndex:bi.bucketIndex,sourceLayerIndex:bi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Z.dynamicFilter)(Ir,Wr,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new c.pointGeometry(rt.tileAnchorX,rt.tileAnchorY),this.transform.calculateDistanceTileData(Z.unwrappedTileID)))return this.placements[rt.crossTileID]=new Fr(!1,!1,!1,!0),void(l[rt.crossTileID]=!0)}if(l[rt.crossTileID])return;if(se)return void(this.placements[rt.crossTileID]=new Fr(!1,!1,!1));let un=!1,_t=!1,en=!0,kt=!1,yn=!1,fn=null,Fn={box:null,offscreen:null,occluded:null},$n={box:null,offscreen:null,occluded:null},ci=null,Fi=null,Bn=null,mi=0,ji=0,Br=0;Bt.textFeatureIndex?mi=Bt.textFeatureIndex:rt.useRuntimeCollisionCircles&&(mi=rt.featureIndex),Bt.verticalTextFeatureIndex&&(ji=Bt.verticalTextFeatureIndex);const fo=Ir=>{Ir.tileID=this.retainedQueryData[w.bucketInstanceId].tileID,(this.transform.elevation||Ir.elevation)&&(Ir.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[w.bucketInstanceId].tileID,Ir.tileAnchorX,Ir.tileAnchorY):0)},gr=Bt.textBox;if(gr){fo(gr);const Ir=bi=>{let ro=c.WritingMode.horizontal;if(w.allowVerticalPlacement&&!bi&&this.prevPlacement){const jo=this.prevPlacement.placedOrientations[rt.crossTileID];jo&&(this.placedOrientations[rt.crossTileID]=jo,ro=jo,this.markUsedOrientation(w,ro,rt))}return ro},Wr=(bi,ro)=>{if(w.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const jo of w.writingModes)if(jo===c.WritingMode.vertical?(Fn=ro(),$n=Fn):Fn=bi(),Fn&&Fn.box&&Fn.box.length)break}else Fn=bi()};if(S.get("text-variable-anchor")){let bi=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[rt.crossTileID]){const sr=this.prevPlacement.variableOffsets[rt.crossTileID];bi.indexOf(sr.anchor)>0&&(bi=bi.filter(Cs=>Cs!==sr.anchor),bi.unshift(sr.anchor))}const ro=(sr,Cs,Tl)=>{const Hs=w.getSymbolInstanceTextSize(de,rt,this.transform.zoom,Pt),il=(sr.x2-sr.x1)*Hs+2*sr.padding,Ql=(sr.y2-sr.y1)*Hs+2*sr.padding,xc=je&&!qe?Cs:null;xc&&fo(xc);let ks={box:[],offscreen:!1,occluded:!1};const wc=we?2*bi.length:bi.length;for(let ec=0;ec<wc;++ec){const Ju=this.attemptAnchorPlacement(bi[ec%bi.length],sr,il,Ql,Hs,Ue,Ne,ne,P,ge,ec>=bi.length,rt,Pt,w,Tl,xc,de,me);if(Ju&&(ks=Ju.placedGlyphBoxes,ks&&ks.box&&ks.box.length)){un=!0,fn=Ju.shift;break}}return ks};Wr(()=>ro(gr,Bt.iconBox,c.WritingMode.horizontal),()=>{const sr=Bt.verticalTextBox;return sr&&fo(sr),w.allowVerticalPlacement&&!(Fn&&Fn.box&&Fn.box.length)&&rt.numVerticalGlyphVertices>0&&sr?ro(sr,Bt.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Fn&&(un=Fn.box,en=Fn.offscreen,kt=Fn.occluded);const jo=Ir(Fn&&Fn.box);if(!un&&this.prevPlacement){const sr=this.prevPlacement.variableOffsets[rt.crossTileID];sr&&(this.variableOffsets[rt.crossTileID]=sr,this.markUsedJustification(w,sr.anchor,rt,jo))}}else{const bi=(ro,jo)=>{const sr=w.getSymbolInstanceTextSize(de,rt,this.transform.zoom,Pt),Cs=this.collisionIndex.placeCollisionBox(w,sr,ro,new c.pointGeometry(0,0),we,ne,P,ge.predicate);return Cs&&Cs.box&&Cs.box.length&&(this.markUsedOrientation(w,jo,rt),this.placedOrientations[rt.crossTileID]=jo),Cs};Wr(()=>bi(gr,c.WritingMode.horizontal),()=>{const ro=Bt.verticalTextBox;return w.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&ro?(fo(ro),bi(ro,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ir(Fn&&Fn.box&&Fn.box.length)}}if(ci=Fn,un=ci&&ci.box&&ci.box.length>0,en=ci&&ci.offscreen,kt=ci&&ci.occluded,rt.useRuntimeCollisionCircles){const Ir=w.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex>=0?rt.centerJustifiedTextSymbolIndex:rt.verticalPlacedTextSymbolIndex),Wr=c.evaluateSizeForFeature(w.textSizeData,de,Ir),bi=S.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(w,we,Ir,w.lineVertexArray,w.glyphOffsetArray,Wr,P,F,$,m,Ne,ge.predicate,rt.collisionCircleDiameter*Wr/c.ONE_EM,bi,this.retainedQueryData[w.bucketInstanceId].tileID),un=we||Fi.circles.length>0&&!Fi.collisionDetected,en=en&&Fi.offscreen,kt=Fi.occluded}if(Bt.iconFeatureIndex&&(Br=Bt.iconFeatureIndex),Bt.iconBox){const Ir=Wr=>{fo(Wr);const bi=je&&fn?Ma(fn.x,fn.y,Ue,Ne,this.transform.angle):new c.pointGeometry(0,0),ro=w.getSymbolInstanceIconSize(me,this.transform.zoom,Pt);return this.collisionIndex.placeCollisionBox(w,ro,Wr,bi,qe,ne,P,ge.predicate)};$n&&$n.box&&$n.box.length&&Bt.verticalIconBox?(Bn=Ir(Bt.verticalIconBox),_t=Bn.box.length>0):(Bn=Ir(Bt.iconBox),_t=Bn.box.length>0),en=en&&Bn.offscreen,yn=Bn.occluded}const Ts=fe||0===rt.numHorizontalGlyphVertices&&0===rt.numVerticalGlyphVertices,Da=De||0===rt.numIconVertices;if(Ts||Da?Da?Ts||(_t=_t&&un):un=_t&&un:_t=un=_t&&un,un&&ci&&ci.box&&this.collisionIndex.insertCollisionBox(ci.box,S.get("text-ignore-placement"),w.bucketInstanceId,$n&&$n.box&&ji?ji:mi,ge.ID),_t&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,S.get("icon-ignore-placement"),w.bucketInstanceId,Br,ge.ID),Fi&&(un&&this.collisionIndex.insertCollisionCircles(Fi.circles,S.get("text-ignore-placement"),w.bucketInstanceId,mi,ge.ID),m)){const Ir=w.bucketInstanceId;let Wr=this.collisionCircleArrays[Ir];void 0===Wr&&(Wr=this.collisionCircleArrays[Ir]=new Ms);for(let bi=0;bi<Fi.circles.length;bi+=4)Wr.circles.push(Fi.circles[bi+0]),Wr.circles.push(Fi.circles[bi+1]),Wr.circles.push(Fi.circles[bi+2]),Wr.circles.push(Fi.collisionDetected?1:0)}const Kl="globe"!==w.projection.name;Je=Je&&(Kl||!kt),tt=tt&&(Kl||!yn),this.placements[rt.crossTileID]=new Fr(un||Je,_t||tt,en||w.justReloaded),l[rt.crossTileID]=!0};if(Le){const rt=w.getSortedSymbolIndexes(this.transform.angle);for(let Pt=rt.length-1;Pt>=0;--Pt){const Bt=rt[Pt];nn(w.symbolInstances.get(Bt),Bt,w.collisionArrays[Bt])}}else for(let rt=i.symbolInstanceStart;rt<i.symbolInstanceEnd;rt++)nn(w.symbolInstances.get(rt),rt,w.collisionArrays[rt]);if(m&&w.bucketInstanceId in this.collisionCircleArrays){const rt=this.collisionCircleArrays[w.bucketInstanceId];c.invert(rt.invProjMatrix,P),rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,l,m,x){let w;w=x===c.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[c.getAnchorJustification(l)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const P of S)P>=0&&(i.text.placedSymbolArray.get(P).crossTileID=w>=0&&P!==w?0:m.crossTileID)}markUsedOrientation(i,l,m){const x=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,w=l===c.WritingMode.vertical?l:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const P of S)i.text.placedSymbolArray.get(P).placedOrientation=x;m.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const x=l?l.symbolFadeChange(i):1,w=l?l.opacities:{},S=l?l.variableOffsets:{},P=l?l.placedOrientations:{};for(const F in this.placements){const $=this.placements[F],Z=w[F];Z?(this.opacities[F]=new Vs(Z,x,$.text,$.icon,null,$.clipped),m=m||$.text!==Z.text.placed||$.icon!==Z.icon.placed):(this.opacities[F]=new Vs(null,x,$.text,$.icon,$.skipFade,$.clipped),m=m||$.text||$.icon)}for(const F in w){const $=w[F];if(!this.opacities[F]){const Z=new Vs($,x,!1,!1);Z.isHidden()||(this.opacities[F]=Z,m=m||$.text.placed||$.icon.placed)}}for(const F in S)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=S[F]);for(const F in P)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=P[F]);m?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){const m={};for(const x of l){const w=x.getBucket(i);w&&x.latestFeatureIndex&&i.id===w.layerIds[0]&&this.updateBucketOpacities(w,m,x.collisionBoxArray)}}updateBucketOpacities(i,l,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const x=i.layers[0].layout,w=!!i.layers[0].dynamicFilter(),S=new Vs(null,0,!1,!1,!0),P=x.get("text-allow-overlap"),F=x.get("icon-allow-overlap"),$=x.get("text-variable-anchor"),Z="map"===x.get("text-rotation-alignment"),ne="map"===x.get("text-pitch-alignment"),se="none"!==x.get("icon-text-fit"),ve=new Vs(null,0,P&&(F||!i.hasIconData()||x.get("icon-optional")),F&&(P||!i.hasTextData()||x.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const de=(ge,fe,De)=>{for(let we=0;we<fe/4;we++)ge.opacityVertexArray.emplaceBack(De)};let me=0;for(let ge=0;ge<i.symbolInstances.length;ge++){const fe=i.symbolInstances.get(ge),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:we,crossTileID:qe}=fe;let Ue=this.opacities[qe];l[qe]?Ue=S:Ue||(Ue=ve,this.opacities[qe]=Ue),l[qe]=!0;const Ne=De>0||we>0,je=fe.numIconVertices>0,Le=this.placedOrientations[fe.crossTileID],Je=Le===c.WritingMode.vertical,tt=Le===c.WritingMode.horizontal||Le===c.WritingMode.horizontalOnly;if(!Ne&&!je||Ue.isHidden()||me++,Ne){const nn=ys(Ue.text);de(i.text,De,Je?wo:nn),de(i.text,we,tt?wo:nn);const rt=Ue.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(un=>{un>=0&&(i.text.placedSymbolArray.get(un).hidden=rt||Je?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=rt||tt?1:0);const Pt=this.variableOffsets[fe.crossTileID];Pt&&this.markUsedJustification(i,Pt.anchor,fe,Le);const Bt=this.placedOrientations[fe.crossTileID];Bt&&(this.markUsedJustification(i,"left",fe,Bt),this.markUsedOrientation(i,Bt,fe))}if(je){const nn=ys(Ue.icon);fe.placedIconSymbolIndex>=0&&(de(i.icon,fe.numIconVertices,Je?wo:nn),i.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Ue.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(de(i.icon,fe.numVerticalIconVertices,tt?wo:nn),i.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Ue.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const nn=i.collisionArrays[ge];if(nn){let rt=new c.pointGeometry(0,0),Pt=!0;if(nn.textBox||nn.verticalTextBox){if($){const un=this.variableOffsets[qe];un?(rt=co(un.anchor,un.width,un.height,un.textOffset,un.textScale),Z&&rt._rotate(ne?this.transform.angle:-this.transform.angle)):Pt=!1}w&&(Pt=!Ue.clipped),nn.textBox&&Po(i.textCollisionBox.collisionVertexArray,Ue.text.placed,!Pt||Je,rt.x,rt.y),nn.verticalTextBox&&Po(i.textCollisionBox.collisionVertexArray,Ue.text.placed,!Pt||tt,rt.x,rt.y)}const Bt=Pt&&Boolean(!tt&&nn.verticalIconBox);nn.iconBox&&Po(i.iconCollisionBox.collisionVertexArray,Ue.icon.placed,Bt,se?rt.x:0,se?rt.y:0),nn.verticalIconBox&&Po(i.iconCollisionBox.collisionVertexArray,Ue.icon.placed,!Bt,se?rt.x:0,se?rt.y:0)}}}if(i.fullyClipped=0===me,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ge.invProjMatrix,i.placementViewportMatrix=ge.viewportMatrix,i.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function Po(d,i,l,m,x){d.emplaceBack(i?1:0,l?1:0,m||0,x||0),d.emplaceBack(i?1:0,l?1:0,m||0,x||0),d.emplaceBack(i?1:0,l?1:0,m||0,x||0),d.emplaceBack(i?1:0,l?1:0,m||0,x||0)}const Lo=Math.pow(2,25),_s=Math.pow(2,24),dc=Math.pow(2,17),Za=Math.pow(2,16),na=Math.pow(2,9),pa=Math.pow(2,8),Sa=Math.pow(2,1);function ys(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const i=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Lo+i*_s+l*dc+i*Za+l*na+i*pa+l*Sa+i}const wo=0;class qa{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,l,m,x,w){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(S,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((P,F)=>P.sortKey-F.sortKey));this._currentPartIndex<S.length;){const P=S[this._currentPartIndex];if(l.placeLayerBucketPart(P,this._seenCrossTileIDs,m,0===P.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class vs{constructor(i,l,m,x,w,S,P,F){this.placement=new _l(i,w,S,P,F),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,l,m){const x=c.exported.now(),w=()=>{const S=c.exported.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=l[i[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=P)&&(!S.maxzoom||S.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new qa(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ns=512/c.EXTENT/2;class is{constructor(i,l,m){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let x=0;x<l.length;x++){const w=l.get(x),S=w.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,i)})}}getScaledCoordinates(i,l){const m=ns/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+i.tileAnchorX)*m),y:Math.floor((l.canonical.y*c.EXTENT+i.tileAnchorY)*m)}}findMatches(i,l,m){const x=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let w=0;w<i.length;w++){const S=i.get(w);if(S.crossTileID)continue;const P=this.indexedSymbolInstances[S.key];if(!P)continue;const F=this.getScaledCoordinates(S,l);for(const $ of P)if(Math.abs($.coord.x-F.x)<=x&&Math.abs($.coord.y-F.y)<=x&&!m[$.crossTileID]){m[$.crossTileID]=!0,S.crossTileID=$.crossTileID;break}}}}class ia{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(0!==l)for(const m in this.indexes){const x=this.indexes[m],w={};for(const S in x){const P=x[S];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+l),w[P.tileID.key]=P}this.indexes[m]=w}this.lng=i}addBucket(i,l,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<l.symbolInstances.length;w++)l.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const x=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>i.overscaledZ)for(const P in S){const F=S[P];F.tileID.isChildOf(i)&&F.findMatches(l.symbolInstances,i,x)}else{const P=S[i.scaledTo(Number(w)).key];P&&P.findMatches(l.symbolInstances,i,x)}}for(let w=0;w<l.symbolInstances.length;w++){const S=l.symbolInstances.get(w);S.crossTileID||(S.crossTileID=m.generate(),x[S.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new is(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const m in l.indexedSymbolInstances)for(const x of l.indexedSymbolInstances[m])delete this.usedCrossTileIDs[i][x.crossTileID]}removeStaleBuckets(i){let l=!1;for(const m in this.indexes){const x=this.indexes[m];for(const w in x)i[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[w]),delete x[w],l=!0)}return l}}class Ss{constructor(){this.layerIndexes={},this.crossTileIDs=new ia,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,m,x){let w=this.layerIndexes[i.id];void 0===w&&(w=this.layerIndexes[i.id]=new hc);let S=!1;const P={};"globe"!==x.name&&w.handleWrapJump(m);for(const F of l){const $=F.getBucket(i);$&&i.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(F.tileID,$,this.crossTileIDs)&&(S=!0),P[$.bucketInstanceId]=!0)}return w.removeStaleBuckets(P)&&(S=!0),S}pruneUnusedLayers(i){const l={};i.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const Us=(d,i)=>c.emitValidationErrors(d,i&&i.filter(l=>"source.canvas"!==l.identifier)),Ya=c.pick(In,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Xa=c.pick(In,["setCenter","setZoom","setBearing","setPitch"]),ma={version:8,layers:[],sources:{}},Ia={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class qo extends c.Evented{constructor(i,l={}){super(),this.map=i,this.dispatcher=new Di(Rn(),this),this.imageManager=new Qt,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(i._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new c.LineAtlas(256,512),this.crossTileSymbolIndex=new Ss,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new c.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const m=this;this._rtlTextPluginCallback=qo.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,S)=>{if(c.triggerPluginCompletionEvent(w),S&&S.every(P=>P))for(const P in m._sourceCaches){const F=m._sourceCaches[P],$=F.getSource().type;"vector"!==$&&"geojson"!==$||F.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const w=this.getSource(x.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const P=this._layers[S];P.source===w.id&&this._validateLayer(P)}})}loadURL(i,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,l.accessToken);const x=this.map._requestManager.transformRequest(i,c.ResourceType.Style);this._request=c.getJSON(x,(w,S)=>{this._request=null,w?this.fire(new c.ErrorEvent(w)):S&&this._load(S,m)})}loadJSON(i,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(i,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(ma,!1)}_updateLayerCount(i,l){const m=l?1:-1;i.is3D()&&(this._num3DLayers+=m),"circle"===i.type&&(this._numCircleLayers+=m),"symbol"===i.type&&(this._numSymbolLayers+=m)}_load(i,l){if(l&&Us(this,c.validateStyle(i)))return;this._loaded=!0,this.stylesheet=c.clone$1(i),this._updateMapProjection();for(const x in i.sources)this.addSource(x,i.sources[x],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=jn(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of m)x=c.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(l,m,x){let w,S,P;const F=c.exported.devicePixelRatio>1?"@2x":"";let $=c.getJSON(m.transformRequest(m.normalizeSpriteURL(l,F,".json"),c.ResourceType.SpriteJSON),(se,ve)=>{$=null,P||(P=se,w=ve,ne())}),Z=c.getImage(m.transformRequest(m.normalizeSpriteURL(l,F,".png"),c.ResourceType.SpriteImage),(se,ve)=>{Z=null,P||(P=se,S=ve,ne())});function ne(){if(P)x(P);else if(w&&S){const se=c.exported.getImageData(S),ve={};for(const de in w){const{width:me,height:ge,x:fe,y:De,sdf:we,pixelRatio:qe,stretchX:Ue,stretchY:Ne,content:je}=w[de],Le=new c.RGBAImage({width:me,height:ge});c.RGBAImage.copy(se,Le,{x:fe,y:De},{x:0,y:0},{width:me,height:ge}),ve[de]={data:Le,pixelRatio:qe,sdf:we,stretchX:Ue,stretchY:Ne,content:je}}x(null,ve)}}return{cancel(){$&&($.cancel(),$=null),Z&&(Z.cancel(),Z=null)}}}(i,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(i){const l=this.getSource(i.source);if(!l)return;const m=i.sourceLayer;m&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(m))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const l=[];for(const m of i){const x=this._layers[m];"custom"!==x.type&&l.push(x.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Ia[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const l=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(x.length||w.length)&&this._updateWorkerLayers(x,w);for(const S in this._updatedSources){const P=this._updatedSources[S];"reload"===P?this._reloadSource(S):"clear"===P&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const w=this._sourceCaches[x];m[x]=w.used,w.used=!1}for(const x of this._order){const w=this._layers[x];if(w.recalculate(i,this._availableImages),!w.isHidden(i.zoom)){const P=this._getLayerSourceCache(w);P&&(P.used=!0)}const S=this.map.painter;if(S){const P=w.getProgramIds();if(!P)continue;const F=w.getProgramConfiguration(i.zoom);for(const $ of P)S.useProgram($,F)}}for(const x in m){const w=this._sourceCaches[x];m[x]!==w.used&&w.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Us(this,c.validateStyle(i)))return!1;(i=c.clone$1(i)).layers=jn(i.layers);const l=function(x,w){if(!x)return[{command:In.setStyle,args:[w]}];let S=[];try{if(!ze(x.version,w.version))return[{command:In.setStyle,args:[w]}];ze(x.center,w.center)||S.push({command:In.setCenter,args:[w.center]}),ze(x.zoom,w.zoom)||S.push({command:In.setZoom,args:[w.zoom]}),ze(x.bearing,w.bearing)||S.push({command:In.setBearing,args:[w.bearing]}),ze(x.pitch,w.pitch)||S.push({command:In.setPitch,args:[w.pitch]}),ze(x.sprite,w.sprite)||S.push({command:In.setSprite,args:[w.sprite]}),ze(x.glyphs,w.glyphs)||S.push({command:In.setGlyphs,args:[w.glyphs]}),ze(x.transition,w.transition)||S.push({command:In.setTransition,args:[w.transition]}),ze(x.light,w.light)||S.push({command:In.setLight,args:[w.light]}),ze(x.fog,w.fog)||S.push({command:In.setFog,args:[w.fog]}),ze(x.projection,w.projection)||S.push({command:In.setProjection,args:[w.projection]});const P={},F=[];!function(ne,se,ve,de){let me;for(me in se=se||{},ne=ne||{})ne.hasOwnProperty(me)&&(se.hasOwnProperty(me)||$r(me,ve,de));for(me in se)se.hasOwnProperty(me)&&(ne.hasOwnProperty(me)?ze(ne[me],se[me])||("geojson"===ne[me].type&&"geojson"===se[me].type&&Xn(ne,se,me)?ve.push({command:In.setGeoJSONSourceData,args:[me,se[me].data]}):$i(me,se,ve,de)):at(me,se,ve))}(x.sources,w.sources,F,P);const $=[];x.layers&&x.layers.forEach(ne=>{ne.source&&P[ne.source]?S.push({command:In.removeLayer,args:[ne.id]}):$.push(ne)});let Z=x.terrain;Z&&P[Z.source]&&(S.push({command:In.setTerrain,args:[void 0]}),Z=void 0),S=S.concat(F),ze(Z,w.terrain)||S.push({command:In.setTerrain,args:[w.terrain]}),function(ne,se,ve){se=se||[];const de=(ne=ne||[]).map(Tr),me=se.map(Tr),ge=ne.reduce(go,{}),fe=se.reduce(go,{}),De=de.slice(),we=Object.create(null);let qe,Ue,Ne,je,Le,Je,tt;for(qe=0,Ue=0;qe<de.length;qe++)Ne=de[qe],fe.hasOwnProperty(Ne)?Ue++:(ve.push({command:In.removeLayer,args:[Ne]}),De.splice(De.indexOf(Ne,Ue),1));for(qe=0,Ue=0;qe<me.length;qe++)Ne=me[me.length-1-qe],De[De.length-1-qe]!==Ne&&(ge.hasOwnProperty(Ne)?(ve.push({command:In.removeLayer,args:[Ne]}),De.splice(De.lastIndexOf(Ne,De.length-Ue),1)):Ue++,Je=De[De.length-qe],ve.push({command:In.addLayer,args:[fe[Ne],Je]}),De.splice(De.length-qe,0,Ne),we[Ne]=!0);for(qe=0;qe<me.length;qe++)if(Ne=me[qe],je=ge[Ne],Le=fe[Ne],!we[Ne]&&!ze(je,Le))if(ze(je.source,Le.source)&&ze(je["source-layer"],Le["source-layer"])&&ze(je.type,Le.type)){for(tt in xo(je.layout,Le.layout,ve,Ne,null,In.setLayoutProperty),xo(je.paint,Le.paint,ve,Ne,null,In.setPaintProperty),ze(je.filter,Le.filter)||ve.push({command:In.setFilter,args:[Ne,Le.filter]}),ze(je.minzoom,Le.minzoom)&&ze(je.maxzoom,Le.maxzoom)||ve.push({command:In.setLayerZoomRange,args:[Ne,Le.minzoom,Le.maxzoom]}),je)je.hasOwnProperty(tt)&&"layout"!==tt&&"paint"!==tt&&"filter"!==tt&&"metadata"!==tt&&"minzoom"!==tt&&"maxzoom"!==tt&&(0===tt.indexOf("paint.")?xo(je[tt],Le[tt],ve,Ne,tt.slice(6),In.setPaintProperty):ze(je[tt],Le[tt])||ve.push({command:In.setLayerProperty,args:[Ne,tt,Le[tt]]}));for(tt in Le)Le.hasOwnProperty(tt)&&!je.hasOwnProperty(tt)&&"layout"!==tt&&"paint"!==tt&&"filter"!==tt&&"metadata"!==tt&&"minzoom"!==tt&&"maxzoom"!==tt&&(0===tt.indexOf("paint.")?xo(je[tt],Le[tt],ve,Ne,tt.slice(6),In.setPaintProperty):ze(je[tt],Le[tt])||ve.push({command:In.setLayerProperty,args:[Ne,tt,Le[tt]]}))}else ve.push({command:In.removeLayer,args:[Ne]}),Je=De[De.lastIndexOf(Ne)+1],ve.push({command:In.addLayer,args:[Le,Je]})}($,w.layers,S)}catch(P){console.warn("Unable to compute style diff:",P),S=[{command:In.setStyle,args:[w]}]}return S}(this.serialize(),i).filter(x=>!(x.command in Xa));if(0===l.length)return!1;const m=l.filter(x=>!(x.command in Ya));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return l.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,l){return this.getImage(i)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,l),this._afterImageUpdated(i),this)}updateImage(i,l){this.imageManager.updateImage(i,l)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,l,m={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${i}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const x=Ke(i,l,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:x.serialize(),sourceId:i}));const w=S=>{const P=(S?"symbol:":"other:")+i,F=this._sourceCaches[P]=new c.SourceCache(P,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[i]=F,F.style=this,F.onAdd(this.map)};w(!1),"vector"!==l.type&&"geojson"!==l.type||w(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const l=this.getSource(i);if(!l)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new c.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new c.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getSource(i).setData(l),this._changed=!0}getSource(i){const l=this._getSourceCache(i);return l&&l.getSource()}addLayer(i,l,m={}){this._checkLoaded();const x=i.id;if(this.getLayer(x))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let w;if("custom"===i.type){if(Us(this,c.validateCustomStyleLayer(i)))return;w=c.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(x,i.source),i=c.clone$1(i),i=c.extend(i,{source:x})),this._validate(c.validateLayer,`layers.${x}`,i,{arrayIndex:-1},m))return;w=c.createStyleLayer(i),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const S=l?this._order.indexOf(l):this._order.length;if(l&&-1===S)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const P=this._getLayerSourceCache(w);if(this._removedLayers[x]&&w.source&&P&&"custom"!==w.type){const F=this._removedLayers[x];delete this._removedLayers[x],F.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",P.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,l){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===l)return;const m=this._order.indexOf(i);this._order.splice(m,1);const x=l?this._order.indexOf(l):this._order.length;l&&-1===x?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(x,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const l=this._layers[i];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=l,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,m){this._checkLoaded();const x=this.getLayer(i);x?x.minzoom===l&&x.maxzoom===m||(null!=l&&(x.minzoom=l),null!=m&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,l,m={}){this._checkLoaded();const x=this.getLayer(i);if(x){if(!ze(x.filter,l))return null==l?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(c.validateFilter,`layers.${x.id}.filter`,l,{layerType:x.type},m)||(x.filter=c.clone$1(l),this._updateLayer(x)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const l=this.getLayer(i);return l&&c.clone$1(l.filter)}setLayoutProperty(i,l,m,x={}){this._checkLoaded();const w=this.getLayer(i);w?ze(w.getLayoutProperty(l),m)||(w.setLayoutProperty(l,m,x),this._updateLayer(w)):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,l){const m=this.getLayer(i);if(m)return m.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,l,m,x={}){this._checkLoaded();const w=this.getLayer(i);w?ze(w.getPaintProperty(l),m)||(w.setPaintProperty(l,m,x)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,l){const m=this.getLayer(i);return m&&m.getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const m=i.source,x=i.sourceLayer,w=this.getSource(m);if(!w)return void this.fire(new c.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const S=w.type;if("geojson"===S&&x)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===S&&!x)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const P=this._getSourceCaches(m);for(const F of P)F.setFeatureState(x,i.id,l)}removeFeatureState(i,l){this._checkLoaded();const m=i.source,x=this.getSource(m);if(!x)return void this.fire(new c.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const w=x.type,S="vector"===w?i.sourceLayer:void 0;if("vector"===w&&!S)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const P=this._getSourceCaches(m);for(const F of P)F.removeFeatureState(S,i.id,l)}getFeatureState(i){this._checkLoaded();const l=i.source,m=i.sourceLayer,x=this.getSource(l);if(x){if("vector"!==x.type||m)return void 0===i.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(m,i.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();i[m.id]||(i[m.id]=m.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(i){this._updatedLayers[i.id]=!0;const l=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[i.source]="reload",l.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=S=>"fill-extrusion"===this._layers[S].type,m={},x=[];for(let S=this._order.length-1;S>=0;S--){const P=this._order[S];if(l(P)){m[P]=S;for(const F of i){const $=F[P];if($)for(const Z of $)x.push(Z)}}}x.sort((S,P)=>P.intersectionZ-S.intersectionZ);const w=[];for(let S=this._order.length-1;S>=0;S--){const P=this._order[S];if(l(P))for(let F=x.length-1;F>=0;F--){const $=x[F].feature;if(m[$.layer.id]<S)break;w.push($),x.pop()}else for(const F of i){const $=F[P];if($)for(const Z of $)w.push(Z.feature)}}return w}queryRenderedFeatures(i,l,m){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const x={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const F of l.layers){const $=this._layers[F];if(!$)return this.fire(new c.ErrorEvent(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];x[$.source]=!0}}const w=[];l.availableImages=this._availableImages;const S=l&&l.layers?l.layers.some(F=>{const $=this.getLayer(F);return $&&$.is3D()}):this.has3DLayers(),P=Ni.createFromScreenPoints(i,m);for(const F in this._sourceCaches){const $=this._sourceCaches[F].getSource().id;l.layers&&!x[$]||w.push(Ae(this._sourceCaches[F],this._layers,this._serializedLayers,P,l,m,S,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(F,$,Z,ne,se,ve,de){const me={},ge=ve.queryRenderedSymbols(ne),fe=[];for(const De of Object.keys(ge).map(Number))fe.push(de[De]);fe.sort(be);for(const De of fe){const we=De.featureIndex.lookupSymbolFeatures(ge[De.bucketInstanceId],$,De.bucketIndex,De.sourceLayerIndex,se.filter,se.layers,se.availableImages,F);for(const qe in we){const Ue=me[qe]=me[qe]||[],Ne=we[qe];Ne.sort((je,Le)=>{const Je=De.featureSortOrder;if(Je){const tt=Je.indexOf(je.featureIndex);return Je.indexOf(Le.featureIndex)-tt}return Le.featureIndex-je.featureIndex});for(const je of Ne)Ue.push(je)}}for(const De in me)me[De].forEach(we=>{const qe=we.feature,Ue=Z(F[De]).getFeatureState(qe.layer["source-layer"],qe.id);qe.source=qe.layer.source,qe.layer["source-layer"]&&(qe.sourceLayer=qe.layer["source-layer"]),qe.state=Ue});return me}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),P.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const m=this._getSourceCaches(i);let x=[];for(const w of m)x=x.concat(ye(w,l));return x}addSourceType(i,l,m){return qo.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(qo.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,l={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const S in i)if(!ze(i[S],m[S])){x=!0;break}if(!x)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,l),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,l=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof i.source){const m="terrain-dem-src";this.addSource(m,i.source),i=c.clone$1(i),i=c.extend(i,{source:m})}if(this._validate(c.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(i,l);else{const m=this.terrain,x=m.get();for(const w of Object.keys(c.spec.terrain))!i.hasOwnProperty(w)&&c.spec.terrain[w].default&&(i[w]=c.spec.terrain[w].default);for(const w in i)if(!ze(i[w],x[w])){m.set(i),this.stylesheet.terrain=i;const S=this._setTransitionParameters({duration:0});m.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new An(i,this.map.transform);this.stylesheet.fog=i;const m=this._setTransitionParameters({duration:0});l.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,m=l.get();0===Object.keys(i).length&&l.set(i);for(const x in i)if(!ze(i[x],m[x])){l.set(i),this.stylesheet.fog=i;const w=this._setTransitionParameters({duration:0});l.updateTransitions(w);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:c.exported.now(),transition:c.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),l=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const m=this.terrain=new It(i,l);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];"symbol"===l.type&&this._updateLayer(l)}}_validate(i,l,m,x,w={}){return(!w||!1!==w.validate)&&Us(this,i.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:m,styleSpec:c.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const l=this._getSourceCaches(i);for(const m of l)m.clearTiles()}_reloadSource(i){const l=this._getSourceCaches(i);for(const m of l)m.resume(),m.reload()}_updateSources(i){for(const l in this._sourceCaches)this._sourceCaches[l].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,m,x,w=!1){let S=!1,P=!1;const F={};for(const $ of this._order){const Z=this._layers[$];if("symbol"!==Z.type)continue;if(!F[Z.source]){const se=this._getLayerSourceCache(Z);if(!se)continue;F[Z.source]=se.getRenderableIds(!0).map(ve=>se.getTileByID(ve)).sort((ve,de)=>de.tileID.overscaledZ-ve.tileID.overscaledZ||(ve.tileID.isLessThan(de.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(Z,F[Z.source],i.center.lng,i.projection);S=S||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),i.zoom))&&(this.pauseablePlacement=new vs(i,this._order,w,l,m,x,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),P=!0),S&&this.pauseablePlacement.placement.setStale()),P||S)for(const $ of this._order){const Z=this._layers[$];"symbol"===Z.type&&this.placement.updateLayerOpacities(Z,F[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,l,m){this.imageManager.getImages(l.icons,m),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(l.tileID.key,l.type,l.icons)};x(this._otherSourceCaches[l.source]),x(this._symbolSourceCaches[l.source])}getGlyphs(i,l,m){this.glyphManager.getGlyphs(l.stacks,m)}getResource(i,l,m){return c.makeRequest(l,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){const l=this._getSourceCaches(i);return 0===l.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):l.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}qo.getSourceType=function(d){return We[d]},qo.setSourceType=function(d,i){We[d]=i},qo.registerForPluginStateChange=c.registerForPluginStateChange;var Co="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Aa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pa="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",bs="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Is="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Oa={},mr={};const Eo=[];xs(Co,Eo),xs(Pa,Eo),xs(bs,Eo),xs(Is,Eo),Oa=_i("",Pa),mr=_i(Is,bs);const Ra=_i("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ga=Co,rr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var yl={background:_i("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:_i("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:_i("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_i("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:_i("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:_i("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:_i("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:_i("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:_i("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:_i("uniform lowp vec3 u_lightpos;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvoid main() {vec4 color=v_color;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:_i("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_i("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:_i("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:_i("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:_i("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:_i("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:_i("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:_i("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:_i("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:_i("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:_i("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Aa),skyboxGradient:_i("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Aa),skyboxCapture:_i("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:_i("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:_i("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function xs(d,i){const l=d.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of l)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const w of x)i.includes(w)||i.push(w)}}function _i(d,i){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},w=[...Eo];return xs(d,w),xs(i,w),{fragmentSource:d=d.replace(l,(S,P,F,$,Z)=>(x[Z]=!0,"define"===P?`\n#ifndef HAS_UNIFORM_u_${Z}\nvarying ${F} ${$} ${Z};\n#else\nuniform ${F} ${$} u_${Z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Z}\n    ${F} ${$} ${Z} = u_${Z};\n#endif\n`)),vertexSource:i=i.replace(l,(S,P,F,$,Z)=>{const ne="float"===$?"vec2":"vec4",se=Z.match(/color/)?"color":ne;return x[Z]?"define"===P?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${F} ${ne} a_${Z};\nvarying ${F} ${$} ${Z};\n#else\nuniform ${F} ${$} u_${Z};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = a_${Z};\n#else\n    ${F} ${$} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = unpack_mix_${se}(a_${Z}, u_${Z}_t);\n#else\n    ${F} ${$} ${Z} = u_${Z};\n#endif\n`:"define"===P?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${F} ${ne} a_${Z};\n#else\nuniform ${F} ${$} u_${Z};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${F} ${$} ${Z} = a_${Z};\n#else\n    ${F} ${$} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${F} ${$} ${Z} = unpack_mix_${se}(a_${Z}, u_${Z}_t);\n#else\n    ${F} ${$} ${Z} = u_${Z};\n#endif\n`}),staticAttributes:m,usedDefines:w}}class uo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,m,x,w,S,P){this.context=i;let F=this.boundPaintVertexBuffers.length!==x.length;for(let Z=0;!F&&Z<x.length;Z++)this.boundPaintVertexBuffers[Z]!==x[Z]&&(F=!0);let $=this.boundDynamicVertexBuffers.length!==P.length;for(let Z=0;!$&&Z<P.length;Z++)this.boundDynamicVertexBuffers[Z]!==P[Z]&&($=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==m||F||$||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(l,m,x,w,S,P);else{i.bindVertexArrayOES.set(this.vao);for(const Z of P)Z&&Z.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(i,l,m,x,w,S){let P;const F=i.numAttributes,$=this.context,Z=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S;else{P=$.currentNumAttributes||0;for(let ne=F;ne<P;ne++)Z.disableVertexAttribArray(ne)}l.enableAttributes(Z,i),l.bind(),l.setVertexAttribPointers(Z,i,w);for(const ne of m)ne.enableAttributes(Z,i),ne.bind(),ne.setVertexAttribPointers(Z,i,w);for(const ne of S)ne&&(ne.enableAttributes(Z,i),ne.bind(),ne.setVertexAttribPointers(Z,i,w));x&&x.bind(),$.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ja(d,i){const l=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new c.MercatorCoordinate(0,m/l).toLngLat().lat,new c.MercatorCoordinate(0,(m+1)/l).toLngLat().lat]}function _a(d,i,l,m,x,w,S){const P=d.context,F=P.gl,$=l.fbo;if(!$)return;d.prepareDrawTile();const Z=d.useProgram("hillshade");P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,$.colorAttachment.get());const ne=((me,ge,fe,De)=>{const we=fe.paint.get("hillshade-shadow-color"),qe=fe.paint.get("hillshade-highlight-color"),Ue=fe.paint.get("hillshade-accent-color");let Ne=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===fe.paint.get("hillshade-illumination-anchor")&&(Ne-=me.transform.angle);const je=!me.options.moving;return{u_matrix:De||me.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),je),u_image:0,u_latrange:Ja(0,ge.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),Ne],u_shadow:we,u_highlight:qe,u_accent:Ue}})(d,l,m,d.terrain?i.projMatrix:null);d.prepareDrawProgram(P,Z,i.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:ve,tileBoundsSegments:de}=d.getTileBoundsBuffers(l);Z.draw(P,F.TRIANGLES,x,w,S,c.CullFaceMode.disabled,ne,m.id,se,ve,de)}function Ti(d,i,l){if(!i.needsDEMTextureUpload)return;const m=d.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(l.stride);const w=l.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new c.Texture(m,w,x.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Sr(d,i,l,m,x,w){const S=d.context,P=S.gl;if(!i.dem)return;const F=i.dem;if(S.activeTexture.set(P.TEXTURE1),Ti(d,i,F),!i.demTexture)return;i.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);const $=F.dim;S.activeTexture.set(P.TEXTURE0);let Z=i.fbo;if(!Z){const de=new c.Texture(S,{width:$,height:$,data:null},P.RGBA);de.bind(P.LINEAR,P.CLAMP_TO_EDGE),Z=i.fbo=S.createFramebuffer($,$,!0),Z.colorAttachment.set(de.texture)}S.bindFramebuffer.set(Z.framebuffer),S.viewport.set([0,0,$,$]);const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:se,tileBoundsSegments:ve}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(S,P.TRIANGLES,m,x,w,c.CullFaceMode.disabled,((de,me)=>{const ge=me.stride,fe=c.create();return c.ortho(fe,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(fe,fe,[0,-c.EXTENT,0]),{u_matrix:fe,u_image:1,u_dimension:[ge,ge],u_zoom:de.overscaledZ,u_unpack:me.unpackVector}})(i.tileID,F),l.id,ne,se,ve),i.needsHillshadePrepare=!1}const ya=d=>({u_matrix:new c.UniformMatrix4f(d),u_image0:new c.Uniform1i(d),u_skirt_height:new c.Uniform1f(d)}),As=(d,i)=>({u_matrix:d,u_image0:0,u_skirt_height:i}),li=(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:l,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:P,u_frustum_br:F,u_frustum_bl:$,u_globe_pos:Z,u_globe_radius:ne,u_viewport:se,u_grid_matrix:ve?Float32Array.from(ve):new Float32Array(9)});function Ka(d,i){return null!=d&&null!=i&&!(!d.hasData()||!i.hasData())&&null!=d.demTexture&&null!=i.demTexture&&d.tileID.key!==i.tileID.key}const Yo=new class{constructor(){this.operations={}}newMorphing(d,i,l,m,x){if(d in this.operations){const w=this.operations[d];w.to.tileID.key!==l.tileID.key&&(w.queued=l)}else this.operations[d]={startTime:m,phase:0,duration:x,from:i,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(const i in this.operations){const l=this.operations[i];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},ra={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function $c(d,i){const l=1<<d.z;return!i&&(0===d.x||d.x===l-1)||0===d.y||d.y===l-1}const fc=d=>({u_matrix:d});function rs(d,i,l,m,x){if(x>0){const w=c.exported.now(),S=(w-d.timeAdded)/x,P=i?(w-i.timeAdded)/x:-1,F=l.getSource(),$=m.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),Z=!i||Math.abs(i.tileID.overscaledZ-$)>Math.abs(d.tileID.overscaledZ-$),ne=Z&&d.refreshedUponExpiration?1:c.clamp(Z?S:1-P,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}class va extends c.SourceCache{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new Di(Rn(),null),x=Ke("mock-dem",l,m,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class Qa extends c.SourceCache{constructor(i){const l=Ke("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Di(Rn(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,m){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const P=new c.Tile(S,this._source.tileSize*S.overscaleFactor(),i.tileZoom);P.state="loaded",this._tiles[S.key]=P}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const l=this.proxyCachedFBO[i];if(void 0!==l){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Jt extends c.OverscaledTileID{constructor(i,l,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class Ei extends c.Elevation{constructor(i,l){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,w]=function(F){const $=new c.StructArrayLayout4i8,Z=new c.StructArrayLayout3ui6;$.reserve(17161),Z.reserve(33800);const se=c.EXTENT/128,ve=c.EXTENT+se/2,de=ve+se;for(let ge=-se;ge<de;ge+=se)for(let fe=-se;fe<de;fe+=se){const De=fe<0||fe>ve||ge<0||ge>ve?24575:0,we=c.clamp(Math.round(fe),0,c.EXTENT),qe=c.clamp(Math.round(ge),0,c.EXTENT);$.emplaceBack(we+De,qe,we,qe)}const me=(ge,fe)=>{const De=131*fe+ge;Z.emplaceBack(De+1,De,De+131),Z.emplaceBack(De+131,De+131+1,De+1)};for(let ge=1;ge<129;ge++)for(let fe=1;fe<129;fe++)me(fe,ge);return[0,129].forEach(ge=>{for(let fe=0;fe<130;fe++)me(fe,ge),me(ge,fe)}),[$,Z,32768]}(),S=i.context;this.gridBuffer=S.createVertexBuffer(m,c.boundsAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=c.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qa(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,0,c.EXTENT,0,c.EXTENT,0,1);const P=S.gl;this._overlapStencilMode=new c.StencilMode({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new va(l.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,l,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const x=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const w=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(l,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),l.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=l.getIds().map(F=>{const $=l.getTileByID(F).tileID;return $.projMatrix=m.calculateProjMatrix($.toUnwrapped()),$});(function(F,$){const Z=$.transform.pointCoordinate($.transform.getCameraPoint()),ne=new c.pointGeometry(Z.x,Z.y);F.sort((se,ve)=>{if(ve.overscaledZ-se.overscaledZ)return ve.overscaledZ-se.overscaledZ;const de=new c.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),me=new c.pointGeometry(ve.canonical.x+(1<<ve.canonical.z)*ve.wrap,ve.canonical.y),ge=ne.mult(1<<se.canonical.z);return ge.x-=.5,ge.y-=.5,ge.distSqr(de)-ge.distSqr(me)})})(x,this.painter),this._previousZoom=m.zoom;const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const F in S){const $=S[F];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,i[F],w),$.usedForTerrain))continue;const Z=i[F];$.getSource().reparseOverscaled&&this._assignTerrainTiles(Z)}this.proxiedCoords[l.id]=x.map(F=>new Jt(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const P={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const $=this.terrainTileForTile[F.key];if(!$)continue;const Z=$.tileID.key;Z in P||(this._visibleDemTiles.push($),P[Z]=Z)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),Ti(this.painter,x,w))}}_prepareDemTileUniforms(i,l,m,x){if(!l||null==l.demTexture)return!1;const w=i.tileID.canonical,S=Math.pow(2,l.tileID.canonical.z-w.z),P=x||"";return m[`u_dem_tl${P}`]=[w.x*S%1,w.y*S%1],m[`u_dem_scale${P}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,l=i.gl;if(!this._emptyDepthBufferTexture){const m=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(i,m,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const l=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const w=x.dem.tree.minimums[0];return w>0&&i++,m+w},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new c.Texture(i,x,l.RGBA,{premultiply:!1}),w}setupElevationDraw(i,l,m){const x=this.painter.context,w=x.gl,S=(P=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(P),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var P;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();const F=this.painter.transform,$=F.projection,Z=i.tileID.canonical;S.u_tile_tl_up=$.upVector(Z,0,0),S.u_tile_tr_up=$.upVector(Z,c.EXTENT,0),S.u_tile_br_up=$.upVector(Z,c.EXTENT,c.EXTENT),S.u_tile_bl_up=$.upVector(Z,0,c.EXTENT),S.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?c.GLOBE_METERS_TO_ECEF:$.upVectorScale(Z,F.center.lat,F.worldSize).metersToTile;let ne=null,se=null,ve=1;if(m&&m.morphing&&this._useVertexMorphing){const de=m.morphing.srcDemTile,me=m.morphing.dstDemTile;ve=m.morphing.phase,de&&me&&(this._prepareDemTileUniforms(i,de,S,"_prev")&&(se=de),this._prepareDemTileUniforms(i,me,S)&&(ne=me))}if(se&&ne?(x.activeTexture.set(w.TEXTURE2),ne.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),x.activeTexture.set(w.TEXTURE4),se.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),S.u_dem_lerp=ve):(ne=this.terrainTileForTile[i.tileID.key],x.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(i,ne,S)?ne.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&ne){const de=(1<<ne.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=de}m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(x,S)}renderToBackBuffer(i){const l=this.painter,m=this.painter.context;0!==i.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,S,P,F){if("globe"===x.transform.projection.name)!function($,Z,ne,se,ve){const de=$.context,me=de.gl;let ge,fe;const De=$.options.showTerrainWireframe?2:0,we=$.transform,qe=c.globeUseCustomAntiAliasing($,de,we),Ue=(un,_t)=>{if(fe===un)return;const en=[ra[un],"PROJECTION_GLOBE_VIEW"];qe&&en.push("CUSTOM_ANTIALIASING"),_t&&en.push(ra[De]),ge=$.useProgram("globeRaster",null,en),fe=un},Ne=$.colorModeForRenderPass(),je=new c.DepthMode(me.LEQUAL,c.DepthMode.ReadWrite,$.depthRangeFor3D);Yo.update(ve);const Le=c.calculateGlobeMercatorMatrix(we),Je=[c.mercatorXfromLng(we.center.lng),c.mercatorYfromLat(we.center.lat)],tt=De?[!1,!0]:[!1],nn=$.globeSharedBuffers,rt=[we.width*c.exported.devicePixelRatio,we.height*c.exported.devicePixelRatio],Pt=Float32Array.from(we.globeMatrix),Bt={useDenormalizedUpVectorScale:!0};if(tt.forEach(un=>{fe=-1;const _t=un?me.LINES:me.TRIANGLES;for(const en of se){const kt=ne.getTile(en),yn=c.StencilMode.disabled,fn=Z.prevTerrainTileForTile[en.key],Fn=Z.terrainTileForTile[en.key];Ka(fn,Fn)&&Yo.newMorphing(en.key,fn,Fn,ve,250),de.activeTexture.set(me.TEXTURE0),kt.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE);const $n=Yo.getMorphValuesForProxy(en.key),ci=$n?1:0;$n&&c.extend$1(Bt,{morphing:{srcDemTile:$n.from,dstDemTile:$n.to,phase:c.easeCubicInOut($n.phase)}});const Fi=c.tileCornersToBounds(en.canonical),Bn=c.getLatitudinalLod(Fi.getCenter().lat),mi=c.getGridMatrix(en.canonical,Fi,Bn),ji=c.globeNormalizeECEF(c.globeTileBounds(en.canonical)),Br=li(we.projMatrix,Pt,Le,ji,c.globeToMercatorTransition(we.zoom),Je,we.frustumCorners.TL,we.frustumCorners.TR,we.frustumCorners.BR,we.frustumCorners.BL,we.globeCenterInViewSpace,we.globeRadius,rt,mi);if(Ue(ci,un),Z.setupElevationDraw(kt,ge,Bt),$.prepareDrawProgram(de,ge,en.toUnwrapped()),nn){const[fo,gr,Ts]=un?nn.getWirefameBuffers($.context,Bn):nn.getGridBuffers(Bn);ge.draw(de,_t,je,yn,Ne,c.CullFaceMode.backCCW,Br,"globe_raster",fo,gr,Ts)}}}),nn){const un=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];qe&&un.push("CUSTOM_ANTIALIASING"),ge=$.useProgram("globeRaster",null,un);for(const _t of se){const{x:en,y:kt,z:yn}=_t.canonical,fn=0===kt,Fn=kt===(1<<yn)-1,[$n,ci,Fi,Bn]=nn.getPoleBuffers(yn);if(Bn&&(fn||Fn)){const mi=ne.getTile(_t);de.activeTexture.set(me.TEXTURE0),mi.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE);let ji=c.globePoleMatrixForTile(yn,en,we);const Br=c.globeNormalizeECEF(c.globeTileBounds(_t.canonical)),fo=(gr,Ts)=>gr.draw(de,me.TRIANGLES,je,c.StencilMode.disabled,Ne,c.CullFaceMode.disabled,li(we.projMatrix,ji,ji,Br,0,Je,we.frustumCorners.TL,we.frustumCorners.TR,we.frustumCorners.BR,we.frustumCorners.BL,we.globeCenterInViewSpace,we.globeRadius,rt),"globe_pole_raster",Ts,Fi,Bn);Z.setupElevationDraw(mi,ge,Bt),$.prepareDrawProgram(de,ge,_t.toUnwrapped()),fn&&fo(ge,$n),Fn&&(ji=c.scale(c.create(),ji,[1,-1,1]),fo(ge,ci))}}}}(x,w,S,P,F);else{const $=x.context,Z=$.gl;let ne,se;const ve=x.options.showTerrainWireframe?2:0,de=(we,qe)=>{if(se===we)return;const Ue=[ra[we]];qe&&Ue.push(ra[ve]),ne=x.useProgram("terrainRaster",null,Ue),se=we},me=x.colorModeForRenderPass(),ge=new c.DepthMode(Z.LEQUAL,c.DepthMode.ReadWrite,x.depthRangeFor3D);Yo.update(F);const fe=x.transform,De=6*Math.pow(1.5,22-fe.zoom)*w.exaggeration();(ve?[!1,!0]:[!1]).forEach(we=>{se=-1;const qe=we?Z.LINES:Z.TRIANGLES,[Ue,Ne]=we?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const je of P){const Le=S.getTile(je),Je=c.StencilMode.disabled,tt=w.prevTerrainTileForTile[je.key],nn=w.terrainTileForTile[je.key];Ka(tt,nn)&&Yo.newMorphing(je.key,tt,nn,F,250),$.activeTexture.set(Z.TEXTURE0),Le.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST);const rt=Yo.getMorphValuesForProxy(je.key),Pt=rt?1:0;let Bt;rt&&(Bt={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:c.easeCubicInOut(rt.phase)}});const un=As(je.projMatrix,$c(je.canonical,fe.renderWorldCopies)?De/10:De);de(Pt,we),w.setupElevationDraw(Le,ne,Bt),x.prepareDrawProgram($,ne,je.toUnwrapped()),ne.draw($,qe,ge,Je,me,c.CullFaceMode.backCCW,un,"terrain_raster",w.gridBuffer,Ue,Ne)}})}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),P=[],F=l.style.order;let $=0;for(const Z of w){const ne=x.getTileByID(Z.proxyTileKey),se=x.proxyCachedFBO[Z.key]?x.proxyCachedFBO[Z.key][i]:void 0,ve=void 0!==se?x.renderCache[se]:this.pool[$++],de=void 0!==se;if(ne.texture=ve.tex,de&&!ve.dirty){P.push(ne.tileID);continue}let me;m.bindFramebuffer.set(ve.fb.framebuffer),this.renderedToTile=!1,ve.dirty&&(m.clear({color:c.Color.transparent,stencil:0}),ve.dirty=!1);for(let ge=S.start;ge<=S.end;++ge){const fe=l.style._layers[F[ge]];if(fe.isHidden(l.transform.zoom))continue;const De=l.style._getLayerSourceCache(fe),we=De?this.proxyToSource[Z.key][De.id]:[Z];if(!we)continue;const qe=we;m.viewport.set([0,0,ve.fb.width,ve.fb.height]),me!==(De?De.id:null)&&(this._setupStencil(ve,we,fe,De),me=De?De.id:null),l.renderLayer(l,De,fe,qe)}this.renderedToTile?(ve.dirty=!0,P.push(ne.tileID)):de||--$,5===$&&($=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),S.end+1}postRender(){}renderCacheEfficiency(i){const l=i.order.length;if(0===l)return{efficiency:100};let m,x=0,w=0,S=!1;for(let P=0;P<l;++P){const F=i._layers[i.order[P]];this._style.isLayerDraped(F)?(S&&++x,++w):S||(S=!0,m=F.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-x/w),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,l,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,P=1<<S.overscaledZ,{x:F,y:$}=S.canonical,Z=F/P,ne=(F+1)/P,se=$/P,ve=($+1)/P;return{minx:Z,miny:se,maxx:ne,maxy:ve,t:w.dem.tree.raycastRoot(Z,se,ne,ve,i,l,m),tile:w}});x.sort((w,S)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==S.t?S.t:Number.MAX_VALUE));for(const w of x){if(null==w.t)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,l,m);if(null!=S)return S}return null}_createFBO(){const i=this.painter.context,l=i.gl,m=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const x=new c.Texture(i,{width:m[0],height:m[1],data:null},l.RGBA);x.bind(l.LINEAR,l.CLAMP_TO_EDGE);const w=i.createFramebuffer(m[0],m[1],!1);return w.colorAttachment.set(x.texture),w.depthAttachment=new te(i,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._layers[i],m=l.isHidden(this.painter.transform.zoom),x=l.getCrossfadeParameters(),w=!!x&&1!==x.t,S=l.hasTransition();return"custom"!==l.type&&!m&&(w||S)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof Se){i=!0;break}if(i)for(let l=0;l<this._style.order.length;++l){const m=this._style._layers[this._style.order[l]],x=m.isHidden(this.painter.transform.zoom),w=this._style._getLayerSourceCache(m);if("raster"!==m.type||x||!w)continue;const S=m.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const F=this.proxyToSource[P.key][w.id];if(F)for(const $ of F){const Z=rs(w.getTile($),w.findLoadedParent($,0),w,this.painter.transform,S);(1!==Z.opacity||0!==Z.mix)&&this._clearRenderCacheForTile(w.id,$)}}}}_setupDrapedRenderBatches(){const i=this._style.order,l=i.length;if(0===l)return;const m=[];let x,w=0,S=this._style._layers[i[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<l;)S=this._style._layers[i[w]];for(;w<l;++w){const P=this._style._layers[i[w]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?void 0===x&&(x=w):void 0!==x&&(m.push({start:x,end:w-1}),x=void 0))}void 0!==x&&m.push({start:x,end:w-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const S=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let P=0;P<S.length;++P){const F=Object.values(S[P]);l.renderCachePool.push(...F)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const P=m[S];if(l.getTileByID(P.key),void 0!==l.proxyCachedFBO[P.key]){const F=i[P.key],$=this.proxyToSource[P.key];let Z=0;for(const ne in $){const se=$[ne],ve=F[ne];if(!ve||ve.length!==se.length||se.some((de,me)=>de!==ve[me]||x[ne]&&x[ne].hasOwnProperty(de.key))){Z=-1;break}++Z}for(const ne in l.proxyCachedFBO[P.key])l.renderCache[l.proxyCachedFBO[P.key][ne]].dirty=Z<0||Z!==Object.values(F).length}}const w=[...this._drapedRenderBatches];w.sort((S,P)=>P.end-P.start-(S.end-S.start));for(const S of w)for(const P of m){if(l.proxyCachedFBO[P.key])continue;let F=l.renderCachePool.pop();void 0===F&&l.renderCache.length<50&&(F=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==F&&(l.proxyCachedFBO[P.key]={},l.proxyCachedFBO[P.key][S.start]=F,l.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let P;if(m.isTileClipped())P=l.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(i,l){const m=this.painter,x=this.painter.context,w=x.gl;m._tileClippingMaskIDs={},x.setColorMode(c.ColorMode.disabled),x.setDepthMode(c.DepthMode.disabled);const S=m.useProgram("clippingMask");for(const P of i){const F=m._tileClippingMaskIDs[P.key]=--l;S.draw(x,w.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:w.ALWAYS,mask:0},F,255,w.KEEP,w.KEEP,w.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,fc(P.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const m=[i.x,i.y,1,1];c.transformMat4$1(m,m,l.pixelMatrixInverse),c.scale$1(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const x=l._camera.position,w=c.mercatorZfromAltitude(1,l.center.lat),S=[x[0],x[1],x[2]/w,0],P=c.subtract([],m.slice(0,3),S);c.normalize(P,P);const F=this.raycast(S,P,this._exaggeration);return null!==F&&F?(c.scaleAndAdd(S,S,P,F),S[3]=S[2],S[2]*=w,S):null}drawDepth(){const i=this.painter,l=i.context,m=this.proxySourceCache,x=Math.ceil(i.width),w=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=l.gl,P=l.createFramebuffer(x,w,!0);l.activeTexture.set(S.TEXTURE0);const F=new c.Texture(l,{width:x,height:w,data:null},S.RGBA);F.bind(S.NEAREST,S.CLAMP_TO_EDGE),P.colorAttachment.set(F.texture);const $=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,x,w);P.depthAttachment.set($),this._depthFBO=P,this._depthTexture=F}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,x,w]),function(S,P,F,$){if("globe"===S.transform.projection.name)return;const Z=S.context,ne=Z.gl;Z.clear({depth:1});const se=S.useProgram("terrainDepth"),ve=new c.DepthMode(ne.LESS,c.DepthMode.ReadWrite,S.depthRangeFor3D);for(const de of $){const me=F.getTile(de),ge=As(de.projMatrix,0);P.setupElevationDraw(me,se),se.draw(Z,ne.TRIANGLES,ve,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,ge,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,l,m){if(i.getSource()instanceof et)return this._setupProxiedCoordsForImageSource(i,l,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let P=0;P<w.length;P++){const F=w[P],$=this._findTileCoveringTileID(F,i);if($){const Z=this._createProxiedId(F,$,m[F.key]&&m[F.key][i.id]);x.push(Z),this.proxyToSource[F.key][i.id]=[Z]}}let S=!1;for(let P=0;P<l.length;P++){const F=i.getTile(l[P]);if(!F||!F.hasData())continue;const $=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==F.tileID.canonical.z){const Z=this.proxyToSource[$.tileID.key][i.id],ne=this._createProxiedId($.tileID,F,m[$.tileID.key]&&m[$.tileID.key][i.id]);Z?Z.splice(Z.length-1,0,ne):this.proxyToSource[$.tileID.key][i.id]=[ne],x.push(ne),S=!0}}this._sourceTilesOverlap[i.id]=S}_setupProxiedCoordsForImageSource(i,l,m){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords,S=i.getSource(),P=new c.pointGeometry(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),F=S.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((Z,ne)=>(Z.min.x=Math.min(Z.min.x,ne.x-P.x),Z.min.y=Math.min(Z.min.y,ne.y-P.y),Z.max.x=Math.max(Z.max.x,ne.x-P.x),Z.max.y=Math.max(Z.max.y,ne.y-P.y),Z),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(Z,ne)=>{const se=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ve=Z.canonical.y/(1<<Z.canonical.z),de=c.EXTENT/(1<<Z.canonical.z),me=ne.wrap+ne.canonical.x/(1<<ne.canonical.z),ge=ne.canonical.y/(1<<ne.canonical.z);return se+de<me+F.min.x||se>me+F.max.x||ve+de<ge+F.min.y||ve>ge+F.max.y};for(let Z=0;Z<w.length;Z++){const ne=w[Z];for(let se=0;se<l.length;se++){const ve=i.getTile(l[se]);if(!ve||!ve.hasData()||$(ne,ve.tileID))continue;const de=this._createProxiedId(ne,ve,m[ne.key]&&m[ne.key][i.id]),me=this.proxyToSource[ne.key][i.id];me?me.push(de):this.proxyToSource[ne.key][i.id]=[de],x.push(de)}}}_createProxiedId(i,l,m){let x=this.orthoMatrix;if(m){const w=m.find(S=>S.key===l.tileID.key);if(w)return w}if(l.tileID.key!==i.key){const w=i.canonical.z-l.tileID.canonical.z;let S,P,F;x=c.create();const $=l.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(S=c.EXTENT>>w,P=S*((l.tileID.canonical.x<<w)-i.canonical.x+$),F=S*((l.tileID.canonical.y<<w)-i.canonical.y)):(S=c.EXTENT<<-w,P=c.EXTENT*(l.tileID.canonical.x-(i.canonical.x+$<<-w)),F=c.EXTENT*(l.tileID.canonical.y-(i.canonical.y<<-w))),c.ortho(x,0,S,0,S,0,1),c.translate(x,x,[P,F,0])}return new Jt(l.tileID,i.key,x)}_findTileCoveringTileID(i,l){let m=l.getTile(i);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[l.id],w=x[i.key];if(m=w?l.getTileByID(w):null,m&&m.hasData()||null===w)return m;let S=m?m.tileID:i,P=S.overscaledZ;const F=l.getSource().minzoom,$=[];if(!w){const ne=l.getSource().maxzoom;if(i.canonical.z>=ne){const se=i.canonical.z-ne;l.getSource().reparseOverscaled?(P=Math.max(i.canonical.z+2,l.transform.tileZoom),S=new c.OverscaledTileID(P,i.wrap,ne,i.canonical.x>>se,i.canonical.y>>se)):0!==se&&(P=ne,S=new c.OverscaledTileID(P,i.wrap,ne,i.canonical.x>>se,i.canonical.y>>se))}S.key!==i.key&&($.push(S.key),m=l.getTile(S))}const Z=ne=>{$.forEach(se=>{x[se]=ne}),$.length=0};for(P-=1;P>=F&&(!m||!m.hasData());P--){m&&Z(m.tileID.key);const ne=S.calculateScaledKey(P);if(m=l.getTileByID(ne),m&&m.hasData())break;const se=x[ne];if(null===se)break;void 0===se?$.push(ne):m=l.getTileByID(se)}return Z(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(l){let m=0;const x=new c.StructArrayLayout2ui4,w=131;for(let S=1;S<129;S++){for(let P=1;P<129;P++)m=S*w+P,x.emplaceBack(m,m+1),x.emplaceBack(m,m+w),x.emplaceBack(m+1,m+w),128===S&&x.emplaceBack(m+w,m+w+1);x.emplaceBack(m+1,m+1+w)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ba{static cacheKey(i,l,m,x){let w=`${l}${x?x.cacheKey:""}`;for(const S of m)i.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(i,l,m,x,w,S){const P=i.gl;this.program=P.createProgram();const F=function(ge){const fe=[];for(let De=0;De<ge.length;De++){if(null===ge[De])continue;const we=ge[De].split(" ");fe.push(we.pop())}return fe}(m.staticAttributes),$=x?x.getBinderAttributes():[],Z=F.concat($);let ne=x?x.defines():[];ne=ne.concat(S.map(ge=>`#define ${ge}`));const se=ne.concat(i.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(rr):rr,rr,ga,Ra.fragmentSource,mr.fragmentSource,m.fragmentSource).join("\n"),ve=ne.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ga,Ra.vertexSource,mr.vertexSource,Oa.vertexSource,m.vertexSource).join("\n"),de=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(de,se),P.compileShader(de),P.attachShader(this.program,de);const me=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(me,ve),P.compileShader(me),P.attachShader(this.program,me),this.attributes={},this.numAttributes=Z.length;for(let ge=0;ge<this.numAttributes;ge++)Z[ge]&&(P.bindAttribLocation(this.program,ge,Z[ge]),this.attributes[Z[ge]]=ge);P.linkProgram(this.program),P.deleteShader(me),P.deleteShader(de),this.fixedUniforms=w(i),this.binderUniforms=x?x.getUniforms(i):[],-1!==S.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(ge=i),u_dem_prev:new c.Uniform1i(ge),u_dem_unpack:new c.Uniform4f(ge),u_dem_tl:new c.Uniform2f(ge),u_dem_scale:new c.Uniform1f(ge),u_dem_tl_prev:new c.Uniform2f(ge),u_dem_scale_prev:new c.Uniform1f(ge),u_dem_size:new c.Uniform1f(ge),u_dem_lerp:new c.Uniform1f(ge),u_exaggeration:new c.Uniform1f(ge),u_depth:new c.Uniform1i(ge),u_depth_size_inv:new c.Uniform2f(ge),u_meter_to_dem:new c.Uniform1f(ge),u_label_plane_matrix_inv:new c.UniformMatrix4f(ge),u_tile_tl_up:new c.Uniform3f(ge),u_tile_tr_up:new c.Uniform3f(ge),u_tile_br_up:new c.Uniform3f(ge),u_tile_bl_up:new c.Uniform3f(ge),u_tile_up_scale:new c.Uniform1f(ge)}),-1!==S.indexOf("FOG")&&(this.fogUniforms=(ge=>({u_fog_matrix:new c.UniformMatrix4f(ge),u_fog_range:new c.Uniform2f(ge),u_fog_color:new c.Uniform4f(ge),u_fog_horizon_blend:new c.Uniform1f(ge),u_fog_temporal_offset:new c.Uniform1f(ge),u_frustum_tl:new c.Uniform3f(ge),u_frustum_tr:new c.Uniform3f(ge),u_frustum_br:new c.Uniform3f(ge),u_frustum_bl:new c.Uniform3f(ge),u_globe_pos:new c.Uniform3f(ge),u_globe_radius:new c.Uniform1f(ge),u_globe_transition:new c.Uniform1f(ge),u_is_globe:new c.Uniform1i(ge),u_viewport:new c.Uniform2f(ge)}))(i))}var ge}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}}draw(i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me){const ge=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(x),i.setColorMode(w),i.setCullFace(S);for(const De of Object.keys(this.fixedUniforms))this.fixedUniforms[De].set(this.program,De,P[De]);de&&de.setUniforms(this.program,i,this.binderUniforms,se,{zoom:ve});const fe={[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[l];for(const De of ne.get()){const we=De.vaos||(De.vaos={});(we[F]||(we[F]=new uo)).bind(i,this,$,de?de.getPaintVertexBuffers():[],Z,De.vertexOffset,me||[]),ge.drawElements(l,De.primitiveLength*fe,ge.UNSIGNED_SHORT,De.primitiveOffset*fe*2)}}}function el(d,i,l){const m=1/Kn(l,1,i.transform.tileZoom),x=Math.pow(2,l.tileID.overscaledZ),w=l.tileSize*Math.pow(2,i.transform.tileZoom)/x,S=w*(l.tileID.canonical.x+l.tileID.wrap*x),P=w*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[m,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[S>>16,P>>16],u_pixel_coord_lower:[65535&S,65535&P]}}const Lr=c.create(),Na=(d,i,l,m,x,w,S,P,F,$,Z)=>{const ne=i.style.light,se=ne.properties.get("position"),ve=[se.x,se.y,se.z],de=c.create$1();"viewport"===ne.properties.get("anchor")&&(c.fromRotation(de,-i.transform.angle),c.transformMat3(ve,ve,de));const me=ne.properties.get("color"),ge=i.transform,fe={u_matrix:d,u_lightpos:ve,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_vertical_gradient:+l,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w};return"globe"===ge.projection.name&&(fe.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],fe.u_zoom_transition=F,fe.u_inv_rot_matrix=Z,fe.u_merc_center=$,fe.u_up_dir=ge.projection.upVector(new c.CanonicalTileID(0,0,0),$[0]*c.EXTENT,$[1]*c.EXTENT),fe.u_height_lift=P),fe},xa=(d,i,l,m,x,w,S,P,F,$,Z,ne,se)=>{const ve=Na(d,i,l,m,x,w,S,$,Z,ne,se),de={u_height_factor:-Math.pow(2,S.overscaledZ)/F.tileSize/8};return c.extend(ve,el(P,i,F),de)},Bo=d=>({u_matrix:d}),J=(d,i,l,m)=>c.extend(Bo(d),el(l,i,m)),q=(d,i)=>({u_matrix:d,u_world:i}),G=(d,i,l,m,x)=>c.extend(J(d,i,l,m),{u_world:x}),ue=c.create(),gt=(d,i,l,m,x,w)=>{const S=d.transform,P="globe"===S.projection.name;let F;if("map"===w.paint.get("circle-pitch-alignment"))if(P){const Z=c.globePixelsToTileUnits(S.zoom,i.canonical)*S._pixelsPerMercatorPixel;F=Float32Array.from([Z,0,0,Z])}else F=S.calculatePixelsToTileUnitsMatrix(l);else F=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const $={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:d.translatePosMatrix(i.projMatrix,l,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:F,u_inv_rot_matrix:ue,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){$.u_inv_rot_matrix=m,$.u_merc_center=x,$.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],$.u_zoom_transition=c.globeToMercatorTransition(S.zoom);const Z=x[0]*c.EXTENT,ne=x[1]*c.EXTENT;$.u_up_dir=S.projection.upVector(new c.CanonicalTileID(0,0,0),Z,ne)}return $},On=d=>{const i=[];return"map"===d.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Mi=(d,i,l,m)=>{const x=c.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},to=(d,i,l=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:l}),Ps=c.create(),ws=(d,i,l,m,x,w,S)=>{const P=d.transform,F="globe"===P.projection.name,$=F?c.globePixelsToTileUnits(P.zoom,i.canonical)*P._pixelsPerMercatorPixel:Kn(l,1,w),Z={u_matrix:i.projMatrix,u_extrude_scale:$,u_intensity:S,u_inv_rot_matrix:Ps,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){Z.u_inv_rot_matrix=m,Z.u_merc_center=x,Z.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],Z.u_zoom_transition=c.globeToMercatorTransition(P.zoom);const ne=x[0]*c.EXTENT,se=x[1]*c.EXTENT;Z.u_up_dir=P.projection.upVector(new c.CanonicalTileID(0,0,0),ne,se)}return Z},Oo=(d,i,l,m,x,w,S,P)=>{const F=d.transform,$=F.calculatePixelsToTileUnitsMatrix(i),Z={u_matrix:_u(d,i,l,x),u_pixels_to_tile_units:$,u_device_pixel_ratio:S,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:P};if(Nl(l)){const ne=ka(i,d.transform);Z.u_texsize=i.lineAtlasTexture.size,Z.u_scale=[ne,m.fromScale,m.toScale],Z.u_mix=m.t}return Z},Rl=(d,i,l,m,x,w)=>{const S=d.transform,P=ka(i,S);return{u_matrix:_u(d,i,l,x),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:w,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ka(d,i){return 1/Kn(d,1,i.tileZoom)}function _u(d,i,l,m){return d.translatePosMatrix(m||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Nl(d){const i=d.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const kl=(d,i,l,m,x,w)=>{return{u_matrix:d,u_tl_parent:i,u_scale_parent:l,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(P=x.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:vl(x.paint.get("raster-hue-rotate")),u_perspective_transform:w};var S,P};function vl(d){d*=Math.PI/180;const i=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const Fl=c.create(),bl=(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me)=>{const ge=x.transform,fe={u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ge.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:ge.width/ge.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:P,u_is_text:+F,u_pitch_with_map:+m,u_texsize:$,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Fl,u_up_vector:[0,-1,0]};return"globe"===me.name&&(fe.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],fe.u_zoom_transition=ne,fe.u_inv_rot_matrix=ve,fe.u_merc_center=se,fe.u_camera_forward=ge._camera.forward(),fe.u_ecef_origin=c.globeECEFOrigin(ge.globeMatrix,Z.toUnwrapped()),fe.u_tile_matrix=Float32Array.from(ge.globeMatrix),fe.u_up_vector=de),fe},Ll=(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me,ge)=>c.extend(bl(d,i,l,m,x,w,S,P,F,$,ne,se,ve,de,me,ge),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+Z}),oa=(d,i,l,m,x,w,S,P,F,$,Z,ne,se,ve,de,me)=>c.extend(Ll(d,i,l,m,x,w,S,P,!0,F,!0,Z,ne,se,ve,de,me),{u_texsize_icon:$,u_texture_icon:1}),j=(d,i,l)=>({u_matrix:d,u_opacity:i,u_color:l}),ie=(d,i,l,m,x,w)=>c.extend(function(S,P,F,$){const Z=F.imageManager.getPattern(S.from.toString()),ne=F.imageManager.getPattern(S.to.toString()),{width:se,height:ve}=F.imageManager.getPixelSize(),de=Math.pow(2,$.tileID.overscaledZ),me=$.tileSize*Math.pow(2,F.transform.tileZoom)/de,ge=me*($.tileID.canonical.x+$.tileID.wrap*de),fe=me*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:ne.tl,u_pattern_br_b:ne.br,u_texsize:[se,ve],u_mix:P.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:ne.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/Kn($,1,F.transform.tileZoom),u_pixel_coord_upper:[ge>>16,fe>>16],u_pixel_coord_lower:[65535&ge,65535&fe]}}(m,w,l,x),{u_matrix:d,u_opacity:i}),H={fillExtrusion:d=>({u_matrix:new c.UniformMatrix4f(d),u_lightpos:new c.Uniform3f(d),u_lightintensity:new c.Uniform1f(d),u_lightcolor:new c.Uniform3f(d),u_vertical_gradient:new c.Uniform1f(d),u_opacity:new c.Uniform1f(d),u_edge_radius:new c.Uniform1f(d),u_ao:new c.Uniform2f(d),u_tile_id:new c.Uniform3f(d),u_zoom_transition:new c.Uniform1f(d),u_inv_rot_matrix:new c.UniformMatrix4f(d),u_merc_center:new c.Uniform2f(d),u_up_dir:new c.Uniform3f(d),u_height_lift:new c.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new c.UniformMatrix4f(d),u_lightpos:new c.Uniform3f(d),u_lightintensity:new c.Uniform1f(d),u_lightcolor:new c.Uniform3f(d),u_vertical_gradient:new c.Uniform1f(d),u_height_factor:new c.Uniform1f(d),u_edge_radius:new c.Uniform1f(d),u_ao:new c.Uniform2f(d),u_tile_id:new c.Uniform3f(d),u_zoom_transition:new c.Uniform1f(d),u_inv_rot_matrix:new c.UniformMatrix4f(d),u_merc_center:new c.Uniform2f(d),u_up_dir:new c.Uniform3f(d),u_height_lift:new c.Uniform1f(d),u_image:new c.Uniform1i(d),u_texsize:new c.Uniform2f(d),u_pixel_coord_upper:new c.Uniform2f(d),u_pixel_coord_lower:new c.Uniform2f(d),u_scale:new c.Uniform3f(d),u_fade:new c.Uniform1f(d),u_opacity:new c.Uniform1f(d)}),fill:d=>({u_matrix:new c.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new c.UniformMatrix4f(d),u_image:new c.Uniform1i(d),u_texsize:new c.Uniform2f(d),u_pixel_coord_upper:new c.Uniform2f(d),u_pixel_coord_lower:new c.Uniform2f(d),u_scale:new c.Uniform3f(d),u_fade:new c.Uniform1f(d)}),fillOutline:d=>({u_matrix:new c.UniformMatrix4f(d),u_world:new c.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new c.UniformMatrix4f(d),u_world:new c.Uniform2f(d),u_image:new c.Uniform1i(d),u_texsize:new c.Uniform2f(d),u_pixel_coord_upper:new c.Uniform2f(d),u_pixel_coord_lower:new c.Uniform2f(d),u_scale:new c.Uniform3f(d),u_fade:new c.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new c.Uniform1f(d),u_extrude_scale:new c.UniformMatrix2f(d),u_device_pixel_ratio:new c.Uniform1f(d),u_matrix:new c.UniformMatrix4f(d),u_inv_rot_matrix:new c.UniformMatrix4f(d),u_merc_center:new c.Uniform2f(d),u_tile_id:new c.Uniform3f(d),u_zoom_transition:new c.Uniform1f(d),u_up_dir:new c.Uniform3f(d)}),collisionBox:d=>({u_matrix:new c.UniformMatrix4f(d),u_camera_to_center_distance:new c.Uniform1f(d),u_extrude_scale:new c.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new c.UniformMatrix4f(d),u_inv_matrix:new c.UniformMatrix4f(d),u_camera_to_center_distance:new c.Uniform1f(d),u_viewport_size:new c.Uniform2f(d)}),debug:d=>({u_color:new c.UniformColor(d),u_matrix:new c.UniformMatrix4f(d),u_overlay:new c.Uniform1i(d),u_overlay_scale:new c.Uniform1f(d)}),clippingMask:d=>({u_matrix:new c.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new c.Uniform1f(d),u_intensity:new c.Uniform1f(d),u_matrix:new c.UniformMatrix4f(d),u_inv_rot_matrix:new c.UniformMatrix4f(d),u_merc_center:new c.Uniform2f(d),u_tile_id:new c.Uniform3f(d),u_zoom_transition:new c.Uniform1f(d),u_up_dir:new c.Uniform3f(d)}),heatmapTexture:d=>({u_image:new c.Uniform1i(d),u_color_ramp:new c.Uniform1i(d),u_opacity:new c.Uniform1f(d)}),hillshade:d=>({u_matrix:new c.UniformMatrix4f(d),u_image:new c.Uniform1i(d),u_latrange:new c.Uniform2f(d),u_light:new c.Uniform2f(d),u_shadow:new c.UniformColor(d),u_highlight:new c.UniformColor(d),u_accent:new c.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new c.UniformMatrix4f(d),u_image:new c.Uniform1i(d),u_dimension:new c.Uniform2f(d),u_zoom:new c.Uniform1f(d),u_unpack:new c.Uniform4f(d)}),line:d=>({u_matrix:new c.UniformMatrix4f(d),u_pixels_to_tile_units:new c.UniformMatrix2f(d),u_device_pixel_ratio:new c.Uniform1f(d),u_units_to_pixels:new c.Uniform2f(d),u_dash_image:new c.Uniform1i(d),u_gradient_image:new c.Uniform1i(d),u_image_height:new c.Uniform1f(d),u_texsize:new c.Uniform2f(d),u_scale:new c.Uniform3f(d),u_mix:new c.Uniform1f(d),u_alpha_discard_threshold:new c.Uniform1f(d),u_trim_offset:new c.Uniform2f(d)}),linePattern:d=>({u_matrix:new c.UniformMatrix4f(d),u_texsize:new c.Uniform2f(d),u_pixels_to_tile_units:new c.UniformMatrix2f(d),u_device_pixel_ratio:new c.Uniform1f(d),u_image:new c.Uniform1i(d),u_units_to_pixels:new c.Uniform2f(d),u_scale:new c.Uniform3f(d),u_fade:new c.Uniform1f(d),u_alpha_discard_threshold:new c.Uniform1f(d)}),raster:d=>({u_matrix:new c.UniformMatrix4f(d),u_tl_parent:new c.Uniform2f(d),u_scale_parent:new c.Uniform1f(d),u_fade_t:new c.Uniform1f(d),u_opacity:new c.Uniform1f(d),u_image0:new c.Uniform1i(d),u_image1:new c.Uniform1i(d),u_brightness_low:new c.Uniform1f(d),u_brightness_high:new c.Uniform1f(d),u_saturation_factor:new c.Uniform1f(d),u_contrast_factor:new c.Uniform1f(d),u_spin_weights:new c.Uniform3f(d),u_perspective_transform:new c.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new c.Uniform1i(d),u_is_size_feature_constant:new c.Uniform1i(d),u_size_t:new c.Uniform1f(d),u_size:new c.Uniform1f(d),u_camera_to_center_distance:new c.Uniform1f(d),u_rotate_symbol:new c.Uniform1i(d),u_aspect_ratio:new c.Uniform1f(d),u_fade_change:new c.Uniform1f(d),u_matrix:new c.UniformMatrix4f(d),u_label_plane_matrix:new c.UniformMatrix4f(d),u_coord_matrix:new c.UniformMatrix4f(d),u_is_text:new c.Uniform1i(d),u_pitch_with_map:new c.Uniform1i(d),u_texsize:new c.Uniform2f(d),u_tile_id:new c.Uniform3f(d),u_zoom_transition:new c.Uniform1f(d),u_inv_rot_matrix:new c.UniformMatrix4f(d),u_merc_center:new c.Uniform2f(d),u_camera_forward:new c.Uniform3f(d),u_tile_matrix:new c.UniformMatrix4f(d),u_up_vector:new c.Uniform3f(d),u_ecef_origin:new c.Uniform3f(d),u_texture:new c.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new c.Uniform1i(d),u_is_size_feature_constant:new c.Uniform1i(d),u_size_t:new c.Uniform1f(d),u_size:new c.Uniform1f(d),u_camera_to_center_distance:new c.Uniform1f(d),u_rotate_symbol:new c.Uniform1i(d),u_aspect_ratio:new c.Uniform1f(d),u_fade_change:new c.Uniform1f(d),u_matrix:new c.UniformMatrix4f(d),u_label_plane_matrix:new c.UniformMatrix4f(d),u_coord_matrix:new c.UniformMatrix4f(d),u_is_text:new c.Uniform1i(d),u_pitch_with_map:new c.Uniform1i(d),u_texsize:new c.Uniform2f(d),u_texture:new c.Uniform1i(d),u_gamma_scale:new c.Uniform1f(d),u_device_pixel_ratio:new c.Uniform1f(d),u_tile_id:new c.Uniform3f(d),u_zoom_transition:new c.Uniform1f(d),u_inv_rot_matrix:new c.UniformMatrix4f(d),u_merc_center:new c.Uniform2f(d),u_camera_forward:new c.Uniform3f(d),u_tile_matrix:new c.UniformMatrix4f(d),u_up_vector:new c.Uniform3f(d),u_ecef_origin:new c.Uniform3f(d),u_is_halo:new c.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new c.Uniform1i(d),u_is_size_feature_constant:new c.Uniform1i(d),u_size_t:new c.Uniform1f(d),u_size:new c.Uniform1f(d),u_camera_to_center_distance:new c.Uniform1f(d),u_rotate_symbol:new c.Uniform1i(d),u_aspect_ratio:new c.Uniform1f(d),u_fade_change:new c.Uniform1f(d),u_matrix:new c.UniformMatrix4f(d),u_label_plane_matrix:new c.UniformMatrix4f(d),u_coord_matrix:new c.UniformMatrix4f(d),u_is_text:new c.Uniform1i(d),u_pitch_with_map:new c.Uniform1i(d),u_texsize:new c.Uniform2f(d),u_texsize_icon:new c.Uniform2f(d),u_texture:new c.Uniform1i(d),u_texture_icon:new c.Uniform1i(d),u_gamma_scale:new c.Uniform1f(d),u_device_pixel_ratio:new c.Uniform1f(d),u_is_halo:new c.Uniform1i(d)}),background:d=>({u_matrix:new c.UniformMatrix4f(d),u_opacity:new c.Uniform1f(d),u_color:new c.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new c.UniformMatrix4f(d),u_opacity:new c.Uniform1f(d),u_image:new c.Uniform1i(d),u_pattern_tl_a:new c.Uniform2f(d),u_pattern_br_a:new c.Uniform2f(d),u_pattern_tl_b:new c.Uniform2f(d),u_pattern_br_b:new c.Uniform2f(d),u_texsize:new c.Uniform2f(d),u_mix:new c.Uniform1f(d),u_pattern_size_a:new c.Uniform2f(d),u_pattern_size_b:new c.Uniform2f(d),u_scale_a:new c.Uniform1f(d),u_scale_b:new c.Uniform1f(d),u_pixel_coord_upper:new c.Uniform2f(d),u_pixel_coord_lower:new c.Uniform2f(d),u_tile_units_to_pixels:new c.Uniform1f(d)}),terrainRaster:ya,terrainDepth:ya,skybox:d=>({u_matrix:new c.UniformMatrix4f(d),u_sun_direction:new c.Uniform3f(d),u_cubemap:new c.Uniform1i(d),u_opacity:new c.Uniform1f(d),u_temporal_offset:new c.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new c.UniformMatrix4f(d),u_color_ramp:new c.Uniform1i(d),u_center_direction:new c.Uniform3f(d),u_radius:new c.Uniform1f(d),u_opacity:new c.Uniform1f(d),u_temporal_offset:new c.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new c.UniformMatrix3f(d),u_sun_direction:new c.Uniform3f(d),u_sun_intensity:new c.Uniform1f(d),u_color_tint_r:new c.Uniform4f(d),u_color_tint_m:new c.Uniform4f(d),u_luminance:new c.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new c.UniformMatrix4f(d),u_globe_matrix:new c.UniformMatrix4f(d),u_normalize_matrix:new c.UniformMatrix4f(d),u_merc_matrix:new c.UniformMatrix4f(d),u_zoom_transition:new c.Uniform1f(d),u_merc_center:new c.Uniform2f(d),u_image0:new c.Uniform1i(d),u_grid_matrix:new c.UniformMatrix3f(d),u_frustum_tl:new c.Uniform3f(d),u_frustum_tr:new c.Uniform3f(d),u_frustum_br:new c.Uniform3f(d),u_frustum_bl:new c.Uniform3f(d),u_globe_pos:new c.Uniform3f(d),u_globe_radius:new c.Uniform1f(d),u_viewport:new c.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new c.Uniform3f(d),u_frustum_tr:new c.Uniform3f(d),u_frustum_br:new c.Uniform3f(d),u_frustum_bl:new c.Uniform3f(d),u_horizon:new c.Uniform1f(d),u_transition:new c.Uniform1f(d),u_fadeout_range:new c.Uniform1f(d),u_color:new c.Uniform4f(d),u_high_color:new c.Uniform4f(d),u_space_color:new c.Uniform4f(d),u_star_intensity:new c.Uniform1f(d),u_star_density:new c.Uniform1f(d),u_star_size:new c.Uniform1f(d),u_temporal_offset:new c.Uniform1f(d),u_horizon_angle:new c.Uniform1f(d),u_rotation_matrix:new c.UniformMatrix4f(d)})};let ce;function He(d,i,l,m,x,w,S){const P=d.context,F=P.gl,$=d.transform,Z=d.useProgram("collisionBox"),ne=[];let se=0,ve=0;for(let qe=0;qe<m.length;qe++){const Ue=m[qe],Ne=i.getTile(Ue),je=Ne.getBucket(l);if(!je)continue;const Le=Zo(Ue,je,$);let Je=Le;0===x[0]&&0===x[1]||(Je=d.translatePosMatrix(Le,Ne,x,w));const tt=S?je.textCollisionBox:je.iconCollisionBox,nn=je.collisionCircleArray;if(nn.length>0){const rt=c.create(),Pt=Je;c.mul(rt,je.placementInvProjMatrix,$.glCoordMatrix),c.mul(rt,rt,je.placementViewportMatrix),ne.push({circleArray:nn,circleOffset:ve,transform:Pt,invTransform:rt,projection:je.getProjection()}),se+=nn.length/4,ve=se}tt&&(d.terrain&&d.terrain.setupElevationDraw(Ne,Z),Z.draw(P,F.LINES,c.DepthMode.disabled,c.StencilMode.disabled,d.colorModeForRenderPass(),c.CullFaceMode.disabled,Mi(Je,$,Ne,je.getProjection()),l.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,$.zoom,null,[tt.collisionVertexBuffer,tt.collisionVertexBufferExt]))}if(!S||!ne.length)return;const de=d.useProgram("collisionCircle"),me=new c.StructArrayLayout2f1f2i16;me.resize(4*se),me._trim();let ge=0;for(const qe of ne)for(let Ue=0;Ue<qe.circleArray.length/4;Ue++){const Ne=4*Ue,je=qe.circleArray[Ne+0],Le=qe.circleArray[Ne+1],Je=qe.circleArray[Ne+2],tt=qe.circleArray[Ne+3];me.emplace(ge++,je,Le,Je,tt,0),me.emplace(ge++,je,Le,Je,tt,1),me.emplace(ge++,je,Le,Je,tt,2),me.emplace(ge++,je,Le,Je,tt,3)}(!ce||ce.length<2*se)&&(ce=function(qe){const Ue=2*qe,Ne=new c.StructArrayLayout3ui6;Ne.resize(Ue),Ne._trim();for(let je=0;je<Ue;je++){const Le=6*je;Ne.uint16[Le+0]=4*je+0,Ne.uint16[Le+1]=4*je+1,Ne.uint16[Le+2]=4*je+2,Ne.uint16[Le+3]=4*je+2,Ne.uint16[Le+4]=4*je+3,Ne.uint16[Le+5]=4*je+0}return Ne}(se));const fe=P.createIndexBuffer(ce,!0),De=P.createVertexBuffer(me,c.collisionCircleLayout.members,!0);for(const qe of ne){const Ue={u_matrix:qe.transform,u_inv_matrix:qe.invTransform,u_camera_to_center_distance:(we=$).getCameraToCenterDistance(qe.projection),u_viewport_size:[we.width,we.height]};de.draw(P,F.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,d.colorModeForRenderPass(),c.CullFaceMode.disabled,Ue,l.id,De,fe,c.SegmentVector.simpleSegment(0,2*qe.circleOffset,qe.circleArray.length,qe.circleArray.length/2),null,$.zoom)}var we;De.destroy(),fe.destroy()}const Dt=c.create();function Yt(d,i,l,m,x,w){const{horizontalAlign:S,verticalAlign:P}=c.getAnchorAlignment(d),F=-(S-.5)*i,$=-(P-.5)*l,Z=c.evaluateVariableOffset(d,m);return new c.pointGeometry((F/x+Z[0])*w,($/x+Z[1])*w)}function Ln(d,i,l,m,x,w,S,P,F,$,Z){const ne=d.text.placedSymbolArray,se=d.text.dynamicLayoutVertexArray,ve=d.icon.dynamicLayoutVertexArray,de={},me=Mr(P,d.getProjection(),w),ge=w.elevation,fe=d.getProjection().upVectorScale(P.canonical,w.center.lat,w.worldSize);se.clear();for(let De=0;De<ne.length;De++){const we=ne.get(De),qe=d.allowVerticalPlacement&&!we.placedOrientation,Ue=we.hidden||!we.crossTileID||qe?null:m[we.crossTileID];if(Ue){const Ne=new c.pointGeometry(we.tileAnchorX,we.tileAnchorY),je=d.getProjection().upVector(P.canonical,Ne.x,Ne.y),Le=ge?ge.getAtTileOffset(P,Ne.x,Ne.y):0,Je=Sn([we.projectedAnchorX+Le*je[0]*fe.metersToTile,we.projectedAnchorY+Le*je[1]*fe.metersToTile,we.projectedAnchorZ+Le*je[2]*fe.metersToTile],l?me:S),tt=Wo(w.getCameraToCenterDistance(d.getProjection()),Je.signedDistanceFromCamera);let nn=x.evaluateSizeForFeature(d.textSizeData,$,we)*tt/c.ONE_EM;l&&(nn*=d.tilePixelRatio/F);const{width:rt,height:Pt,anchor:Bt,textOffset:un,textScale:_t}=Ue,en=Yt(Bt,rt,Pt,un,_t,nn);let kt;if(l){const fn=Ne.add(en),{x:Fn,y:$n,z:ci}=d.getProjection().projectTilePoint(fn.x,fn.y,P.canonical);kt=Sn([Fn+Le*je[0]*fe.metersToTile,$n+Le*je[1]*fe.metersToTile,ci+Le*je[2]*fe.metersToTile],S).point}else{const fn=i?en.rotate(-w.angle):en;kt=[Je.point[0]+fn.x,Je.point[1]+fn.y,0]}const yn=d.allowVerticalPlacement&&we.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let fn=0;fn<we.numGlyphs;fn++)c.addDynamicAttributes(se,kt[0],kt[1],kt[2],yn);Z&&we.associatedIconIndex>=0&&(de[we.associatedIconIndex]={shiftedAnchor:kt,angle:yn})}else eo(we.numGlyphs,se)}if(Z){ve.clear();const De=d.icon.placedSymbolArray;for(let we=0;we<De.length;we++){const qe=De.get(we);if(qe.hidden)eo(qe.numGlyphs,ve);else{const Ue=de[we];if(Ue)for(let Ne=0;Ne<qe.numGlyphs;Ne++)c.addDynamicAttributes(ve,Ue.shiftedAnchor[0],Ue.shiftedAnchor[1],Ue.shiftedAnchor[2],Ue.angle);else eo(qe.numGlyphs,ve)}}d.icon.dynamicLayoutVertexBuffer.updateData(ve)}d.text.dynamicLayoutVertexBuffer.updateData(se)}function fi(d,i,l){return l.iconsInText&&i?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Si(d,i,l,m,x,w,S,P,F,$,Z,ne){const se=d.context,ve=se.gl,de=d.transform,me="map"===P,ge="map"===F,fe=me&&"point"!==l.layout.get("symbol-placement"),De=me&&!ge&&!fe,we=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let qe=!1;const Ue=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),Ne=[c.mercatorXfromLng(de.center.lng),c.mercatorYfromLat(de.center.lat)],je=l.layout.get("text-variable-anchor"),Le="globe"===de.projection.name,Je=[],tt=[0,-1,0];let nn=tt;!Le&&!de.mercatorFromTransition||me||(nn=function(rt){const Pt=rt._camera.getWorldToCamera(rt.worldSize,1),Bt=c.multiply([],Pt,rt.globeMatrix);c.invert(Bt,Bt);const un=[0,0,0],_t=[0,1,0,0];return c.transformMat4$1(_t,_t,Bt),un[0]=_t[0],un[1]=_t[1],un[2]=_t[2],c.normalize(un,un),un}(de));for(const rt of m){const Pt=i.getTile(rt),Bt=Pt.getBucket(l);if(!Bt||"mercator"===Bt.projection.name&&Le)continue;const un=x?Bt.text:Bt.icon;if(!un||Bt.fullyClipped||!un.segments.get().length)continue;const _t=un.programConfigurations.get(l.id),en=x||Bt.sdfIcons,kt=x?Bt.textSizeData:Bt.iconSizeData,yn=ge||0!==de.pitch,fn=c.evaluateSizeForZoom(kt,de.zoom);let Fn,$n,ci,Fi,Bn=[0,0],mi=null;if(x){if($n=Pt.glyphAtlasTexture,ci=ve.LINEAR,Fn=Pt.glyphAtlasTexture.size,Bt.iconsInText){Bn=Pt.imageAtlasTexture.size,mi=Pt.imageAtlasTexture;const ks="composite"===kt.kind||"camera"===kt.kind;Fi=yn||d.options.rotating||d.options.zooming||ks?ve.LINEAR:ve.NEAREST}}else{const ks=1!==l.layout.get("icon-size").constantOr(0)||Bt.iconsNeedLinear;$n=Pt.imageAtlasTexture,ci=en||d.options.rotating||d.options.zooming||ks||yn?ve.LINEAR:ve.NEAREST,Fn=Pt.imageAtlasTexture.size}const ji="globe"===Bt.projection.name,Br=ji?nn:tt,fo=ji?c.globeToMercatorTransition(de.zoom):0,gr=Mr(rt,Bt.getProjection(),de),Ts=de.calculatePixelsToTileUnitsMatrix(Pt),Da=Qn(gr,Pt.tileID.canonical,ge,me,de,Bt.getProjection(),Ts),Kl=d.terrain&&ge&&fe?c.invert(c.create(),Da):Dt,Ir=wr(gr,Pt.tileID.canonical,ge,me,de,Bt.getProjection(),Ts),Wr=je&&Bt.hasTextData(),bi="none"!==l.layout.get("icon-text-fit")&&Wr&&Bt.hasIconData();if(fe){const ks=de.elevation,wc=ks?ks.getAtTileOffsetFunc(rt,de.center.lat,de.worldSize,Bt.getProjection()):Ju=>[0,0,0],ec=Jn(gr,Pt.tileID.canonical,ge,me,de,Bt.getProjection(),Ts);ms(Bt,gr,d,x,ec,Ir,ge,$,wc,rt)}const ro=fe||x&&je||bi,jo=d.translatePosMatrix(gr,Pt,w,S),sr=ro?Dt:Da,Cs=d.translatePosMatrix(Ir,Pt,w,S,!0),Tl=Bt.getProjection().createInversionMatrix(de,rt.canonical),Hs=[];d.terrain&&ge&&Hs.push("PITCH_WITH_MAP_TERRAIN"),ji&&Hs.push("PROJECTION_GLOBE_VIEW"),ro&&Hs.push("PROJECTED_POS_ON_VIEWPORT");const il=en&&0!==l.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Ql;Ql=en?Bt.iconsInText?oa(kt.kind,fn,De,ge,d,jo,sr,Cs,Fn,Bn,rt,fo,Ne,Tl,Br,Bt.getProjection()):Ll(kt.kind,fn,De,ge,d,jo,sr,Cs,x,Fn,!0,rt,fo,Ne,Tl,Br,Bt.getProjection()):bl(kt.kind,fn,De,ge,d,jo,sr,Cs,x,Fn,rt,fo,Ne,Tl,Br,Bt.getProjection());const xc={program:d.useProgram(fi(en,x,Bt),_t,Hs),buffers:un,uniformValues:Ql,atlasTexture:$n,atlasTextureIcon:mi,atlasInterpolation:ci,atlasInterpolationIcon:Fi,isSDF:en,hasHalo:il,tile:Pt,labelPlaneMatrixInv:Kl};if(we&&Bt.canOverlap){qe=!0;const ks=un.segments.get();for(const wc of ks)Je.push({segments:new c.SegmentVector([wc]),sortKey:wc.sortKey,state:xc})}else Je.push({segments:un.segments,sortKey:0,state:xc})}qe&&Je.sort((rt,Pt)=>rt.sortKey-Pt.sortKey);for(const rt of Je){const Pt=rt.state;if(d.terrain&&d.terrain.setupElevationDraw(Pt.tile,Pt.program,{useDepthForOcclusion:!Le,labelPlaneMatrixInv:Pt.labelPlaneMatrixInv}),se.activeTexture.set(ve.TEXTURE0),Pt.atlasTexture.bind(Pt.atlasInterpolation,ve.CLAMP_TO_EDGE),Pt.atlasTextureIcon&&(se.activeTexture.set(ve.TEXTURE1),Pt.atlasTextureIcon&&Pt.atlasTextureIcon.bind(Pt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE)),Pt.isSDF){const Bt=Pt.uniformValues;Pt.hasHalo&&(Bt.u_is_halo=1,qn(Pt.buffers,rt.segments,l,d,Pt.program,Ue,Z,ne,Bt)),Bt.u_is_halo=0}qn(Pt.buffers,rt.segments,l,d,Pt.program,Ue,Z,ne,Pt.uniformValues)}}function qn(d,i,l,m,x,w,S,P,F){const $=m.context,Z=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];x.draw($,$.gl.TRIANGLES,w,S,P,c.CullFaceMode.disabled,F,l.id,d.layoutVertexBuffer,d.indexBuffer,i,l.paint,m.transform.zoom,d.programConfigurations.get(l.id),Z)}function Ii(d,i,l,m,x,w,S){const P=d.context.gl,F=l.paint.get("fill-pattern"),$=F&&F.constantOr(1),Z=l.getCrossfadeParameters();let ne,se,ve,de,me;S?(se=$&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=P.LINES):(se=$?"fillPattern":"fill",ne=P.TRIANGLES);for(const ge of m){const fe=i.getTile(ge);if($&&!fe.patternsLoaded())continue;const De=fe.getBucket(l);if(!De)continue;d.prepareDrawTile();const we=De.programConfigurations.get(l.id),qe=d.useProgram(se,we);$&&(d.context.activeTexture.set(P.TEXTURE0),fe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),we.updatePaintBuffers(Z));const Ue=F.constantOr(null);if(Ue&&fe.imageAtlas){const je=fe.imageAtlas,Le=je.patternPositions[Ue.to.toString()],Je=je.patternPositions[Ue.from.toString()];Le&&Je&&we.setConstantPatternPositions(Le,Je)}const Ne=d.translatePosMatrix(ge.projMatrix,fe,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(S){de=De.indexBuffer2,me=De.segments2;const je=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];ve="fillOutlinePattern"===se&&$?G(Ne,d,Z,fe,je):q(Ne,je)}else de=De.indexBuffer,me=De.segments,ve=$?J(Ne,d,Z,fe):Bo(Ne);d.prepareDrawProgram(d.context,qe,ge.toUnwrapped()),qe.draw(d.context,ne,x,d.stencilModeForClipping(ge),w,c.CullFaceMode.disabled,ve,l.id,De.layoutVertexBuffer,de,me,l.paint,d.transform.zoom,we)}}function xr(d,i,l,m,x,w,S){const P=d.context,F=P.gl,$=d.transform,Z=l.paint.get("fill-extrusion-pattern"),ne=Z.constantOr(1),se=l.getCrossfadeParameters(),ve=l.paint.get("fill-extrusion-opacity"),de=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],me=l.layout.get("fill-extrusion-edge-radius"),ge="globe"===$.projection.name?c.fillExtrusionHeightLift():0,fe="globe"===$.projection.name,De=fe?c.globeToMercatorTransition($.zoom):0,we=[c.mercatorXfromLng($.center.lng),c.mercatorYfromLat($.center.lat)],qe=[];fe&&(qe.push("PROJECTION_GLOBE_VIEW"),d.style.terrainSetForDrapingOnly()&&qe.push("TERRAIN")),de[0]>0&&qe.push("FAUX_AO");for(const Ue of m){const Ne=i.getTile(Ue),je=Ne.getBucket(l);if(!je||je.projection.name!==$.projection.name)continue;const Le=je.programConfigurations.get(l.id),Je=d.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",Le,qe);if(d.terrain){const _t=d.terrain;if(d.style.terrainSetForDrapingOnly())_t.setupElevationDraw(Ne,Je,{useMeterToDem:!0});else{if(!je.enableTerrain)continue;if(_t.setupElevationDraw(Ne,Je,{useMeterToDem:!0}),or(P,i,Ue,je,l,_t),!je.centroidVertexBuffer){const en=Je.attributes.a_centroid_pos;void 0!==en&&F.vertexAttrib2f(en,0,0)}}}ne&&(d.context.activeTexture.set(F.TEXTURE0),Ne.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Le.updatePaintBuffers(se));const tt=Z.constantOr(null);if(tt&&Ne.imageAtlas){const _t=Ne.imageAtlas,en=_t.patternPositions[tt.to.toString()],kt=_t.patternPositions[tt.from.toString()];en&&kt&&Le.setConstantPatternPositions(en,kt)}const nn=d.translatePosMatrix(Ue.projMatrix,Ne,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),rt=$.projection.createInversionMatrix($,Ue.canonical),Pt=l.paint.get("fill-extrusion-vertical-gradient"),Bt=ne?xa(nn,d,Pt,ve,de,me,Ue,se,Ne,ge,De,we,rt):Na(nn,d,Pt,ve,de,me,Ue,ge,De,we,rt);d.prepareDrawProgram(P,Je,Ue.toUnwrapped());const un=[];d.terrain&&un.push(je.centroidVertexBuffer),fe&&un.push(je.layoutVertexExtBuffer),Je.draw(P,P.gl.TRIANGLES,x,w,S,c.CullFaceMode.backCCW,Bt,l.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,l.paint,d.transform.zoom,Le,un)}}function or(d,i,l,m,x,w){const S=[fe=>{let De=fe.canonical.x-1,we=fe.wrap;return De<0&&(De=(1<<fe.canonical.z)-1,we--),new c.OverscaledTileID(fe.overscaledZ,we,fe.canonical.z,De,fe.canonical.y)},fe=>{let De=fe.canonical.x+1,we=fe.wrap;return De===1<<fe.canonical.z&&(De=0,we++),new c.OverscaledTileID(fe.overscaledZ,we,fe.canonical.z,De,fe.canonical.y)},fe=>new c.OverscaledTileID(fe.overscaledZ,fe.wrap,fe.canonical.z,fe.canonical.x,(0===fe.canonical.y?1<<fe.canonical.z:fe.canonical.y)-1),fe=>new c.OverscaledTileID(fe.overscaledZ,fe.wrap,fe.canonical.z,fe.canonical.x,fe.canonical.y===(1<<fe.canonical.z)-1?0:fe.canonical.y+1)],P=fe=>{const De=i.getSource().minzoom,we=Ue=>{const Ne=i.getTileByID(Ue);if(Ne&&Ne.hasData())return Ne.getBucket(x)},qe=[0,-1,1];for(const Ue of qe){if(fe.overscaledZ+Ue<De)continue;const Ne=we(fe.calculateScaledKey(fe.overscaledZ+Ue));if(Ne)return Ne}},F=[0,0,0],$=(fe,De)=>(F[0]=Math.min(fe.min.y,De.min.y),F[1]=Math.max(fe.max.y,De.max.y),F[2]=c.EXTENT-De.min.x>fe.max.x?De.min.x-c.EXTENT:fe.max.x,F),Z=(fe,De)=>(F[0]=Math.min(fe.min.x,De.min.x),F[1]=Math.max(fe.max.x,De.max.x),F[2]=c.EXTENT-De.min.y>fe.max.y?De.min.y-c.EXTENT:fe.max.y,F),ne=[(fe,De)=>$(fe,De),(fe,De)=>$(De,fe),(fe,De)=>Z(fe,De),(fe,De)=>Z(De,fe)],se=new c.pointGeometry(0,0);let ve,de,me;const ge=(fe,De,we,qe,Ue)=>{const Ne=[[qe?we:fe,qe?fe:we,0],[qe?we:De,qe?De:we,0]],je=Ue<0?c.EXTENT+Ue:Ue,Le=[qe?je:(fe+De)/2,qe?(fe+De)/2:je,0];return 0===we&&Ue<0||0!==we&&Ue>0?w.getForTilePoints(me,[Le],!0,de):Ne.push(Le),w.getForTilePoints(l,Ne,!0,ve),Math.max(Ne[0][2],Ne[1][2],Le[2])/w.exaggeration()};for(let fe=0;fe<4;fe++){const De=(fe<2?1:5)-fe,we=m.borders[fe];if(0===we.length)continue;const qe=me=S[fe](l),Ue=P(qe);if(!(Ue&&Ue instanceof c.FillExtrusionBucket&&Ue.enableTerrain)||m.borderDoneWithNeighborZ[fe]===Ue.canonical.z&&Ue.borderDoneWithNeighborZ[De]===m.canonical.z||(de=w.findDEMTileFor(qe),!de||!de.dem))continue;if(!ve){const Je=w.findDEMTileFor(l);if(!Je||!Je.dem)return;ve=Je}const Ne=Ue.borders[De];let je=0;const Le=Ue.borderDoneWithNeighborZ[De]!==m.canonical.z;if(m.canonical.z===Ue.canonical.z){for(let Je=0;Je<we.length;Je++){const tt=m.featuresOnBorder[we[Je]],nn=tt.borders[fe];let rt;for(;je<Ne.length&&(rt=Ue.featuresOnBorder[Ne[je]],!(rt.borders[De][1]>nn[0]+3));)Le&&Ue.encodeCentroid(void 0,rt,!1),je++;if(rt&&je<Ne.length){const Pt=je;let Bt=0;for(;!(rt.borders[De][0]>nn[1]-3)&&(Bt++,++je!==Ne.length);)rt=Ue.featuresOnBorder[Ne[je]];if(rt=Ue.featuresOnBorder[Ne[Pt]],tt.intersectsCount()>1||rt.intersectsCount()>1||1!==Bt){1!==Bt&&(je=Pt),m.encodeCentroid(void 0,tt,!1),Le&&Ue.encodeCentroid(void 0,rt,!1);continue}const un=ne[fe](tt,rt),_t=fe%2?c.EXTENT-1:0;se.x=ge(un[0],Math.min(c.EXTENT-1,un[1]),_t,fe<2,un[2]),se.y=0,m.encodeCentroid(se,tt,!1),Le&&Ue.encodeCentroid(se,rt,!1)}else m.encodeCentroid(void 0,tt,!1)}m.borderDoneWithNeighborZ[fe]=Ue.canonical.z,m.needsCentroidUpdate=!0,Le&&(Ue.borderDoneWithNeighborZ[De]=m.canonical.z,Ue.needsCentroidUpdate=!0)}else{for(const Je of we)m.encodeCentroid(void 0,m.featuresOnBorder[Je],!1);if(Le){for(const Je of Ne)Ue.encodeCentroid(void 0,Ue.featuresOnBorder[Je],!1);Ue.borderDoneWithNeighborZ[De]=m.canonical.z,Ue.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[fe]=Ue.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(d)}const Do=new c.Color(1,0,0,1),Ds=new c.Color(0,1,0,1),zo=new c.Color(0,0,1,1),Ro=new c.Color(1,0,1,1),os=new c.Color(0,1,1,1);function Ai(d,i,l){const m=d.context,x=d.transform,w=m.gl,S="globe"===x.projection.name,P=S?["PROJECTION_GLOBE_VIEW"]:null;let F=l.projMatrix;if(S&&c.globeToMercatorTransition(x.zoom)>0){const tt=c.transitionTileAABBinECEF(l.canonical,x),nn=c.globeDenormalizeECEF(tt);F=c.multiply(new Float32Array(16),x.globeMatrix,nn),c.multiply(F,x.projMatrix,F)}const $=d.useProgram("debug",null,P),Z=i.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(Z,$);const ne=c.DepthMode.disabled,se=c.StencilMode.disabled,ve=d.colorModeForRenderPass();m.activeTexture.set(w.TEXTURE0),d.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),S?Z._makeGlobeTileDebugBuffers(d.context,x):Z._makeDebugTileBoundsBuffers(d.context,x.projection);const me=Z._tileDebugBuffer||d.debugBuffer,ge=Z._tileDebugIndexBuffer||d.debugIndexBuffer,fe=Z._tileDebugSegments||d.debugSegments;$.draw(m,w.LINE_STRIP,ne,se,ve,c.CullFaceMode.disabled,to(F,c.Color.red),"$debug",me,ge,fe,null,null,null,[Z._globeTileDebugBorderBuffer]);const De=Z.latestRawTileData,we=Math.floor((De&&De.byteLength||0)/1024),qe=i.getTile(l).tileSize,Ue=512/Math.min(qe,512)*(l.overscaledZ/x.zoom)*.5;let Ne=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ne+=` => ${l.overscaledZ}`),Ne+=` ${we}kb`,function(tt,nn){tt.initDebugOverlayCanvas();const rt=tt.debugOverlayCanvas,Pt=tt.context.gl,Bt=tt.debugOverlayCanvas.getContext("2d");Bt.clearRect(0,0,rt.width,rt.height),Bt.shadowColor="white",Bt.shadowBlur=2,Bt.lineWidth=1.5,Bt.strokeStyle="white",Bt.textBaseline="top",Bt.font="bold 36px Open Sans, sans-serif",Bt.fillText(nn,5,5),Bt.strokeText(nn,5,5),tt.debugOverlayTexture.update(rt),tt.debugOverlayTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE)}(d,Ne);const je=Z._tileDebugTextBuffer||d.debugBuffer,Le=Z._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Je=Z._tileDebugTextSegments||d.debugSegments;$.draw(m,w.TRIANGLES,ne,se,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,to(F,c.Color.transparent,Ue),"$debug",je,Le,Je,null,null,null,[Z._globeTileDebugTextBuffer])}function sa(d,i,l,m){pc(d,0,i+l/2,d.transform.width,l,m)}function Bl(d,i,l,m){pc(d,i-l/2,0,l,d.transform.height,m)}function pc(d,i,l,m,x,w){const S=d.context,P=S.gl;P.enable(P.SCISSOR_TEST),P.scissor(i*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,m*c.exported.devicePixelRatio,x*c.exported.devicePixelRatio),S.clear({color:w}),P.disable(P.SCISSOR_TEST)}const js=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mc}=js;function Fa(d,i,l,m){d.emplaceBack(i,l,m)}class yu{constructor(i){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,Fa(this.vertexArray,-1,-1,1),Fa(this.vertexArray,1,-1,1),Fa(this.vertexArray,-1,1,1),Fa(this.vertexArray,1,1,1),Fa(this.vertexArray,-1,-1,-1),Fa(this.vertexArray,1,-1,-1),Fa(this.vertexArray,-1,1,-1),Fa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,mc),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function aa(d,i,l,m,x,w){const S=d.gl,P=i.paint.get("sky-atmosphere-color"),F=i.paint.get("sky-atmosphere-halo-color"),$=i.paint.get("sky-atmosphere-sun-intensity"),Z={u_matrix_3f:c.fromMat4(c.create$1(),m),u_sun_direction:x,u_sun_intensity:$,u_color_tint_r:[(de=P).r,de.g,de.b,de.a],u_color_tint_m:[(me=F).r,me.g,me.b,me.a],u_luminance:5e-5};var de,me;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),l.draw(d,S.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,Z,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const zl=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class gc{constructor(i){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const m=new c.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,zl.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Vl={symbol:function(d,i,l,m,x){if("translucent"!==d.renderPass)return;const w=c.StencilMode.disabled,S=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(P,F,$,Z,ne,se,ve){const de=F.transform,me="map"===ne,ge="map"===se;for(const fe of P){const De=Z.getTile(fe),we=De.getBucket($);if(!we||!we.text||!we.text.segments.get().length)continue;const qe=c.evaluateSizeForZoom(we.textSizeData,de.zoom),Ue=Mr(fe,we.getProjection(),de),Ne=de.calculatePixelsToTileUnitsMatrix(De),je=Qn(Ue,De.tileID.canonical,ge,me,de,we.getProjection(),Ne),Le="none"!==$.layout.get("icon-text-fit")&&we.hasIconData();if(qe){const Je=Math.pow(2,de.zoom-De.tileID.overscaledZ);Ln(we,me,ge,ve,c.symbolSize,de,je,fe,Je,qe,Le)}}}(m,d,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x),0!==l.paint.get("icon-opacity").constantOr(1)&&Si(d,i,l,m,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),w,S),0!==l.paint.get("text-opacity").constantOr(1)&&Si(d,i,l,m,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),w,S),i.map.showCollisionBoxes&&(He(d,i,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),He(d,i,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,l,m){if("translucent"!==d.renderPass)return;const x=l.paint.get("circle-opacity"),w=l.paint.get("circle-stroke-width"),S=l.paint.get("circle-stroke-opacity"),P=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===w.constantOr(1)||0===S.constantOr(1)))return;const F=d.context,$=F.gl,Z=d.transform,ne=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),se=c.StencilMode.disabled,ve=d.colorModeForRenderPass(),de="globe"===Z.projection.name,me=[c.mercatorXfromLng(Z.center.lng),c.mercatorYfromLat(Z.center.lat)],ge=[];for(let De=0;De<m.length;De++){const we=m[De],qe=i.getTile(we),Ue=qe.getBucket(l);if(!Ue||Ue.projection.name!==Z.projection.name)continue;const Ne=Ue.programConfigurations.get(l.id),je=On(l);de&&je.push("PROJECTION_GLOBE_VIEW");const Le=d.useProgram("circle",Ne,je),Je=Ue.layoutVertexBuffer,tt=Ue.globeExtVertexBuffer,nn=Ue.indexBuffer,rt=Z.projection.createInversionMatrix(Z,we.canonical),Pt={programConfiguration:Ne,program:Le,layoutVertexBuffer:Je,globeExtVertexBuffer:tt,indexBuffer:nn,uniformValues:gt(d,we,qe,rt,me,l),tile:qe};if(P){const Bt=Ue.segments.get();for(const un of Bt)ge.push({segments:new c.SegmentVector([un]),sortKey:un.sortKey,state:Pt})}else ge.push({segments:Ue.segments,sortKey:0,state:Pt})}P&&ge.sort((De,we)=>De.sortKey-we.sortKey);const fe={useDepthForOcclusion:!de};for(const De of ge){const{programConfiguration:we,program:qe,layoutVertexBuffer:Ue,globeExtVertexBuffer:Ne,indexBuffer:je,uniformValues:Le,tile:Je}=De.state,tt=De.segments;d.terrain&&d.terrain.setupElevationDraw(Je,qe,fe),d.prepareDrawProgram(F,qe,Je.tileID.toUnwrapped()),qe.draw(F,$.TRIANGLES,ne,se,ve,c.CullFaceMode.disabled,Le,l.id,Ue,je,tt,l.paint,Z.zoom,we,[Ne])}},heatmap:function(d,i,l,m){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const x=d.context,w=x.gl,S=c.StencilMode.disabled,P=new c.ColorMode([w.ONE,w.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(ve,de,me,ge){const fe=ve.gl,De=de.width*ge,we=de.height*ge;ve.activeTexture.set(fe.TEXTURE1),ve.viewport.set([0,0,De,we]);let qe=me.heatmapFbo;if(!qe||qe&&(qe.width!==De||qe.height!==we)){qe&&qe.destroy();const Ue=fe.createTexture();fe.bindTexture(fe.TEXTURE_2D,Ue),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MAG_FILTER,fe.LINEAR),qe=me.heatmapFbo=ve.createFramebuffer(De,we,!1),function(Ne,je,Le,Je,tt,nn){const rt=Ne.gl;rt.texImage2D(rt.TEXTURE_2D,0,rt.RGBA,tt,nn,0,rt.RGBA,Ne.extRenderToTextureHalfFloat?Ne.extTextureHalfFloat.HALF_FLOAT_OES:rt.UNSIGNED_BYTE,null),Je.colorAttachment.set(Le)}(ve,0,Ue,qe,De,we)}else fe.bindTexture(fe.TEXTURE_2D,qe.colorAttachment.get()),ve.bindFramebuffer.set(qe.framebuffer)})(x,d,l,"globe"===d.transform.projection.name?.5:.25),x.clear({color:c.Color.transparent});const F=d.transform,$="globe"===F.projection.name,Z=$?["PROJECTION_GLOBE_VIEW"]:null,ne=$?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,se=[c.mercatorXfromLng(F.center.lng),c.mercatorYfromLat(F.center.lat)];for(let ve=0;ve<m.length;ve++){const de=m[ve];if(i.hasRenderableParent(de))continue;const me=i.getTile(de),ge=me.getBucket(l);if(!ge||ge.projection.name!==F.projection.name)continue;const fe=ge.programConfigurations.get(l.id),De=d.useProgram("heatmap",fe,Z),{zoom:we}=d.transform;d.terrain&&d.terrain.setupElevationDraw(me,De),d.prepareDrawProgram(x,De,de.toUnwrapped());const qe=F.projection.createInversionMatrix(F,de.canonical);De.draw(x,w.TRIANGLES,c.DepthMode.disabled,S,P,ne,ws(d,de,me,qe,se,we,l.paint.get("heatmap-intensity")),l.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,l.paint,d.transform.zoom,fe,$?[ge.globeExtVertexBuffer]:null)}x.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(x,w){const S=x.context,P=S.gl,F=w.heatmapFbo;if(!F)return;S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get()),S.activeTexture.set(P.TEXTURE1);let $=w.colorRampTexture;$||($=w.colorRampTexture=new c.Texture(S,w.colorRamp,P.RGBA)),$.bind(P.LINEAR,P.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(S,P.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,x.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(d,l))},line:function(d,i,l,m){if("translucent"!==d.renderPass)return;const x=l.paint.get("line-opacity"),w=l.paint.get("line-width");if(0===x.constantOr(1)||0===w.constantOr(1))return;const S=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),P=d.colorModeForRenderPass(),F=d.terrain&&d.terrain.renderingToTexture?1:c.exported.devicePixelRatio,$=l.paint.get("line-dasharray"),Z=$.constantOr(1),ne=l.layout.get("line-cap"),se=l.paint.get("line-pattern"),ve=se.constantOr(1),de=l.paint.get("line-gradient"),me=l.getCrossfadeParameters(),ge=ve?"linePattern":"line",fe=d.context,De=fe.gl,we=(Ue=>{const Ne=[];Nl(Ue)&&Ne.push("RENDER_LINE_DASH"),Ue.paint.get("line-gradient")&&Ne.push("RENDER_LINE_GRADIENT");const je=Ue.paint.get("line-trim-offset");0===je[0]&&0===je[1]||Ne.push("RENDER_LINE_TRIM_OFFSET");const Le=Ue.paint.get("line-pattern").constantOr(1),Je=1!==Ue.paint.get("line-opacity").constantOr(1);return!Le&&Je&&Ne.push("RENDER_LINE_ALPHA_DISCARD"),Ne})(l);let qe=we.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(qe=!1);for(const Ue of m){const Ne=i.getTile(Ue);if(ve&&!Ne.patternsLoaded())continue;const je=Ne.getBucket(l);if(!je)continue;d.prepareDrawTile();const Le=je.programConfigurations.get(l.id),Je=d.useProgram(ge,Le,we),tt=se.constantOr(null);if(tt&&Ne.imageAtlas){const kt=Ne.imageAtlas,yn=kt.patternPositions[tt.to.toString()],fn=kt.patternPositions[tt.from.toString()];yn&&fn&&Le.setConstantPatternPositions(yn,fn)}const nn=$.constantOr(null),rt=ne.constantOr(null);if(!ve&&nn&&rt&&Ne.lineAtlas){const kt=Ne.lineAtlas,yn=kt.getDash(nn.to,rt),fn=kt.getDash(nn.from,rt);yn&&fn&&Le.setConstantPatternPositions(yn,fn)}let[Pt,Bt]=l.paint.get("line-trim-offset");("round"===rt||"square"===rt)&&Pt!==Bt&&(0===Pt&&(Pt-=1),1===Bt&&(Bt+=1));const un=d.terrain?Ue.projMatrix:null,_t=ve?Rl(d,Ne,l,me,un,F):Oo(d,Ne,l,me,un,je.lineClipsArray.length,F,[Pt,Bt]);if(de){const kt=je.gradients[l.id];let yn=kt.texture;if(l.gradientVersion!==kt.version){let fn=256;if(l.stepInterpolant){const Fn=i.getSource().maxzoom,$n=Ue.canonical.z===Fn?Math.ceil(1<<d.transform.maxZoom-Ue.canonical.z):1;fn=c.clamp(c.nextPowerOfTwo(je.maxLineLength/c.EXTENT*1024*$n),256,fe.maxTextureSize)}kt.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:fn,image:kt.gradient||void 0,clips:je.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new c.Texture(fe,kt.gradient,De.RGBA),kt.version=l.gradientVersion,yn=kt.texture}fe.activeTexture.set(De.TEXTURE1),yn.bind(l.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}Z&&(fe.activeTexture.set(De.TEXTURE0),Ne.lineAtlasTexture.bind(De.LINEAR,De.REPEAT),Le.updatePaintBuffers(me)),ve&&(fe.activeTexture.set(De.TEXTURE0),Ne.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),Le.updatePaintBuffers(me)),d.prepareDrawProgram(fe,Je,Ue.toUnwrapped());const en=kt=>{Je.draw(fe,De.TRIANGLES,S,kt,P,c.CullFaceMode.disabled,_t,l.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,l.paint,d.transform.zoom,Le,[je.layoutVertexBuffer2])};if(qe){const kt=d.stencilModeForClipping(Ue).ref;0===kt&&d.terrain&&fe.clear({stencil:0});const yn={func:De.EQUAL,mask:255};_t.u_alpha_discard_threshold=.8,en(new c.StencilMode(yn,kt,255,De.KEEP,De.KEEP,De.INVERT)),_t.u_alpha_discard_threshold=0,en(new c.StencilMode(yn,kt,255,De.KEEP,De.KEEP,De.KEEP))}else en(d.stencilModeForClipping(Ue))}qe&&(d.resetStencilClippingMasks(),d.terrain&&fe.clear({stencil:0}))},fill:function(d,i,l,m){const x=l.paint.get("fill-color"),w=l.paint.get("fill-opacity");if(0===w.constantOr(1))return;const S=d.colorModeForRenderPass(),P=l.paint.get("fill-pattern"),F=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&1===x.constantOr(c.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(d.renderPass===F){const $=d.depthModeForSublayer(1,"opaque"===d.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);Ii(d,i,l,m,$,S,!1)}if("translucent"===d.renderPass&&l.paint.get("fill-antialias")){const $=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);Ii(d,i,l,m,$,S,!0)}},"fill-extrusion":function(d,i,l,m){const x=l.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===d.renderPass){const w=new c.DepthMode(d.context.gl.LEQUAL,c.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==x||l.paint.get("fill-extrusion-pattern").constantOr(1))xr(d,i,l,m,w,c.StencilMode.disabled,c.ColorMode.disabled),xr(d,i,l,m,w,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const S=d.colorModeForRenderPass();xr(d,i,l,m,w,c.StencilMode.disabled,S)}}},hillshade:function(d,i,l,m){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const x=d.context,w=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),P=d.terrain&&d.terrain.renderingToTexture,[F,$]="translucent"!==d.renderPass||P?[{},m]:d.stencilConfigForOverlap(m);for(const Z of $){const ne=i.getTile(Z);if(ne.needsHillshadePrepare&&"offscreen"===d.renderPass)Sr(d,ne,l,w,c.StencilMode.disabled,S);else if("translucent"===d.renderPass){const se=P&&d.terrain?d.terrain.stencilModeForRTTOverlap(Z):F[Z.overscaledZ];_a(d,Z,ne,l,w,se,S)}}x.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,l,m,x,w){if("translucent"!==d.renderPass||0===l.paint.get("raster-opacity")||!m.length)return;const S=d.context,P=S.gl,F=i.getSource(),$=d.useProgram("raster"),Z=d.colorModeForRenderPass(),ne=d.terrain&&d.terrain.renderingToTexture,[se,ve]=F instanceof et||ne?[{},m]:d.stencilConfigForOverlap(m),de=ve[ve.length-1].overscaledZ,me=!d.options.moving;for(const ge of ve){const fe=ne?c.DepthMode.disabled:d.depthModeForSublayer(ge.overscaledZ-de,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,P.LESS),De=ge.toUnwrapped(),we=i.getTile(ge);if(ne&&(!we||!we.hasData()))continue;const qe=ne?ge.projMatrix:d.transform.calculateProjMatrix(De,me),Ue=d.terrain&&ne?d.terrain.stencilModeForRTTOverlap(ge):se[ge.overscaledZ],Ne=w?0:l.paint.get("raster-fade-duration");we.registerFadeDuration(Ne);const je=i.findLoadedParent(ge,0),Le=rs(we,je,i,d.transform,Ne);let Je,tt;d.terrain&&d.terrain.prepareDrawTile();const nn="nearest"===l.paint.get("raster-resampling")?P.NEAREST:P.LINEAR;S.activeTexture.set(P.TEXTURE0),we.texture.bind(nn,P.CLAMP_TO_EDGE),S.activeTexture.set(P.TEXTURE1),je?(je.texture.bind(nn,P.CLAMP_TO_EDGE),Je=Math.pow(2,je.tileID.overscaledZ-we.tileID.overscaledZ),tt=[we.tileID.canonical.x*Je%1,we.tileID.canonical.y*Je%1]):we.texture.bind(nn,P.CLAMP_TO_EDGE);const rt=kl(qe,tt||[0,0],Je||1,Le,l,F instanceof et?F.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(S,$,De),F instanceof et)F.boundsBuffer&&F.boundsSegments&&$.draw(S,P.TRIANGLES,fe,c.StencilMode.disabled,Z,c.CullFaceMode.disabled,rt,l.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else{const{tileBoundsBuffer:Pt,tileBoundsIndexBuffer:Bt,tileBoundsSegments:un}=d.getTileBoundsBuffers(we);$.draw(S,P.TRIANGLES,fe,Ue,Z,c.CullFaceMode.disabled,rt,l.id,Pt,Bt,un)}}d.resetStencilClippingMasks()},background:function(d,i,l,m){const x=l.paint.get("background-color"),w=l.paint.get("background-opacity");if(0===w)return;const S=d.context,P=S.gl,F=d.transform,$=F.tileSize,Z=l.paint.get("background-pattern");if(d.isPatternMissing(Z))return;const ne=!Z&&1===x.a&&1===w&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==ne)return;const se=c.StencilMode.disabled,ve=d.depthModeForSublayer(0,"opaque"===ne?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),de=d.colorModeForRenderPass(),me=d.useProgram(Z?"backgroundPattern":"background");let ge,fe=m;fe||(ge=d.getBackgroundTiles(),fe=Object.values(ge).map(we=>we.tileID)),Z&&(S.activeTexture.set(P.TEXTURE0),d.imageManager.bind(d.context));const De=l.getCrossfadeParameters();for(const we of fe){const qe=we.toUnwrapped(),Ue=m?we.projMatrix:d.transform.calculateProjMatrix(qe);d.prepareDrawTile();const Ne=i?i.getTile(we):ge?ge[we.key]:new c.Tile(we,$,F.zoom,d),je=Z?ie(Ue,w,d,Z,{tileID:we,tileSize:$},De):j(Ue,w,x);d.prepareDrawProgram(S,me,qe);const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:Je,tileBoundsSegments:tt}=d.getTileBoundsBuffers(Ne);me.draw(S,P.TRIANGLES,ve,se,de,c.CullFaceMode.disabled,je,l.id,Le,Je,tt)}},sky:function(d,i,l){const m=d.transform,x="mercator"===m.projection.name||"globe"===m.projection.name?1:c.smoothstep(7,8,m.zoom),w=l.paint.get("sky-opacity")*x;if(0===w)return;const S=d.context,P=l.paint.get("sky-type"),F=new c.DepthMode(S.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),$=d.frameCounter/1e3%1;"atmosphere"===P?"offscreen"===d.renderPass?l.needsSkyboxCapture(d)&&(function(Z,ne,se,ve){const de=Z.context,me=de.gl;let ge=ne.skyboxFbo;if(!ge){ge=ne.skyboxFbo=de.createFramebuffer(32,32,!1),ne.skyboxGeometry=new yu(de),ne.skyboxTexture=de.gl.createTexture(),me.bindTexture(me.TEXTURE_CUBE_MAP,ne.skyboxTexture),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MAG_FILTER,me.LINEAR);for(let qe=0;qe<6;++qe)me.texImage2D(me.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0,me.RGBA,32,32,0,me.RGBA,me.UNSIGNED_BYTE,null)}de.bindFramebuffer.set(ge.framebuffer),de.viewport.set([0,0,32,32]);const fe=ne.getCenter(Z,!0),De=Z.useProgram("skyboxCapture"),we=new Float64Array(16);c.identity(we),c.rotateY(we,we,.5*-Math.PI),aa(de,ne,De,we,fe,0),c.identity(we),c.rotateY(we,we,.5*Math.PI),aa(de,ne,De,we,fe,1),c.identity(we),c.rotateX(we,we,.5*-Math.PI),aa(de,ne,De,we,fe,2),c.identity(we),c.rotateX(we,we,.5*Math.PI),aa(de,ne,De,we,fe,3),c.identity(we),aa(de,ne,De,we,fe,4),c.identity(we),c.rotateY(we,we,Math.PI),aa(de,ne,De,we,fe,5),de.viewport.set([0,0,Z.width,Z.height])}(d,l),l.markSkyboxValid(d)):"sky"===d.renderPass&&function(Z,ne,se,ve,de){const me=Z.context,ge=me.gl,fe=Z.transform,De=Z.useProgram("skybox");me.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_CUBE_MAP,ne.skyboxTexture);const we={u_matrix:fe.skyboxMatrix,u_sun_direction:ne.getCenter(Z,!1),u_cubemap:0,u_opacity:ve,u_temporal_offset:de};Z.prepareDrawProgram(me,De),De.draw(me,ge.TRIANGLES,se,c.StencilMode.disabled,Z.colorModeForRenderPass(),c.CullFaceMode.backCW,we,"skybox",ne.skyboxGeometry.vertexBuffer,ne.skyboxGeometry.indexBuffer,ne.skyboxGeometry.segment)}(d,l,F,w,$):"gradient"===P&&"sky"===d.renderPass&&function(Z,ne,se,ve,de){const me=Z.context,ge=me.gl,fe=Z.transform,De=Z.useProgram("skyboxGradient");ne.skyboxGeometry||(ne.skyboxGeometry=new yu(me)),me.activeTexture.set(ge.TEXTURE0);let we=ne.colorRampTexture;we||(we=ne.colorRampTexture=new c.Texture(me,ne.colorRamp,ge.RGBA)),we.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const qe=(Ue=fe.skyboxMatrix,Ne=ne.getCenter(Z,!1),je=ne.paint.get("sky-gradient-radius"),Le=ve,Je=de,{u_matrix:Ue,u_color_ramp:0,u_center_direction:Ne,u_radius:c.degToRad(je),u_opacity:Le,u_temporal_offset:Je});var Ue,Ne,je,Le,Je;Z.prepareDrawProgram(me,De),De.draw(me,ge.TRIANGLES,se,c.StencilMode.disabled,Z.colorModeForRenderPass(),c.CullFaceMode.backCW,qe,"skyboxGradient",ne.skyboxGeometry.vertexBuffer,ne.skyboxGeometry.indexBuffer,ne.skyboxGeometry.segment)}(d,l,F,w,$)},debug:function(d,i,l){for(let m=0;m<l.length;m++)Ai(d,i,l[m])},custom:function(d,i,l){const m=d.context,x=l.implementation;if(d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes("custom"))c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===d.renderPass){const w=x.prerender;w&&(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),w.call(x,m.gl,d.transform.customLayerMatrix()),m.setDirty(),d.setBaseState())}else if("translucent"===d.renderPass){d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(c.StencilMode.disabled);const w="3d"===x.renderingMode?new c.DepthMode(d.context.gl.LEQUAL,c.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,c.DepthMode.ReadOnly);m.setDepthMode(w),x.render(m.gl,d.transform.customLayerMatrix()),m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}};class $u{constructor(i,l){this.context=new xe(i),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,l){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ei(this,i));const x=this._terrain;this.transform.elevation=m?x:null,x.update(i,this.transform,l)}_updateFog(i){const l=i.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=l.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const w=m+.78*(x-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,l){if(this.width=i*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const m=new c.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(c.EXTENT,0),m.emplaceBack(0,c.EXTENT),m.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=i.createVertexBuffer(m,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const x=new c.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const w=new c.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(c.EXTENT,0,c.EXTENT,0),w.emplaceBack(0,c.EXTENT,0,c.EXTENT),w.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(w,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const S=new c.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(S);const P=new c.StructArrayLayout1ui2;for(const $ of[0,1,3,2,0])P.emplaceBack($);this.debugIndexBuffer=i.createIndexBuffer(P),this.emptyTexture=new c.Texture(i,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=c.create();const F=this.context.gl;this.stencilClearMode=new c.StencilMode({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new gc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,l=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,fc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,m){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const F of m)if(void 0===this._tileClippingMaskIDs[F.key]){P=!0;break}if(!P)return}this.currentStencilSource=l.id;const x=this.context,w=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(c.ColorMode.disabled),x.setDepthMode(c.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of m){const F=l.getTile(P),$=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:Z,tileBoundsIndexBuffer:ne,tileBoundsSegments:se}=this.getTileBoundsBuffers(F);S.draw(x,w.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:w.ALWAYS,mask:0},$,255,w.KEEP,w.KEEP,w.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,fc(P.projMatrix),"$clipping",Z,ne,se)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,m=i.sort((S,P)=>P.overscaledZ-S.overscaledZ),x=m[m.length-1].overscaledZ,w=m[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let P=0;P<w;P++)S[P+x]=new c.StencilMode({func:l.GEQUAL,mask:255},P+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=w,[S,m]}return[{[x]:c.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([i.CONSTANT_COLOR,i.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(i,l,m){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new c.DepthMode(m||this.context.gl.LEQUAL,l,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,l){this.style=i,this.options=l,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const F in x){const $=x[F];$.used&&$.prepare(this.context)}const w={},S={},P={};for(const F in x){const $=x[F];w[F]=$.getVisibleCoordinates(),S[F]=w[F].slice().reverse(),P[F]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<m.length;F++)if(this.style._layers[m[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),c.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const F of m){const $=this.style._layers[F],Z=i._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const ne=Z?S[Z.id]:void 0;("custom"===$.type||$.isSky()||ne&&ne.length)&&this.renderLayer(this,Z,$,ne)}if(this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[m[this.currentLayer]],$=i._getLayerSourceCache(F);if(F.isSky())continue;const Z=$?S[$.id]:void 0;this._renderTileClippingMasks(F,$,Z),this.renderLayer(this,$,F,Z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(F,$){const Z=F.context,ne=Z.gl,se=F.transform,ve=new c.DepthMode(ne.LEQUAL,c.DepthMode.ReadOnly,[0,1]),de=F.useProgram("globeAtmosphere",null,"globe"===se.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),me=c.globeToMercatorTransition(se.zoom),ge=$.properties.get("color").toArray01(),fe=$.properties.get("high-color").toArray01(),De=$.properties.get("space-color").toArray01PremultipliedAlpha(),we=c.identity$1([]);c.rotateY$1(we,we,-c.degToRad(se._center.lng)),c.rotateX$1(we,we,c.degToRad(se._center.lat)),c.rotateZ$1(we,we,se.angle),c.rotateX$1(we,we,-se._pitch);const qe=c.fromQuat(new Float32Array(16),we),Ue=c.mapValue($.properties.get("star-intensity"),0,1,0,.25),je=c.mapValue($.properties.get("horizon-blend"),0,1,5e-4,.25),Le=c.globeUseCustomAntiAliasing(F,Z,se)&&5e-4===je?se.worldSize/(2*Math.PI*1.025)-1:se.globeRadius,Je=F.frameCounter/1e3%1,tt=c.length(se.globeCenterInViewSpace),nn=Math.sqrt(Math.pow(tt,2)-Math.pow(Le,2)),rt=Math.acos(nn/tt),Pt={u_frustum_tl:se.frustumCorners.TL,u_frustum_tr:se.frustumCorners.TR,u_frustum_br:se.frustumCorners.BR,u_frustum_bl:se.frustumCorners.BL,u_horizon:se.frustumCorners.horizon,u_transition:me,u_fadeout_range:je,u_color:ge,u_high_color:fe,u_space_color:De,u_star_intensity:Ue,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Je,u_horizon_angle:rt,u_rotation_matrix:qe};F.prepareDrawProgram(Z,de);const Bt=F.atmosphereBuffer;Bt&&de.draw(Z,ne.TRIANGLES,ve,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,Pt,"skybox",Bt.vertexBuffer,Bt.indexBuffer,Bt.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const F=this.style._layers[m[this.currentLayer]],$=i._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,$,F,$?S[$.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const F=this.style._layers[m[this.currentLayer]],$=i._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Z=$?("symbol"===F.type?P:S)[$.id]:void 0;this._renderTileClippingMasks(F,$,$?w[$.id]:void 0),this.renderLayer(this,$,F,Z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let F=null;c.values(this.style._layers).forEach($=>{const Z=i._getLayerSourceCache($);Z&&!$.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<Z.getSource().maxzoom)&&(F=Z)}),F&&this.options.showTileBoundaries&&Vl.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const $=F.transform.padding;sa(F,F.transform.height-($.top||0),3,Do),sa(F,$.bottom||0,3,Ds),Bl(F,$.left||0,3,zo),Bl(F,F.transform.width-($.right||0),3,Ro);const Z=F.transform.centerPoint;var ne,se,ve,de;pc(ne=F,(se=Z.x)-1,(ve=F.transform.height-Z.y)-10,2,20,de=os),pc(ne,se-10,ve-1,20,2,de)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}}renderLayer(i,l,m,x){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)||Vl[m.type](i,l,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),m.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,l=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),i.beginQueryEXT(i.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const l={};for(const m in i){const x=i[m],w=this.context.extTimerQuery,S=w.getQueryObjectEXT(x.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(x.query),l[m]=S}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let m=0;for(const x of i)m+=l.getQueryObjectEXT(x,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(x);return m}translatePosMatrix(i,l,m,x,w){if(!m[0]&&!m[1])return i;const S=w?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(S){const $=Math.sin(S),Z=Math.cos(S);m=[m[0]*Z-m[1]*$,m[0]*$+m[1]*Z]}const P=[w?m[0]:Kn(l,m[0],this.transform.zoom),w?m[1]:Kn(l,m[1],this.transform.zoom),0],F=new Float32Array(16);return c.translate(F,i,P),F}saveTileTexture(i){const l=this._tileTextures[i.size[0]];l?l.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const l=this.imageManager.getPattern(i.from.toString()),m=this.imageManager.getPattern(i.to.toString());return!l||!m}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),l&&!i&&0!==l.getOpacity(this.transform.pitch)&&m.push("FOG"),i&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(i,l,m){this.cache=this.cache||{};const x=m||[],w=this.currentGlobalDefines().concat(x),S=ba.cacheKey(yl[i],i,w,l);return this.cache[S]||(this.cache[S]=new ba(this.context,i,yl[i],l,H[i],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,l,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),S=((P,F,$,Z,ne,se,ve,de,me,ge,fe)=>{const De=P.transform,we=F.properties.get("color").toArray01();we[3]=Z;const qe=P.frameCounter/1e3%1;return{u_fog_matrix:$?De.calculateFogTileMatrix($):P.identityMat,u_fog_range:F.getFovAdjustedRange(De._fov),u_fog_color:we,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_temporal_offset:qe,u_frustum_tl:ne,u_frustum_tr:se,u_frustum_br:ve,u_frustum_bl:de,u_globe_pos:me,u_globe_radius:ge,u_viewport:fe,u_globe_transition:c.globeToMercatorTransition(De.zoom),u_is_globe:+("globe"===De.projection.name)}})(this,x,m,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(i,S)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)l[x.key]=i[x.key]||new c.Tile(x,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class vu{constructor(i=0,l=0,m=0,x=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=m,this.right=x}interpolate(i,l,m){return null!=l.top&&null!=i.top&&(this.top=c.number(i.top,l.top,m)),null!=l.bottom&&null!=i.bottom&&(this.bottom=c.number(i.bottom,l.bottom,m)),null!=l.left&&null!=i.left&&(this.left=c.number(i.left,l.left,m)),null!=l.right&&null!=i.right&&(this.right=c.number(i.right,l.right,m)),this}getCenter(i,l){const m=c.clamp((this.left+i-this.right)/2,0,i),x=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(m,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new vu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ul(d,i){const l=c.getColumn(d,3);c.fromQuat(d,i),c.setColumn(d,3,l)}function jl(d,i){const l=c.identity$1([]);return c.rotateZ$1(l,l,-i),c.rotateX$1(l,l,-d),l}function Gl(d,i){const l=[d[0],d[1],0],m=[i[0],i[1],0];if(c.length(l)>=1e-15){const S=c.normalize([],l);c.scale$2(m,S,c.dot(m,S)),i[0]=m[0],i[1]=m[1]}const x=c.cross([],i,d);if(c.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return jl(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),w)}class bn{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){const l=i instanceof c.MercatorCoordinate?i:new c.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(i)):0,x=this.position,w=c.MercatorCoordinate.fromLngLat(i,m),S=[w.x-x.x,w.y-x.y,w.z-x.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Gl(S,l)}setPitchBearing(i,l){this.orientation=jl(c.degToRad(i),c.degToRad(-l))}}class Os{constructor(i,l){this._transform=c.identity([]),this.orientation=l,this.position=i}get mercatorPosition(){const i=this.position;return new c.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=c.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&c.setColumn(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||c.identity$1([]),i&&Ul(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=jl(i,l),Ul(this._transform,this._orientation)}forward(){const i=c.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=c.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=c.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const m=new Float64Array(16);return c.invert(m,this.getWorldToCamera(i,l)),m}getWorldToCameraPosition(i,l,m){const x=this.position;c.scale$2(x,x,-i);const w=new Float64Array(16);return c.fromScaling(w,[m,m,m]),c.translate(w,w,x),w[10]*=l,w}getWorldToCamera(i,l){const m=new Float64Array(16),x=new Float64Array(4),w=this.position;return c.conjugate(x,this._orientation),c.scale$2(w,w,-i),c.fromQuat(m,x),c.translate(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(i,l,m,x){const w=new Float64Array(16);return c.perspective(w,i,l,m,x),w}getDistanceToElevation(i){const l=0===i?0:c.mercatorZfromAltitude(i,this.position[1]),m=this.forward();return(l-this.position[2])/m[2]}clone(){return new Os([...this.position],[...this.orientation])}}function Hc(d,i){const l=$l(d.projection,d.zoom,d.width,d.height),m=function(w,S,P,F,$){const Z=new c.LngLat(P.lng-180*Vo,P.lat),ne=new c.LngLat(P.lng+180*Vo,P.lat),se=w.project(Z.lng,Z.lat),ve=w.project(ne.lng,ne.lat),de=-Math.atan2(ve.y-se.y,ve.x-se.x),me=c.MercatorCoordinate.fromLngLat(P);me.y=c.clamp(me.y,-.999975,.999975);const ge=me.toLngLat(),fe=w.project(ge.lng,ge.lat),De=c.MercatorCoordinate.fromLngLat(ge);De.x+=Vo;const we=De.toLngLat(),qe=w.project(we.lng,we.lat),Ue=xl(qe.x-fe.x,qe.y-fe.y,de),Ne=c.MercatorCoordinate.fromLngLat(ge);Ne.y+=Vo;const je=Ne.toLngLat(),Le=w.project(je.lng,je.lat),Je=xl(Le.x-fe.x,Le.y-fe.y,de),tt=Math.abs(Ue.x)/Math.abs(Je.y),nn=c.identity([]);c.rotateZ(nn,nn,-de*(1-($?0:F)));const rt=c.identity([]);return c.scale(rt,rt,[1,1-(1-tt)*F,1]),rt[4]=-Je.x/Je.y*F,c.rotateZ(rt,rt,de),c.multiply(rt,nn,rt),rt}(d.projection,0,d.center,l,i),x=La(d);return c.scale(m,m,[x,x,1]),m}function La(d){const i=d.projection,l=$l(d.projection,d.zoom,d.width,d.height),m=bu(i,d.center),x=bu(i,c.LngLat.convert(i.center));return Math.pow(2,m*l+(1-l)*x)}function $l(d,i,l,m,x=1/0){const w=d.range;if(!w)return 0;const S=Math.min(x,Math.max(l,m)),P=Math.log(S/1024)/Math.LN2;return c.smoothstep(w[0]+P,w[1]+P,i)}const Vo=1/4e4;function bu(d,i){const l=c.clamp(i.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),m=new c.LngLat(i.lng-180*Vo,l),x=new c.LngLat(i.lng+180*Vo,l),w=d.project(m.lng,l),S=d.project(x.lng,l),P=c.MercatorCoordinate.fromLngLat(m),F=c.MercatorCoordinate.fromLngLat(x),$=S.x-w.x,Z=S.y-w.y,ne=F.x-P.x,se=F.y-P.y,ve=Math.sqrt((ne*ne+se*se)/($*$+Z*Z));return Math.log(ve)/Math.LN2}function xl(d,i,l){const m=Math.cos(l),x=Math.sin(l);return{x:d*m-i*x,y:d*x+i*m}}class Wc{constructor(i,l,m,x,w,S,P){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new vu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Os,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new Wc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i){const l=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||l)&&this._updateCameraOnTerrain(),(i||l)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const m=!ze(l,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;var m,x,w,S,P,F,$,Z,ne,se;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(m=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),x=this.rotationMatrix,S=this.angle,P=(w=this.rotationMatrix)[0],F=w[1],$=w[2],Z=w[3],ne=Math.sin(S),se=Math.cos(S),x[0]=P*se+$*ne,x[1]=F*se+Z*ne,x[2]=P*-ne+$*se,x[3]=F*-ne+Z*se)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=c.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,w=0;for(let S=0;S<l.length;S++){const P=new c.pointGeometry(l[S][0]*this.width,m+l[S][1]*(this.height-m)),F=i.pointCoordinate(P);if(!F)continue;const $=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);x+=F[3]*$,w+=$}return 0===w?NaN:x/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,x=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-m,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const x=c.length(c.sub([],this._camera.position,m));return c.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!c.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];c.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new bn;return l.position=new c.MercatorCoordinate(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!c.length$1(i))return!1;c.normalize$1(i,i);const l=c.transformQuat([],[0,0,-1],i),m=c.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const x=Gl(l,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=c.clamp(i[2],x/m,x/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,m){this._unmodified=!1,this._edgeInsets.interpolate(i,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new c.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new c.pointGeometry(0,0)),x=this.pointCoordinate(new c.pointGeometry(this.width,0)),w=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new c.pointGeometry(0,this.height)),P=Math.floor(Math.min(m.x,x.x,w.x,S.x)),F=Math.floor(Math.max(m.x,x.x,w.x,S.x)),$=1;for(let Z=P-$;Z<=F+$;Z++)0!==Z&&l.push(new c.UnwrappedTileID(Z,i))}return l}coveringTiles(i){let l=this.coveringZoomLevel(i);const m=l,x=this.elevation&&!i.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==i.minzoom&&l<i.minzoom)return[];void 0!==i.maxzoom&&l>i.maxzoom&&(l=i.maxzoom);const S=this.locationCoordinate(this.center),P=this.center.lat,F=1<<l,$=[F*S.x,F*S.y,0],Z="globe"===this.projection.name,ne=!Z,se=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,ne),ve=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),de=F*c.mercatorZfromAltitude(1,this.center.lat),me=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),ge=[F*ve.x,F*ve.y,me*(ne?1:de)],fe=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),De=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,we=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,qe=i.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ue=this.projection.isReprojectedInTileSpace?La(this):1,Ne=_t=>{const kt=new c.MercatorCoordinate(_t.x+25e-6,_t.y,_t.z),yn=new c.MercatorCoordinate(_t.x,_t.y+25e-6,_t.z),fn=_t.toLngLat(),Fn=kt.toLngLat(),$n=yn.toLngLat(),ci=this.locationCoordinate(fn),Fi=this.locationCoordinate(Fn),Bn=this.locationCoordinate($n),mi=Math.hypot(Fi.x-ci.x,Fi.y-ci.y),ji=Math.hypot(Bn.x-ci.x,Bn.y-ci.y);return Math.sqrt(mi*ji)*Ue/25e-6},je=_t=>{const en=we,kt=qe;return{aabb:c.tileAABB(this,F,0,0,0,_t,kt,en,this.projection),zoom:0,x:0,y:0,minZ:kt,maxZ:en,wrap:_t,fullyVisible:!1}},Le=[];let Je=[];const tt=l,nn=i.reparseOverscaled?m:l,rt=_t=>_t*_t,Pt=rt((me-this._centerAltitude)*de),Bt=_t=>{if(!this._elevation||!_t.tileID||!w)return;const en=this._elevation.getMinMaxForTile(_t.tileID),kt=_t.aabb;en?(kt.min[2]=en.min,kt.max[2]=en.max,kt.center[2]=(kt.min[2]+kt.max[2])/2):(_t.shouldSplit=un(_t),_t.shouldSplit||(kt.min[2]=kt.max[2]=kt.center[2]=this._centerAltitude))},un=_t=>{if(_t.zoom<De)return!0;if(_t.zoom===tt)return!1;if(null!=_t.shouldSplit)return _t.shouldSplit;const en=_t.aabb.distanceX(ge),kt=_t.aabb.distanceY(ge);let yn=Pt,fn=1;if(Z){yn=rt(_t.aabb.distanceZ(ge));const $n=Math.pow(2,_t.zoom),ci=c.latFromMercatorY((_t.y+1)/$n),Fi=c.latFromMercatorY(_t.y/$n),Bn=Math.min(Math.max(P,ci),Fi),mi=c.circumferenceAtLatitude(Bn)/c.circumferenceAtLatitude(P);if(fn=Bn===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,mi/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&_t.zoom===tt-1&&mi>=.9)return!0}else if(x&&(yn=rt(_t.aabb.distanceZ(ge)*de)),this.projection.isReprojectedInTileSpace&&m<=5){const $n=Math.pow(2,_t.zoom),ci=Ne(new c.MercatorCoordinate((_t.x+.5)/$n,(_t.y+.5)/$n));fn=ci>.85?1:ci}const Fn=en*en+kt*kt+yn;return Fn<rt((1<<tt-_t.zoom)*fe*fn*(($n,ci)=>{if(ci*rt(.707)<$n)return 1;const Fi=Math.sqrt(ci/$n);return Fi/(1.4144271570014144+(Math.pow(1.1,Fi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(yn,Pt),Fn))};if(this.renderWorldCopies)for(let _t=1;_t<=3;_t++)Le.push(je(-_t)),Le.push(je(_t));for(Le.push(je(0));Le.length>0;){const _t=Le.pop(),en=_t.x,kt=_t.y;let yn=_t.fullyVisible;if(!yn){const fn=_t.aabb.intersects(se);if(0===fn)continue;yn=2===fn}if(_t.zoom!==tt&&un(_t))for(let fn=0;fn<4;fn++){const Fn=(en<<1)+fn%2,$n=(kt<<1)+(fn>>1),ci={aabb:w?_t.aabb.quadrant(fn):c.tileAABB(this,F,_t.zoom+1,Fn,$n,_t.wrap,_t.minZ,_t.maxZ,this.projection),zoom:_t.zoom+1,x:Fn,y:$n,wrap:_t.wrap,fullyVisible:yn,tileID:void 0,shouldSplit:void 0,minZ:_t.minZ,maxZ:_t.maxZ};x&&!Z&&(ci.tileID=new c.OverscaledTileID(_t.zoom+1===tt?nn:_t.zoom+1,_t.wrap,_t.zoom+1,Fn,$n),Bt(ci)),Le.push(ci)}else{const fn=_t.zoom===tt?nn:_t.zoom;if(i.minzoom&&i.minzoom>fn)continue;const Fn=$[0]-(.5+en+(_t.wrap<<_t.zoom))*(1<<l-_t.zoom),$n=$[1]-.5-kt,ci=_t.tileID?_t.tileID:new c.OverscaledTileID(fn,_t.wrap,_t.zoom,en,kt);Je.push({tileID:ci,distanceSq:Fn*Fn+$n*$n})}}if(this.fogCullDistSq){const _t=this.fogCullDistSq,en=this.horizonLineFromTop();Je=Je.filter(kt=>{const yn=[0,0,0,1],fn=[c.EXTENT,c.EXTENT,0,1],Fn=this.calculateFogTileMatrix(kt.tileID.toUnwrapped());c.transformMat4$1(yn,yn,Fn),c.transformMat4$1(fn,fn,Fn);const $n=c.getAABBPointSquareDist(yn,fn);if(0===$n)return!0;let ci=!1;const Fi=this._elevation;if(Fi&&$n>_t&&0!==en){const Bn=this.calculateProjMatrix(kt.tileID.toUnwrapped());let mi;i.isTerrainDEM||(mi=Fi.getMinMaxForTile(kt.tileID)),mi||(mi={min:qe,max:we});const ji=c.furthestTileCorner(this.rotation),Br=[ji[0]*c.EXTENT,ji[1]*c.EXTENT,mi.max];c.transformMat4(Br,Br,Bn),ci=(1-Br[1])*this.height*.5<en}return $n<_t||ci})}return Je.sort((_t,en)=>_t.distanceSq-en.distanceSq).map(_t=>_t.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=c.clamp(i.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,l);return new c.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,l){let m,x;const w=this.centerPoint;if("globe"===this.projection.name){const P=this.worldSize;m=(l.x-w.x)/P,x=(l.y-w.y)/P}else{const P=this.pointCoordinate(l),F=this.pointCoordinate(w);m=P.x-F.x,x=P.y-F.y}const S=this.locationCoordinate(i);this.setLocation(new c.MercatorCoordinate(S.x-m,S.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const m=l?c.mercatorZfromAltitude(l,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new c.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const m=l??this._centerAltitude,x=[i.x,i.y,0,1],w=[i.x,i.y,1,1];c.transformMat4$1(x,x,this.pixelMatrixInverse),c.transformMat4$1(w,w,this.pixelMatrixInverse);const S=w[3];c.scale$1(x,x,1/x[3]),c.scale$1(w,w,1/S);const P=x[2],F=w[2];return{p0:x,p1:w,t:P===F?0:(m-P)/(F-P)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(m,m,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(m,m,1/m[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,m[2]=c.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(m,m,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],m,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:m,t:x}=i,w=c.mercatorZfromAltitude(l[2],this._center.lat),S=c.mercatorZfromAltitude(m[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],m[0],x)/this.worldSize,c.number(l[1],m[1],x)/this.worldSize,c.number(w,S,x))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let l=this.projection.pointCoordinate3D(this,i.x,i.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let m=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const w=.02*x,S=i.clone();for(let P=0;P<10&&x-m>w;P++){S.y=c.number(m,x,.66);const F=this.projection.pointCoordinate3D(this,S.x,S.y);F?(x=S.y,l=F):m=S.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}_coordinatePoint(i,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return c.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new c.pointGeometry(x[0]/x[3],x[1]/x[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,l){const m=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),w=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),S=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let P=this.pointCoordinate(m,i),F=this.pointCoordinate(x,i);const $=this.pointCoordinate(w,l),Z=this.pointCoordinate(S,l),ne=(se,ve)=>(ve.y-se.y)/(ve.x-se.x);return P.y>1&&F.y>=0?P=new c.MercatorCoordinate((1-Z.y)/ne(Z,P)+Z.x,1):P.y<0&&F.y<=1&&(P=new c.MercatorCoordinate(-Z.y/ne(Z,P)+Z.x,0)),F.y>1&&P.y>=0?F=new c.MercatorCoordinate((1-$.y)/ne($,F)+$.x,1):F.y<0&&P.y<=1&&(F=new c.MercatorCoordinate(-$.y/ne($,F)+$.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation($))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const l=i.visibleDemTiles.reduce((m,x)=>{if(x.dem){const w=x.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){const l=i.key,m=this._distanceTileDataCache;if(m[l])return m[l];const x=i.canonical,w=1/this.height,S=this.cameraWorldSize/this.zoomScale(x.z),P=(x.x+Math.pow(2,x.z)*i.wrap)*S,F=x.y*S,$=this.point,Z=this.angle,ne=Math.sin(-Z),se=-Math.cos(-Z);return m[l]={bearing:[ne,se],center:[($.x-P)*w,($.y-F)*w],scale:S/c.EXTENT*w},m[l]}calculateFogTileMatrix(i){const l=i.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const x=this.projection.createTileMatrix(this,this.cameraWorldSize,i);return c.multiply(x,this.worldToFogMatrix,x),m[l]=new Float32Array(x),m[l]}calculateProjMatrix(i,l=!1){const m=i.key,x=l?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const w=this.calculatePosMatrix(i,this.worldSize);return c.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,w),x[m]=new Float32Array(w),x[m]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const x=function(w,S){const{scale:P}=w.tileTransform,F=P*c.EXTENT/(w.tileSize*Math.pow(2,S.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return $=new Float32Array(4),se=(Z=S.inverseAdjustmentMatrix)[1],ve=Z[2],de=Z[3],ge=(ne=[F,F])[1],$[0]=Z[0]*(me=ne[0]),$[1]=se*me,$[2]=ve*ge,$[3]=de*ge,$;var $,Z,ne,se,ve,de,me,ge}(i,this);return m[l]=x,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),x=this._camera.forward(),w=c.mercatorZfromAltitude(1,this._center.lat);m[2]/=w,x[2]/=w,c.normalize(x,x);const S=i.raycast(m,x,i.exaggeration());if(S){const P=c.scaleAndAdd([],m,x,S),F=new c.MercatorCoordinate(P[0],P[1],c.mercatorZfromAltitude(P[2],c.latFromMercatorY(P[1]))),$=(F.z+c.length([F.x-m[0],F.y-m[1],F.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),x=i.getAtPointOrZero(new c.MercatorCoordinate(...m)),w=this._minimumHeightOverTerrain()*Math.cos(c.degToRad(this._maxPitch)),S=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(S<w){const P=this.locationCoordinate(this._center,this._centerAltitude),F=[P.x-m[0],P.y-m[1],P.z-m[2]],$=c.length(F);F[2]-=(w-S)/this._pixelsPerMercatorPixel;const Z=c.length(F);if(0===Z)return;c.scale$2(F,F,$/Z*this._pixelsPerMercatorPixel),this._camera.position=[P.x-F[0],P.y-F[1],P.z*this._pixelsPerMercatorPixel-F[2]],this._camera.orientation=Gl(F,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const se=this.center;return se.lat=c.clamp(se.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(se.lng=c.clamp(se.lng,this.minLng,this.maxLng)),this.center=se,void(this._constraining=!1)}const l=this._unmodified,{x:m,y:x}=this.point;let w=0,S=m,P=x;const F=this.width/2,$=this.height/2,Z=this.worldMinY*this.scale,ne=this.worldMaxY*this.scale;if(x-$<Z&&(P=Z+$),x+$>ne&&(P=ne-$),ne-Z<this.height&&(w=Math.max(w,this.height/(ne-Z)),P=(ne+Z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const se=this.worldMinX*this.scale,ve=this.worldMaxX*this.scale,de=this.worldSize/2-(se+ve)/2;S=(m+de+this.worldSize)%this.worldSize-de,S-F<se&&(S=se+F),S+F>ve&&(S=ve-F),ve-se<this.width&&(w=Math.max(w,this.width/(ve-se)),S=(ve+se)/2)}S===m&&P===x||(this.center=this.unproject(new c.pointGeometry(S,P))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCameraAltitude(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const m=$l(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?l:1),w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);w[8]=2*-i.x/this.width,w[9]=2*i.y/this.height;let S=c.mul([],w,x);if(this.projection.isReprojectedInTileSpace){const Ue=this.locationCoordinate(this.center),Ne=c.identity([]);c.translate(Ne,Ne,[Ue.x*this.worldSize,Ue.y*this.worldSize,0]),c.multiply(Ne,Ne,Hc(this)),c.translate(Ne,Ne,[-Ue.x*this.worldSize,-Ue.y*this.worldSize,0]),c.multiply(S,S,Ne),this.inverseAdjustmentMatrix=function(je){const Le=Hc(je,!0);return St([],[Le[0],Le[1],Le[4],Le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],S,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=S,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const P=c.invert([],w);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const F=new Float32Array(16);c.identity(F),c.scale(F,F,[1,-1,1]),c.rotateX(F,F,this._pitch),c.rotateZ(F,F,this.angle);const $=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-i.x/this.width,$[9]=2*(i.y+Z)/this.height,this.skyboxMatrix=c.multiply(F,$,F);const ne=this.point,se=ne.x,ve=ne.y,de=this.width%2/2,me=this.height%2/2,ge=Math.cos(this.angle),fe=Math.sin(this.angle),De=se-Math.round(se)+ge*de+fe*me,we=ve-Math.round(ve)+ge*me+fe*de,qe=new Float64Array(S);if(c.translate(qe,qe,[De>.5?De-1:De,we>.5?we-1:we,0]),this.alignedProjMatrix=qe,S=c.create(),c.scale(S,S,[this.width/2,-this.height/2,1]),c.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=c.create(),c.scale(S,S,[1,-1,1]),c.translate(S,S,[-1,-1,0]),c.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=c.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const Ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(Ue,Ue,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,l=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,l];c.scale$2(w,w,x),c.scale$2(m,m,-1),c.multiply$2(m,m,w);const S=c.create();c.translate(S,S,m),c.scale(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,x)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*w,x.y/this.worldSize-m[1]*w,i/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=i[2];let x=1;m>0&&(x=Math.min((l-this._camera.position[2])/m,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,i,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),w=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),P=Math.max((i[2]-w)/Math.cos(m),S),F=this._zoomFromMercatorZ(P);c.scaleAndAdd(i,i,l,P),this._pitch=c.clamp(m,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(x,-Math.PI,Math.PI),this._setZoom(c.clamp(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){const m=Math.min(i.x,l.x),x=Math.max(i.x,l.x),w=Math.min(i.y,l.y),S=Math.max(i.y,l.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const P=[new c.pointGeometry(m,w),new c.pointGeometry(x,S),new c.pointGeometry(m,S),new c.pointGeometry(x,w)],F=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const Z of P){const ne=this.pointRayIntersection(Z);if(ne.t<0)return!0;const se=this.rayIntersectionCoordinate(ne);if(se.x<F||se.y<0||se.x>$||se.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,l){const m=c.length(c.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const i=function(l,m){const x=[l[0],l[1],l[2],1];c.transformMat4$1(x,x,m);const w=Math.max(x[3],1e-6);return[x[0]/w,x[1]/w,x[2]/w,w]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,i))}}getCameraToCenterDistance(i){const l=$l(i,this.zoom,this.width,this.height,1024),m=i.pixelSpaceConversion(this.center.lat,this.worldSize,l);return.5/Math.tan(.5*this._fov)*this.height*m}}function Hl(d,i){let l=!1,m=null;const x=()=>{m=null,l&&(d(),m=setTimeout(x,i),l=!1)};return()=>(l=!0,m||x(),m)}class Hu{constructor(i){this._hashName=i&&encodeURIComponent(i),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hl(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,c.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const l=_c(i);if(this._hashName){const m=this._hashName;let x=!1;const w=c.window.location.hash.slice(1).split("&").map(S=>{const P=S.split("=")[0];return P===m?(x=!0,`${P}=${l}`):S}).filter(S=>S);return x||w.push(`${m}=${l}`),`#${w.join("&")}`}return`#${l}`}_getCurrentHash(){const i=c.window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:m,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,i)}}function _c(d,i){const l=d.getCenter(),m=Math.round(100*d.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),S=Math.round(l.lng*w)/w,P=Math.round(l.lat*w)/w,F=d.getBearing(),$=d.getPitch();let Z=i?`/${S}/${P}/${m}`:`${m}/${P}/${S}`;return(F||$)&&(Z+="/"+Math.round(10*F)/10),$&&(Z+=`/${Math.round($)}`),Z}const Mo={linearity:.3,easing:c.bezier(0,0,.3,1)},Wu=c.extend({deceleration:2500,maxSpeed:1400},Mo),wl=c.extend({deceleration:20,maxSpeed:1400},Mo),Zc=c.extend({deceleration:1e3,maxSpeed:360},Mo),yc=c.extend({deceleration:1e3,maxSpeed:90},Mo);class tl{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=c.exported.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)l.zoom+=w.zoomDelta||0,l.bearing+=w.bearingDelta||0,l.pitch+=w.pitchDelta||0,w.panDelta&&l.pan._add(w.panDelta),w.around&&(l.around=w.around),w.pinchAround&&(l.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(l.pan.mag()){const w=vc(l.pan.mag(),m,c.extend({},Wu,i||{}));x.offset=l.pan.mult(w.amount/l.pan.mag()),x.center=this._map.transform.center,nl(x,w)}if(l.zoom){const w=vc(l.zoom,m,wl);x.zoom=this._map.transform.zoom+w.amount,nl(x,w)}if(l.bearing){const w=vc(l.bearing,m,Zc);x.bearing=this._map.transform.bearing+c.clamp(w.amount,-179,179),nl(x,w)}if(l.pitch){const w=vc(l.pitch,m,yc);x.pitch=this._map.transform.pitch+w.amount,nl(x,w)}if(x.zoom||x.bearing){const w=void 0===l.pinchAround?l.around:l.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function nl(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function vc(d,i,l){const{maxSpeed:m,linearity:x,deceleration:w}=l,S=c.clamp(d*x/(i/1e3),-m,m),P=Math.abs(S)/(w*x);return{easing:l.easing,duration:1e3*P,amount:S*(P/2)}}class Xo extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,m,x={}){const w=on(l.getCanvasContainer(),m),S=l.unproject(w);super(i,c.extend({point:w,lngLat:S,originalEvent:m},x)),this._defaultPrevented=!1,this.target=l}}class To extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,m){const x="touchend"===i?m.changedTouches:m.touches,w=vn(l.getCanvasContainer(),x),S=w.map(F=>l.unproject(F)),P=w.reduce((F,$,Z,ne)=>F.add($.div(ne.length)),new c.pointGeometry(0,0));super(i,{points:w,point:P,lngLats:S,lngLat:l.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class Zu extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class qc{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Zu(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new Xo(i.type,this._map,i))}mouseup(i){this._map.fire(new Xo(i.type,this._map,i))}preclick(i){const l=c.extend({},i);l.type="preclick",this._map.fire(new Xo(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Xo(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Xo(i.type,this._map,i))}mouseover(i){this._map.fire(new Xo(i.type,this._map,i))}mouseout(i){this._map.fire(new Xo(i.type,this._map,i))}touchstart(i){return this._firePreventable(new To(i.type,this._map,i))}touchmove(i){this._map.fire(new To(i.type,this._map,i))}touchend(i){this._map.fire(new To(i.type,this._map,i))}touchcancel(i){this._map.fire(new To(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class no{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Xo(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Xo(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yo{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&0===i.button&&(jt(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const m=l;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=m,this._box||(this._box=xt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const w=Math.min(x.x,m.x),S=Math.max(x.x,m.x),P=Math.min(x.y,m.y),F=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${P}px)`,this._box.style.width=S-w+"px",this._box.style.height=F-P+"px")})}mouseupWindow(i,l){if(!this._active||0!==i.button)return;const m=this._startPos,x=l;if(this.reset(),xn(),m.x!==x.x||m.y!==x.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xt(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new c.Event(i,{originalEvent:l}))}}function ho(d,i){const l={};for(let m=0;m<d.length;m++)l[d[m].identifier]=i[m];return l}class ss{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const w=new c.pointGeometry(0,0);for(const S of x)w._add(S);return w.div(x.length)}(l),this.touches=ho(m,l)))}touchmove(i,l,m){if(this.aborted||!this.centroid)return;const x=ho(m,l);for(const w in this.touches){const S=this.touches[w],P=x[w];(!P||P.dist(S)>30)&&(this.aborted=!0)}}touchend(i,l,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Ba{constructor(i){this.singleTap=new ss(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,m){this.singleTap.touchstart(i,l,m)}touchmove(i,l,m){this.singleTap.touchmove(i,l,m)}touchend(i,l,m){const x=this.singleTap.touchend(i,l,m);if(x){const w=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(w&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Yc{constructor(){this._zoomIn=new Ba({numTouches:1,numTaps:2}),this._zoomOut=new Ba({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,m){this._zoomIn.touchstart(i,l,m),this._zoomOut.touchstart(i,l,m)}touchmove(i,l,m){this._zoomIn.touchmove(i,l,m),this._zoomOut.touchmove(i,l,m)}touchend(i,l,m){const x=this._zoomIn.touchend(i,l,m),w=this._zoomOut.touchend(i,l,m);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Wl={0:1,2:2};class Zl{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const m=ki(i);this._correctButton(i,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(i,l){const m=this._lastPoint;if(m)if(i.preventDefault(),null!=this._eventButton&&function(x,w){const S=Wl[w];return void 0===x.buttons||(x.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}mouseupWindow(i){this._lastPoint&&ki(i)===this._eventButton&&(this._moved&&xn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qu extends Zl{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return 0===l&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class za extends Zl{_correctButton(i,l){return 0===l&&i.ctrlKey||2===l}_move(i,l){const m=.8*(l.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Uo extends Zl{_correctButton(i,l){return 0===l&&i.ctrlKey||2===l}_move(i,l){const m=-.5*(l.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class xu{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(i,l,m){return this._calculateTransform(i,l,m)}touchmove(i,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,m)}}touchend(i,l,m){this._calculateTransform(i,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,m){m.length>0&&(this._active=!0);const x=ho(m,l),w=new c.pointGeometry(0,0),S=new c.pointGeometry(0,0);let P=0;for(const $ in x){const Z=x[$],ne=this._touches[$];ne&&(w._add(Z),S._add(Z.sub(ne)),P++,x[$]=Z)}if(this._touches=x,P<this._minTouches||!S.mag())return;const F=S.div(P);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Dl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,m){return{}}touchstart(i,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,m){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[w,S]=x,P=Rs(m,l,w),F=Rs(m,l,S);if(!P||!F)return;const $=this._aroundCenter?null:P.add(F).div(2);return this._move([P,F],$,i)}touchend(i,l,m){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,S=Rs(m,l,x),P=Rs(m,l,w);S&&P||(this._active&&xn(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rs(d,i,l){for(let m=0;m<d.length;m++)if(d[m].identifier===l)return i[m]}function ql(d,i){return Math.log(d/i)/Math.LN2}class as extends Dl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(ql(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ql(this._distance,m),pinchAround:l}}}function Ns(d,i){return 180*d.angleWith(i)/Math.PI}class Hr extends Dl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ns(this._vector,m),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,m=Ns(i,this._startVector);return Math.abs(m)<l}}function Jo(d){return Math.abs(d.y)>Math.abs(d.x)}class Xc extends Dl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Jo(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,m){const x=this._lastPoints;if(!x)return;const w=i[0].sub(x[0]),S=i[1].sub(x[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(i,l,m){if(void 0!==this._valid)return this._valid;const x=i.mag()>=2,w=l.mag()>=2;if(!x&&!w)return;if(!x||!w)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=i.y>0==l.y>0;return Jo(i)&&Jo(l)&&S}}const Dn={panStep:100,bearingStep:15,pitchStep:10};class Qi{constructor(){const i=Dn;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,m=0,x=0,w=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:P=>{const F=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Td,zoom:l?Math.round(F)+l*(i.shiftKey?2:1):F,bearing:P.getBearing()+m*this._bearingStep,pitch:P.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:P.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Td(d){return d*(2-d)}const bc=4.000244140625;class Yl{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=c.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==l&&l%bc==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=on(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>bc?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==$&&($=1/$);const Z=l(),ne=Math.pow(2,Z),se="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):ne;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(se*$))),"wheel"===this._type&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:l(),x=this._startZoom,w=this._easing;let S,P=!1;if("wheel"===this._type&&x&&w){const F=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),$=w(F);S=c.number(x,m,$),F<1?this._frameId||(this._frameId=!0):P=!0}else S=m,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:S-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=c.ease;if(this._prevEase){const m=this._prevEase,x=(c.exported.now()-m.start)/m.duration,w=m.easing(x+.01)-m.easing(x),S=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-S*S);l=c.bezier(S,P,.25,1)}return this._prevEase={start:c.exported.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class wu{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xu{constructor(){this._tap=new Ba({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,l,m))}touchmove(i,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=l[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,l,m)}touchend(i,l,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(i,l,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jc{constructor(i,l,m){this._el=i,this._mousePan=l,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xl{constructor(i,l,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Du{constructor(i,l,m,x){this._el=i,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Tu=d=>d.zoom||d.drag||d.pitch||d.rotate;class io extends c.Event{}class Kc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const m=c.sub([],l,i);this.radius=c.length(m[2]<0?c.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){c.div(i,i,this.constants),c.normalize(i,i),c.mul$1(i,i,this.constants);const l=c.scale$2([],i,this.radius);if(l[2]>0){const m=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),x=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),w=c.add([],l,c.scale$2([],c.sub([],c.add([],x,m),l),2));l[0]=w[0],l[1]=w[1]}return l}}function wa(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class oh{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tl(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Kc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[x,w,S]of this._listeners)x.addEventListener(w,x===c.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[i,l,m]of this._listeners)i.removeEventListener(l,i===c.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new qc(l,i));const x=l.boxZoom=new yo(l,i);this._add("boxZoom",x);const w=new Yc,S=new Yu;l.doubleClickZoom=new wu(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const P=new Xu;this._add("tapDragZoom",P);const F=l.touchPitch=new Xc(l);this._add("touchPitch",F);const $=new za(i),Z=new Uo(i);l.dragRotate=new Xl(i,$,Z),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]);const ne=new qu(i),se=new xu(l,i);l.dragPan=new Jc(m,ne,se),this._add("mousePan",ne),this._add("touchPan",se,["touchZoom","touchRotate"]);const ve=new Hr,de=new as;l.touchZoomRotate=new Du(m,de,ve,P),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",de,["touchPan","touchRotate"]),this._add("blockableMapEvent",new no(l));const me=l.scrollZoom=new Yl(l,this);this._add("scrollZoom",me,["mousePan"]);const ge=l.keyboard=new Qi;this._add("keyboard",ge);for(const fe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[fe]&&l[fe].enable(i[fe])}_add(i,l,m){this._handlers.push({handlerName:i,handler:l,allowed:m}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Tu(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,l,m){for(const x in i)if(x!==m&&(!l||l.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const m of i)this._el.contains(m.target)&&l.push(m);return l}handleEvent(i,l){this._updatingCamera=!0;const m="renderFrame"===i.type,x=m?void 0:i,w={needsRenderFrame:!1},S={},P={},F=i.touches?this._getMapTouches(i.touches):void 0,$=F?vn(this._el,F):m?void 0:on(this._el,i);for(const{handlerName:se,handler:ve,allowed:de}of this._handlers){if(!ve.isEnabled())continue;let me;this._blockedByActive(P,de,se)?ve.reset():ve[l||i.type]&&(me=ve[l||i.type](i,$,F),this.mergeHandlerResult(w,S,me,se,x),me&&me.needsRenderFrame&&this._triggerRenderFrame()),(me||ve.isActive())&&(P[se]=ve)}const Z={};for(const se in this._previousActiveHandlers)P[se]||(Z[se]=x);this._previousActiveHandlers=P,(Object.keys(Z).length||wa(w))&&(this._changes.push([w,S,Z]),this._triggerRenderFrame()),(Object.keys(P).length||wa(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ne}=w;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))}mergeHandlerResult(i,l,m,x,w){if(!m)return;c.extend(i,m);const S={handlerName:x,originalEvent:m.originalEvent||w};void 0!==m.zoomDelta&&(l.zoom=S),void 0!==m.panDelta&&(l.drag=S),void 0!==m.pitchDelta&&(l.pitch=S),void 0!==m.bearingDelta&&(l.rotate=S)}_applyChanges(){const i={},l={},m={};for(const[x,w,S]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new c.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(i.around=x.around),void 0!==x.aroundCoord&&(i.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),c.extend(l,w),c.extend(m,S);this._updateMapTransform(i,l,m),this._changes=[]}_updateMapTransform(i,l,m){const x=this._map,w=x.transform,S=De=>[De.x,De.y,De.z];if((De=>{const we=this._eventsInProgress.drag;return we&&!this._handlersById[we.handlerName].isActive()})()&&!wa(i)){const De=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",De!==w.zoom&&this._map._update(!0)}if(!wa(i))return void this._fireEvents(l,m,!0);let{panDelta:P,zoomDelta:F,bearingDelta:$,pitchDelta:Z,around:ne,aroundCoord:se,pinchAround:ve}=i;void 0!==ve&&(ne=ve),(De=>l.drag&&!this._eventsInProgress.drag)()&&ne&&(this._dragOrigin=S(w.pointCoordinate3D(ne)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),ne=ne||x.transform.centerPoint,$&&(w.bearing+=$),Z&&(w.pitch+=Z),w._updateCameraState();const de=[0,0,0];if(P)if("mercator"===w.projection.name){const De=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(ne).dir),we=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(ne.sub(P)).dir);de[0]=we[0]-De[0],de[1]=we[1]-De[1]}else{const De=w.pointCoordinate(ne);if("globe"===w.projection.name){P=P.rotate(-w.angle);const we=w._pixelsPerMercatorPixel/w.worldSize;de[0]=-P.x*c.mercatorScale(c.latFromMercatorY(De.y))*we,de[1]=-P.y*c.mercatorScale(w.center.lat)*we}else{const we=w.pointCoordinate(ne.sub(P));De&&we&&(de[0]=we.x-De.x,de[1]=we.y-De.y)}}const me=w.zoom,ge=[0,0,0];if(F){const De=S(se||w.pointCoordinate3D(ne)),we={dir:c.normalize([],c.sub([],De,w._camera.position))};if(we.dir[2]<0){const qe=w.zoomDeltaToMovement(De,F);c.scale$2(ge,we.dir,qe)}}const fe=c.add(de,de,ge);w._translateCameraConstrained(fe),F&&Math.abs(w.zoom-me)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,m,!0)}_fireEvents(i,l,m){const x=Tu(this._eventsInProgress),w=Tu(i),S={};for(const Z in i){const{originalEvent:ne}=i[Z];this._eventsInProgress[Z]||(S[`${Z}start`]=ne),this._eventsInProgress[Z]=i[Z]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const Z in S)this._fireEvent(Z,S[Z]);w&&this._fireEvent("move",w.originalEvent);for(const Z in i){const{originalEvent:ne}=i[Z];this._fireEvent(Z,ne)}const P={};let F;for(const Z in this._eventsInProgress){const{handlerName:ne,originalEvent:se}=this._eventsInProgress[Z];this._handlersById[ne].isActive()||(delete this._eventsInProgress[Z],F=l[ne]||se,P[`${Z}end`]=F)}for(const Z in P)this._fireEvent(Z,P[Z]);const $=Tu(this._eventsInProgress);if(m&&(x||w)&&!$){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=se=>0!==se&&-this._bearingSnap<se&&se<this._bearingSnap;Z?(ne(Z.bearing||this._map.getBearing())&&(Z.bearing=0),this._map.easeTo(Z,{originalEvent:F})):(this._map.fire(new c.Event("moveend",{originalEvent:F})),ne(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new c.Event(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new io("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Qc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class vo extends c.Evented{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,m){return i=c.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,c.extend({offset:i},l),m)}panTo(i,l,m){return this.easeTo(c.extend({center:i},l),m)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,m){return this.easeTo(c.extend({zoom:i},l),m)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,m){return this.easeTo(c.extend({bearing:i},l),m)}resetNorth(i,l){return this.rotateTo(0,c.extend({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){"globe"===this.transform.projection.name&&c.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),i=c.LngLatBounds.convert(i);const m=l&&l.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),m,l)}_extendCameraOptions(i){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=c.extend(l,i.padding),i}_cameraForBoxAndBearing(i,l,m,x){const w=this._extendCameraOptions(x),S=this.transform,P=S.padding,F=S.project(c.LngLat.convert(i)),$=S.project(c.LngLat.convert(l)),Z=new c.pointGeometry(F.x,$.y),ne=new c.pointGeometry($.x,F.y),se=-c.degToRad(m),ve=F.rotate(se),de=$.rotate(se),me=Z.rotate(se),ge=ne.rotate(se),fe=new c.pointGeometry(Math.max(ve.x,de.x,me.x,ge.x),Math.max(ve.y,de.y,me.y,ge.y)),De=new c.pointGeometry(Math.min(ve.x,de.x,me.x,ge.x),Math.min(ve.y,de.y,me.y,ge.y)),we=fe.sub(De),qe=(S.width-((P.left||0)+(P.right||0)+w.padding.left+w.padding.right))/we.x,Ue=(S.height-((P.top||0)+(P.bottom||0)+w.padding.top+w.padding.bottom))/we.y;if(Ue<0||qe<0)return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ne=Math.min(S.scaleZoom(S.scale*Math.min(qe,Ue)),w.maxZoom),je="number"==typeof w.offset.x&&"number"==typeof w.offset.y?new c.pointGeometry(w.offset.x,w.offset.y):c.pointGeometry.convert(w.offset),Le=new c.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(m*Math.PI/180),Je=je.add(Le).mult(S.scale/S.zoomScale(Ne));return{center:S.unproject(F.add($).div(2).sub(Je)),zoom:Ne,bearing:m}}_cameraForBox(i,l,m,x,w){const S=this._extendCameraOptions(w);m=m||0,x=x||0,i=c.LngLat.convert(i),l=c.LngLat.convert(l);const P=this.transform.clone();P.padding=S.padding;const F=this.getFreeCameraOptions(),$=new c.LngLat(.5*(i.lng+l.lng),.5*(i.lat+l.lat)),Z=.5*(m+x);if(P._camera.position[2]<c.mercatorZfromAltitude(Z,$.lat))return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");F.lookAtPoint($),P.setFreeCameraOptions(F);const ne=c.MercatorCoordinate.fromLngLat(i),se=c.MercatorCoordinate.fromLngLat(l),ve=P.pointRayIntersection(P.centerPoint,Z),de=[(me=P.rayIntersectionCoordinate(ve)).x,me.y,me.z];var me;const ge=P.screenPointToMercatorRay(P.centerPoint),fe="globe"!==P.projection.name;let De,we=0;do{const qe=Math.floor(P.zoom),Ue=1<<qe,Ne=Math.min(Ue*ne.x,Ue*se.x),je=Math.min(Ue*ne.y,Ue*se.y),Le=Math.max(Ue*ne.x,Ue*se.x),Je=Math.max(Ue*ne.y,Ue*se.y),tt=new c.Aabb([Ne,je,m],[Le,Je,x]),nn=c.Frustum.fromInvProjectionMatrix(P.invProjMatrix,P.worldSize,qe,fe);if(2!==tt.intersects(nn)){De&&(P._camera.position=c.scaleAndAdd([],P._camera.position,ge.dir,-De),P._updateStateFromCamera());break}const rt=c.sub([],P._camera.position,de);De=.5*c.length(rt),P._camera.position=c.scaleAndAdd([],P._camera.position,ge.dir,De);try{P._updateStateFromCamera()}catch{return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++we<10);return{center:P.center,zoom:P.zoom,bearing:P.bearing,pitch:P.pitch}}fitBounds(i,l,m){return"globe"===this.transform.projection.name&&c.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(i,l),l,m)}_raycastElevationBox(i,l){const m=this.transform.elevation;if(!m)return;const x=new c.pointGeometry(i.x,l.y),w=new c.pointGeometry(l.x,i.y),S=m.pointCoordinate(i);if(!S)return;const P=m.pointCoordinate(l);if(!P)return;const F=m.pointCoordinate(x);if(!F)return;const $=m.pointCoordinate(w);if(!$)return;const Z=new c.MercatorCoordinate(S[0],S[1]).toLngLat(),ne=new c.MercatorCoordinate(P[0],P[1]).toLngLat(),se=new c.MercatorCoordinate(F[0],F[1]).toLngLat(),ve=new c.MercatorCoordinate($[0],$[1]).toLngLat(),de=Math.min(Z.lng,Math.min(ne.lng,Math.min(se.lng,ve.lng))),me=Math.min(Z.lat,Math.min(ne.lat,Math.min(se.lat,ve.lat))),ge=Math.max(Z.lng,Math.max(ne.lng,Math.max(se.lng,ve.lng))),fe=Math.max(Z.lat,Math.max(ne.lat,Math.max(se.lat,ve.lat))),De=Math.min(S[3],Math.min(P[3],Math.min(F[3],$[3]))),we=Math.max(S[3],Math.max(P[3],Math.max(F[3],$[3])));return{minLngLat:new c.LngLat(de,me),maxLngLat:new c.LngLat(ge,fe),minAltitude:De,maxAltitude:we}}fitScreenCoordinates(i,l,m,x,w){let S,P,F,$;"globe"===this.transform.projection.name&&c.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const Z=c.pointGeometry.convert(i),ne=c.pointGeometry.convert(l),se=this._raycastElevationBox(Z,ne);if(se)S=se.minLngLat,P=se.maxLngLat,F=se.minAltitude,$=se.maxAltitude;else{if(this.transform.anyCornerOffEdge(Z,ne))return this;S=this.transform.pointLocation(Z),P=this.transform.pointLocation(ne)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(c.pointGeometry.convert(i)),this.transform.pointLocation(c.pointGeometry.convert(l)),m,x):this._cameraForBox(S,P,F,$,x),x,w)}_fitInternal(i,l,m){return i?(delete(l=c.extend(i,l)).padding,l.linear?this.easeTo(l,m):this.flyTo(l,m)):this}jumpTo(i,l){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,S=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(x=!0,m.zoom=+i.zoom),void 0!==i.center&&(m.center=c.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(w=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(S=!0,m.pitch=+i.pitch),null==i.padding||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),x&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),w&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),S&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(Qc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return c.warnOnce(Qc),this;this.stop();const x=m.zoom,w=m.pitch,S=m.bearing;m.setFreeCameraOptions(i);const P=x!==m.zoom,F=w!==m.pitch,$=S!==m.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),P&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),$&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),F&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),(!1===(i=c.extend({offset:[0,0],duration:500,easing:c.ease},i)).animate||!i.essential&&c.exported.prefersReducedMotion)&&(i.duration=0);const m=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),P=this.getPadding(),F="zoom"in i?+i.zoom:x,$="bearing"in i?this._normalizeBearing(i.bearing,w):w,Z="pitch"in i?+i.pitch:S,ne="padding"in i?i.padding:m.padding,se=c.pointGeometry.convert(i.offset);let ve,de,me;if("globe"===m.projection.name){const Je=c.MercatorCoordinate.fromLngLat(m.center),tt=se.rotate(-m.angle);Je.x+=tt.x/m.worldSize,Je.y+=tt.y/m.worldSize;const nn=Je.toLngLat(),rt=c.LngLat.convert(i.center||nn);this._normalizeCenter(rt),ve=m.centerPoint.add(tt),de=new c.pointGeometry(Je.x,Je.y).mult(m.worldSize),me=new c.pointGeometry(c.mercatorXfromLng(rt.lng),c.mercatorYfromLat(rt.lat)).mult(m.worldSize).sub(de)}else{ve=m.centerPoint.add(se);const Je=m.pointLocation(ve),tt=c.LngLat.convert(i.center||Je);this._normalizeCenter(tt),de=m.project(Je),me=m.project(tt).sub(de)}const ge=m.zoomScale(F-x);let fe,De;i.around&&(fe=c.LngLat.convert(i.around),De=m.locationPoint(fe));const we=this._zooming||F!==x,qe=this._rotating||w!==$,Ue=this._pitching||Z!==S,Ne=!m.isPaddingEqual(ne),je=Je=>tt=>{if(we&&(Je.zoom=c.number(x,F,tt)),qe&&(Je.bearing=c.number(w,$,tt)),Ue&&(Je.pitch=c.number(S,Z,tt)),Ne&&(Je.interpolatePadding(P,ne,tt),ve=Je.centerPoint.add(se)),fe)Je.setLocationAtPoint(fe,De);else{const nn=Je.zoomScale(Je.zoom-x),rt=F>x?Math.min(2,ge):Math.max(.5,ge),Pt=Math.pow(rt,1-tt),Bt=Je.unproject(de.add(me.mult(tt*Pt)).mult(nn));Je.setLocationAtPoint(Je.renderWorldCopies?Bt.wrap():Bt,ve)}return i.preloadOnly||this._fireMoveEvents(l),Je};if(i.preloadOnly){const Je=this._emulate(je,i.duration,m);return this._preloadTiles(Je),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=qe,this._pitching=Ue,this._padding=Ne,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,Le),this._ease(je(m),Je=>{m.recenterOnTerrain(),this._afterEase(l,Je)},i),this}_prepareEase(i,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||m.moving||this.fire(new c.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new c.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new c.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new c.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new c.Event("move",i)),this._zooming&&this.fire(new c.Event("zoom",i)),this._rotating&&this.fire(new c.Event("rotate",i)),this._pitching&&this.fire(new c.Event("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new c.Event("zoomend",i)),x&&this.fire(new c.Event("rotateend",i)),w&&this.fire(new c.Event("pitchend",i)),this.fire(new c.Event("moveend",i))}flyTo(i,l){if(!i.essential&&c.exported.prefersReducedMotion){const yn=c.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yn,l)}this.stop(),i=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},i);const m=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),P=this.getPadding(),F="zoom"in i?c.clamp(+i.zoom,m.minZoom,m.maxZoom):x,$="bearing"in i?this._normalizeBearing(i.bearing,w):w,Z="pitch"in i?+i.pitch:S,ne="padding"in i?i.padding:m.padding,se=m.zoomScale(F-x),ve=c.pointGeometry.convert(i.offset);let de=m.centerPoint.add(ve);const me=m.pointLocation(de),ge=c.LngLat.convert(i.center||me);this._normalizeCenter(ge);const fe=m.project(me),De=m.project(ge).sub(fe);let we=i.curve;const qe=Math.max(m.width,m.height),Ue=qe/se,Ne=De.mag();if("minZoom"in i){const yn=c.clamp(Math.min(i.minZoom,x,F),m.minZoom,m.maxZoom),fn=qe/m.zoomScale(yn-x);we=Math.sqrt(fn/Ne*2)}const je=we*we;function Le(yn){const fn=(Ue*Ue-qe*qe+(yn?-1:1)*je*je*Ne*Ne)/(2*(yn?Ue:qe)*je*Ne);return Math.log(Math.sqrt(fn*fn+1)-fn)}function Je(yn){return(Math.exp(yn)-Math.exp(-yn))/2}function tt(yn){return(Math.exp(yn)+Math.exp(-yn))/2}const nn=Le(0);let rt=function(yn){return tt(nn)/tt(nn+we*yn)},Pt=function(yn){return qe*((tt(nn)*(Je(fn=nn+we*yn)/tt(fn))-Je(nn))/je)/Ne;var fn},Bt=(Le(1)-nn)/we;if(Math.abs(Ne)<1e-6||!isFinite(Bt)){if(Math.abs(qe-Ue)<1e-6)return this.easeTo(i,l);const yn=Ue<qe?-1:1;Bt=Math.abs(Math.log(Ue/qe))/we,Pt=function(){return 0},rt=function(fn){return Math.exp(yn*we*fn)}}i.duration="duration"in i?+i.duration:1e3*Bt/("screenSpeed"in i?+i.screenSpeed/we:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const un=w!==$,_t=Z!==S,en=!m.isPaddingEqual(ne),kt=yn=>fn=>{const Fn=fn*Bt,$n=1/rt(Fn);yn.zoom=1===fn?F:x+yn.scaleZoom($n),un&&(yn.bearing=c.number(w,$,fn)),_t&&(yn.pitch=c.number(S,Z,fn)),en&&(yn.interpolatePadding(P,ne,fn),de=yn.centerPoint.add(ve));const ci=1===fn?ge:yn.unproject(fe.add(De.mult(Pt(Fn))).mult($n));return yn.setLocationAtPoint(yn.renderWorldCopies?ci.wrap():ci,de),yn._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),yn};if(i.preloadOnly){const yn=this._emulate(kt,i.duration,m);return this._preloadTiles(yn),this}return this._zooming=!0,this._rotating=un,this._pitching=_t,this._padding=en,this._prepareEase(l,!1),this._ease(kt(m),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,l)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,l,m){!1===m.animate||0===m.duration?(i(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=c.wrap(i,-180,180);const m=Math.abs(i-l);return Math.abs(i-360-l)<m&&(i-=360),Math.abs(i+360-l)<m&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const m=i.lng-l.center.lng;i.lng+=m>180?-360:m<-180?360:0}_emulate(i,l,m){const x=Math.ceil(15*l/1e3),w=[],S=i(m.clone());for(let P=0;P<=x;P++){const F=S(P/x);w.push(F.clone())}return w}}class Gs{constructor(i={}){this.options=i,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact;return this._map=i,this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xt("button","mapboxgl-ctrl-attrib-button",this._container),xt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,l){const m=this._map._getUIString(`AttributionControl.${l}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(i){const m=l.reduce((x,w,S)=>(w.value&&(x+=`${w.key}=${w.value}${S<l.length-1?"&":""}`),x),"?");i.href=`${c.config.FEEDBACK_URL}/${m}#${_c(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const l=this._map.style._sourceCaches;for(const x in l){const w=l[x];if(w.used){const S=w.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort((x,w)=>x.length-w.length),i=i.filter((x,w)=>{for(let S=w+1;S<i.length;S++)if(i[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Va{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=xt("div","mapboxgl-ctrl");const l=xt("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const l in i){const m=i[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Ua{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const x of m)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Jl(d,i,l){if(d=new c.LngLat(d.lng,d.lat),i){const m=new c.LngLat(d.lng-360,d.lat),x=new c.LngLat(d.lng+360,d.lat),w=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),S=l.locationPoint(d).distSqr(i),P=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(m).distSqr(i)<S&&(P||Math.abs(m.lng-l.center.lng)<w)?d=m:l.locationPoint(x).distSqr(i)<S&&(P||Math.abs(x.lng-l.center.lng)<w)&&(d=x)}for(;Math.abs(d.lng-l.center.lng)>180;){const m=l.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const O={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class k extends c.Evented{constructor(i,l){if(super(),(i instanceof c.window.HTMLElement||l)&&(i=c.extend({element:i},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=c.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=xt("div");const x=41,w=27,S=ut("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),P=ut("radialGradient",{id:"shadowGradient"},ut("defs",{},S));ut("stop",{offset:"10%","stop-opacity":.4},P),ut("stop",{offset:"100%","stop-opacity":.05},P),ut("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),ut("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),ut("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),ut("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=c.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in O)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=c.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,m=i.charCode||i.keyCode;"Space"!==l&&"Enter"!==l&&32!==m&&13!==m||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map;if(!i)return!1;const l=i.unproject(this._pos),m=i.getFreeCameraOptions();if(!m.position)return!1;const x=m.position.toLngLat();return x.distanceTo(l)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(l);let x;i._showingGlobe()&&c.isLngLatBehindGlobe(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=.2)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px)\n            ${O[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const i=this._pos,l=this._map,m=this.getPitchAlignment();if(!l||!i||"map"!==m)return"";if(!l._showingGlobe()){const F=l.getPitch();return F?`rotateX(${F}deg)`:""}const x=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),w=i.sub(c.globeCenterToScreenPoint(l.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(0===S)return"";const P=x/S;return`rotateX(${-w.y*P}deg) rotateY(${w.x*P}deg)`}_calculateZTransform(){const i=this._pos,l=this._map;if(!l||!i)return"";let m=0;const x=this.getRotationAlignment();if("map"===x)if(l._showingGlobe()){const w=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);m=c.radToDeg(Math.atan2(S.y,S.x))-90}else m=-l.getBearing();else if("horizon"===x){const w=c.smoothstep(4,6,l.getZoom()),S=c.globeCenterToScreenPoint(l.transform);S.y+=w*l.transform.height;const P=i.sub(S),F=c.radToDeg(Math.atan2(P.y,P.x));m=(F>90?F-270:F+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Jl(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===i?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=c.pointGeometry.convert(i),this._update(),this}_onMove(i){const l=this._map;if(l){if(!this._isDragging){const m=this._clickTolerance||l._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(i){const l=this._map;l&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class A{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=c.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,m){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+m}}const U={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Y={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ae(d){d.parentNode&&d.parentNode.removeChild(d)}const Ie={showCompass:!0,showZoom:!0,visualizePitch:!1};class ke{constructor(i,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new za({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Uo({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),jt()}move(i,l){const m=this.map,x=this.mouseRotate.mousemoveWindow(i,l),w=x&&x.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(i,l),P=S&&S.pitchDelta;P&&m.setPitch(m.getPitch()+P)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xt(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(c.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),on(this.element,i)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,on(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=vn(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=vn(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Tt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},En={maxWidth:100,unit:"metric"};function gi(d,i,l){const m=gn(i),x=m/i,w={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=d*x+"px",this._container.innerHTML=`${m}&nbsp;${w}`})}function gn(d){const i=Math.pow(10,`${Math.floor(d)}`.length-1);let l=d/i;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(m){const x=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*x)/x}(l),i*l}const er={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ls=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $s(d=new c.pointGeometry(0,0),i="bottom"){if("number"==typeof d){const l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new c.pointGeometry(0,d);case"top-left":return new c.pointGeometry(l,l);case"top-right":return new c.pointGeometry(-l,l);case"bottom":return new c.pointGeometry(0,-d);case"bottom-left":return new c.pointGeometry(l,-l);case"bottom-right":return new c.pointGeometry(-l,-l);case"left":return new c.pointGeometry(d,0);case"right":return new c.pointGeometry(-d,0)}return new c.pointGeometry(0,0)}return d instanceof c.pointGeometry||Array.isArray(d)?c.pointGeometry.convert(d):c.pointGeometry.convert(d[i]||[0,0])}const la={version:c.version,supported:Vt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends vo{constructor(d){if(null!=(d=c.extend({},Y,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(d.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wc(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language="auto"===d.language?c.window.navigator.language:d.language,this._worldview=d.worldview,this._renderTaskQueue=new Ua,this._domRenderTaskQueue=new Ua,this._controls=[],this._markers=[],this._mapId=c.uniqueId(),this._locale=c.extend({},U,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new A(0),this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=c.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new oh(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new Hu("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,c.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Gs({customAttribution:d.customAttribution})),this._logoControl=new Va,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new c.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new c.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(d,i){if(void 0===i&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[i];return-1!==i.indexOf("bottom")?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new c.Event("movestart",d)).fire(new c.Event("move",d)),this.fire(new c.Event("resize",d)),i&&this.fire(new c.Event("moveend",d)),this}getBounds(){return"globe"===this.transform.projection.name&&c.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(c.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getLanguage(){return this._language}setLanguage(d){if(this._language="auto"===d?c.window.navigator.language:d,this.style)for(const i in this.style._sourceCaches){const l=this.style._sourceCaches[i]._source;l._setLanguage&&l._setLanguage(this._language)}for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){if(this._worldview=d,this.style)for(const i in this.style._sourceCaches){const l=this.style._sourceCaches[i]._source;l._setWorldview&&l._setWorldview(d)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(d){return this._lazyInitEmptyStyle(),d?"string"==typeof d&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const d=this.transform,i=d.projection.name;let l;"globe"===i&&d.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),l=!0):"mercator"===i&&d.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;if(i="globe"===d.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0)}return this}project(d){return this.transform.locationPoint3D(c.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(c.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(d,i,l){if("mouseenter"===d||"mouseover"===d){let m=!1;const x=S=>{const P=i.filter($=>this.getLayer($)),F=P.length?this.queryRenderedFeatures(S.point,{layers:P}):[];F.length?m||(m=!0,l.call(this,new Xo(d,this,S.originalEvent,{features:F}))):m=!1},w=()=>{m=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:x,mouseout:w}}}if("mouseleave"===d||"mouseout"===d){let m=!1;const x=S=>{const P=i.filter(F=>this.getLayer(F));(P.length?this.queryRenderedFeatures(S.point,{layers:P}):[]).length?m=!0:m&&(m=!1,l.call(this,new Xo(d,this,S.originalEvent)))},w=S=>{m&&(m=!1,l.call(this,new Xo(d,this,S.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:x,mouseout:w}}}{const m=x=>{const w=i.filter(P=>this.getLayer(P)),S=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];S.length&&(x.features=S,l.call(this,x),delete x.features)};return{layers:new Set(i),listener:l,delegates:{[d]:m}}}}on(d,i,l){if(void 0===l)return super.on(d,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(d,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(d,i,l){if(void 0===l)return super.once(d,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(d,i,l);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(d,i,l){if(void 0===l)return super.off(d,i);i=new Set(Array.isArray(i)?i:[i]);const m=(w,S)=>{if(w.size!==S.size)return!1;for(const P of w)if(!S.has(P))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[d]:void 0;return x&&(w=>{for(let S=0;S<w.length;S++){const P=w[S];if(P.listener===l&&m(P.layers,i)){for(const F in P.delegates)this.off(F,P.delegates[F]);return w.splice(S,1),this}}})(x),this}queryRenderedFeatures(d,i){return this.style?(void 0!==i||void 0===d||d instanceof c.pointGeometry||Array.isArray(d)||(i=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(d,i){return this.style.querySourceFeatures(d,i)}queryTerrainElevation(d,i){const l=this.transform.elevation;return l?(i=c.extend({},{exaggerated:!0},i),l.getAtPoint(c.MercatorCoordinate.fromLngLat(d),null,i.exaggerated)):null}setStyle(d,i){return!1!==(i=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){const i=this._locale[d];if(null==i)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new qo(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new qo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,i){if("string"==typeof d){const l=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(m,(x,w)=>{x?this.fire(new c.ErrorEvent(x)):w&&this._updateDiff(w,i)})}else"object"==typeof d&&this._updateDiff(d,i)}_updateDiff(d,i){try{this.style.setState(d)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(d,i){return this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const i in d){const l=d[i]._tiles;for(const m in l){const x=l[m];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(d,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,i,{pixelRatio:l=1,sdf:m=!1,stretchX:x,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap){const{width:P,height:F,data:$}=c.exported.getImageData(i);this.style.addImage(d,{data:new c.RGBAImage({width:P,height:F},$),pixelRatio:l,stretchX:x,stretchY:w,content:S,sdf:m,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:F}=i,$=i;this.style.addImage(d,{data:new c.RGBAImage({width:P,height:F},new Uint8Array($.data)),pixelRatio:l,stretchX:x,stretchY:w,content:S,sdf:m,version:0,userImage:$}),$.onAdd&&$.onAdd(this,d)}}updateImage(d,i){const l=this.style.getImage(d);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap?c.exported.getImageData(i):i,{width:x,height:w}=m;void 0!==x&&void 0!==w?x===l.data.width&&w===l.data.height?(l.data.replace(m.data,!(i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap)),this.style.updateImage(d,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${w})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){c.getImage(this._requestManager.transformRequest(d,c.ResourceType.Image),(l,m)=>{i(l,m instanceof c.window.HTMLImageElement?c.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,i){return this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)}moveLayer(d,i){return this.style.moveLayer(d,i),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,i,l){return this.style.setLayerZoomRange(d,i,l),this._update(!0)}setFilter(d,i,l={}){return this.style.setFilter(d,i,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,i,l,m={}){return this.style.setPaintProperty(d,i,l,m),this._update(!0)}getPaintProperty(d,i){return this.style.getPaintProperty(d,i)}setLayoutProperty(d,i,l,m={}){return this.style.setLayoutProperty(d,i,l,m),this._update(!0)}getLayoutProperty(d,i){return this.style.getLayoutProperty(d,i)}setLight(d,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(d),this.transform):0}setFeatureState(d,i){return this.style.setFeatureState(d,i),this._update()}removeFeatureState(d,i){return this.style.removeFeatureState(d,i),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,m,x,w=this._container;for(;w&&(!m||!x);){const S=c.window.getComputedStyle(w).transform;S&&"none"!==S&&(l=S.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(m=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(x=l[3])),w=w.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=xt("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=xt("div","mapboxgl-canvas-container",d);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=xt("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=xt("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=xt("div",`mapboxgl-ctrl-${x}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const i=this._markers.indexOf(d);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const d=c.extend({},Vt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);i?(c.storeAuthState(i,!0),this.painter=new $u(i,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(i)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;const l=this.painter.context.extTimerQuery,m=c.exported.now();if(this.listens("gpu-timing-frame")&&(i=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let x=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,$=this.transform.pitch,Z=c.exported.now();this.style.zoomHistory.update(F,Z);const ne=new c.EvaluationParameters(F,{now:Z,fadeDuration:w,pitch:$,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=ne.crossFadingFactor();1===se&&se===this._crossFadingFactor||(x=!0,this._crossFadingFactor=se),this.style.update(ne)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):S=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const F=c.exported.now()-m;l.endQueryEXT(l.TIME_ELAPSED_EXT,i),setTimeout(()=>{const $=l.getQueryObjectEXT(i,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(i),this.fire(new c.Event("gpu-timing-frame",{cpuTime:F,gpuTime:$})),c.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:$}})},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const $=this.painter.queryGpuTimers(F);this.fire(new c.Event("gpu-timing-layer",{layerTimes:$}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const $=this.painter.queryGpuTimeDeferredRender(F);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:$}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(P||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const $=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:$})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,i=!1){const l=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const S=Math.abs(m-x);if(S>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(x),l(x);this._averageElevation.easeTo(x,d,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),l(x)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===c.AUTH_ERR_MSG||401===d.status)){const i=this.painter.context.gl;c.storeAuthState(i,!1),this._logoControl instanceof Va&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function x(w){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,w,0);const S=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,S),S}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(x(d),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(d,i,l){let m=l[1]-l[0];const x=d.length/4;for(let w=0;w<i.length;w++){const S=i[w];let P=0;for(let F=0;F<S.length;F+=4)S[F]===d[F]&&S[F+1]===d[F+1]&&S[F+2]===d[F+2]&&S[F+3]===d[F+3]&&(P+=1);m+=(l[w+2]-l[w+1])*(1-P/x)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),ae(this._canvasContainer),ae(this._controlContainer),ae(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=c.exported.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(d){const i=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(i,(l,m)=>l._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,i){c.setCacheLimits(d,i)}get version(){return c.version}},NavigationControl:class{constructor(d){this.options=c.extend({},Ie,d),this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),xt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),xt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=xt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const i=d.getZoom(),l=i===d.getMaxZoom(),m=i===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ke(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){const l=xt("button",d,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(d,i){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(d){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},Tt,d),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Hl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){void 0!==this._supportsGeolocation?d(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(i=>{this._supportsGeolocation="denied"!==i.state,d(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,d(this._supportsGeolocation))}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),l=d.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",d)),this._finish()}}_updateCamera(d){const i=new c.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,m=this._map.getBearing(),x=c.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),x,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new c.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,i=c.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=xt("button","mapboxgl-ctrl-geolocate",this._container),xt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===d){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xt("div","mapboxgl-user-location"),this._dotElement.appendChild(xt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new k({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new k({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Gs,ScaleControl:class{constructor(d){this.options=c.extend({},En,d),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=gi.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,m=i._containerWidth/2-d/2,x=i.unproject([m,l]),w=i.unproject([m+d,l]),S=x.distanceTo(w);if("imperial"===this.options.unit){const P=3.2808*S;P>5280?this._setScale(d,P/5280,"mile"):this._setScale(d,P,"foot")}else"nautical"===this.options.unit?this._setScale(d,S/1852,"nautical-mile"):S>=1e3?this._setScale(d,S/1e3,"kilometer"):this._setScale(d,S,"meter")}_setScale(d,i,l){const m=gn(i),x=m/i;this._map._requestDomTask(()=>{this._container.style.width=d*x+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(m):`${m}&nbsp;nm`})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof c.window.HTMLElement?this._container=d.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=xt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xt("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(d){super(),this.options=c.extend(Object.create(er),d),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=c.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(c.window.document.createTextNode(d))}setHTML(d){const i=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let m;for(l.innerHTML=d;m=l.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=xt("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){const l=this._closeButton=xt("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const i=this._map,l=this._container,m=this._pos;if(!i||!l||!m)return"bottom";const x=l.offsetWidth,w=l.offsetHeight,S=m.x<x/2,P=m.x>i.transform.width-x/2;if(m.y+d<w)return S?"top-left":P?"top-right":"top";if(m.y>i.transform.height-w){if(S)return"bottom-left";if(P)return"bottom-right"}return S?"left":P?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){const i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let m=this._container;if(m||(m=this._container=xt("div","mapboxgl-popup",i.getContainer()),this._tip=xt("div","mapboxgl-popup-tip",m),m.appendChild(l)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jl(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){const x=this._pos=this._trackPointer&&d?d:i.project(this._lngLat),w=$s(this.options.offset),S=this._anchor=this._getAnchor(w.y),P=$s(this.options.offset,S),F=x.add(P).round();i._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${O[S]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=c.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ls);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:k,Style:qo,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:bn,Evented:c.Evented,config:c.config,prewarm:function(){Rn().acquire(Pe)},clearPrewarmedResources:function(){const d=qt;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(Pe),qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(d){c.config.ACCESS_TOKEN=d},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(d){c.config.API_URL=d},get workerCount(){return ft.workerCount},set workerCount(d){ft.workerCount=d},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){c.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){c.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return la}),_}()},1135:(Yn,Ut,he)=>{"use strict";he.d(Ut,{X:()=>Q});var _=he(7579);class Q extends _.x{constructor(c){super(),this._value=c}get value(){return this.getValue()}_subscribe(c){const ze=super._subscribe(c);return!ze.closed&&c.next(this._value),ze}getValue(){const{hasError:c,thrownError:ze,_value:Vt}=this;if(c)throw ze;return this._throwIfClosed(),Vt}next(c){super.next(this._value=c)}}},9751:(Yn,Ut,he)=>{"use strict";he.d(Ut,{y:()=>st});var _=he(930),Q=he(727),ot=he(8822),c=he(9635),ze=he(2416),Vt=he(576),Ft=he(2806);let st=(()=>{class lt{constructor(jt){jt&&(this._subscribe=jt)}lift(jt){const Xt=new lt;return Xt.source=this,Xt.operator=jt,Xt}subscribe(jt,Xt,Gt){const xn=function Et(lt){return lt&&lt instanceof _.Lv||function ut(lt){return lt&&(0,Vt.m)(lt.next)&&(0,Vt.m)(lt.error)&&(0,Vt.m)(lt.complete)}(lt)&&(0,Q.Nn)(lt)}(jt)?jt:new _.Hp(jt,Xt,Gt);return(0,Ft.x)(()=>{const{operator:on,source:vn}=this;xn.add(on?on.call(xn,vn):vn?this._subscribe(xn):this._trySubscribe(xn))}),xn}_trySubscribe(jt){try{return this._subscribe(jt)}catch(Xt){jt.error(Xt)}}forEach(jt,Xt){return new(Xt=xt(Xt))((Gt,xn)=>{const on=new _.Hp({next:vn=>{try{jt(vn)}catch(ki){xn(ki),on.unsubscribe()}},error:xn,complete:Gt});this.subscribe(on)})}_subscribe(jt){var Xt;return null===(Xt=this.source)||void 0===Xt?void 0:Xt.subscribe(jt)}[ot.L](){return this}pipe(...jt){return(0,c.U)(jt)(this)}toPromise(jt){return new(jt=xt(jt))((Xt,Gt)=>{let xn;this.subscribe(on=>xn=on,on=>Gt(on),()=>Xt(xn))})}}return lt.create=dn=>new lt(dn),lt})();function xt(lt){var dn;return null!==(dn=lt??ze.v.Promise)&&void 0!==dn?dn:Promise}},7579:(Yn,Ut,he)=>{"use strict";he.d(Ut,{x:()=>Ft});var _=he(9751),Q=he(727);const c=(0,he(3888).d)(xt=>function(){xt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ze=he(8737),Vt=he(2806);let Ft=(()=>{class xt extends _.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(Et){const lt=new st(this,this);return lt.operator=Et,lt}_throwIfClosed(){if(this.closed)throw new c}next(Et){(0,Vt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const lt of this.currentObservers)lt.next(Et)}})}error(Et){(0,Vt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=Et;const{observers:lt}=this;for(;lt.length;)lt.shift().error(Et)}})}complete(){(0,Vt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:Et}=this;for(;Et.length;)Et.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var Et;return(null===(Et=this.observers)||void 0===Et?void 0:Et.length)>0}_trySubscribe(Et){return this._throwIfClosed(),super._trySubscribe(Et)}_subscribe(Et){return this._throwIfClosed(),this._checkFinalizedStatuses(Et),this._innerSubscribe(Et)}_innerSubscribe(Et){const{hasError:lt,isStopped:dn,observers:jt}=this;return lt||dn?Q.Lc:(this.currentObservers=null,jt.push(Et),new Q.w0(()=>{this.currentObservers=null,(0,ze.P)(jt,Et)}))}_checkFinalizedStatuses(Et){const{hasError:lt,thrownError:dn,isStopped:jt}=this;lt?Et.error(dn):jt&&Et.complete()}asObservable(){const Et=new _.y;return Et.source=this,Et}}return xt.create=(ut,Et)=>new st(ut,Et),xt})();class st extends Ft{constructor(ut,Et){super(),this.destination=ut,this.source=Et}next(ut){var Et,lt;null===(lt=null===(Et=this.destination)||void 0===Et?void 0:Et.next)||void 0===lt||lt.call(Et,ut)}error(ut){var Et,lt;null===(lt=null===(Et=this.destination)||void 0===Et?void 0:Et.error)||void 0===lt||lt.call(Et,ut)}complete(){var ut,Et;null===(Et=null===(ut=this.destination)||void 0===ut?void 0:ut.complete)||void 0===Et||Et.call(ut)}_subscribe(ut){var Et,lt;return null!==(lt=null===(Et=this.source)||void 0===Et?void 0:Et.subscribe(ut))&&void 0!==lt?lt:Q.Lc}}},930:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Hp:()=>Gt,Lv:()=>lt});var _=he(576),Q=he(727),ot=he(2416),c=he(7849),ze=he(5032);const Vt=xt("C",void 0,void 0);function xt(At,St,Zt){return{kind:At,value:St,error:Zt}}var ut=he(3410),Et=he(2806);class lt extends Q.w0{constructor(St){super(),this.isStopped=!1,St?(this.destination=St,(0,Q.Nn)(St)&&St.add(this)):this.destination=ki}static create(St,Zt,Qt){return new Gt(St,Zt,Qt)}next(St){this.isStopped?vn(function st(At){return xt("N",At,void 0)}(St),this):this._next(St)}error(St){this.isStopped?vn(function Ft(At){return xt("E",void 0,At)}(St),this):(this.isStopped=!0,this._error(St))}complete(){this.isStopped?vn(Vt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(St){this.destination.next(St)}_error(St){try{this.destination.error(St)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const dn=Function.prototype.bind;function jt(At,St){return dn.call(At,St)}class Xt{constructor(St){this.partialObserver=St}next(St){const{partialObserver:Zt}=this;if(Zt.next)try{Zt.next(St)}catch(Qt){xn(Qt)}}error(St){const{partialObserver:Zt}=this;if(Zt.error)try{Zt.error(St)}catch(Qt){xn(Qt)}else xn(St)}complete(){const{partialObserver:St}=this;if(St.complete)try{St.complete()}catch(Zt){xn(Zt)}}}class Gt extends lt{constructor(St,Zt,Qt){let tn;if(super(),(0,_.m)(St)||!St)tn={next:St??void 0,error:Zt??void 0,complete:Qt??void 0};else{let Rt;this&&ot.v.useDeprecatedNextContext?(Rt=Object.create(St),Rt.unsubscribe=()=>this.unsubscribe(),tn={next:St.next&&jt(St.next,Rt),error:St.error&&jt(St.error,Rt),complete:St.complete&&jt(St.complete,Rt)}):tn=St}this.destination=new Xt(tn)}}function xn(At){ot.v.useDeprecatedSynchronousErrorHandling?(0,Et.O)(At):(0,c.h)(At)}function vn(At,St){const{onStoppedNotification:Zt}=ot.v;Zt&&ut.z.setTimeout(()=>Zt(At,St))}const ki={closed:!0,next:ze.Z,error:function on(At){throw At},complete:ze.Z}},727:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Lc:()=>Vt,w0:()=>ze,Nn:()=>Ft});var _=he(576);const ot=(0,he(3888).d)(xt=>function(Et){xt(this),this.message=Et?`${Et.length} errors occurred during unsubscription:\n${Et.map((lt,dn)=>`${dn+1}) ${lt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Et});var c=he(8737);class ze{constructor(ut){this.initialTeardown=ut,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let ut;if(!this.closed){this.closed=!0;const{_parentage:Et}=this;if(Et)if(this._parentage=null,Array.isArray(Et))for(const jt of Et)jt.remove(this);else Et.remove(this);const{initialTeardown:lt}=this;if((0,_.m)(lt))try{lt()}catch(jt){ut=jt instanceof ot?jt.errors:[jt]}const{_finalizers:dn}=this;if(dn){this._finalizers=null;for(const jt of dn)try{st(jt)}catch(Xt){ut=ut??[],Xt instanceof ot?ut=[...ut,...Xt.errors]:ut.push(Xt)}}if(ut)throw new ot(ut)}}add(ut){var Et;if(ut&&ut!==this)if(this.closed)st(ut);else{if(ut instanceof ze){if(ut.closed||ut._hasParent(this))return;ut._addParent(this)}(this._finalizers=null!==(Et=this._finalizers)&&void 0!==Et?Et:[]).push(ut)}}_hasParent(ut){const{_parentage:Et}=this;return Et===ut||Array.isArray(Et)&&Et.includes(ut)}_addParent(ut){const{_parentage:Et}=this;this._parentage=Array.isArray(Et)?(Et.push(ut),Et):Et?[Et,ut]:ut}_removeParent(ut){const{_parentage:Et}=this;Et===ut?this._parentage=null:Array.isArray(Et)&&(0,c.P)(Et,ut)}remove(ut){const{_finalizers:Et}=this;Et&&(0,c.P)(Et,ut),ut instanceof ze&&ut._removeParent(this)}}ze.EMPTY=(()=>{const xt=new ze;return xt.closed=!0,xt})();const Vt=ze.EMPTY;function Ft(xt){return xt instanceof ze||xt&&"closed"in xt&&(0,_.m)(xt.remove)&&(0,_.m)(xt.add)&&(0,_.m)(xt.unsubscribe)}function st(xt){(0,_.m)(xt)?xt():xt.unsubscribe()}},2416:(Yn,Ut,he)=>{"use strict";he.d(Ut,{v:()=>_});const _={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},9841:(Yn,Ut,he)=>{"use strict";he.d(Ut,{a:()=>ut});var _=he(9751),Q=he(4742),ot=he(2076),c=he(4671),ze=he(3268),Vt=he(3269),Ft=he(1810),st=he(5403),xt=he(9672);function ut(...dn){const jt=(0,Vt.yG)(dn),Xt=(0,Vt.jO)(dn),{args:Gt,keys:xn}=(0,Q.D)(dn);if(0===Gt.length)return(0,ot.D)([],jt);const on=new _.y(function Et(dn,jt,Xt=c.y){return Gt=>{lt(jt,()=>{const{length:xn}=dn,on=new Array(xn);let vn=xn,ki=xn;for(let At=0;At<xn;At++)lt(jt,()=>{const St=(0,ot.D)(dn[At],jt);let Zt=!1;St.subscribe((0,st.x)(Gt,Qt=>{on[At]=Qt,Zt||(Zt=!0,ki--),ki||Gt.next(Xt(on.slice()))},()=>{--vn||Gt.complete()}))},Gt)},Gt)}}(Gt,jt,xn?vn=>(0,Ft.n)(xn,vn):c.y));return Xt?on.pipe((0,ze.Z)(Xt)):on}function lt(dn,jt,Xt){dn?(0,xt.f)(Xt,dn,jt):jt()}},7272:(Yn,Ut,he)=>{"use strict";he.d(Ut,{z:()=>ze});var _=he(8189),ot=he(3269),c=he(2076);function ze(...Vt){return function Q(){return(0,_.J)(1)}()((0,c.D)(Vt,(0,ot.yG)(Vt)))}},515:(Yn,Ut,he)=>{"use strict";he.d(Ut,{E:()=>Q});const Q=new(he(9751).y)(ze=>ze.complete())},2076:(Yn,Ut,he)=>{"use strict";he.d(Ut,{D:()=>Qt});var _=he(8421),Q=he(9672),ot=he(4482),c=he(5403);function ze(tn,Rt=0){return(0,ot.e)((Kt,it)=>{Kt.subscribe((0,c.x)(it,ct=>(0,Q.f)(it,tn,()=>it.next(ct),Rt),()=>(0,Q.f)(it,tn,()=>it.complete(),Rt),ct=>(0,Q.f)(it,tn,()=>it.error(ct),Rt)))})}function Vt(tn,Rt=0){return(0,ot.e)((Kt,it)=>{it.add(tn.schedule(()=>Kt.subscribe(it),Rt))})}var xt=he(9751),Et=he(2202),lt=he(576);function jt(tn,Rt){if(!tn)throw new Error("Iterable cannot be null");return new xt.y(Kt=>{(0,Q.f)(Kt,Rt,()=>{const it=tn[Symbol.asyncIterator]();(0,Q.f)(Kt,Rt,()=>{it.next().then(ct=>{ct.done?Kt.complete():Kt.next(ct.value)})},0,!0)})})}var Xt=he(3670),Gt=he(8239),xn=he(1144),on=he(6495),vn=he(2206),ki=he(4532),At=he(3260);function Qt(tn,Rt){return Rt?function Zt(tn,Rt){if(null!=tn){if((0,Xt.c)(tn))return function Ft(tn,Rt){return(0,_.Xf)(tn).pipe(Vt(Rt),ze(Rt))}(tn,Rt);if((0,xn.z)(tn))return function ut(tn,Rt){return new xt.y(Kt=>{let it=0;return Rt.schedule(function(){it===tn.length?Kt.complete():(Kt.next(tn[it++]),Kt.closed||this.schedule())})})}(tn,Rt);if((0,Gt.t)(tn))return function st(tn,Rt){return(0,_.Xf)(tn).pipe(Vt(Rt),ze(Rt))}(tn,Rt);if((0,vn.D)(tn))return jt(tn,Rt);if((0,on.T)(tn))return function dn(tn,Rt){return new xt.y(Kt=>{let it;return(0,Q.f)(Kt,Rt,()=>{it=tn[Et.h](),(0,Q.f)(Kt,Rt,()=>{let ct,It;try{({value:ct,done:It}=it.next())}catch(dt){return void Kt.error(dt)}It?Kt.complete():Kt.next(ct)},0,!0)}),()=>(0,lt.m)(it?.return)&&it.return()})}(tn,Rt);if((0,At.L)(tn))return function St(tn,Rt){return jt((0,At.Q)(tn),Rt)}(tn,Rt)}throw(0,ki.z)(tn)}(tn,Rt):(0,_.Xf)(tn)}},8421:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Xf:()=>dn});var _=he(655),Q=he(1144),ot=he(8239),c=he(9751),ze=he(3670),Vt=he(2206),Ft=he(4532),st=he(6495),xt=he(3260),ut=he(576),Et=he(7849),lt=he(8822);function dn(At){if(At instanceof c.y)return At;if(null!=At){if((0,ze.c)(At))return function jt(At){return new c.y(St=>{const Zt=At[lt.L]();if((0,ut.m)(Zt.subscribe))return Zt.subscribe(St);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(At);if((0,Q.z)(At))return function Xt(At){return new c.y(St=>{for(let Zt=0;Zt<At.length&&!St.closed;Zt++)St.next(At[Zt]);St.complete()})}(At);if((0,ot.t)(At))return function Gt(At){return new c.y(St=>{At.then(Zt=>{St.closed||(St.next(Zt),St.complete())},Zt=>St.error(Zt)).then(null,Et.h)})}(At);if((0,Vt.D)(At))return on(At);if((0,st.T)(At))return function xn(At){return new c.y(St=>{for(const Zt of At)if(St.next(Zt),St.closed)return;St.complete()})}(At);if((0,xt.L)(At))return function vn(At){return on((0,xt.Q)(At))}(At)}throw(0,Ft.z)(At)}function on(At){return new c.y(St=>{(function ki(At,St){var Zt,Qt,tn,Rt;return(0,_.mG)(this,void 0,void 0,function*(){try{for(Zt=(0,_.KL)(At);!(Qt=yield Zt.next()).done;)if(St.next(Qt.value),St.closed)return}catch(Kt){tn={error:Kt}}finally{try{Qt&&!Qt.done&&(Rt=Zt.return)&&(yield Rt.call(Zt))}finally{if(tn)throw tn.error}}St.complete()})})(At,St).catch(Zt=>St.error(Zt))})}},6451:(Yn,Ut,he)=>{"use strict";he.d(Ut,{T:()=>Vt});var _=he(8189),Q=he(8421),ot=he(515),c=he(3269),ze=he(2076);function Vt(...Ft){const st=(0,c.yG)(Ft),xt=(0,c._6)(Ft,1/0),ut=Ft;return ut.length?1===ut.length?(0,Q.Xf)(ut[0]):(0,_.J)(xt)((0,ze.D)(ut,st)):ot.E}},9646:(Yn,Ut,he)=>{"use strict";he.d(Ut,{of:()=>ot});var _=he(3269),Q=he(2076);function ot(...c){const ze=(0,_.yG)(c);return(0,Q.D)(c,ze)}},5403:(Yn,Ut,he)=>{"use strict";he.d(Ut,{x:()=>Q});var _=he(930);function Q(c,ze,Vt,Ft,st){return new ot(c,ze,Vt,Ft,st)}class ot extends _.Lv{constructor(ze,Vt,Ft,st,xt,ut){super(ze),this.onFinalize=xt,this.shouldUnsubscribe=ut,this._next=Vt?function(Et){try{Vt(Et)}catch(lt){ze.error(lt)}}:super._next,this._error=st?function(Et){try{st(Et)}catch(lt){ze.error(lt)}finally{this.unsubscribe()}}:super._error,this._complete=Ft?function(){try{Ft()}catch(Et){ze.error(Et)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ze;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Vt}=this;super.unsubscribe(),!Vt&&(null===(ze=this.onFinalize)||void 0===ze||ze.call(this))}}}},262:(Yn,Ut,he)=>{"use strict";he.d(Ut,{K:()=>c});var _=he(8421),Q=he(5403),ot=he(4482);function c(ze){return(0,ot.e)((Vt,Ft)=>{let ut,st=null,xt=!1;st=Vt.subscribe((0,Q.x)(Ft,void 0,void 0,Et=>{ut=(0,_.Xf)(ze(Et,c(ze)(Vt))),st?(st.unsubscribe(),st=null,ut.subscribe(Ft)):xt=!0})),xt&&(st.unsubscribe(),st=null,ut.subscribe(Ft))})}},4351:(Yn,Ut,he)=>{"use strict";he.d(Ut,{b:()=>ot});var _=he(5577),Q=he(576);function ot(c,ze){return(0,Q.m)(ze)?(0,_.z)(c,ze,1):(0,_.z)(c,1)}},9300:(Yn,Ut,he)=>{"use strict";he.d(Ut,{h:()=>ot});var _=he(4482),Q=he(5403);function ot(c,ze){return(0,_.e)((Vt,Ft)=>{let st=0;Vt.subscribe((0,Q.x)(Ft,xt=>c.call(ze,xt,st++)&&Ft.next(xt)))})}},4004:(Yn,Ut,he)=>{"use strict";he.d(Ut,{U:()=>ot});var _=he(4482),Q=he(5403);function ot(c,ze){return(0,_.e)((Vt,Ft)=>{let st=0;Vt.subscribe((0,Q.x)(Ft,xt=>{Ft.next(c.call(ze,xt,st++))}))})}},9718:(Yn,Ut,he)=>{"use strict";he.d(Ut,{h:()=>Q});var _=he(4004);function Q(ot){return(0,_.U)(()=>ot)}},8189:(Yn,Ut,he)=>{"use strict";he.d(Ut,{J:()=>ot});var _=he(5577),Q=he(4671);function ot(c=1/0){return(0,_.z)(Q.y,c)}},5577:(Yn,Ut,he)=>{"use strict";he.d(Ut,{z:()=>st});var _=he(4004),Q=he(8421),ot=he(4482),c=he(9672),ze=he(5403),Ft=he(576);function st(xt,ut,Et=1/0){return(0,Ft.m)(ut)?st((lt,dn)=>(0,_.U)((jt,Xt)=>ut(lt,jt,dn,Xt))((0,Q.Xf)(xt(lt,dn))),Et):("number"==typeof ut&&(Et=ut),(0,ot.e)((lt,dn)=>function Vt(xt,ut,Et,lt,dn,jt,Xt,Gt){const xn=[];let on=0,vn=0,ki=!1;const At=()=>{ki&&!xn.length&&!on&&ut.complete()},St=Qt=>on<lt?Zt(Qt):xn.push(Qt),Zt=Qt=>{jt&&ut.next(Qt),on++;let tn=!1;(0,Q.Xf)(Et(Qt,vn++)).subscribe((0,ze.x)(ut,Rt=>{dn?.(Rt),jt?St(Rt):ut.next(Rt)},()=>{tn=!0},void 0,()=>{if(tn)try{for(on--;xn.length&&on<lt;){const Rt=xn.shift();Xt?(0,c.f)(ut,Xt,()=>Zt(Rt)):Zt(Rt)}At()}catch(Rt){ut.error(Rt)}}))};return xt.subscribe((0,ze.x)(ut,St,()=>{ki=!0,At()})),()=>{Gt?.()}}(lt,dn,xt,Et)))}},8675:(Yn,Ut,he)=>{"use strict";he.d(Ut,{O:()=>c});var _=he(7272),Q=he(3269),ot=he(4482);function c(...ze){const Vt=(0,Q.yG)(ze);return(0,ot.e)((Ft,st)=>{(Vt?(0,_.z)(ze,Ft,Vt):(0,_.z)(ze,Ft)).subscribe(st)})}},3900:(Yn,Ut,he)=>{"use strict";he.d(Ut,{w:()=>c});var _=he(8421),Q=he(4482),ot=he(5403);function c(ze,Vt){return(0,Q.e)((Ft,st)=>{let xt=null,ut=0,Et=!1;const lt=()=>Et&&!xt&&st.complete();Ft.subscribe((0,ot.x)(st,dn=>{xt?.unsubscribe();let jt=0;const Xt=ut++;(0,_.Xf)(ze(dn,Xt)).subscribe(xt=(0,ot.x)(st,Gt=>st.next(Vt?Vt(dn,Gt,Xt,jt++):Gt),()=>{xt=null,lt()}))},()=>{Et=!0,lt()}))})}},5698:(Yn,Ut,he)=>{"use strict";he.d(Ut,{q:()=>c});var _=he(515),Q=he(4482),ot=he(5403);function c(ze){return ze<=0?()=>_.E:(0,Q.e)((Vt,Ft)=>{let st=0;Vt.subscribe((0,ot.x)(Ft,xt=>{++st<=ze&&(Ft.next(xt),ze<=st&&Ft.complete())}))})}},8505:(Yn,Ut,he)=>{"use strict";he.d(Ut,{b:()=>ze});var _=he(576),Q=he(4482),ot=he(5403),c=he(4671);function ze(Vt,Ft,st){const xt=(0,_.m)(Vt)||Ft||st?{next:Vt,error:Ft,complete:st}:Vt;return xt?(0,Q.e)((ut,Et)=>{var lt;null===(lt=xt.subscribe)||void 0===lt||lt.call(xt);let dn=!0;ut.subscribe((0,ot.x)(Et,jt=>{var Xt;null===(Xt=xt.next)||void 0===Xt||Xt.call(xt,jt),Et.next(jt)},()=>{var jt;dn=!1,null===(jt=xt.complete)||void 0===jt||jt.call(xt),Et.complete()},jt=>{var Xt;dn=!1,null===(Xt=xt.error)||void 0===Xt||Xt.call(xt,jt),Et.error(jt)},()=>{var jt,Xt;dn&&(null===(jt=xt.unsubscribe)||void 0===jt||jt.call(xt)),null===(Xt=xt.finalize)||void 0===Xt||Xt.call(xt)}))}):c.y}},3410:(Yn,Ut,he)=>{"use strict";he.d(Ut,{z:()=>_});const _={setTimeout(Q,ot,...c){const{delegate:ze}=_;return ze?.setTimeout?ze.setTimeout(Q,ot,...c):setTimeout(Q,ot,...c)},clearTimeout(Q){const{delegate:ot}=_;return(ot?.clearTimeout||clearTimeout)(Q)},delegate:void 0}},2202:(Yn,Ut,he)=>{"use strict";he.d(Ut,{h:()=>Q});const Q=function _(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Yn,Ut,he)=>{"use strict";he.d(Ut,{L:()=>_});const _="function"==typeof Symbol&&Symbol.observable||"@@observable"},3269:(Yn,Ut,he)=>{"use strict";he.d(Ut,{_6:()=>Vt,jO:()=>c,yG:()=>ze});var _=he(576),Q=he(3532);function ot(Ft){return Ft[Ft.length-1]}function c(Ft){return(0,_.m)(ot(Ft))?Ft.pop():void 0}function ze(Ft){return(0,Q.K)(ot(Ft))?Ft.pop():void 0}function Vt(Ft,st){return"number"==typeof ot(Ft)?Ft.pop():st}},4742:(Yn,Ut,he)=>{"use strict";he.d(Ut,{D:()=>ze});const{isArray:_}=Array,{getPrototypeOf:Q,prototype:ot,keys:c}=Object;function ze(Ft){if(1===Ft.length){const st=Ft[0];if(_(st))return{args:st,keys:null};if(function Vt(Ft){return Ft&&"object"==typeof Ft&&Q(Ft)===ot}(st)){const xt=c(st);return{args:xt.map(ut=>st[ut]),keys:xt}}}return{args:Ft,keys:null}}},8737:(Yn,Ut,he)=>{"use strict";function _(Q,ot){if(Q){const c=Q.indexOf(ot);0<=c&&Q.splice(c,1)}}he.d(Ut,{P:()=>_})},3888:(Yn,Ut,he)=>{"use strict";function _(Q){const c=Q(ze=>{Error.call(ze),ze.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}he.d(Ut,{d:()=>_})},1810:(Yn,Ut,he)=>{"use strict";function _(Q,ot){return Q.reduce((c,ze,Vt)=>(c[ze]=ot[Vt],c),{})}he.d(Ut,{n:()=>_})},2806:(Yn,Ut,he)=>{"use strict";he.d(Ut,{O:()=>c,x:()=>ot});var _=he(2416);let Q=null;function ot(ze){if(_.v.useDeprecatedSynchronousErrorHandling){const Vt=!Q;if(Vt&&(Q={errorThrown:!1,error:null}),ze(),Vt){const{errorThrown:Ft,error:st}=Q;if(Q=null,Ft)throw st}}else ze()}function c(ze){_.v.useDeprecatedSynchronousErrorHandling&&Q&&(Q.errorThrown=!0,Q.error=ze)}},9672:(Yn,Ut,he)=>{"use strict";function _(Q,ot,c,ze=0,Vt=!1){const Ft=ot.schedule(function(){c(),Vt?Q.add(this.schedule(null,ze)):this.unsubscribe()},ze);if(Q.add(Ft),!Vt)return Ft}he.d(Ut,{f:()=>_})},4671:(Yn,Ut,he)=>{"use strict";function _(Q){return Q}he.d(Ut,{y:()=>_})},1144:(Yn,Ut,he)=>{"use strict";he.d(Ut,{z:()=>_});const _=Q=>Q&&"number"==typeof Q.length&&"function"!=typeof Q},2206:(Yn,Ut,he)=>{"use strict";he.d(Ut,{D:()=>Q});var _=he(576);function Q(ot){return Symbol.asyncIterator&&(0,_.m)(ot?.[Symbol.asyncIterator])}},576:(Yn,Ut,he)=>{"use strict";function _(Q){return"function"==typeof Q}he.d(Ut,{m:()=>_})},3670:(Yn,Ut,he)=>{"use strict";he.d(Ut,{c:()=>ot});var _=he(8822),Q=he(576);function ot(c){return(0,Q.m)(c[_.L])}},6495:(Yn,Ut,he)=>{"use strict";he.d(Ut,{T:()=>ot});var _=he(2202),Q=he(576);function ot(c){return(0,Q.m)(c?.[_.h])}},8239:(Yn,Ut,he)=>{"use strict";he.d(Ut,{t:()=>Q});var _=he(576);function Q(ot){return(0,_.m)(ot?.then)}},3260:(Yn,Ut,he)=>{"use strict";he.d(Ut,{L:()=>c,Q:()=>ot});var _=he(655),Q=he(576);function ot(ze){return(0,_.FC)(this,arguments,function*(){const Ft=ze.getReader();try{for(;;){const{value:st,done:xt}=yield(0,_.qq)(Ft.read());if(xt)return yield(0,_.qq)(void 0);yield yield(0,_.qq)(st)}}finally{Ft.releaseLock()}})}function c(ze){return(0,Q.m)(ze?.getReader)}},3532:(Yn,Ut,he)=>{"use strict";he.d(Ut,{K:()=>Q});var _=he(576);function Q(ot){return ot&&(0,_.m)(ot.schedule)}},4482:(Yn,Ut,he)=>{"use strict";he.d(Ut,{A:()=>Q,e:()=>ot});var _=he(576);function Q(c){return(0,_.m)(c?.lift)}function ot(c){return ze=>{if(Q(ze))return ze.lift(function(Vt){try{return c(Vt,this)}catch(Ft){this.error(Ft)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Z:()=>c});var _=he(4004);const{isArray:Q}=Array;function c(ze){return(0,_.U)(Vt=>function ot(ze,Vt){return Q(Vt)?ze(...Vt):ze(Vt)}(ze,Vt))}},5032:(Yn,Ut,he)=>{"use strict";function _(){}he.d(Ut,{Z:()=>_})},9635:(Yn,Ut,he)=>{"use strict";he.d(Ut,{U:()=>ot,z:()=>Q});var _=he(4671);function Q(...c){return ot(c)}function ot(c){return 0===c.length?_.y:1===c.length?c[0]:function(Vt){return c.reduce((Ft,st)=>st(Ft),Vt)}}},7849:(Yn,Ut,he)=>{"use strict";he.d(Ut,{h:()=>ot});var _=he(2416),Q=he(3410);function ot(c){Q.z.setTimeout(()=>{const{onUnhandledError:ze}=_.v;if(!ze)throw c;ze(c)})}},4532:(Yn,Ut,he)=>{"use strict";function _(Q){return new TypeError(`You provided ${null!==Q&&"object"==typeof Q?"an invalid object":`'${Q}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}he.d(Ut,{z:()=>_})},655:(Yn,Ut,he)=>{"use strict";function st(it,ct,It,dt){return new(It||(It=Promise))(function(rn,Zn){function An(Ni){try{Kn(dt.next(Ni))}catch(kr){Zn(kr)}}function Di(Ni){try{Kn(dt.throw(Ni))}catch(kr){Zn(kr)}}function Kn(Ni){Ni.done?rn(Ni.value):function _n(rn){return rn instanceof It?rn:new It(function(Zn){Zn(rn)})}(Ni.value).then(An,Di)}Kn((dt=dt.apply(it,ct||[])).next())})}function xn(it){return this instanceof xn?(this.v=it,this):new xn(it)}function on(it,ct,It){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _n,dt=It.apply(it,ct||[]),rn=[];return _n={},Zn("next"),Zn("throw"),Zn("return"),_n[Symbol.asyncIterator]=function(){return this},_n;function Zn(oi){dt[oi]&&(_n[oi]=function(ei){return new Promise(function(ko,Xi){rn.push([oi,ei,ko,Xi])>1||An(oi,ei)})})}function An(oi,ei){try{!function Di(oi){oi.value instanceof xn?Promise.resolve(oi.value.v).then(Kn,Ni):kr(rn[0][2],oi)}(dt[oi](ei))}catch(ko){kr(rn[0][3],ko)}}function Kn(oi){An("next",oi)}function Ni(oi){An("throw",oi)}function kr(oi,ei){oi(ei),rn.shift(),rn.length&&An(rn[0][0],rn[0][1])}}function ki(it){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var It,ct=it[Symbol.asyncIterator];return ct?ct.call(it):(it=function lt(it){var ct="function"==typeof Symbol&&Symbol.iterator,It=ct&&it[ct],dt=0;if(It)return It.call(it);if(it&&"number"==typeof it.length)return{next:function(){return it&&dt>=it.length&&(it=void 0),{value:it&&it[dt++],done:!it}}};throw new TypeError(ct?"Object is not iterable.":"Symbol.iterator is not defined.")}(it),It={},dt("next"),dt("throw"),dt("return"),It[Symbol.asyncIterator]=function(){return this},It);function dt(rn){It[rn]=it[rn]&&function(Zn){return new Promise(function(An,Di){!function _n(rn,Zn,An,Di){Promise.resolve(Di).then(function(Kn){rn({value:Kn,done:An})},Zn)}(An,Di,(Zn=it[rn](Zn)).done,Zn.value)})}}}he.d(Ut,{FC:()=>on,KL:()=>ki,mG:()=>st,qq:()=>xn})},6895:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Do:()=>ki,EM:()=>bs,HT:()=>ze,JF:()=>Ra,K0:()=>Ft,Mn:()=>An,Mx:()=>ln,NF:()=>Ia,O5:()=>lo,S$:()=>xn,Tn:()=>ct,UT:()=>Di,V_:()=>ut,Ye:()=>At,b0:()=>vn,bD:()=>Us,ez:()=>Ss,p6:()=>Nt,q:()=>ot,sg:()=>Wo,tP:()=>_o,uU:()=>Lo,w_:()=>Vt,x:()=>it});var _=he(1571);let Q=null;function ot(){return Q}function ze(j){Q||(Q=j)}class Vt{}const Ft=new _.OlP("DocumentToken");let st=(()=>{class j{historyGo(H){throw new Error("Not implemented")}}return j.\u0275fac=function(H){return new(H||j)},j.\u0275prov=_.Yz7({token:j,factory:function(){return function xt(){return(0,_.LFG)(Et)}()},providedIn:"platform"}),j})();const ut=new _.OlP("Location Initialized");let Et=(()=>{class j extends st{constructor(H){super(),this._doc=H,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ot().getBaseHref(this._doc)}onPopState(H){const ce=ot().getGlobalEventTarget(this._doc,"window");return ce.addEventListener("popstate",H,!1),()=>ce.removeEventListener("popstate",H)}onHashChange(H){const ce=ot().getGlobalEventTarget(this._doc,"window");return ce.addEventListener("hashchange",H,!1),()=>ce.removeEventListener("hashchange",H)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(H){this.location.pathname=H}pushState(H,ce,He){lt()?this._history.pushState(H,ce,He):this.location.hash=He}replaceState(H,ce,He){lt()?this._history.replaceState(H,ce,He):this.location.hash=He}forward(){this._history.forward()}back(){this._history.back()}historyGo(H=0){this._history.go(H)}getState(){return this._history.state}}return j.\u0275fac=function(H){return new(H||j)(_.LFG(Ft))},j.\u0275prov=_.Yz7({token:j,factory:function(){return function dn(){return new Et((0,_.LFG)(Ft))}()},providedIn:"platform"}),j})();function lt(){return!!window.history.pushState}function jt(j,ie){if(0==j.length)return ie;if(0==ie.length)return j;let H=0;return j.endsWith("/")&&H++,ie.startsWith("/")&&H++,2==H?j+ie.substring(1):1==H?j+ie:j+"/"+ie}function Xt(j){const ie=j.match(/#|\?|$/),H=ie&&ie.index||j.length;return j.slice(0,H-("/"===j[H-1]?1:0))+j.slice(H)}function Gt(j){return j&&"?"!==j[0]?"?"+j:j}let xn=(()=>{class j{historyGo(H){throw new Error("Not implemented")}}return j.\u0275fac=function(H){return new(H||j)},j.\u0275prov=_.Yz7({token:j,factory:function(){return(0,_.f3M)(vn)},providedIn:"root"}),j})();const on=new _.OlP("appBaseHref");let vn=(()=>{class j extends xn{constructor(H,ce){super(),this._platformLocation=H,this._removeListenerFns=[],this._baseHref=ce??this._platformLocation.getBaseHrefFromDOM()??(0,_.f3M)(Ft).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(H){this._removeListenerFns.push(this._platformLocation.onPopState(H),this._platformLocation.onHashChange(H))}getBaseHref(){return this._baseHref}prepareExternalUrl(H){return jt(this._baseHref,H)}path(H=!1){const ce=this._platformLocation.pathname+Gt(this._platformLocation.search),He=this._platformLocation.hash;return He&&H?`${ce}${He}`:ce}pushState(H,ce,He,Dt){const Yt=this.prepareExternalUrl(He+Gt(Dt));this._platformLocation.pushState(H,ce,Yt)}replaceState(H,ce,He,Dt){const Yt=this.prepareExternalUrl(He+Gt(Dt));this._platformLocation.replaceState(H,ce,Yt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(H=0){this._platformLocation.historyGo?.(H)}}return j.\u0275fac=function(H){return new(H||j)(_.LFG(st),_.LFG(on,8))},j.\u0275prov=_.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"}),j})(),ki=(()=>{class j extends xn{constructor(H,ce){super(),this._platformLocation=H,this._baseHref="",this._removeListenerFns=[],null!=ce&&(this._baseHref=ce)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(H){this._removeListenerFns.push(this._platformLocation.onPopState(H),this._platformLocation.onHashChange(H))}getBaseHref(){return this._baseHref}path(H=!1){let ce=this._platformLocation.hash;return null==ce&&(ce="#"),ce.length>0?ce.substring(1):ce}prepareExternalUrl(H){const ce=jt(this._baseHref,H);return ce.length>0?"#"+ce:ce}pushState(H,ce,He,Dt){let Yt=this.prepareExternalUrl(He+Gt(Dt));0==Yt.length&&(Yt=this._platformLocation.pathname),this._platformLocation.pushState(H,ce,Yt)}replaceState(H,ce,He,Dt){let Yt=this.prepareExternalUrl(He+Gt(Dt));0==Yt.length&&(Yt=this._platformLocation.pathname),this._platformLocation.replaceState(H,ce,Yt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(H=0){this._platformLocation.historyGo?.(H)}}return j.\u0275fac=function(H){return new(H||j)(_.LFG(st),_.LFG(on,8))},j.\u0275prov=_.Yz7({token:j,factory:j.\u0275fac}),j})(),At=(()=>{class j{constructor(H){this._subject=new _.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=H;const ce=this._locationStrategy.getBaseHref();this._baseHref=Xt(Qt(ce)),this._locationStrategy.onPopState(He=>{this._subject.emit({url:this.path(!0),pop:!0,state:He.state,type:He.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(H=!1){return this.normalize(this._locationStrategy.path(H))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(H,ce=""){return this.path()==this.normalize(H+Gt(ce))}normalize(H){return j.stripTrailingSlash(function Zt(j,ie){return j&&ie.startsWith(j)?ie.substring(j.length):ie}(this._baseHref,Qt(H)))}prepareExternalUrl(H){return H&&"/"!==H[0]&&(H="/"+H),this._locationStrategy.prepareExternalUrl(H)}go(H,ce="",He=null){this._locationStrategy.pushState(He,"",H,ce),this._notifyUrlChangeListeners(this.prepareExternalUrl(H+Gt(ce)),He)}replaceState(H,ce="",He=null){this._locationStrategy.replaceState(He,"",H,ce),this._notifyUrlChangeListeners(this.prepareExternalUrl(H+Gt(ce)),He)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(H=0){this._locationStrategy.historyGo?.(H)}onUrlChange(H){return this._urlChangeListeners.push(H),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(ce=>{this._notifyUrlChangeListeners(ce.url,ce.state)})),()=>{const ce=this._urlChangeListeners.indexOf(H);this._urlChangeListeners.splice(ce,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(H="",ce){this._urlChangeListeners.forEach(He=>He(H,ce))}subscribe(H,ce,He){return this._subject.subscribe({next:H,error:ce,complete:He})}}return j.normalizeQueryParams=Gt,j.joinWithSlash=jt,j.stripTrailingSlash=Xt,j.\u0275fac=function(H){return new(H||j)(_.LFG(xn))},j.\u0275prov=_.Yz7({token:j,factory:function(){return function St(){return new At((0,_.LFG)(xn))}()},providedIn:"root"}),j})();function Qt(j){return j.replace(/\/index.html$/,"")}var it=(()=>((it=it||{})[it.Format=0]="Format",it[it.Standalone=1]="Standalone",it))(),ct=(()=>((ct=ct||{})[ct.Narrow=0]="Narrow",ct[ct.Abbreviated=1]="Abbreviated",ct[ct.Wide=2]="Wide",ct[ct.Short=3]="Short",ct))(),It=(()=>((It=It||{})[It.Short=0]="Short",It[It.Medium=1]="Medium",It[It.Long=2]="Long",It[It.Full=3]="Full",It))(),dt=(()=>((dt=dt||{})[dt.Decimal=0]="Decimal",dt[dt.Group=1]="Group",dt[dt.List=2]="List",dt[dt.PercentSign=3]="PercentSign",dt[dt.PlusSign=4]="PlusSign",dt[dt.MinusSign=5]="MinusSign",dt[dt.Exponential=6]="Exponential",dt[dt.SuperscriptingExponent=7]="SuperscriptingExponent",dt[dt.PerMille=8]="PerMille",dt[dt.Infinity=9]="Infinity",dt[dt.NaN=10]="NaN",dt[dt.TimeSeparator=11]="TimeSeparator",dt[dt.CurrencyDecimal=12]="CurrencyDecimal",dt[dt.CurrencyGroup=13]="CurrencyGroup",dt))();function An(j,ie,H){const ce=(0,_.cg1)(j),Dt=Ji([ce[_.wAp.DaysFormat],ce[_.wAp.DaysStandalone]],ie);return Ji(Dt,H)}function Di(j,ie,H){const ce=(0,_.cg1)(j),Dt=Ji([ce[_.wAp.MonthsFormat],ce[_.wAp.MonthsStandalone]],ie);return Ji(Dt,H)}function oi(j,ie){return Ji((0,_.cg1)(j)[_.wAp.DateFormat],ie)}function ei(j,ie){return Ji((0,_.cg1)(j)[_.wAp.TimeFormat],ie)}function ko(j,ie){return Ji((0,_.cg1)(j)[_.wAp.DateTimeFormat],ie)}function Xi(j,ie){const H=(0,_.cg1)(j),ce=H[_.wAp.NumberSymbols][ie];if(typeof ce>"u"){if(ie===dt.CurrencyDecimal)return H[_.wAp.NumberSymbols][dt.Decimal];if(ie===dt.CurrencyGroup)return H[_.wAp.NumberSymbols][dt.Group]}return ce}function cr(j){if(!j[_.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${j[_.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Ji(j,ie){for(let H=ie;H>-1;H--)if(typeof j[H]<"u")return j[H];throw new Error("Locale data API: locale data undefined")}function jr(j){const[ie,H]=j.split(":");return{hours:+ie,minutes:+H}}const Ho=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ts={},Mt=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Ve=(()=>((Ve=Ve||{})[Ve.Short=0]="Short",Ve[Ve.ShortGMT=1]="ShortGMT",Ve[Ve.Long=2]="Long",Ve[Ve.Extended=3]="Extended",Ve))(),Oe=(()=>((Oe=Oe||{})[Oe.FullYear=0]="FullYear",Oe[Oe.Month=1]="Month",Oe[Oe.Date=2]="Date",Oe[Oe.Hours=3]="Hours",Oe[Oe.Minutes=4]="Minutes",Oe[Oe.Seconds=5]="Seconds",Oe[Oe.FractionalSeconds=6]="FractionalSeconds",Oe[Oe.Day=7]="Day",Oe))(),Ct=(()=>((Ct=Ct||{})[Ct.DayPeriods=0]="DayPeriods",Ct[Ct.Days=1]="Days",Ct[Ct.Months=2]="Months",Ct[Ct.Eras=3]="Eras",Ct))();function Nt(j,ie,H,ce){let He=function nt(j){if(We(j))return j;if("number"==typeof j&&!isNaN(j))return new Date(j);if("string"==typeof j){if(j=j.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(j)){const[He,Dt=1,Yt=1]=j.split("-").map(Ln=>+Ln);return Un(He,Dt-1,Yt)}const H=parseFloat(j);if(!isNaN(j-H))return new Date(H);let ce;if(ce=j.match(Ho))return function et(j){const ie=new Date(0);let H=0,ce=0;const He=j[8]?ie.setUTCFullYear:ie.setFullYear,Dt=j[8]?ie.setUTCHours:ie.setHours;j[9]&&(H=Number(j[9]+j[10]),ce=Number(j[9]+j[11])),He.call(ie,Number(j[1]),Number(j[2])-1,Number(j[3]));const Yt=Number(j[4]||0)-H,Ln=Number(j[5]||0)-ce,fi=Number(j[6]||0),Si=Math.floor(1e3*parseFloat("0."+(j[7]||0)));return Dt.call(ie,Yt,Ln,fi,Si),ie}(ce)}const ie=new Date(j);if(!We(ie))throw new Error(`Unable to convert "${j}" into a date`);return ie}(j);ie=ni(H,ie)||ie;let Ln,Yt=[];for(;ie;){if(Ln=Mt.exec(ie),!Ln){Yt.push(ie);break}{Yt=Yt.concat(Ln.slice(1));const qn=Yt.pop();if(!qn)break;ie=qn}}let fi=He.getTimezoneOffset();ce&&(fi=xe(ce,fi),He=function $e(j,ie,H){const ce=H?-1:1,He=j.getTimezoneOffset();return function Se(j,ie){return(j=new Date(j.getTime())).setMinutes(j.getMinutes()+ie),j}(j,ce*(xe(ie,He)-He))}(He,ce,!0));let Si="";return Yt.forEach(qn=>{const Ii=function re(j){if(te[j])return te[j];let ie;switch(j){case"G":case"GG":case"GGG":ie=wn(Ct.Eras,ct.Abbreviated);break;case"GGGG":ie=wn(Ct.Eras,ct.Wide);break;case"GGGGG":ie=wn(Ct.Eras,ct.Narrow);break;case"y":ie=Tn(Oe.FullYear,1,0,!1,!0);break;case"yy":ie=Tn(Oe.FullYear,2,0,!0,!0);break;case"yyy":ie=Tn(Oe.FullYear,3,0,!1,!0);break;case"yyyy":ie=Tn(Oe.FullYear,4,0,!1,!0);break;case"Y":ie=_e(1);break;case"YY":ie=_e(2,!0);break;case"YYY":ie=_e(3);break;case"YYYY":ie=_e(4);break;case"M":case"L":ie=Tn(Oe.Month,1,1);break;case"MM":case"LL":ie=Tn(Oe.Month,2,1);break;case"MMM":ie=wn(Ct.Months,ct.Abbreviated);break;case"MMMM":ie=wn(Ct.Months,ct.Wide);break;case"MMMMM":ie=wn(Ct.Months,ct.Narrow);break;case"LLL":ie=wn(Ct.Months,ct.Abbreviated,it.Standalone);break;case"LLLL":ie=wn(Ct.Months,ct.Wide,it.Standalone);break;case"LLLLL":ie=wn(Ct.Months,ct.Narrow,it.Standalone);break;case"w":ie=mo(1);break;case"ww":ie=mo(2);break;case"W":ie=mo(1,!0);break;case"d":ie=Tn(Oe.Date,1);break;case"dd":ie=Tn(Oe.Date,2);break;case"c":case"cc":ie=Tn(Oe.Day,1);break;case"ccc":ie=wn(Ct.Days,ct.Abbreviated,it.Standalone);break;case"cccc":ie=wn(Ct.Days,ct.Wide,it.Standalone);break;case"ccccc":ie=wn(Ct.Days,ct.Narrow,it.Standalone);break;case"cccccc":ie=wn(Ct.Days,ct.Short,it.Standalone);break;case"E":case"EE":case"EEE":ie=wn(Ct.Days,ct.Abbreviated);break;case"EEEE":ie=wn(Ct.Days,ct.Wide);break;case"EEEEE":ie=wn(Ct.Days,ct.Narrow);break;case"EEEEEE":ie=wn(Ct.Days,ct.Short);break;case"a":case"aa":case"aaa":ie=wn(Ct.DayPeriods,ct.Abbreviated);break;case"aaaa":ie=wn(Ct.DayPeriods,ct.Wide);break;case"aaaaa":ie=wn(Ct.DayPeriods,ct.Narrow);break;case"b":case"bb":case"bbb":ie=wn(Ct.DayPeriods,ct.Abbreviated,it.Standalone,!0);break;case"bbbb":ie=wn(Ct.DayPeriods,ct.Wide,it.Standalone,!0);break;case"bbbbb":ie=wn(Ct.DayPeriods,ct.Narrow,it.Standalone,!0);break;case"B":case"BB":case"BBB":ie=wn(Ct.DayPeriods,ct.Abbreviated,it.Format,!0);break;case"BBBB":ie=wn(Ct.DayPeriods,ct.Wide,it.Format,!0);break;case"BBBBB":ie=wn(Ct.DayPeriods,ct.Narrow,it.Format,!0);break;case"h":ie=Tn(Oe.Hours,1,-12);break;case"hh":ie=Tn(Oe.Hours,2,-12);break;case"H":ie=Tn(Oe.Hours,1);break;case"HH":ie=Tn(Oe.Hours,2);break;case"m":ie=Tn(Oe.Minutes,1);break;case"mm":ie=Tn(Oe.Minutes,2);break;case"s":ie=Tn(Oe.Seconds,1);break;case"ss":ie=Tn(Oe.Seconds,2);break;case"S":ie=Tn(Oe.FractionalSeconds,1);break;case"SS":ie=Tn(Oe.FractionalSeconds,2);break;case"SSS":ie=Tn(Oe.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":ie=Ci(Ve.Short);break;case"ZZZZZ":ie=Ci(Ve.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":ie=Ci(Ve.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":ie=Ci(Ve.Long);break;default:return null}return te[j]=ie,ie}(qn);Si+=Ii?Ii(He,H,fi):"''"===qn?"'":qn.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Si}function Un(j,ie,H){const ce=new Date(0);return ce.setFullYear(j,ie,H),ce.setHours(0,0,0),ce}function ni(j,ie){const H=function rn(j){return(0,_.cg1)(j)[_.wAp.LocaleId]}(j);if(ts[H]=ts[H]||{},ts[H][ie])return ts[H][ie];let ce="";switch(ie){case"shortDate":ce=oi(j,It.Short);break;case"mediumDate":ce=oi(j,It.Medium);break;case"longDate":ce=oi(j,It.Long);break;case"fullDate":ce=oi(j,It.Full);break;case"shortTime":ce=ei(j,It.Short);break;case"mediumTime":ce=ei(j,It.Medium);break;case"longTime":ce=ei(j,It.Long);break;case"fullTime":ce=ei(j,It.Full);break;case"short":const He=ni(j,"shortTime"),Dt=ni(j,"shortDate");ce=ui(ko(j,It.Short),[He,Dt]);break;case"medium":const Yt=ni(j,"mediumTime"),Ln=ni(j,"mediumDate");ce=ui(ko(j,It.Medium),[Yt,Ln]);break;case"long":const fi=ni(j,"longTime"),Si=ni(j,"longDate");ce=ui(ko(j,It.Long),[fi,Si]);break;case"full":const qn=ni(j,"fullTime"),Ii=ni(j,"fullDate");ce=ui(ko(j,It.Full),[qn,Ii])}return ce&&(ts[H][ie]=ce),ce}function ui(j,ie){return ie&&(j=j.replace(/\{([^}]+)}/g,function(H,ce){return null!=ie&&ce in ie?ie[ce]:H})),j}function Pn(j,ie,H="-",ce,He){let Dt="";(j<0||He&&j<=0)&&(He?j=1-j:(j=-j,Dt=H));let Yt=String(j);for(;Yt.length<ie;)Yt="0"+Yt;return ce&&(Yt=Yt.slice(Yt.length-ie)),Dt+Yt}function Tn(j,ie,H=0,ce=!1,He=!1){return function(Dt,Yt){let Ln=function qi(j,ie){switch(j){case Oe.FullYear:return ie.getFullYear();case Oe.Month:return ie.getMonth();case Oe.Date:return ie.getDate();case Oe.Hours:return ie.getHours();case Oe.Minutes:return ie.getMinutes();case Oe.Seconds:return ie.getSeconds();case Oe.FractionalSeconds:return ie.getMilliseconds();case Oe.Day:return ie.getDay();default:throw new Error(`Unknown DateType value "${j}".`)}}(j,Dt);if((H>0||Ln>-H)&&(Ln+=H),j===Oe.Hours)0===Ln&&-12===H&&(Ln=12);else if(j===Oe.FractionalSeconds)return function Ki(j,ie){return Pn(j,3).substring(0,ie)}(Ln,ie);const fi=Xi(Yt,dt.MinusSign);return Pn(Ln,ie,fi,ce,He)}}function wn(j,ie,H=it.Format,ce=!1){return function(He,Dt){return function di(j,ie,H,ce,He,Dt){switch(H){case Ct.Months:return Di(ie,He,ce)[j.getMonth()];case Ct.Days:return An(ie,He,ce)[j.getDay()];case Ct.DayPeriods:const Yt=j.getHours(),Ln=j.getMinutes();if(Dt){const Si=function Hi(j){const ie=(0,_.cg1)(j);return cr(ie),(ie[_.wAp.ExtraData][2]||[]).map(ce=>"string"==typeof ce?jr(ce):[jr(ce[0]),jr(ce[1])])}(ie),qn=function nr(j,ie,H){const ce=(0,_.cg1)(j);cr(ce);const Dt=Ji([ce[_.wAp.ExtraData][0],ce[_.wAp.ExtraData][1]],ie)||[];return Ji(Dt,H)||[]}(ie,He,ce),Ii=Si.findIndex(xr=>{if(Array.isArray(xr)){const[or,Do]=xr,Ds=Yt>=or.hours&&Ln>=or.minutes,zo=Yt<Do.hours||Yt===Do.hours&&Ln<Do.minutes;if(or.hours<Do.hours){if(Ds&&zo)return!0}else if(Ds||zo)return!0}else if(xr.hours===Yt&&xr.minutes===Ln)return!0;return!1});if(-1!==Ii)return qn[Ii]}return function Zn(j,ie,H){const ce=(0,_.cg1)(j),Dt=Ji([ce[_.wAp.DayPeriodsFormat],ce[_.wAp.DayPeriodsStandalone]],ie);return Ji(Dt,H)}(ie,He,ce)[Yt<12?0:1];case Ct.Eras:return function Kn(j,ie){return Ji((0,_.cg1)(j)[_.wAp.Eras],ie)}(ie,ce)[j.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${H}`)}}(He,Dt,j,ie,H,ce)}}function Ci(j){return function(ie,H,ce){const He=-1*ce,Dt=Xi(H,dt.MinusSign),Yt=He>0?Math.floor(He/60):Math.ceil(He/60);switch(j){case Ve.Short:return(He>=0?"+":"")+Pn(Yt,2,Dt)+Pn(Math.abs(He%60),2,Dt);case Ve.ShortGMT:return"GMT"+(He>=0?"+":"")+Pn(Yt,1,Dt);case Ve.Long:return"GMT"+(He>=0?"+":"")+Pn(Yt,2,Dt)+":"+Pn(Math.abs(He%60),2,Dt);case Ve.Extended:return 0===ce?"Z":(He>=0?"+":"")+Pn(Yt,2,Dt)+":"+Pn(Math.abs(He%60),2,Dt);default:throw new Error(`Unknown zone width "${j}"`)}}}function dr(j){return Un(j.getFullYear(),j.getMonth(),j.getDate()+(4-j.getDay()))}function mo(j,ie=!1){return function(H,ce){let He;if(ie){const Dt=new Date(H.getFullYear(),H.getMonth(),1).getDay()-1,Yt=H.getDate();He=1+Math.floor((Yt+Dt)/7)}else{const Dt=dr(H),Yt=function Wi(j){const ie=Un(j,0,1).getDay();return Un(j,0,1+(ie<=4?4:11)-ie)}(Dt.getFullYear()),Ln=Dt.getTime()-Yt.getTime();He=1+Math.round(Ln/6048e5)}return Pn(He,j,Xi(ce,dt.MinusSign))}}function _e(j,ie=!1){return function(H,ce){return Pn(dr(H).getFullYear(),j,Xi(ce,dt.MinusSign),ie)}}const te={};function xe(j,ie){j=j.replace(/:/g,"");const H=Date.parse("Jan 01, 1970 00:00:00 "+j)/6e4;return isNaN(H)?ie:H}function We(j){return j instanceof Date&&!isNaN(j.valueOf())}function ln(j,ie){ie=encodeURIComponent(ie);for(const H of j.split(";")){const ce=H.indexOf("="),[He,Dt]=-1==ce?[H,""]:[H.slice(0,ce),H.slice(ce+1)];if(He.trim()===ie)return decodeURIComponent(Dt)}return null}class Sn{constructor(ie,H,ce,He){this.$implicit=ie,this.ngForOf=H,this.index=ce,this.count=He}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Wo=(()=>{class j{constructor(H,ce,He){this._viewContainer=H,this._template=ce,this._differs=He,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(H){this._ngForOf=H,this._ngForOfDirty=!0}set ngForTrackBy(H){this._trackByFn=H}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(H){H&&(this._template=H)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const H=this._ngForOf;!this._differ&&H&&(this._differ=this._differs.find(H).create(this.ngForTrackBy))}if(this._differ){const H=this._differ.diff(this._ngForOf);H&&this._applyChanges(H)}}_applyChanges(H){const ce=this._viewContainer;H.forEachOperation((He,Dt,Yt)=>{if(null==He.previousIndex)ce.createEmbeddedView(this._template,new Sn(He.item,this._ngForOf,-1,-1),null===Yt?void 0:Yt);else if(null==Yt)ce.remove(null===Dt?void 0:Dt);else if(null!==Dt){const Ln=ce.get(Dt);ce.move(Ln,Yt),ps(Ln,He)}});for(let He=0,Dt=ce.length;He<Dt;He++){const Ln=ce.get(He).context;Ln.index=He,Ln.count=Dt,Ln.ngForOf=this._ngForOf}H.forEachIdentityChange(He=>{ps(ce.get(He.currentIndex),He)})}static ngTemplateContextGuard(H,ce){return!0}}return j.\u0275fac=function(H){return new(H||j)(_.Y36(_.s_b),_.Y36(_.Rgc),_.Y36(_.ZZ4))},j.\u0275dir=_.lG2({type:j,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),j})();function ps(j,ie){j.context.$implicit=ie.item}let lo=(()=>{class j{constructor(H,ce){this._viewContainer=H,this._context=new Vi,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=ce}set ngIf(H){this._context.$implicit=this._context.ngIf=H,this._updateView()}set ngIfThen(H){gs("ngIfThen",H),this._thenTemplateRef=H,this._thenViewRef=null,this._updateView()}set ngIfElse(H){gs("ngIfElse",H),this._elseTemplateRef=H,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(H,ce){return!0}}return j.\u0275fac=function(H){return new(H||j)(_.Y36(_.s_b),_.Y36(_.Rgc))},j.\u0275dir=_.lG2({type:j,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),j})();class Vi{constructor(){this.$implicit=null,this.ngIf=null}}function gs(j,ie){if(ie&&!ie.createEmbeddedView)throw new Error(`${j} must be a TemplateRef, but received '${(0,_.AaK)(ie)}'.`)}let _o=(()=>{class j{constructor(H){this._viewContainerRef=H,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(H){if(H.ngTemplateOutlet||H.ngTemplateOutletInjector){const ce=this._viewContainerRef;if(this._viewRef&&ce.remove(ce.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:He,ngTemplateOutletContext:Dt,ngTemplateOutletInjector:Yt}=this;this._viewRef=ce.createEmbeddedView(He,Dt,Yt?{injector:Yt}:void 0)}else this._viewRef=null}else this._viewRef&&H.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return j.\u0275fac=function(H){return new(H||j)(_.Y36(_.s_b))},j.\u0275dir=_.lG2({type:j,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[_.TTD]}),j})();const Po=new _.OlP("DATE_PIPE_DEFAULT_TIMEZONE");let Lo=(()=>{class j{constructor(H,ce){this.locale=H,this.defaultTimezone=ce}transform(H,ce="mediumDate",He,Dt){if(null==H||""===H||H!=H)return null;try{return Nt(H,ce,Dt||this.locale,He??this.defaultTimezone??void 0)}catch(Yt){throw function Mr(j,ie){return new _.vHH(2100,!1)}()}}}return j.\u0275fac=function(H){return new(H||j)(_.Y36(_.soG,16),_.Y36(Po,24))},j.\u0275pipe=_.Yjl({name:"date",type:j,pure:!0,standalone:!0}),j})(),Ss=(()=>{class j{}return j.\u0275fac=function(H){return new(H||j)},j.\u0275mod=_.oAB({type:j}),j.\u0275inj=_.cJS({}),j})();const Us="browser";function Ia(j){return j===Us}let bs=(()=>{class j{}return j.\u0275prov=(0,_.Yz7)({token:j,providedIn:"root",factory:()=>new Is((0,_.LFG)(Ft),window)}),j})();class Is{constructor(ie,H){this.document=ie,this.window=H,this.offset=()=>[0,0]}setOffset(ie){this.offset=Array.isArray(ie)?()=>ie:ie}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(ie){this.supportsScrolling()&&this.window.scrollTo(ie[0],ie[1])}scrollToAnchor(ie){if(!this.supportsScrolling())return;const H=function mr(j,ie){const H=j.getElementById(ie)||j.getElementsByName(ie)[0];if(H)return H;if("function"==typeof j.createTreeWalker&&j.body&&(j.body.createShadowRoot||j.body.attachShadow)){const ce=j.createTreeWalker(j.body,NodeFilter.SHOW_ELEMENT);let He=ce.currentNode;for(;He;){const Dt=He.shadowRoot;if(Dt){const Yt=Dt.getElementById(ie)||Dt.querySelector(`[name="${ie}"]`);if(Yt)return Yt}He=ce.nextNode()}}return null}(this.document,ie);H&&(this.scrollToElement(H),H.focus())}setHistoryScrollRestoration(ie){if(this.supportScrollRestoration()){const H=this.window.history;H&&H.scrollRestoration&&(H.scrollRestoration=ie)}}scrollToElement(ie){const H=ie.getBoundingClientRect(),ce=H.left+this.window.pageXOffset,He=H.top+this.window.pageYOffset,Dt=this.offset();this.window.scrollTo(ce-Dt[0],He-Dt[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const ie=Oa(this.window.history)||Oa(Object.getPrototypeOf(this.window.history));return!(!ie||!ie.writable&&!ie.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Oa(j){return Object.getOwnPropertyDescriptor(j,"scrollRestoration")}class Ra{}},529:(Yn,Ut,he)=>{"use strict";he.d(Ut,{JF:()=>zn,PG:()=>st,WM:()=>ut,eN:()=>rn});var _=he(6895),Q=he(1571),ot=he(9646),c=he(9751),ze=he(4351),Vt=he(9300),Ft=he(4004);class st{}class xt{}class ut{constructor(Ve){this.normalizedNames=new Map,this.lazyUpdate=null,Ve?this.lazyInit="string"==typeof Ve?()=>{this.headers=new Map,Ve.split("\n").forEach(Oe=>{const Ct=Oe.indexOf(":");if(Ct>0){const Nt=Oe.slice(0,Ct),Un=Nt.toLowerCase(),ni=Oe.slice(Ct+1).trim();this.maybeSetNormalizedName(Nt,Un),this.headers.has(Un)?this.headers.get(Un).push(ni):this.headers.set(Un,[ni])}})}:()=>{this.headers=new Map,Object.keys(Ve).forEach(Oe=>{let Ct=Ve[Oe];const Nt=Oe.toLowerCase();"string"==typeof Ct&&(Ct=[Ct]),Ct.length>0&&(this.headers.set(Nt,Ct),this.maybeSetNormalizedName(Oe,Nt))})}:this.headers=new Map}has(Ve){return this.init(),this.headers.has(Ve.toLowerCase())}get(Ve){this.init();const Oe=this.headers.get(Ve.toLowerCase());return Oe&&Oe.length>0?Oe[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Ve){return this.init(),this.headers.get(Ve.toLowerCase())||null}append(Ve,Oe){return this.clone({name:Ve,value:Oe,op:"a"})}set(Ve,Oe){return this.clone({name:Ve,value:Oe,op:"s"})}delete(Ve,Oe){return this.clone({name:Ve,value:Oe,op:"d"})}maybeSetNormalizedName(Ve,Oe){this.normalizedNames.has(Oe)||this.normalizedNames.set(Oe,Ve)}init(){this.lazyInit&&(this.lazyInit instanceof ut?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Ve=>this.applyUpdate(Ve)),this.lazyUpdate=null))}copyFrom(Ve){Ve.init(),Array.from(Ve.headers.keys()).forEach(Oe=>{this.headers.set(Oe,Ve.headers.get(Oe)),this.normalizedNames.set(Oe,Ve.normalizedNames.get(Oe))})}clone(Ve){const Oe=new ut;return Oe.lazyInit=this.lazyInit&&this.lazyInit instanceof ut?this.lazyInit:this,Oe.lazyUpdate=(this.lazyUpdate||[]).concat([Ve]),Oe}applyUpdate(Ve){const Oe=Ve.name.toLowerCase();switch(Ve.op){case"a":case"s":let Ct=Ve.value;if("string"==typeof Ct&&(Ct=[Ct]),0===Ct.length)return;this.maybeSetNormalizedName(Ve.name,Oe);const Nt=("a"===Ve.op?this.headers.get(Oe):void 0)||[];Nt.push(...Ct),this.headers.set(Oe,Nt);break;case"d":const Un=Ve.value;if(Un){let ni=this.headers.get(Oe);if(!ni)return;ni=ni.filter(ui=>-1===Un.indexOf(ui)),0===ni.length?(this.headers.delete(Oe),this.normalizedNames.delete(Oe)):this.headers.set(Oe,ni)}else this.headers.delete(Oe),this.normalizedNames.delete(Oe)}}forEach(Ve){this.init(),Array.from(this.normalizedNames.keys()).forEach(Oe=>Ve(this.normalizedNames.get(Oe),this.headers.get(Oe)))}}class lt{encodeKey(Ve){return Gt(Ve)}encodeValue(Ve){return Gt(Ve)}decodeKey(Ve){return decodeURIComponent(Ve)}decodeValue(Ve){return decodeURIComponent(Ve)}}const jt=/%(\d[a-f0-9])/gi,Xt={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Gt(Mt){return encodeURIComponent(Mt).replace(jt,(Ve,Oe)=>Xt[Oe]??Ve)}function xn(Mt){return`${Mt}`}class on{constructor(Ve={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Ve.encoder||new lt,Ve.fromString){if(Ve.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function dn(Mt,Ve){const Oe=new Map;return Mt.length>0&&Mt.replace(/^\?/,"").split("&").forEach(Nt=>{const Un=Nt.indexOf("="),[ni,ui]=-1==Un?[Ve.decodeKey(Nt),""]:[Ve.decodeKey(Nt.slice(0,Un)),Ve.decodeValue(Nt.slice(Un+1))],Pn=Oe.get(ni)||[];Pn.push(ui),Oe.set(ni,Pn)}),Oe}(Ve.fromString,this.encoder)}else Ve.fromObject?(this.map=new Map,Object.keys(Ve.fromObject).forEach(Oe=>{const Ct=Ve.fromObject[Oe],Nt=Array.isArray(Ct)?Ct.map(xn):[xn(Ct)];this.map.set(Oe,Nt)})):this.map=null}has(Ve){return this.init(),this.map.has(Ve)}get(Ve){this.init();const Oe=this.map.get(Ve);return Oe?Oe[0]:null}getAll(Ve){return this.init(),this.map.get(Ve)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Ve,Oe){return this.clone({param:Ve,value:Oe,op:"a"})}appendAll(Ve){const Oe=[];return Object.keys(Ve).forEach(Ct=>{const Nt=Ve[Ct];Array.isArray(Nt)?Nt.forEach(Un=>{Oe.push({param:Ct,value:Un,op:"a"})}):Oe.push({param:Ct,value:Nt,op:"a"})}),this.clone(Oe)}set(Ve,Oe){return this.clone({param:Ve,value:Oe,op:"s"})}delete(Ve,Oe){return this.clone({param:Ve,value:Oe,op:"d"})}toString(){return this.init(),this.keys().map(Ve=>{const Oe=this.encoder.encodeKey(Ve);return this.map.get(Ve).map(Ct=>Oe+"="+this.encoder.encodeValue(Ct)).join("&")}).filter(Ve=>""!==Ve).join("&")}clone(Ve){const Oe=new on({encoder:this.encoder});return Oe.cloneFrom=this.cloneFrom||this,Oe.updates=(this.updates||[]).concat(Ve),Oe}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Ve=>this.map.set(Ve,this.cloneFrom.map.get(Ve))),this.updates.forEach(Ve=>{switch(Ve.op){case"a":case"s":const Oe=("a"===Ve.op?this.map.get(Ve.param):void 0)||[];Oe.push(xn(Ve.value)),this.map.set(Ve.param,Oe);break;case"d":if(void 0===Ve.value){this.map.delete(Ve.param);break}{let Ct=this.map.get(Ve.param)||[];const Nt=Ct.indexOf(xn(Ve.value));-1!==Nt&&Ct.splice(Nt,1),Ct.length>0?this.map.set(Ve.param,Ct):this.map.delete(Ve.param)}}}),this.cloneFrom=this.updates=null)}}class ki{constructor(){this.map=new Map}set(Ve,Oe){return this.map.set(Ve,Oe),this}get(Ve){return this.map.has(Ve)||this.map.set(Ve,Ve.defaultValue()),this.map.get(Ve)}delete(Ve){return this.map.delete(Ve),this}has(Ve){return this.map.has(Ve)}keys(){return this.map.keys()}}function St(Mt){return typeof ArrayBuffer<"u"&&Mt instanceof ArrayBuffer}function Zt(Mt){return typeof Blob<"u"&&Mt instanceof Blob}function Qt(Mt){return typeof FormData<"u"&&Mt instanceof FormData}class Rt{constructor(Ve,Oe,Ct,Nt){let Un;if(this.url=Oe,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Ve.toUpperCase(),function At(Mt){switch(Mt){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Nt?(this.body=void 0!==Ct?Ct:null,Un=Nt):Un=Ct,Un&&(this.reportProgress=!!Un.reportProgress,this.withCredentials=!!Un.withCredentials,Un.responseType&&(this.responseType=Un.responseType),Un.headers&&(this.headers=Un.headers),Un.context&&(this.context=Un.context),Un.params&&(this.params=Un.params)),this.headers||(this.headers=new ut),this.context||(this.context=new ki),this.params){const ni=this.params.toString();if(0===ni.length)this.urlWithParams=Oe;else{const ui=Oe.indexOf("?");this.urlWithParams=Oe+(-1===ui?"?":ui<Oe.length-1?"&":"")+ni}}else this.params=new on,this.urlWithParams=Oe}serializeBody(){return null===this.body?null:St(this.body)||Zt(this.body)||Qt(this.body)||function tn(Mt){return typeof URLSearchParams<"u"&&Mt instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof on?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Qt(this.body)?null:Zt(this.body)?this.body.type||null:St(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof on?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Ve={}){const Oe=Ve.method||this.method,Ct=Ve.url||this.url,Nt=Ve.responseType||this.responseType,Un=void 0!==Ve.body?Ve.body:this.body,ni=void 0!==Ve.withCredentials?Ve.withCredentials:this.withCredentials,ui=void 0!==Ve.reportProgress?Ve.reportProgress:this.reportProgress;let Pn=Ve.headers||this.headers,Ki=Ve.params||this.params;const Tn=Ve.context??this.context;return void 0!==Ve.setHeaders&&(Pn=Object.keys(Ve.setHeaders).reduce((qi,wn)=>qi.set(wn,Ve.setHeaders[wn]),Pn)),Ve.setParams&&(Ki=Object.keys(Ve.setParams).reduce((qi,wn)=>qi.set(wn,Ve.setParams[wn]),Ki)),new Rt(Oe,Ct,Un,{params:Ki,headers:Pn,context:Tn,reportProgress:ui,responseType:Nt,withCredentials:ni})}}var Kt=(()=>((Kt=Kt||{})[Kt.Sent=0]="Sent",Kt[Kt.UploadProgress=1]="UploadProgress",Kt[Kt.ResponseHeader=2]="ResponseHeader",Kt[Kt.DownloadProgress=3]="DownloadProgress",Kt[Kt.Response=4]="Response",Kt[Kt.User=5]="User",Kt))();class it{constructor(Ve,Oe=200,Ct="OK"){this.headers=Ve.headers||new ut,this.status=void 0!==Ve.status?Ve.status:Oe,this.statusText=Ve.statusText||Ct,this.url=Ve.url||null,this.ok=this.status>=200&&this.status<300}}class ct extends it{constructor(Ve={}){super(Ve),this.type=Kt.ResponseHeader}clone(Ve={}){return new ct({headers:Ve.headers||this.headers,status:void 0!==Ve.status?Ve.status:this.status,statusText:Ve.statusText||this.statusText,url:Ve.url||this.url||void 0})}}class It extends it{constructor(Ve={}){super(Ve),this.type=Kt.Response,this.body=void 0!==Ve.body?Ve.body:null}clone(Ve={}){return new It({body:void 0!==Ve.body?Ve.body:this.body,headers:Ve.headers||this.headers,status:void 0!==Ve.status?Ve.status:this.status,statusText:Ve.statusText||this.statusText,url:Ve.url||this.url||void 0})}}class dt extends it{constructor(Ve){super(Ve,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Ve.url||"(unknown url)"}`:`Http failure response for ${Ve.url||"(unknown url)"}: ${Ve.status} ${Ve.statusText}`,this.error=Ve.error||null}}function _n(Mt,Ve){return{body:Ve,headers:Mt.headers,context:Mt.context,observe:Mt.observe,params:Mt.params,reportProgress:Mt.reportProgress,responseType:Mt.responseType,withCredentials:Mt.withCredentials}}let rn=(()=>{class Mt{constructor(Oe){this.handler=Oe}request(Oe,Ct,Nt={}){let Un;if(Oe instanceof Rt)Un=Oe;else{let Pn,Ki;Pn=Nt.headers instanceof ut?Nt.headers:new ut(Nt.headers),Nt.params&&(Ki=Nt.params instanceof on?Nt.params:new on({fromObject:Nt.params})),Un=new Rt(Oe,Ct,void 0!==Nt.body?Nt.body:null,{headers:Pn,context:Nt.context,params:Ki,reportProgress:Nt.reportProgress,responseType:Nt.responseType||"json",withCredentials:Nt.withCredentials})}const ni=(0,ot.of)(Un).pipe((0,ze.b)(Pn=>this.handler.handle(Pn)));if(Oe instanceof Rt||"events"===Nt.observe)return ni;const ui=ni.pipe((0,Vt.h)(Pn=>Pn instanceof It));switch(Nt.observe||"body"){case"body":switch(Un.responseType){case"arraybuffer":return ui.pipe((0,Ft.U)(Pn=>{if(null!==Pn.body&&!(Pn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Pn.body}));case"blob":return ui.pipe((0,Ft.U)(Pn=>{if(null!==Pn.body&&!(Pn.body instanceof Blob))throw new Error("Response is not a Blob.");return Pn.body}));case"text":return ui.pipe((0,Ft.U)(Pn=>{if(null!==Pn.body&&"string"!=typeof Pn.body)throw new Error("Response is not a string.");return Pn.body}));default:return ui.pipe((0,Ft.U)(Pn=>Pn.body))}case"response":return ui;default:throw new Error(`Unreachable: unhandled observe type ${Nt.observe}}`)}}delete(Oe,Ct={}){return this.request("DELETE",Oe,Ct)}get(Oe,Ct={}){return this.request("GET",Oe,Ct)}head(Oe,Ct={}){return this.request("HEAD",Oe,Ct)}jsonp(Oe,Ct){return this.request("JSONP",Oe,{params:(new on).append(Ct,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Oe,Ct={}){return this.request("OPTIONS",Oe,Ct)}patch(Oe,Ct,Nt={}){return this.request("PATCH",Oe,_n(Nt,Ct))}post(Oe,Ct,Nt={}){return this.request("POST",Oe,_n(Nt,Ct))}put(Oe,Ct,Nt={}){return this.request("PUT",Oe,_n(Nt,Ct))}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)(Q.LFG(st))},Mt.\u0275prov=Q.Yz7({token:Mt,factory:Mt.\u0275fac}),Mt})();class Zn{constructor(Ve,Oe){this.next=Ve,this.interceptor=Oe}handle(Ve){return this.interceptor.intercept(Ve,this.next)}}const An=new Q.OlP("HTTP_INTERCEPTORS");let Di=(()=>{class Mt{intercept(Oe,Ct){return Ct.handle(Oe)}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)},Mt.\u0275prov=Q.Yz7({token:Mt,factory:Mt.\u0275fac}),Mt})();const ti=/^\)\]\}',?\n/;let Ur=(()=>{class Mt{constructor(Oe){this.xhrFactory=Oe}handle(Oe){if("JSONP"===Oe.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new c.y(Ct=>{const Nt=this.xhrFactory.build();if(Nt.open(Oe.method,Oe.urlWithParams),Oe.withCredentials&&(Nt.withCredentials=!0),Oe.headers.forEach((di,Ci)=>Nt.setRequestHeader(di,Ci.join(","))),Oe.headers.has("Accept")||Nt.setRequestHeader("Accept","application/json, text/plain, */*"),!Oe.headers.has("Content-Type")){const di=Oe.detectContentTypeHeader();null!==di&&Nt.setRequestHeader("Content-Type",di)}if(Oe.responseType){const di=Oe.responseType.toLowerCase();Nt.responseType="json"!==di?di:"text"}const Un=Oe.serializeBody();let ni=null;const ui=()=>{if(null!==ni)return ni;const di=Nt.statusText||"OK",Ci=new ut(Nt.getAllResponseHeaders()),br=function ai(Mt){return"responseURL"in Mt&&Mt.responseURL?Mt.responseURL:/^X-Request-URL:/m.test(Mt.getAllResponseHeaders())?Mt.getResponseHeader("X-Request-URL"):null}(Nt)||Oe.url;return ni=new ct({headers:Ci,status:Nt.status,statusText:di,url:br}),ni},Pn=()=>{let{headers:di,status:Ci,statusText:br,url:Gr}=ui(),Wi=null;204!==Ci&&(Wi=typeof Nt.response>"u"?Nt.responseText:Nt.response),0===Ci&&(Ci=Wi?200:0);let dr=Ci>=200&&Ci<300;if("json"===Oe.responseType&&"string"==typeof Wi){const mo=Wi;Wi=Wi.replace(ti,"");try{Wi=""!==Wi?JSON.parse(Wi):null}catch(_e){Wi=mo,dr&&(dr=!1,Wi={error:_e,text:Wi})}}dr?(Ct.next(new It({body:Wi,headers:di,status:Ci,statusText:br,url:Gr||void 0})),Ct.complete()):Ct.error(new dt({error:Wi,headers:di,status:Ci,statusText:br,url:Gr||void 0}))},Ki=di=>{const{url:Ci}=ui(),br=new dt({error:di,status:Nt.status||0,statusText:Nt.statusText||"Unknown Error",url:Ci||void 0});Ct.error(br)};let Tn=!1;const qi=di=>{Tn||(Ct.next(ui()),Tn=!0);let Ci={type:Kt.DownloadProgress,loaded:di.loaded};di.lengthComputable&&(Ci.total=di.total),"text"===Oe.responseType&&!!Nt.responseText&&(Ci.partialText=Nt.responseText),Ct.next(Ci)},wn=di=>{let Ci={type:Kt.UploadProgress,loaded:di.loaded};di.lengthComputable&&(Ci.total=di.total),Ct.next(Ci)};return Nt.addEventListener("load",Pn),Nt.addEventListener("error",Ki),Nt.addEventListener("timeout",Ki),Nt.addEventListener("abort",Ki),Oe.reportProgress&&(Nt.addEventListener("progress",qi),null!==Un&&Nt.upload&&Nt.upload.addEventListener("progress",wn)),Nt.send(Un),Ct.next({type:Kt.Sent}),()=>{Nt.removeEventListener("error",Ki),Nt.removeEventListener("abort",Ki),Nt.removeEventListener("load",Pn),Nt.removeEventListener("timeout",Ki),Oe.reportProgress&&(Nt.removeEventListener("progress",qi),null!==Un&&Nt.upload&&Nt.upload.removeEventListener("progress",wn)),Nt.readyState!==Nt.DONE&&Nt.abort()}})}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)(Q.LFG(_.JF))},Mt.\u0275prov=Q.Yz7({token:Mt,factory:Mt.\u0275fac}),Mt})();const vi=new Q.OlP("XSRF_COOKIE_NAME"),cr=new Q.OlP("XSRF_HEADER_NAME");class Hi{}let nr=(()=>{class Mt{constructor(Oe,Ct,Nt){this.doc=Oe,this.platform=Ct,this.cookieName=Nt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Oe=this.doc.cookie||"";return Oe!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,_.Mx)(Oe,this.cookieName),this.lastCookieString=Oe),this.lastToken}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)(Q.LFG(_.K0),Q.LFG(Q.Lbi),Q.LFG(vi))},Mt.\u0275prov=Q.Yz7({token:Mt,factory:Mt.\u0275fac}),Mt})(),si=(()=>{class Mt{constructor(Oe,Ct){this.tokenService=Oe,this.headerName=Ct}intercept(Oe,Ct){const Nt=Oe.url.toLowerCase();if("GET"===Oe.method||"HEAD"===Oe.method||Nt.startsWith("http://")||Nt.startsWith("https://"))return Ct.handle(Oe);const Un=this.tokenService.getToken();return null!==Un&&!Oe.headers.has(this.headerName)&&(Oe=Oe.clone({headers:Oe.headers.set(this.headerName,Un)})),Ct.handle(Oe)}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)(Q.LFG(Hi),Q.LFG(cr))},Mt.\u0275prov=Q.Yz7({token:Mt,factory:Mt.\u0275fac}),Mt})(),Ji=(()=>{class Mt{constructor(Oe,Ct){this.backend=Oe,this.injector=Ct,this.chain=null}handle(Oe){if(null===this.chain){const Ct=this.injector.get(An,[]);this.chain=Ct.reduceRight((Nt,Un)=>new Zn(Nt,Un),this.backend)}return this.chain.handle(Oe)}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)(Q.LFG(xt),Q.LFG(Q.zs3))},Mt.\u0275prov=Q.Yz7({token:Mt,factory:Mt.\u0275fac}),Mt})(),zi=(()=>{class Mt{static disable(){return{ngModule:Mt,providers:[{provide:si,useClass:Di}]}}static withOptions(Oe={}){return{ngModule:Mt,providers:[Oe.cookieName?{provide:vi,useValue:Oe.cookieName}:[],Oe.headerName?{provide:cr,useValue:Oe.headerName}:[]]}}}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)},Mt.\u0275mod=Q.oAB({type:Mt}),Mt.\u0275inj=Q.cJS({providers:[si,{provide:An,useExisting:si,multi:!0},{provide:Hi,useClass:nr},{provide:vi,useValue:"XSRF-TOKEN"},{provide:cr,useValue:"X-XSRF-TOKEN"}]}),Mt})(),zn=(()=>{class Mt{}return Mt.\u0275fac=function(Oe){return new(Oe||Mt)},Mt.\u0275mod=Q.oAB({type:Mt}),Mt.\u0275inj=Q.cJS({providers:[rn,{provide:st,useClass:Ji},Ur,{provide:xt,useExisting:Ur}],imports:[zi.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),Mt})()},1571:(Yn,Ut,he)=>{"use strict";he.d(Ut,{tb:()=>Zv,AFp:()=>$v,ip1:()=>Gv,CZH:()=>r_,hGG:()=>Mw,z2F:()=>s_,sBO:()=>dw,Sil:()=>Wx,_Vd:()=>Ec,EJc:()=>$x,Xts:()=>ic,SBq:()=>ua,lqb:()=>iu,qLn:()=>Pd,vpe:()=>Dd,XFs:()=>zn,OlP:()=>Qi,zs3:()=>pd,ZZ4:()=>Ay,aQg:()=>Py,soG:()=>o_,YKP:()=>W0,h0i:()=>kp,PXZ:()=>ow,R0b:()=>gu,FiY:()=>je,Lbi:()=>Ux,g9A:()=>Wv,Qsj:()=>su,FYo:()=>Au,JOm:()=>W,tp0:()=>Je,Rgc:()=>Hm,dDg:()=>tw,eoX:()=>e1,GfV:()=>Yh,s_b:()=>t_,ifc:()=>ui,LMc:()=>Aw,MMx:()=>oy,Lck:()=>zb,eFA:()=>i1,G48:()=>uw,Gpc:()=>Xt,f3M:()=>ge,_c5:()=>Ew,c2e:()=>jx,zSh:()=>al,wAp:()=>wi,vHH:()=>vn,lri:()=>Kv,rWj:()=>Qv,D6c:()=>Sw,cg1:()=>X_,kL8:()=>g0,dqk:()=>Pn,Z0I:()=>vi,sIi:()=>kh,CqO:()=>Ot,QGY:()=>mt,QP$:()=>ye,F4k:()=>pt,RDi:()=>Wr,AaK:()=>lt,qOj:()=>Sp,TTD:()=>ia,_Bn:()=>H0,jDz:()=>q0,xp6:()=>dg,uIk:()=>Ap,Tol:()=>km,ekj:()=>wd,Suo:()=>vv,Xpm:()=>_e,lG2:()=>et,Yz7:()=>vr,cJS:()=>ai,oAB:()=>Se,Yjl:()=>We,Y36:()=>Fu,_UZ:()=>Ce,qZA:()=>pe,TgZ:()=>oe,EpF:()=>Be,n5z:()=>qu,Ikx:()=>Y_,SDv:()=>j0,QtT:()=>G0,pQV:()=>Q_,LFG:()=>de,$8M:()=>Dl,$Z:()=>xg,NdJ:()=>an,CRH:()=>bv,kcU:()=>or,O4$:()=>Ii,oxw:()=>Wt,ALo:()=>uv,xi3:()=>dv,Hsn:()=>xi,F$t:()=>yi,Q6J:()=>z,s9C:()=>Hn,MGl:()=>hn,DdM:()=>tv,VKq:()=>nv,WLB:()=>iv,kEZ:()=>rv,iGM:()=>_v,MAs:()=>B,KtG:()=>el,CHM:()=>ba,LSH:()=>Gf,Udp:()=>Uc,YNc:()=>M,W1O:()=>Tv,_uU:()=>Jy,Oqu:()=>Z_,hij:()=>Yg,AsE:()=>q_,Gf:()=>yv});var _=he(7579),Q=he(727),ot=he(9751),c=he(6451),ze=he(8421),Vt=he(930),Ft=he(4482);function xt(r,o,...a){if(!0===o)return void r();if(!1===o)return;const h=new Vt.Hp({next:()=>{h.unsubscribe(),r()}});return o(...a).subscribe(h)}function ut(r){for(let o in r)if(r[o]===ut)return o;throw Error("Could not find renamed property on target object.")}function Et(r,o){for(const a in o)o.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&(r[a]=o[a])}function lt(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(lt).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function dn(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const jt=ut({__forward_ref__:ut});function Xt(r){return r.__forward_ref__=Xt,r.toString=function(){return lt(this())},r}function Gt(r){return xn(r)?r():r}function xn(r){return"function"==typeof r&&r.hasOwnProperty(jt)&&r.__forward_ref__===Xt}class vn extends Error{constructor(o,a){super(function ki(r,o){return`NG0${Math.abs(r)}${o?": "+o.trim():""}`}(o,a)),this.code=o}}function At(r){return"string"==typeof r?r:null==r?"":String(r)}function Rt(r,o){throw new vn(-201,!1)}function ei(r,o,a,h){throw new Error(`ASSERTION ERROR: ${r}`+(null==h?"":` [Expected=> ${a} ${h} ${o} <=Actual]`))}function vr(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function ai(r){return{providers:r.providers||[],imports:r.imports||[]}}function Ur(r){return cr(r,Ji)||cr(r,pr)}function vi(r){return null!==Ur(r)}function cr(r,o){return r.hasOwnProperty(o)?r[o]:null}function si(r){return r&&(r.hasOwnProperty(jr)||r.hasOwnProperty(zi))?r[jr]:null}const Ji=ut({\u0275prov:ut}),jr=ut({\u0275inj:ut}),pr=ut({ngInjectableDef:ut}),zi=ut({ngInjectorDef:ut});var zn=(()=>((zn=zn||{})[zn.Default=0]="Default",zn[zn.Host=1]="Host",zn[zn.Self=2]="Self",zn[zn.SkipSelf=4]="SkipSelf",zn[zn.Optional=8]="Optional",zn))();let Ho;function Mt(r){const o=Ho;return Ho=r,o}function Ve(r,o,a){const h=Ur(r);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:a&zn.Optional?null:void 0!==o?o:void Rt(lt(r))}function Ct(r){return{toString:r}.toString()}var Nt=(()=>((Nt=Nt||{})[Nt.OnPush=0]="OnPush",Nt[Nt.Default=1]="Default",Nt))(),ui=(()=>{return(r=ui||(ui={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",ui;var r})();const Pn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),qi={},wn=[],di=ut({\u0275cmp:ut}),Ci=ut({\u0275dir:ut}),br=ut({\u0275pipe:ut}),Gr=ut({\u0275mod:ut}),Wi=ut({\u0275fac:ut}),dr=ut({__NG_ELEMENT_ID__:ut});let mo=0;function _e(r){return Ct(()=>{const a=!0===r.standalone,h={},v={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:h,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Nt.OnPush,directiveDefs:null,pipeDefs:null,standalone:a,dependencies:a&&r.dependencies||null,getStandaloneInjector:null,selectors:r.selectors||wn,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||ui.Emulated,id:"c"+mo++,styles:r.styles||wn,_:null,setInput:null,schemas:r.schemas||null,tView:null},D=r.dependencies,I=r.features;return v.inputs=nt(r.inputs,h),v.outputs=nt(r.outputs),I&&I.forEach(L=>L(v)),v.directiveDefs=D?()=>("function"==typeof D?D():D).map(re).filter(xe):null,v.pipeDefs=D?()=>("function"==typeof D?D():D).map(Ae).filter(xe):null,v})}function re(r){return Ke(r)||wt(r)}function xe(r){return null!==r}function Se(r){return Ct(()=>({type:r.type,bootstrap:r.bootstrap||wn,declarations:r.declarations||wn,imports:r.imports||wn,exports:r.exports||wn,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function nt(r,o){if(null==r)return qi;const a={};for(const h in r)if(r.hasOwnProperty(h)){let v=r[h],D=v;Array.isArray(v)&&(D=v[1],v=v[0]),a[v]=h,o&&(o[v]=D)}return a}const et=_e;function We(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function Ke(r){return r[di]||null}function wt(r){return r[Ci]||null}function Ae(r){return r[br]||null}function ye(r){const o=Ke(r)||wt(r)||Ae(r);return null!==o&&o.standalone}function be(r,o){const a=r[Gr]||null;if(!a&&!0===o)throw new Error(`Type ${lt(r)} does not have '\u0275mod' property.`);return a}function qr(r){return Array.isArray(r)&&"object"==typeof r[1]}function eo(r){return Array.isArray(r)&&!0===r[1]}function Yr(r){return 0!=(8&r.flags)}function Ui(r){return 2==(2&r.flags)}function fa(r){return 1==(1&r.flags)}function _o(r){return null!==r.template}function Zo(r){return 0!=(256&r[2])}function ns(r,o){return r.hasOwnProperty(Wi)?r[Wi]:null}class is{constructor(o,a,h){this.previousValue=o,this.currentValue=a,this.firstChange=h}isFirstChange(){return this.firstChange}}function ia(){return hc}function hc(r){return r.type.prototype.ngOnChanges&&(r.setInput=Us),Ss}function Ss(){const r=Xa(this),o=r?.current;if(o){const a=r.previous;if(a===qi)r.previous=o;else for(let h in o)a[h]=o[h];r.current=null,this.ngOnChanges(o)}}function Us(r,o,a,h){const v=Xa(r)||function ma(r,o){return r[Ya]=o}(r,{previous:qi,current:null}),D=v.current||(v.current={}),I=v.previous,L=this.declaredInputs[a],V=I[L];D[L]=new is(V&&V.currentValue,o,I===qi),r[h]=o}ia.ngInherit=!0;const Ya="__ngSimpleChanges__";function Xa(r){return r[Ya]||null}function mr(r){for(;Array.isArray(r);)r=r[0];return r}function ga(r,o){return mr(o[r])}function rr(r,o){return mr(o[r.index])}function xs(r,o){return r.data[o]}function _i(r,o){return r[o]}function uo(r,o){const a=o[r];return qr(a)?a:a[0]}function _a(r){return 64==(64&r[2])}function Sr(r,o){return null==o?null:r[o]}function ya(r){r[18]=0}function As(r,o){r[5]+=o;let a=r,h=r[3];for(;null!==h&&(1===o&&1===a[5]||-1===o&&0===a[5]);)h[5]+=o,a=h,h=h[3]}const li={lFrame:H(null),bindingsEnabled:!0};function rs(){return li.bindingsEnabled}function Jt(){return li.lFrame.lView}function Ei(){return li.lFrame.tView}function ba(r){return li.lFrame.contextLView=r,r[8]}function el(r){return li.lFrame.contextLView=null,r}function Lr(){let r=Na();for(;null!==r&&64===r.type;)r=r.parent;return r}function Na(){return li.lFrame.currentTNode}function xa(){const r=li.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}function Bo(r,o){const a=li.lFrame;a.currentTNode=r,a.isParent=o}function J(){return li.lFrame.isParent}function q(){li.lFrame.isParent=!1}function Mi(){const r=li.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function to(){return li.lFrame.bindingIndex}function ws(){return li.lFrame.bindingIndex++}function Oo(r){const o=li.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,a}function ka(r){li.lFrame.inI18n=r}function _u(r,o){const a=li.lFrame;a.bindingIndex=a.bindingRootIndex=r,kl(o)}function kl(r){li.lFrame.currentDirectiveIndex=r}function Fl(){return li.lFrame.currentQueryIndex}function bl(r){li.lFrame.currentQueryIndex=r}function Ll(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function oa(r,o,a){if(a&zn.SkipSelf){let v=o,D=r;for(;!(v=v.parent,null!==v||a&zn.Host||(v=Ll(D),null===v||(D=D[15],10&v.type))););if(null===v)return!1;o=v,r=D}const h=li.lFrame=ie();return h.currentTNode=o,h.lView=r,!0}function j(r){const o=ie(),a=r[1];li.lFrame=o,o.currentTNode=a.firstChild,o.lView=r,o.tView=a,o.contextLView=r,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function ie(){const r=li.lFrame,o=null===r?null:r.child;return null===o?H(r):o}function H(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function ce(){const r=li.lFrame;return li.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const He=ce;function Dt(){const r=ce();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function fi(){return li.lFrame.selectedIndex}function Si(r){li.lFrame.selectedIndex=r}function qn(){const r=li.lFrame;return xs(r.tView,r.selectedIndex)}function Ii(){li.lFrame.currentNamespace="svg"}function or(){!function Do(){li.lFrame.currentNamespace=null}()}function Ro(r,o){for(let a=o.directiveStart,h=o.directiveEnd;a<h;a++){const D=r.data[a].type.prototype,{ngAfterContentInit:I,ngAfterContentChecked:L,ngAfterViewInit:V,ngAfterViewChecked:ee,ngOnDestroy:le}=D;I&&(r.contentHooks||(r.contentHooks=[])).push(-a,I),L&&((r.contentHooks||(r.contentHooks=[])).push(a,L),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(a,L)),V&&(r.viewHooks||(r.viewHooks=[])).push(-a,V),ee&&((r.viewHooks||(r.viewHooks=[])).push(a,ee),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(a,ee)),null!=le&&(r.destroyHooks||(r.destroyHooks=[])).push(a,le)}}function os(r,o,a){Bl(r,o,3,a)}function Ai(r,o,a,h){(3&r[2])===a&&Bl(r,o,a,h)}function sa(r,o){let a=r[2];(3&a)===o&&(a&=2047,a+=1,r[2]=a)}function Bl(r,o,a,h){const D=h??-1,I=o.length-1;let L=0;for(let V=void 0!==h?65535&r[18]:0;V<I;V++)if("number"==typeof o[V+1]){if(L=o[V],null!=h&&L>=h)break}else o[V]<0&&(r[18]+=65536),(L<D||-1==D)&&(pc(r,a,o,V),r[18]=(4294901760&r[18])+V+2),V++}function pc(r,o,a,h){const v=a[h]<0,D=a[h+1],L=r[v?-a[h]:a[h]];if(v){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{D.call(L)}finally{}}}else try{D.call(L)}finally{}}class mc{constructor(o,a,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=h}}function Ul(r,o,a){let h=0;for(;h<a.length;){const v=a[h];if("number"==typeof v){if(0!==v)break;h++;const D=a[h++],I=a[h++],L=a[h++];r.setAttribute(o,I,L,D)}else{const D=v,I=a[++h];Gl(D)?r.setProperty(o,D,I):r.setAttribute(o,D,I),h++}}return h}function jl(r){return 3===r||4===r||6===r}function Gl(r){return 64===r.charCodeAt(0)}function bn(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let a=-1;for(let h=0;h<o.length;h++){const v=o[h];"number"==typeof v?a=v:0===a||Os(r,a,v,null,-1===a||2===a?o[++h]:null)}}return r}function Os(r,o,a,h,v){let D=0,I=r.length;if(-1===o)I=-1;else for(;D<r.length;){const L=r[D++];if("number"==typeof L){if(L===o){I=-1;break}if(L>o){I=D-1;break}}}for(;D<r.length;){const L=r[D];if("number"==typeof L)break;if(L===a){if(null===h)return void(null!==v&&(r[D+1]=v));if(h===r[D+1])return void(r[D+2]=v)}D++,null!==h&&D++,null!==v&&D++}-1!==I&&(r.splice(I,0,o),D=I+1),r.splice(D++,0,a),null!==h&&r.splice(D++,0,h),null!==v&&r.splice(D++,0,v)}function Hc(r){return-1!==r}function La(r){return 32767&r}function Vo(r,o){let a=function $l(r){return r>>16}(r),h=o;for(;a>0;)h=h[15],a--;return h}let bu=!0;function xl(r){const o=bu;return bu=r,o}let _c=0;const Mo={};function wl(r,o){const a=yc(r,o);if(-1!==a)return a;const h=o[1];h.firstCreatePass&&(r.injectorIndex=o.length,Zc(h.data,r),Zc(o,null),Zc(h.blueprint,null));const v=tl(r,o),D=r.injectorIndex;if(Hc(v)){const I=La(v),L=Vo(v,o),V=L[1].data;for(let ee=0;ee<8;ee++)o[D+ee]=L[I+ee]|V[I+ee]}return o[D+8]=v,D}function Zc(r,o){r.push(0,0,0,0,0,0,0,0,o)}function yc(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function tl(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let a=0,h=null,v=o;for(;null!==v;){if(h=xu(v),null===h)return-1;if(a++,v=v[15],-1!==h.injectorIndex)return h.injectorIndex|a<<16}return-1}function nl(r,o,a){!function Wu(r,o,a){let h;"string"==typeof a?h=a.charCodeAt(0)||0:a.hasOwnProperty(dr)&&(h=a[dr]),null==h&&(h=a[dr]=_c++);const v=255&h;o.data[r+(v>>5)]|=1<<v}(r,o,a)}function Xo(r,o,a){if(a&zn.Optional||void 0!==r)return r;Rt()}function To(r,o,a,h){if(a&zn.Optional&&void 0===h&&(h=null),0==(a&(zn.Self|zn.Host))){const v=r[9],D=Mt(void 0);try{return v?v.get(o,h,a&zn.Optional):Ve(o,h,a&zn.Optional)}finally{Mt(D)}}return Xo(h,0,a)}function Zu(r,o,a,h=zn.Default,v){if(null!==r){if(1024&o[2]){const I=function Uo(r,o,a,h,v){let D=r,I=o;for(;null!==D&&null!==I&&1024&I[2]&&!(256&I[2]);){const L=qc(D,I,a,h|zn.Self,Mo);if(L!==Mo)return L;let V=D.parent;if(!V){const ee=I[21];if(ee){const le=ee.get(a,Mo,h);if(le!==Mo)return le}V=xu(I),I=I[15]}D=V}return v}(r,o,a,h,Mo);if(I!==Mo)return I}const D=qc(r,o,a,h,Mo);if(D!==Mo)return D}return To(o,a,h,v)}function qc(r,o,a,h,v){const D=function ss(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(dr)?r[dr]:void 0;return"number"==typeof o?o>=0?255&o:Zl:o}(a);if("function"==typeof D){if(!oa(o,r,h))return h&zn.Host?Xo(v,0,h):To(o,a,h,v);try{const I=D(h);if(null!=I||h&zn.Optional)return I;Rt()}finally{He()}}else if("number"==typeof D){let I=null,L=yc(r,o),V=-1,ee=h&zn.Host?o[16][6]:null;for((-1===L||h&zn.SkipSelf)&&(V=-1===L?tl(r,o):o[L+8],-1!==V&&Yc(h,!1)?(I=o[1],L=La(V),o=Vo(V,o)):L=-1);-1!==L;){const le=o[1];if(Ba(D,L,le.data)){const Me=no(L,o,a,I,h,ee);if(Me!==Mo)return Me}V=o[L+8],-1!==V&&Yc(h,o[1].data[L+8]===ee)&&Ba(D,L,o)?(I=le,L=La(V),o=Vo(V,o)):L=-1}}return v}function no(r,o,a,h,v,D){const I=o[1],L=I.data[r+8],le=yo(L,I,a,null==h?Ui(L)&&bu:h!=I&&0!=(3&L.type),v&zn.Host&&D===L);return null!==le?ho(o,I,le,L):Mo}function yo(r,o,a,h,v){const D=r.providerIndexes,I=o.data,L=1048575&D,V=r.directiveStart,le=D>>20,Qe=v?L+le:r.directiveEnd;for(let ht=h?L:L+le;ht<Qe;ht++){const $t=I[ht];if(ht<V&&a===$t||ht>=V&&$t.type===a)return ht}if(v){const ht=I[V];if(ht&&_o(ht)&&ht.type===a)return V}return null}function ho(r,o,a,h){let v=r[a];const D=o.data;if(function Fa(r){return r instanceof mc}(v)){const I=v;I.resolving&&function Zt(r,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new vn(-200,`Circular dependency in DI detected for ${r}${a}`)}(function St(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():At(r)}(D[a]));const L=xl(I.canSeeViewProviders);I.resolving=!0;const V=I.injectImpl?Mt(I.injectImpl):null;oa(r,h,zn.Default);try{v=r[a]=I.factory(void 0,D,r,h),o.firstCreatePass&&a>=h.directiveStart&&function zo(r,o,a){const{ngOnChanges:h,ngOnInit:v,ngDoCheck:D}=o.type.prototype;if(h){const I=hc(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(r,I),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,I)}v&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-r,v),D&&((a.preOrderHooks||(a.preOrderHooks=[])).push(r,D),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(r,D))}(a,D[a],o)}finally{null!==V&&Mt(V),xl(L),I.resolving=!1,He()}}return v}function Ba(r,o,a){return!!(a[o+(r>>5)]&1<<r)}function Yc(r,o){return!(r&zn.Self||r&zn.Host&&o)}class Wl{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,h){return Zu(this._tNode,this._lView,o,h,a)}}function Zl(){return new Wl(Lr(),Jt())}function qu(r){return Ct(()=>{const o=r.prototype.constructor,a=o[Wi]||za(o),h=Object.prototype;let v=Object.getPrototypeOf(r.prototype).constructor;for(;v&&v!==h;){const D=v[Wi]||za(v);if(D&&D!==a)return D;v=Object.getPrototypeOf(v)}return D=>new D})}function za(r){return xn(r)?()=>{const o=za(Gt(r));return o&&o()}:ns(r)}function xu(r){const o=r[1],a=o.type;return 2===a?o.declTNode:1===a?r[6]:null}function Dl(r){return function vc(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const a=r.attrs;if(a){const h=a.length;let v=0;for(;v<h;){const D=a[v];if(jl(D))break;if(0===D)v+=2;else if("number"==typeof D)for(v++;v<h&&"string"==typeof a[v];)v++;else{if(D===o)return a[v+1];v+=2}}}return null}(Lr(),r)}const ql="__parameters__";function Jo(r,o,a){return Ct(()=>{const h=function Hr(r){return function(...a){if(r){const h=r(...a);for(const v in h)this[v]=h[v]}}}(o);function v(...D){if(this instanceof v)return h.apply(this,D),this;const I=new v(...D);return L.annotation=I,L;function L(V,ee,le){const Me=V.hasOwnProperty(ql)?V[ql]:Object.defineProperty(V,ql,{value:[]})[ql];for(;Me.length<=le;)Me.push(null);return(Me[le]=Me[le]||[]).push(I),V}}return a&&(v.prototype=Object.create(a.prototype)),v.prototype.ngMetadataName=r,v.annotationCls=v,v})}class Qi{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=vr({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function vo(r,o){void 0===o&&(o=r);for(let a=0;a<r.length;a++){let h=r[a];Array.isArray(h)?(o===r&&(o=r.slice(0,a)),vo(h,o)):o!==r&&o.push(h)}return o}function Gs(r,o){r.forEach(a=>Array.isArray(a)?Gs(a,o):o(a))}function Va(r,o,a){o>=r.length?r.push(a):r.splice(o,0,a)}function Ua(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function Jl(r,o){const a=[];for(let h=0;h<r;h++)a.push(o);return a}function Ie(r,o,a){let h=Tt(r,o);return h>=0?r[1|h]=a:(h=~h,function A(r,o,a,h){let v=r.length;if(v==o)r.push(a,h);else if(1===v)r.push(h,r[0]),r[0]=a;else{for(v--,r.push(r[v-1],r[v]);v>o;)r[v]=r[v-2],v--;r[o]=a,r[o+1]=h}}(r,h,o,a)),h}function ke(r,o){const a=Tt(r,o);if(a>=0)return r[1|a]}function Tt(r,o){return function gi(r,o,a){let h=0,v=r.length>>a;for(;v!==h;){const D=h+(v-h>>1),I=r[D<<a];if(o===I)return D<<a;I>o?v=D:h=D+1}return~(v<<a)}(r,o,1)}const x={},w="__NG_DI_FLAG__",S="ngTempTokenPath",F=/\n/gm,Z="__source";let ne;function se(r){const o=ne;return ne=r,o}function ve(r,o=zn.Default){if(void 0===ne)throw new vn(-203,!1);return null===ne?Ve(r,void 0,o):ne.get(r,o&zn.Optional?null:void 0,o)}function de(r,o=zn.Default){return(function ts(){return Ho}()||ve)(Gt(r),o)}function ge(r,o=zn.Default){return"number"!=typeof o&&(o=0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)),de(r,o)}function fe(r){const o=[];for(let a=0;a<r.length;a++){const h=Gt(r[a]);if(Array.isArray(h)){if(0===h.length)throw new vn(900,!1);let v,D=zn.Default;for(let I=0;I<h.length;I++){const L=h[I],V=we(L);"number"==typeof V?-1===V?v=L.token:D|=V:v=L}o.push(de(v,D))}else o.push(de(h))}return o}function De(r,o){return r[w]=o,r.prototype[w]=o,r}function we(r){return r[w]}const je=De(Jo("Optional"),8),Je=De(Jo("SkipSelf"),4);let Ir,ro;function Wr(r){Ir=r}function sr(r){return function jo(){if(void 0===ro&&(ro=null,Pn.trustedTypes))try{ro=Pn.trustedTypes.createPolicy("angular",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return ro}()?.createHTML(r)||r}class ec{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function eu(r){return r instanceof ec?r.changingThisBreaksApplicationSecurity:r}class Hp{constructor(o){this.inertDocumentHelper=o}getInertBodyElement(o){o="<body><remove></remove>"+o;try{const a=(new window.DOMParser).parseFromString(sr(o),"text/html").body;return null===a?this.inertDocumentHelper.getInertBodyElement(o):(a.removeChild(a.firstChild),a)}catch{return null}}}class Vf{constructor(o){if(this.defaultDoc=o,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const a=this.inertDocument.createElement("html");this.inertDocument.appendChild(a);const h=this.inertDocument.createElement("body");a.appendChild(h)}}getInertBodyElement(o){const a=this.inertDocument.createElement("template");if("content"in a)return a.innerHTML=sr(o),a;const h=this.inertDocument.createElement("body");return h.innerHTML=sr(o),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(h),h}stripCustomNsAttrs(o){const a=o.attributes;for(let v=a.length-1;0<v;v--){const I=a.item(v).name;("xmlns:ns1"===I||0===I.indexOf("ns1:"))&&o.removeAttribute(I)}let h=o.firstChild;for(;h;)h.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(h),h=h.nextSibling}}const Cl=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function Zr(r){return(r=String(r)).match(Cl)?r:"unsafe:"+r}function rl(r){const o={};for(const a of r.split(","))o[a]=!0;return o}function tu(...r){const o={};for(const a of r)for(const h in a)a.hasOwnProperty(h)&&(o[h]=!0);return o}const Cu=rl("area,br,col,hr,img,wbr"),tc=rl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Ed=rl("rp,rt"),Ku=tu(Cu,tu(tc,rl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),tu(Ed,rl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),tu(Ed,tc)),lh=rl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Eu=tu(lh,rl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),rl("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"));var Ko=(()=>((Ko=Ko||{})[Ko.NONE=0]="NONE",Ko[Ko.HTML=1]="HTML",Ko[Ko.STYLE=2]="STYLE",Ko[Ko.SCRIPT=3]="SCRIPT",Ko[Ko.URL=4]="URL",Ko[Ko.RESOURCE_URL=5]="RESOURCE_URL",Ko))();function Gf(r){const o=function ja(){const r=Jt();return r&&r[12]}();return o?o.sanitize(Ko.URL,r)||"":function Cd(r,o){const a=function jp(r){return r instanceof ec&&r.getTypeName()||null}(r);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(r,"URL")?eu(r):Zr(At(r))}const ic=new Qi("ENVIRONMENT_INITIALIZER"),sl=new Qi("INJECTOR",-1),Ca=new Qi("INJECTOR_DEF_TYPES");class cs{get(o,a=x){if(a===x){const h=new Error(`NullInjectorError: No provider for ${lt(o)}!`);throw h.name="NullInjectorError",h}return a}}function dh(...r){return{\u0275providers:Ga(0,r)}}function Ga(r,...o){const a=[],h=new Set;let v;return Gs(o,D=>{const I=D;Ml(I,a,[],h)&&(v||(v=[]),v.push(I))}),void 0!==v&&Sd(v,a),a}function Sd(r,o){for(let a=0;a<r.length;a++){const{providers:v}=r[a];Gs(v,D=>{o.push(D)})}}function Ml(r,o,a,h){if(!(r=Gt(r)))return!1;let v=null,D=si(r);const I=!D&&Ke(r);if(D||I){if(I&&!I.standalone)return!1;v=r}else{const V=r.ngModule;if(D=si(V),!D)return!1;v=V}const L=h.has(v);if(I){if(L)return!1;if(h.add(v),I.dependencies){const V="function"==typeof I.dependencies?I.dependencies():I.dependencies;for(const ee of V)Ml(ee,o,a,h)}}else{if(!D)return!1;{if(null!=D.imports&&!L){let ee;h.add(v);try{Gs(D.imports,le=>{Ml(le,o,a,h)&&(ee||(ee=[]),ee.push(le))})}finally{}void 0!==ee&&Sd(ee,o)}if(!L){const ee=ns(v)||(()=>new v);o.push({provide:v,useFactory:ee,deps:wn},{provide:Ca,useValue:v,multi:!0},{provide:ic,useValue:()=>de(v),multi:!0})}const V=D.providers;null==V||L||Gs(V,le=>{o.push(le)})}}return v!==r&&void 0!==r.providers}const Qu=ut({provide:String,useValue:ut});function hh(r){return null!==r&&"object"==typeof r&&Qu in r}function Su(r){return"function"==typeof r}const al=new Qi("Set Injector scope."),oc={},nu={};let ed;function td(){return void 0===ed&&(ed=new cs),ed}class iu{}class Hf extends iu{constructor(o,a,h,v){super(),this.parent=a,this.source=h,this.scopes=v,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,qh(o,I=>this.processProvider(I)),this.records.set(sl,ru(void 0,this)),v.has("environment")&&this.records.set(iu,ru(void 0,this));const D=this.records.get(al);null!=D&&"string"==typeof D.value&&this.scopes.add(D.value),this.injectorDefTypes=new Set(this.get(Ca.multi,wn,zn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const a=se(this),h=Mt(void 0);try{return o()}finally{se(a),Mt(h)}}get(o,a=x,h=zn.Default){this.assertNotDestroyed();const v=se(this),D=Mt(void 0);try{if(!(h&zn.SkipSelf)){let L=this.records.get(o);if(void 0===L){const V=function Cc(r){return"function"==typeof r||"object"==typeof r&&r instanceof Qi}(o)&&Ur(o);L=V&&this.injectableDefInScope(V)?ru(fh(o),oc):null,this.records.set(o,L)}if(null!=L)return this.hydrate(o,L)}return(h&zn.Self?td():this.parent).get(o,a=h&zn.Optional&&a===x?null:a)}catch(I){if("NullInjectorError"===I.name){if((I[S]=I[S]||[]).unshift(lt(o)),v)throw I;return function qe(r,o,a,h){const v=r[S];throw o[Z]&&v.unshift(o[Z]),r.message=function Ue(r,o,a,h=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let v=lt(o);if(Array.isArray(o))v=o.map(lt).join(" -> ");else if("object"==typeof o){let D=[];for(let I in o)if(o.hasOwnProperty(I)){let L=o[I];D.push(I+":"+("string"==typeof L?JSON.stringify(L):lt(L)))}v=`{${D.join(", ")}}`}return`${a}${h?"("+h+")":""}[${v}]: ${r.replace(F,"\n  ")}`}("\n"+r.message,v,a,h),r.ngTokenPath=v,r[S]=null,r}(I,o,"R3InjectorError",this.source)}throw I}finally{Mt(D),se(v)}}resolveInjectorInitializers(){const o=se(this),a=Mt(void 0);try{const h=this.get(ic.multi,wn,zn.Self);for(const v of h)v()}finally{se(o),Mt(a)}}toString(){const o=[],a=this.records;for(const h of a.keys())o.push(lt(h));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new vn(205,!1)}processProvider(o){let a=Su(o=Gt(o))?o:Gt(o&&o.provide);const h=function $h(r){return hh(r)?ru(void 0,r.useValue):ru(Hh(r),oc)}(o);if(Su(o)||!0!==o.multi)this.records.get(a);else{let v=this.records.get(a);v||(v=ru(void 0,oc,!0),v.factory=()=>fe(v.multi),this.records.set(a,v)),a=o,v.multi.push(o)}this.records.set(a,h)}hydrate(o,a){return a.value===oc&&(a.value=nu,a.value=a.factory()),"object"==typeof a.value&&a.value&&function ph(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=Gt(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function fh(r){const o=Ur(r),a=null!==o?o.factory:ns(r);if(null!==a)return a;if(r instanceof Qi)throw new vn(204,!1);if(r instanceof Function)return function Wf(r){const o=r.length;if(o>0)throw Jl(o,"?"),new vn(204,!1);const a=function Hi(r){const o=r&&(r[Ji]||r[pr]);if(o){const a=function nr(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(r);return null!==a?()=>a.factory(r):()=>new r}(r);throw new vn(204,!1)}function Hh(r,o,a){let h;if(Su(r)){const v=Gt(r);return ns(v)||fh(v)}if(hh(r))h=()=>Gt(r.useValue);else if(function rc(r){return!(!r||!r.useFactory)}(r))h=()=>r.useFactory(...fe(r.deps||[]));else if(function Gh(r){return!(!r||!r.useExisting)}(r))h=()=>de(Gt(r.useExisting));else{const v=Gt(r&&(r.useClass||r.provide));if(!function Wh(r){return!!r.deps}(r))return ns(v)||fh(v);h=()=>new v(...fe(r.deps))}return h}function ru(r,o,a=!1){return{factory:r,value:o,multi:a?[]:void 0}}function Zh(r){return!!r.\u0275providers}function qh(r,o){for(const a of r)Array.isArray(a)?qh(a,o):Zh(a)?qh(a.\u0275providers,o):o(a)}class Iu{}class Jp{resolveComponentFactory(o){throw function Yp(r){const o=Error(`No component factory found for ${lt(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Ec=(()=>{class r{}return r.NULL=new Jp,r})();function ca(){return ou(Lr(),Jt())}function ou(r,o){return new ua(rr(r,o))}let ua=(()=>{class r{constructor(a){this.nativeElement=a}}return r.__NG_ELEMENT_ID__=ca,r})();function mh(r){return r instanceof ua?r.nativeElement:r}class Au{}let su=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function qf(){const r=Jt(),a=uo(Lr().index,r);return(qr(a)?a:r)[11]}(),r})(),Id=(()=>{class r{}return r.\u0275prov=vr({token:r,providedIn:"root",factory:()=>null}),r})();class Yh{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const Yf=new Yh("14.2.3"),Xh={};function ef(r){return r.ngOriginalError}class Pd{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&ef(o);for(;a&&ef(a);)a=ef(a);return a||null}}const od=/^>|^->|<!--|-->|--!>|<!-$/g,Kf=/(<|>)/;const Zs=new Map;let em=0;const sc="__ngContext__";function Xr(r,o){qr(o)?(r[sc]=o[20],function tm(r){Zs.set(r[20],r)}(o)):r[sc]=o}function Sc(r){return r instanceof Function?r():r}var W=(()=>((W=W||{})[W.Important=1]="Important",W[W.DashCase=2]="DashCase",W))();let Te;function Ge(r,o){return Te(r,o)}function Nn(r){const o=r[3];return eo(o)?o[3]:o}function Zi(r){return Li(r[13])}function ri(r){return Li(r[4])}function Li(r){for(;null!==r&&!eo(r);)r=r[4];return r}function Pi(r,o,a,h,v){if(null!=h){let D,I=!1;eo(h)?D=h:qr(h)&&(I=!0,h=h[0]);const L=mr(h);0===r&&null!==a?null==v?ld(o,a,L):Oc(o,a,L,v||null,!0):1===r&&null!==a?Oc(o,a,L,v||null,!0):2===r?xh(o,L,I):3===r&&o.destroyNode(L),null!=D&&function Bd(r,o,a,h,v){const D=a[7];D!==mr(a)&&Pi(o,r,h,D,v);for(let L=10;L<a.length;L++){const V=a[L];Ld(V[1],V,r,o,h,D)}}(o,r,D,a,v)}}function oo(r,o){return r.createText(o)}function ar(r,o,a){r.setValue(o,a)}function hr(r,o){return r.createComment(function Qf(r){return r.replace(od,o=>o.replace(Kf,"\u200b$1\u200b"))}(o))}function lr(r,o,a){return r.createElement(o,a)}function qs(r,o){const a=r[9],h=a.indexOf(o),v=o[3];512&o[2]&&(o[2]&=-513,As(v,-1)),a.splice(h,1)}function Ic(r,o){if(r.length<=10)return;const a=10+o,h=r[a];if(h){const v=h[17];null!==v&&v!==r&&qs(v,h),o>0&&(r[a-1][4]=h[4]);const D=Ua(r,10+o);!function Jr(r,o){Ld(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(h[1],h);const I=D[19];null!==I&&I.detachView(D[1]),h[3]=null,h[4]=null,h[2]&=-65}return h}function Ac(r,o){if(!(128&o[2])){const a=o[11];a.destroyNode&&Ld(r,o,a,3,null,null),function ds(r){let o=r[13];if(!o)return Qo(r[1],r);for(;o;){let a=null;if(qr(o))a=o[13];else{const h=o[10];h&&(a=h)}if(!a){for(;o&&!o[4]&&o!==r;)qr(o)&&Qo(o[1],o),o=o[3];null===o&&(o=r),qr(o)&&Qo(o[1],o),a=o&&o[4]}o=a}}(o)}}function Qo(r,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function bh(r,o){let a;if(null!=r&&null!=(a=r.destroyHooks))for(let h=0;h<a.length;h+=2){const v=o[a[h]];if(!(v instanceof mc)){const D=a[h+1];if(Array.isArray(D))for(let I=0;I<D.length;I+=2){const L=v[D[I]],V=D[I+1];try{V.call(L)}finally{}}else try{D.call(v)}finally{}}}}(r,o),function Il(r,o){const a=r.cleanup,h=o[7];let v=-1;if(null!==a)for(let D=0;D<a.length-1;D+=2)if("string"==typeof a[D]){const I=a[D+1],L="function"==typeof I?I(o):mr(o[I]),V=h[v=a[D+2]],ee=a[D+3];"boolean"==typeof ee?L.removeEventListener(a[D],V,ee):ee>=0?h[v=ee]():h[v=-ee].unsubscribe(),D+=2}else{const I=h[v=a[D+1]];a[D].call(I)}if(null!==h){for(let D=v+1;D<h.length;D++)(0,h[D])();o[7]=null}}(r,o),1===o[1].type&&o[11].destroy();const a=o[17];if(null!==a&&eo(o[3])){a!==o[3]&&qs(a,o);const h=o[19];null!==h&&h.detachView(r)}!function eg(r){Zs.delete(r[20])}(o)}}function Pc(r,o,a){return ad(r,o.parent,a)}function ad(r,o,a){let h=o;for(;null!==h&&40&h.type;)h=(o=h).parent;if(null===h)return a[0];if(2&h.flags){const v=r.data[h.directiveStart].encapsulation;if(v===ui.None||v===ui.Emulated)return null}return rr(h,a)}function Oc(r,o,a,h,v){r.insertBefore(o,a,h,v)}function ld(r,o,a){r.appendChild(o,a)}function Al(r,o,a,h,v){null!==h?Oc(r,o,a,h,v):ld(r,o,a)}function au(r,o){return r.parentNode(o)}function ul(r,o,a){return cd(r,o,a)}function Nd(r,o,a){return 40&r.type?rr(r,a):null}let ud,cd=Nd;function op(r,o){cd=r,ud=o}function dd(r,o,a,h){const v=Pc(r,h,o),D=o[11],L=ul(h.parent||o[6],h,o);if(null!=v)if(Array.isArray(a))for(let V=0;V<a.length;V++)Al(D,v,a[V],L,!1);else Al(D,v,a,L,!1);void 0!==ud&&ud(D,h,o,a,v)}function kd(r,o){if(null!==o){const a=o.type;if(3&a)return rr(o,r);if(4&a)return Fd(-1,r[o.index]);if(8&a){const h=o.child;if(null!==h)return kd(r,h);{const v=r[o.index];return eo(v)?Fd(-1,v):mr(v)}}if(32&a)return Ge(o,r)()||mr(r[o.index]);{const h=lf(r,o);return null!==h?Array.isArray(h)?h[0]:kd(Nn(r[16]),h):kd(r,o.next)}}return null}function lf(r,o){return null!==o?r[16][6].projection[o.projection]:null}function Fd(r,o){const a=10+r+1;if(a<o.length){const h=o[a],v=h[1].firstChild;if(null!==v)return kd(h,v)}return o[7]}function xh(r,o,a){const h=au(r,o);h&&function Rc(r,o,a,h){r.removeChild(o,a,h)}(r,h,o,a)}function wh(r,o,a,h,v,D,I){for(;null!=a;){const L=h[a.index],V=a.type;if(I&&0===o&&(L&&Xr(mr(L),h),a.flags|=4),64!=(64&a.flags))if(8&V)wh(r,o,a.child,h,v,D,!1),Pi(o,r,v,L,D);else if(32&V){const ee=Ge(a,h);let le;for(;le=ee();)Pi(o,r,v,le,D);Pi(o,r,v,L,D)}else 16&V?hd(r,o,h,a,v,D):Pi(o,r,v,L,D);a=I?a.projectionNext:a.next}}function Ld(r,o,a,h,v,D){wh(a,h,r.firstChild,o,v,D,!1)}function hd(r,o,a,h,v,D){const I=a[16],V=I[6].projection[h.projection];if(Array.isArray(V))for(let ee=0;ee<V.length;ee++)Pi(o,r,v,V[ee],D);else wh(r,o,V,I[3],v,D,!0)}function hs(r,o,a){r.setAttribute(o,"style",a)}function cu(r,o,a){""===a?r.removeAttribute(o,"class"):r.setAttribute(o,"class",a)}function ku(r,o,a){let h=r.length;for(;;){const v=r.indexOf(o,a);if(-1===v)return v;if(0===v||r.charCodeAt(v-1)<=32){const D=o.length;if(v+D===h||r.charCodeAt(v+D)<=32)return v}a=v+1}}const fd="ng-template";function sg(r,o,a){let h=0;for(;h<r.length;){let v=r[h++];if(a&&"class"===v){if(v=r[h],-1!==ku(v.toLowerCase(),o,0))return!0}else if(1===v){for(;h<r.length&&"string"==typeof(v=r[h++]);)if(v.toLowerCase()===o)return!0;return!1}}return!1}function ag(r){return 4===r.type&&r.value!==fd}function d_(r,o,a){return o===(4!==r.type||a?r.value:fd)}function h_(r,o,a){let h=4;const v=r.attrs||[],D=function p_(r){for(let o=0;o<r.length;o++)if(jl(r[o]))return o;return r.length}(v);let I=!1;for(let L=0;L<o.length;L++){const V=o[L];if("number"!=typeof V){if(!I)if(4&h){if(h=2|1&h,""!==V&&!d_(r,V,a)||""===V&&1===o.length){if(Nc(h))return!1;I=!0}}else{const ee=8&h?V:o[++L];if(8&h&&null!==r.attrs){if(!sg(r.attrs,ee,a)){if(Nc(h))return!1;I=!0}continue}const Me=f_(8&h?"class":V,v,ag(r),a);if(-1===Me){if(Nc(h))return!1;I=!0;continue}if(""!==ee){let Qe;Qe=Me>D?"":v[Me+1].toLowerCase();const ht=8&h?Qe:null;if(ht&&-1!==ku(ht,ee,0)||2&h&&ee!==Qe){if(Nc(h))return!1;I=!0}}}}else{if(!I&&!Nc(h)&&!Nc(V))return!1;if(I&&Nc(V))continue;I=!1,h=V|1&h}}return Nc(h)||I}function Nc(r){return 0==(1&r)}function f_(r,o,a,h){if(null===o)return-1;let v=0;if(h||!a){let D=!1;for(;v<o.length;){const I=o[v];if(I===r)return v;if(3===I||6===I)D=!0;else{if(1===I||2===I){let L=o[++v];for(;"string"==typeof L;)L=o[++v];continue}if(4===I)break;if(0===I){v+=4;continue}}v+=D?1:2}return-1}return function cg(r,o){let a=r.indexOf(4);if(a>-1)for(a++;a<r.length;){const h=r[a];if("number"==typeof h)return-1;if(h===o)return a;a++}return-1}(o,r)}function lg(r,o,a=!1){for(let h=0;h<o.length;h++)if(h_(r,o[h],a))return!0;return!1}function ug(r,o){e:for(let a=0;a<o.length;a++){const h=o[a];if(r.length===h.length){for(let v=0;v<r.length;v++)if(r[v]!==h[v])continue e;return!0}}return!1}function am(r,o){return r?":not("+o.trim()+")":o}function m_(r){let o=r[0],a=1,h=2,v="",D=!1;for(;a<r.length;){let I=r[a];if("string"==typeof I)if(2&h){const L=r[++a];v+="["+I+(L.length>0?'="'+L+'"':"")+"]"}else 8&h?v+="."+I:4&h&&(v+=" "+I);else""!==v&&!Nc(I)&&(o+=am(D,v),v=""),h=I,D=D||!Nc(h);a++}return""!==v&&(o+=am(D,v)),o}const Gi={};function dg(r){lm(Ei(),Jt(),fi()+r,!1)}function lm(r,o,a,h){if(!h)if(3==(3&o[2])){const D=r.preOrderCheckHooks;null!==D&&os(o,D,a)}else{const D=r.preOrderHooks;null!==D&&Ai(o,D,0,a)}Si(a)}function fg(r,o=null,a=null,h){const v=pg(r,o,a,h);return v.resolveInjectorInitializers(),v}function pg(r,o=null,a=null,h,v=new Set){const D=[a||wn,dh(r)];return h=h||("object"==typeof r?void 0:lt(r)),new Hf(D,o||td(),h||null,v)}let pd=(()=>{class r{static create(a,h){if(Array.isArray(a))return fg({name:""},h,a,"");{const v=a.name??"";return fg({name:v},a.parent,a.providers,v)}}}return r.THROW_IF_NOT_FOUND=x,r.NULL=new cs,r.\u0275prov=vr({token:r,providedIn:"any",factory:()=>de(sl)}),r.__NG_ELEMENT_ID__=-1,r})();function Fu(r,o=zn.Default){const a=Jt();return null===a?de(r,o):Zu(Lr(),a,Gt(r),o)}function xg(){throw new Error("invalid")}function uf(r,o){return r<<17|o<<2}function kc(r){return r>>17&32767}function df(r){return 2|r}function Fc(r){return(131068&r)>>2}function gp(r,o){return-131069&r|o<<2}function _p(r){return 1|r}function Gd(r,o){const a=r.contentQueries;if(null!==a)for(let h=0;h<a.length;h+=2){const v=a[h],D=a[h+1];if(-1!==D){const I=r.data[D];bl(v),I.contentQueries(2,o[D],D)}}}function xp(r,o,a,h,v,D,I,L,V,ee,le){const Me=o.blueprint.slice();return Me[0]=v,Me[2]=76|h,(null!==le||r&&1024&r[2])&&(Me[2]|=1024),ya(Me),Me[3]=Me[15]=r,Me[8]=a,Me[10]=I||r&&r[10],Me[11]=L||r&&r[11],Me[12]=V||r&&r[12]||null,Me[9]=ee||r&&r[9]||null,Me[6]=D,Me[20]=function ip(){return em++}(),Me[21]=le,Me[16]=2==o.type?r[16]:Me,Me}function $d(r,o,a,h,v){let D=r.data[o];if(null===D)D=bm(r,o,a,h,v),function Rl(){return li.lFrame.inI18n}()&&(D.flags|=64);else if(64&D.type){D.type=a,D.value=h,D.attrs=v;const I=xa();D.injectorIndex=null===I?-1:I.injectorIndex}return Bo(D,!0),D}function bm(r,o,a,h,v){const D=Na(),I=J(),V=r.data[o]=function Dm(r,o,a,h,v,D){return{type:a,index:h,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:D,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,I?D:D&&D.parent,a,o,h,v);return null===r.firstChild&&(r.firstChild=V),null!==D&&(I?null==D.child&&null!==V.parent&&(D.child=V):null===D.next&&(D.next=V)),V}function _d(r,o,a,h){if(0===a)return-1;const v=o.length;for(let D=0;D<a;D++)o.push(h),r.blueprint.push(h),r.data.push(null);return v}function lc(r,o,a){j(o);try{const h=r.viewQuery;null!==h&&du(1,h,a);const v=r.template;null!==v&&xm(r,o,v,1,a),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&Gd(r,o),r.staticViewQueries&&du(2,r.viewQuery,a);const D=r.components;null!==D&&function Bc(r,o){for(let a=0;a<o.length;a++)Dp(r,o[a])}(o,D)}catch(h){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),h}finally{o[2]&=-5,Dt()}}function bf(r,o,a,h){const v=o[2];if(128!=(128&v)){j(o);try{ya(o),function Ps(r){return li.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==a&&xm(r,o,a,2,h);const I=3==(3&v);if(I){const ee=r.preOrderCheckHooks;null!==ee&&os(o,ee,null)}else{const ee=r.preOrderHooks;null!==ee&&Ai(o,ee,0,null),sa(o,0)}if(function Fg(r){for(let o=Zi(r);null!==o;o=ri(o)){if(!o[2])continue;const a=o[9];for(let h=0;h<a.length;h++){const v=a[h],D=v[3];0==(512&v[2])&&As(D,1),v[2]|=512}}}(o),function U_(r){for(let o=Zi(r);null!==o;o=ri(o))for(let a=10;a<o.length;a++){const h=o[a],v=h[1];_a(h)&&bf(v,h,v.template,h[8])}}(o),null!==r.contentQueries&&Gd(r,o),I){const ee=r.contentCheckHooks;null!==ee&&os(o,ee)}else{const ee=r.contentHooks;null!==ee&&Ai(o,ee,1),sa(o,1)}!function vm(r,o){const a=r.hostBindingOpCodes;if(null!==a)try{for(let h=0;h<a.length;h++){const v=a[h];if(v<0)Si(~v);else{const D=v,I=a[++h],L=a[++h];_u(I,D),L(2,o[D])}}}finally{Si(-1)}}(r,o);const L=r.components;null!==L&&function Lc(r,o){for(let a=0;a<o.length;a++)j_(r,o[a])}(o,L);const V=r.viewQuery;if(null!==V&&du(2,V,h),I){const ee=r.viewCheckHooks;null!==ee&&os(o,ee)}else{const ee=r.viewHooks;null!==ee&&Ai(o,ee,2),sa(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,As(o[3],-1))}finally{Dt()}}}function xm(r,o,a,h,v){const D=fi(),I=2&h;try{Si(-1),I&&o.length>22&&lm(r,o,22,!1),a(h,v)}finally{Si(D)}}function Sh(r,o,a){!rs()||(function Df(r,o,a,h){const v=a.directiveStart,D=a.directiveEnd;r.firstCreatePass||wl(a,o),Xr(h,o);const I=a.initialInputs;for(let L=v;L<D;L++){const V=r.data[L],ee=_o(V);ee&&z_(o,a,V);const le=ho(o,r,L,a);Xr(le,o),null!==I&&V_(0,L-v,le,V,0,I),ee&&(uo(a.index,o)[8]=le)}}(r,o,a,rr(a,o)),128==(128&a.flags)&&function Tf(r,o,a){const h=a.directiveStart,v=a.directiveEnd,D=a.index,I=function Nl(){return li.lFrame.currentDirectiveIndex}();try{Si(D);for(let L=h;L<v;L++){const V=r.data[L],ee=o[L];kl(L),(null!==V.hostBindings||0!==V.hostVars||null!==V.hostAttrs)&&Oh(V,ee)}}finally{Si(-1),kl(I)}}(r,o,a))}function xf(r,o,a=rr){const h=o.localNames;if(null!==h){let v=o.index+1;for(let D=0;D<h.length;D+=2){const I=h[D+1],L=-1===I?a(o,r):r[I];r[v++]=L}}}function Hd(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=Ih(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function Ih(r,o,a,h,v,D,I,L,V,ee){const le=22+h,Me=le+v,Qe=function wf(r,o){const a=[];for(let h=0;h<o;h++)a.push(h<r?null:Gi);return a}(le,Me),ht="function"==typeof ee?ee():ee;return Qe[1]={type:r,blueprint:Qe,template:a,queries:null,viewQuery:L,declTNode:o,data:Qe.slice().fill(null,le),bindingStartIndex:le,expandoStartIndex:Me,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof D?D():D,pipeRegistry:"function"==typeof I?I():I,firstChild:null,schemas:V,consts:ht,incompleteFirstPass:!1}}function Ah(r,o,a,h){const v=Cp(o);null===a?v.push(h):(v.push(a),r.firstCreatePass&&Im(r).push(h,v.length-1))}function Tm(r,o,a){for(let h in r)if(r.hasOwnProperty(h)){const v=r[h];(a=null===a?{}:a).hasOwnProperty(h)?a[h].push(o,v):a[h]=[o,v]}return a}function Ph(r,o){const h=o.directiveEnd,v=r.data,D=o.attrs,I=[];let L=null,V=null;for(let ee=o.directiveStart;ee<h;ee++){const le=v[ee],Me=le.inputs,Qe=null===D||ag(o)?null:kg(Me,D);I.push(Qe),L=Tm(Me,ee,L),V=Tm(le.outputs,ee,V)}null!==L&&(L.hasOwnProperty("class")&&(o.flags|=16),L.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=I,o.inputs=L,o.outputs=V}function dl(r,o,a,h,v,D,I,L){const V=rr(o,a);let le,ee=o.inputs;!L&&null!=ee&&(le=ee[h])?(Am(r,a,le,h,v),Ui(o)&&Ng(a,o.index)):3&o.type&&(h=function Rg(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(h),v=null!=I?I(v,o.value||"",h):v,D.setProperty(V,h,v))}function Ng(r,o){const a=uo(o,r);16&a[2]||(a[2]|=32)}function Cm(r,o,a,h){let v=!1;if(rs()){const D=function Cf(r,o,a){const h=r.directiveRegistry;let v=null;if(h)for(let D=0;D<h.length;D++){const I=h[D];lg(a,I.selectors,!1)&&(v||(v=[]),nl(wl(a,o),r,I.type),_o(I)?(Ef(r,a),v.unshift(I)):v.push(I))}return v}(r,o,a),I=null===h?null:{"":-1};if(null!==D){v=!0,Zd(a,r.data.length,D.length);for(let le=0;le<D.length;le++){const Me=D[le];Me.providersResolver&&Me.providersResolver(Me)}let L=!1,V=!1,ee=_d(r,o,D.length,null);for(let le=0;le<D.length;le++){const Me=D[le];a.mergedAttrs=bn(a.mergedAttrs,Me.hostAttrs),Mf(r,a,o,ee,Me),B_(ee,Me,I),null!==Me.contentQueries&&(a.flags|=8),(null!==Me.hostBindings||null!==Me.hostAttrs||0!==Me.hostVars)&&(a.flags|=128);const Qe=Me.type.prototype;!L&&(Qe.ngOnChanges||Qe.ngOnInit||Qe.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(a.index),L=!0),!V&&(Qe.ngOnChanges||Qe.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(a.index),V=!0),ee++}Ph(r,a)}I&&function L_(r,o,a){if(o){const h=r.localNames=[];for(let v=0;v<o.length;v+=2){const D=a[o[v+1]];if(null==D)throw new vn(-301,!1);h.push(o[v],D)}}}(a,h,I)}return a.mergedAttrs=bn(a.mergedAttrs,a.attrs),v}function zu(r,o,a,h,v,D){const I=D.hostBindings;if(I){let L=r.hostBindingOpCodes;null===L&&(L=r.hostBindingOpCodes=[]);const V=~o.index;(function F_(r){let o=r.length;for(;o>0;){const a=r[--o];if("number"==typeof a&&a<0)return a}return 0})(L)!=V&&L.push(V),L.push(h,v,I)}}function Oh(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function Ef(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function B_(r,o,a){if(a){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)a[o.exportAs[h]]=r;_o(o)&&(a[""]=r)}}function Zd(r,o,a){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+a,r.providerIndexes=o}function Mf(r,o,a,h,v){r.data[h]=v;const D=v.factory||(v.factory=ns(v.type)),I=new mc(D,_o(v),Fu);r.blueprint[h]=I,a[h]=I,zu(r,o,0,h,_d(r,a,v.hostVars,Gi),v)}function z_(r,o,a){const h=rr(o,r),v=Hd(a),D=r[10],I=qd(r,xp(r,v,null,a.onPush?32:16,h,o,D,D.createRenderer(h,a),null,null,null));r[o.index]=I}function wp(r,o,a,h,v,D,I){if(null==D)r.removeAttribute(o,v,a);else{const L=null==I?At(D):I(D,h||"",v);r.setAttribute(o,v,L,a)}}function V_(r,o,a,h,v,D){const I=D[o];if(null!==I){const L=h.setInput;for(let V=0;V<I.length;){const ee=I[V++],le=I[V++],Me=I[V++];null!==L?h.setInput(a,Me,ee,le):a[le]=Me}}}function kg(r,o){let a=null,h=0;for(;h<o.length;){const v=o[h];if(0!==v)if(5!==v){if("number"==typeof v)break;r.hasOwnProperty(v)&&(null===a&&(a=[]),a.push(v,r[v],o[h+1])),h+=2}else h+=2;else h+=4}return a}function Em(r,o,a,h){return new Array(r,!0,!1,o,null,0,h,a,null,null)}function j_(r,o){const a=uo(o,r);if(_a(a)){const h=a[1];48&a[2]?bf(h,a,h.template,a[8]):a[5]>0&&Mm(a)}}function Mm(r){for(let h=Zi(r);null!==h;h=ri(h))for(let v=10;v<h.length;v++){const D=h[v];if(_a(D))if(512&D[2]){const I=D[1];bf(I,D,I.template,D[8])}else D[5]>0&&Mm(D)}const a=r[1].components;if(null!==a)for(let h=0;h<a.length;h++){const v=uo(a[h],r);_a(v)&&v[5]>0&&Mm(v)}}function Dp(r,o){const a=uo(o,r),h=a[1];(function Tp(r,o){for(let a=o.length;a<r.blueprint.length;a++)o.push(r.blueprint[a])})(h,a),lc(h,a,a[8])}function qd(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function Sm(r){for(;r;){r[2]|=32;const o=Nn(r);if(Zo(r)&&!o)return r;r=o}return null}function Rh(r,o,a,h=!0){const v=o[10];v.begin&&v.begin();try{bf(r,o,r.template,a)}catch(I){throw h&&Bg(o,I),I}finally{v.end&&v.end()}}function du(r,o,a){bl(0),o(r,a)}function Cp(r){return r[7]||(r[7]=[])}function Im(r){return r.cleanup||(r.cleanup=[])}function Bg(r,o){const a=r[9],h=a?a.get(Pd,null):null;h&&h.handleError(o)}function Am(r,o,a,h,v){for(let D=0;D<a.length;){const I=a[D++],L=a[D++],V=o[I],ee=r.data[I];null!==ee.setInput?ee.setInput(V,v,h,L):V[L]=v}}function Vu(r,o,a){const h=ga(o,r);ar(r[11],h,a)}function Ep(r,o,a){let h=a?r.styles:null,v=a?r.classes:null,D=0;if(null!==o)for(let I=0;I<o.length;I++){const L=o[I];"number"==typeof L?D=L:1==D?v=dn(v,L):2==D&&(h=dn(h,L+": "+o[++I]+";"))}a?r.styles=h:r.stylesWithoutHost=h,a?r.classes=v:r.classesWithoutHost=v}function Nh(r,o,a,h,v=!1){for(;null!==a;){const D=o[a.index];if(null!==D&&h.push(mr(D)),eo(D))for(let L=10;L<D.length;L++){const V=D[L],ee=V[1].firstChild;null!==ee&&Nh(V[1],V,ee,h)}const I=a.type;if(8&I)Nh(r,o,a.child,h);else if(32&I){const L=Ge(a,o);let V;for(;V=L();)h.push(V)}else if(16&I){const L=lf(o,a);if(Array.isArray(L))h.push(...L);else{const V=Nn(o[16]);Nh(V[1],V,L,h,!0)}}a=v?a.projectionNext:a.next}return h}class If{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return Nh(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(eo(o)){const a=o[8],h=a?a.indexOf(this):-1;h>-1&&(Ic(o,h),Ua(a,h))}this._attachedToViewContainer=!1}Ac(this._lView[1],this._lView)}onDestroy(o){Ah(this._lView[1],this._lView,null,o)}markForCheck(){Sm(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Rh(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new vn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function us(r,o){Ld(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new vn(902,!1);this._appRef=o}}class Af extends If{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Rh(o[1],o,o[8],!1)}checkNoChanges(){}get context(){return null}}class Pf extends Ec{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=Ke(o);return new Of(a,this.ngModule)}}function zg(r){const o=[];for(let a in r)r.hasOwnProperty(a)&&o.push({propName:r[a],templateName:a});return o}class Vg{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,h){const v=this.injector.get(o,Xh,h);return v!==Xh||a===Xh?v:this.parentInjector.get(o,a,h)}}class Of extends Iu{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function g_(r){return r.map(m_).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return zg(this.componentDef.inputs)}get outputs(){return zg(this.componentDef.outputs)}create(o,a,h,v){let D=(v=v||this.ngModule)instanceof iu?v:v?.injector;D&&null!==this.componentDef.getStandaloneInjector&&(D=this.componentDef.getStandaloneInjector(D)||D);const I=D?new Vg(o,D):o,L=I.get(Au,null);if(null===L)throw new vn(407,!1);const V=I.get(Id,null),ee=L.createRenderer(null,this.componentDef),le=this.componentDef.selectors[0][0]||"div",Me=h?function Og(r,o,a){return r.selectRootElement(o,a===ui.ShadowDom)}(ee,h,this.componentDef.encapsulation):lr(L.createRenderer(null,this.componentDef),le,function G_(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(le)),Qe=this.componentDef.onPush?288:272,ht=Ih(0,null,null,1,0,null,null,null,null,null),$t=xp(null,ht,null,Qe,null,null,L,ee,V,I,null);let mn,kn;j($t);try{const Wn=function fu(r,o,a,h,v,D){const I=a[1];a[22]=r;const V=$d(I,22,2,"#host",null),ee=V.mergedAttrs=o.hostAttrs;null!==ee&&(Ep(V,ee,!0),null!==r&&(Ul(v,r,ee),null!==V.classes&&cu(v,r,V.classes),null!==V.styles&&hs(v,r,V.styles)));const le=h.createRenderer(r,o),Me=xp(a,Hd(o),null,o.onPush?32:16,a[22],V,h,le,D||null,null,null);return I.firstCreatePass&&(nl(wl(V,a),I,o.type),Ef(I,V),Zd(V,a.length,1)),qd(a,Me),a[22]=Me}(Me,this.componentDef,$t,L,ee);if(Me)if(h)Ul(ee,Me,["ng-version",Yf.full]);else{const{attrs:hi,classes:cn}=function __(r){const o=[],a=[];let h=1,v=2;for(;h<r.length;){let D=r[h];if("string"==typeof D)2===v?""!==D&&o.push(D,r[++h]):8===v&&a.push(D);else{if(!Nc(v))break;v=D}h++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);hi&&Ul(ee,Me,hi),cn&&cn.length>0&&cu(ee,Me,cn.join(" "))}if(kn=xs(ht,22),void 0!==a){const hi=kn.projection=[];for(let cn=0;cn<this.ngContentSelectors.length;cn++){const Ri=a[cn];hi.push(null!=Ri?Array.from(Ri):null)}}mn=function yd(r,o,a,h){const v=a[1],D=function Wd(r,o,a){const h=Lr();r.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),Mf(r,h,o,_d(r,o,1,null),a),Ph(r,h));const v=ho(o,r,h.directiveStart,h);Xr(v,o);const D=rr(h,o);return D&&Xr(D,o),v}(v,a,o);if(r[8]=a[8]=D,null!==h)for(const L of h)L(D,o);if(o.contentQueries){const L=Lr();o.contentQueries(1,D,L.directiveStart)}const I=Lr();return!v.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(Si(I.index),zu(a[1],I,0,I.directiveStart,I.directiveEnd,o),Oh(o,D)),D}(Wn,this.componentDef,$t,[Mp]),lc(ht,$t,null)}finally{Dt()}return new hu(this.componentType,mn,ou(kn,$t),$t,kn)}}class hu extends class nd{}{constructor(o,a,h,v,D){super(),this.location=h,this._rootLView=v,this._tNode=D,this.instance=a,this.hostView=this.changeDetectorRef=new Af(v),this.componentType=o}setInput(o,a){const h=this._tNode.inputs;let v;if(null!==h&&(v=h[o])){const D=this._rootLView;Am(D[1],D,v,o,a),Ng(D,this._tNode.index)}}get injector(){return new Wl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function Mp(){const r=Lr();Ro(Jt()[1],r)}function Sp(r){let o=function Pm(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),a=!0;const h=[r];for(;o;){let v;if(_o(r))v=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new vn(903,!1);v=o.\u0275dir}if(v){if(a){h.push(v);const I=r;I.inputs=Rf(r.inputs),I.declaredInputs=Rf(r.declaredInputs),I.outputs=Rf(r.outputs);const L=v.hostBindings;L&&$g(r,L);const V=v.viewQuery,ee=v.contentQueries;if(V&&$_(r,V),ee&&Gg(r,ee),Et(r.inputs,v.inputs),Et(r.declaredInputs,v.declaredInputs),Et(r.outputs,v.outputs),_o(v)&&v.data.animation){const le=r.data;le.animation=(le.animation||[]).concat(v.data.animation)}}const D=v.features;if(D)for(let I=0;I<D.length;I++){const L=D[I];L&&L.ngInherit&&L(r),L===Sp&&(a=!1)}}o=Object.getPrototypeOf(o)}!function jg(r){let o=0,a=null;for(let h=r.length-1;h>=0;h--){const v=r[h];v.hostVars=o+=v.hostVars,v.hostAttrs=bn(v.hostAttrs,a=bn(a,v.hostAttrs))}}(h)}function Rf(r){return r===qi?{}:r===wn?[]:r}function $_(r,o){const a=r.viewQuery;r.viewQuery=a?(h,v)=>{o(h,v),a(h,v)}:o}function Gg(r,o){const a=r.contentQueries;r.contentQueries=a?(h,v,D)=>{o(h,v,D),a(h,v,D)}:o}function $g(r,o){const a=r.hostBindings;r.hostBindings=a?(h,v)=>{o(h,v),a(h,v)}:o}let Nf=null;function vd(){if(!Nf){const r=Pn.Symbol;if(r&&r.iterator)Nf=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const h=o[a];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(Nf=h)}}}return Nf}function kh(r){return!!bd(r)&&(Array.isArray(r)||!(r instanceof Map)&&vd()in r)}function bd(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function cc(r,o,a){return r[o]=a}function Xs(r,o,a){return!Object.is(r[o],a)&&(r[o]=a,!0)}function Uu(r,o,a,h){const v=Xs(r,o,a);return Xs(r,o+1,h)||v}function Ap(r,o,a,h){const v=Jt();return Xs(v,ws(),o)&&(Ei(),function zc(r,o,a,h,v,D){const I=rr(r,o);wp(o[11],I,D,r.value,a,h,v)}(qn(),v,r,o,a,h)),Ap}function pu(r,o,a,h){return Xs(r,ws(),a)?o+At(a)+h:Gi}function M(r,o,a,h,v,D,I,L){const V=Jt(),ee=Ei(),le=r+22,Me=ee.firstCreatePass?function E(r,o,a,h,v,D,I,L,V){const ee=o.consts,le=$d(o,r,4,I||null,Sr(ee,L));Cm(o,a,le,Sr(ee,V)),Ro(o,le);const Me=le.tViews=Ih(2,le,h,v,D,o.directiveRegistry,o.pipeRegistry,null,o.schemas,ee);return null!==o.queries&&(o.queries.template(o,le),Me.queries=o.queries.embeddedTView(le)),le}(le,ee,V,o,a,h,v,D,I):ee.data[le];Bo(Me,!1);const Qe=V[11].createComment("");dd(ee,V,Qe,Me),Xr(Qe,V),qd(V,V[le]=Em(Qe,V,Qe,Me)),fa(Me)&&Sh(ee,V,Me),null!=I&&xf(V,Me,L)}function B(r){return _i(function ue(){return li.lFrame.contextLView}(),22+r)}function z(r,o,a){const h=Jt();return Xs(h,ws(),o)&&dl(Ei(),qn(),h,r,o,h[11],a,!1),z}function X(r,o,a,h,v){const I=v?"class":"style";Am(r,a,o.inputs[I],I,h)}function oe(r,o,a,h){const v=Jt(),D=Ei(),I=22+r,L=v[11],V=v[I]=lr(L,o,function Ds(){return li.lFrame.currentNamespace}()),ee=D.firstCreatePass?function K(r,o,a,h,v,D,I){const L=o.consts,ee=$d(o,r,2,v,Sr(L,D));return Cm(o,a,ee,Sr(L,I)),null!==ee.attrs&&Ep(ee,ee.attrs,!1),null!==ee.mergedAttrs&&Ep(ee,ee.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,ee),ee}(I,D,v,0,o,a,h):D.data[I];Bo(ee,!0);const le=ee.mergedAttrs;null!==le&&Ul(L,V,le);const Me=ee.classes;null!==Me&&cu(L,V,Me);const Qe=ee.styles;return null!==Qe&&hs(L,V,Qe),64!=(64&ee.flags)&&dd(D,v,V,ee),0===function ra(){return li.lFrame.elementDepthCount}()&&Xr(V,v),function $c(){li.lFrame.elementDepthCount++}(),fa(ee)&&(Sh(D,v,ee),function Pg(r,o,a){if(Yr(o)){const v=o.directiveEnd;for(let D=o.directiveStart;D<v;D++){const I=r.data[D];I.contentQueries&&I.contentQueries(1,a[D],D)}}}(D,ee,v)),null!==h&&xf(v,ee),oe}function pe(){let r=Lr();J()?q():(r=r.parent,Bo(r,!1));const o=r;!function fc(){li.lFrame.elementDepthCount--}();const a=Ei();return a.firstCreatePass&&(Ro(a,r),Yr(r)&&a.queries.elementEnd(r)),null!=o.classesWithoutHost&&function gc(r){return 0!=(16&r.flags)}(o)&&X(a,o,Jt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Vl(r){return 0!=(32&r.flags)}(o)&&X(a,o,Jt(),o.stylesWithoutHost,!1),pe}function Ce(r,o,a,h){return oe(r,o,a,h),pe(),Ce}function Be(){return Jt()}function mt(r){return!!r&&"function"==typeof r.then}function pt(r){return!!r&&"function"==typeof r.subscribe}const Ot=pt;function an(r,o,a,h){const v=Jt(),D=Ei(),I=Lr();return function Ht(r,o,a,h,v,D,I,L){const V=fa(h),le=r.firstCreatePass&&Im(r),Me=o[8],Qe=Cp(o);let ht=!0;if(3&h.type||L){const kn=rr(h,o),Wn=L?L(kn):kn,hi=Qe.length,cn=L?ao=>L(mr(ao[h.index])):h.index;let Ri=null;if(!L&&V&&(Ri=function zt(r,o,a,h){const v=r.cleanup;if(null!=v)for(let D=0;D<v.length-1;D+=2){const I=v[D];if(I===a&&v[D+1]===h){const L=o[7],V=v[D+2];return L.length>V?L[V]:null}"string"==typeof I&&(D+=2)}return null}(r,o,v,h.index)),null!==Ri)(Ri.__ngLastListenerFn__||Ri).__ngNextListenerFn__=D,Ri.__ngLastListenerFn__=D,ht=!1;else{D=sn(h,o,Me,D,!1);const ao=a.listen(Wn,v,D);Qe.push(D,ao),le&&le.push(v,cn,hi,hi+1)}}else D=sn(h,o,Me,D,!1);const $t=h.outputs;let mn;if(ht&&null!==$t&&(mn=$t[v])){const kn=mn.length;if(kn)for(let Wn=0;Wn<kn;Wn+=2){const es=o[mn[Wn]][mn[Wn+1]].subscribe(D),zf=Qe.length;Qe.push(D,es),le&&le.push(v,h.index,zf,-(zf+1))}}}(D,v,v[11],I,r,o,0,h),an}function Lt(r,o,a,h){try{return!1!==a(h)}catch(v){return Bg(r,v),!1}}function sn(r,o,a,h,v){return function D(I){if(I===Function)return h;Sm(2&r.flags?uo(r.index,o):o);let V=Lt(o,0,h,I),ee=D.__ngNextListenerFn__;for(;ee;)V=Lt(o,0,ee,I)&&V,ee=ee.__ngNextListenerFn__;return v&&!1===V&&(I.preventDefault(),I.returnValue=!1),V}}function Wt(r=1){return function Yt(r){return(li.lFrame.contextLView=function Ln(r,o){for(;r>0;)o=o[15],r--;return o}(r,li.lFrame.contextLView))[8]}(r)}function Cn(r,o){let a=null;const h=function ap(r){const o=r.attrs;if(null!=o){const a=o.indexOf(5);if(0==(1&a))return o[a+1]}return null}(r);for(let v=0;v<o.length;v++){const D=o[v];if("*"!==D){if(null===h?lg(r,D,!0):ug(h,D))return v}else a=v}return a}function yi(r){const o=Jt()[16][6];if(!o.projection){const h=o.projection=Jl(r?r.length:1,null),v=h.slice();let D=o.child;for(;null!==D;){const I=r?Cn(D,r):0;null!==I&&(v[I]?v[I].projectionNext=D:h[I]=D,v[I]=D),D=D.next}}}function xi(r,o=0,a){const h=Jt(),v=Ei(),D=$d(v,22+r,16,null,a||null);null===D.projection&&(D.projection=o),q(),64!=(64&D.flags)&&function Nu(r,o,a){hd(o[11],0,o,a,Pc(r,a,o),ul(a.parent||o[6],a,o))}(v,h,D)}function Hn(r,o,a){return hn(r,"",o,"",a),Hn}function hn(r,o,a,h,v){const D=Jt(),I=pu(D,o,a,h);return I!==Gi&&dl(Ei(),qn(),D,r,I,D[11],v,!1),hn}function Qr(r,o,a,h,v){const D=r[a+1],I=null===o;let L=h?kc(D):Fc(D),V=!1;for(;0!==L&&(!1===V||I);){const le=r[L+1];bo(r[L],o)&&(V=!0,r[L+1]=h?_p(le):df(le)),L=h?kc(le):Fc(le)}V&&(r[a+1]=h?df(D):_p(D))}function bo(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&Tt(r,o)>=0}const fr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Ea(r){return r.substring(fr.key,fr.keyEnd)}function Ks(r,o){const a=fr.textEnd;return a===o?-1:(o=fr.keyEnd=function No(r,o,a){for(;o<a&&r.charCodeAt(o)>32;)o++;return o}(r,fr.key=o,a),Nr(r,o,a))}function Nr(r,o,a){for(;o<a&&r.charCodeAt(o)<=32;)o++;return o}function Uc(r,o,a){return uc(r,o,a,!1),Uc}function wd(r,o){return uc(r,o,null,!0),wd}function km(r){!function Pl(r,o,a,h){const v=Ei(),D=Oo(2);v.firstUpdatePass&&Gc(v,null,D,h);const I=Jt();if(a!==Gi&&Xs(I,D,a)){const L=v.data[fi()];if(Xy(L,h)&&!Pp(v,D)){let V=h?L.classesWithoutHost:L.stylesWithoutHost;null!==V&&(a=dn(V,a||"")),X(v,L,I,a,h)}else!function ml(r,o,a,h,v,D,I,L){v===Gi&&(v=wn);let V=0,ee=0,le=0<v.length?v[0]:null,Me=0<D.length?D[0]:null;for(;null!==le||null!==Me;){const Qe=V<v.length?v[V+1]:void 0,ht=ee<D.length?D[ee+1]:void 0;let mn,$t=null;le===Me?(V+=2,ee+=2,Qe!==ht&&($t=Me,mn=ht)):null===Me||null!==le&&le<Me?(V+=2,$t=le):(ee+=2,$t=Me,mn=ht),null!==$t&&Bh(r,o,a,h,$t,mn,I,L),le=V<v.length?v[V]:null,Me=ee<D.length?D[ee]:null}}(v,L,I,I[11],I[D+1],I[D+1]=function W_(r,o,a){if(null==a||""===a)return wn;const h=[],v=eu(a);if(Array.isArray(v))for(let D=0;D<v.length;D++)r(h,v[D],!0);else if("object"==typeof v)for(const D in v)v.hasOwnProperty(D)&&r(h,D,v[D]);else"string"==typeof v&&o(h,v);return h}(r,o,a),h,D)}}(Ie,jc,r,!0)}function jc(r,o){for(let a=function Io(r){return function da(r){fr.key=0,fr.keyEnd=0,fr.value=0,fr.valueEnd=0,fr.textEnd=r.length}(r),Ks(r,Nr(r,0,fr.textEnd))}(o);a>=0;a=Ks(o,a))Ie(r,Ea(o),!0)}function uc(r,o,a,h){const v=Jt(),D=Ei(),I=Oo(2);D.firstUpdatePass&&Gc(D,r,I,h),o!==Gi&&Xs(v,I,o)&&Bh(D,D.data[fi()],v,v[11],r,v[I+1]=function ih(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=lt(eu(r)))),r}(o,a),h,I)}function Pp(r,o){return o>=r.expandoStartIndex}function Gc(r,o,a,h){const v=r.data;if(null===v[a+1]){const D=v[fi()],I=Pp(r,a);Xy(D,h)&&null===o&&!I&&(o=!1),o=function qg(r,o,a,h){const v=function vl(r){const o=li.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let D=h?o.residualClasses:o.residualStyles;if(null===v)0===(h?o.classBindings:o.styleBindings)&&(a=nh(a=mu(null,r,o,a,h),o.attrs,h),D=null);else{const I=o.directiveStylingLast;if(-1===I||r[I]!==v)if(a=mu(v,r,o,a,h),null===D){let V=function th(r,o,a){const h=a?o.classBindings:o.styleBindings;if(0!==Fc(h))return r[kc(h)]}(r,o,h);void 0!==V&&Array.isArray(V)&&(V=mu(null,r,o,V[1],h),V=nh(V,o.attrs,h),function Fm(r,o,a,h){r[kc(a?o.classBindings:o.styleBindings)]=h}(r,o,h,V))}else D=function Lm(r,o,a){let h;const v=o.directiveEnd;for(let D=1+o.directiveStylingLast;D<v;D++)h=nh(h,r[D].hostAttrs,a);return nh(h,o.attrs,a)}(r,o,h)}return void 0!==D&&(h?o.residualClasses=D:o.residualStyles=D),a}(v,D,o,h),function Vr(r,o,a,h,v,D){let I=D?o.classBindings:o.styleBindings,L=kc(I),V=Fc(I);r[h]=a;let le,ee=!1;if(Array.isArray(a)){const Me=a;le=Me[1],(null===le||Tt(Me,le)>0)&&(ee=!0)}else le=a;if(v)if(0!==V){const Qe=kc(r[L+1]);r[h+1]=uf(Qe,L),0!==Qe&&(r[Qe+1]=gp(r[Qe+1],h)),r[L+1]=function wg(r,o){return 131071&r|o<<17}(r[L+1],h)}else r[h+1]=uf(L,0),0!==L&&(r[L+1]=gp(r[L+1],h)),L=h;else r[h+1]=uf(V,0),0===L?L=h:r[V+1]=gp(r[V+1],h),V=h;ee&&(r[h+1]=df(r[h+1])),Qr(r,le,h,!0),Qr(r,le,h,!1),function Rr(r,o,a,h,v){const D=v?r.residualClasses:r.residualStyles;null!=D&&"string"==typeof o&&Tt(D,o)>=0&&(a[h+1]=_p(a[h+1]))}(o,le,r,h,D),I=uf(L,V),D?o.classBindings=I:o.styleBindings=I}(v,D,o,a,I,h)}}function mu(r,o,a,h,v){let D=null;const I=a.directiveEnd;let L=a.directiveStylingLast;for(-1===L?L=a.directiveStart:L++;L<I&&(D=o[L],h=nh(h,D.hostAttrs,v),D!==r);)L++;return null!==r&&(a.directiveStylingLast=L),h}function nh(r,o,a){const h=a?1:2;let v=-1;if(null!==o)for(let D=0;D<o.length;D++){const I=o[D];"number"==typeof I?v=I:v===h&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),Ie(r,I,!!a||o[++D]))}return void 0===r?null:r}function Bh(r,o,a,h,v,D,I,L){if(!(3&o.type))return;const V=r.data,ee=V[L+1];Ff(function Dg(r){return 1==(1&r)}(ee)?Op(V,o,a,v,Fc(ee),I):void 0)||(Ff(D)||function hm(r){return 2==(2&r)}(ee)&&(D=Op(V,null,a,v,L,I)),function cf(r,o,a,h,v){if(o)v?r.addClass(a,h):r.removeClass(a,h);else{let D=-1===h.indexOf("-")?void 0:W.DashCase;null==v?r.removeStyle(a,h,D):("string"==typeof v&&v.endsWith("!important")&&(v=v.slice(0,-10),D|=W.Important),r.setStyle(a,h,v,D))}}(h,I,ga(fi(),a),v,D))}function Op(r,o,a,h,v,D){const I=null===o;let L;for(;v>0;){const V=r[v],ee=Array.isArray(V),le=ee?V[1]:V,Me=null===le;let Qe=a[v+1];Qe===Gi&&(Qe=Me?wn:void 0);let ht=Me?ke(Qe,h):le===h?Qe:void 0;if(ee&&!Ff(ht)&&(ht=ke(V,h)),Ff(ht)&&(L=ht,I))return L;const $t=r[v+1];v=I?kc($t):Fc($t)}if(null!==o){let V=D?o.residualClasses:o.residualStyles;null!=V&&(L=ke(V,h))}return L}function Ff(r){return void 0!==r}function Xy(r,o){return 0!=(r.flags&(o?16:32))}function Jy(r,o=""){const a=Jt(),h=Ei(),v=r+22,D=h.firstCreatePass?$d(h,v,1,o,null):h.data[v],I=a[v]=oo(a[11],o);dd(h,a,I,D),Bo(D,!1)}function Z_(r){return Yg("",r,""),Z_}function Yg(r,o,a){const h=Jt(),v=pu(h,r,o,a);return v!==Gi&&Vu(h,fi(),v),Yg}function q_(r,o,a,h,v){const D=Jt(),I=function ju(r,o,a,h,v,D){const L=Uu(r,to(),a,v);return Oo(2),L?o+At(a)+h+At(v)+D:Gi}(D,r,o,a,h,v);return I!==Gi&&Vu(D,fi(),I),q_}function Y_(r,o,a){const h=Jt();return Xs(h,ws(),o)&&dl(Ei(),qn(),h,r,o,h[11],a,!0),Y_}const Lf=void 0;var j1=["en",[["a","p"],["AM","PM"],Lf],[["AM","PM"],Lf,Lf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Lf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Lf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Lf,"{1} 'at' {0}",Lf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function U1(r){const a=Math.floor(Math.abs(r)),h=r.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===h?1:5}];let Rp={};function X_(r){const o=function G1(r){return r.toLowerCase().replace(/_/g,"-")}(r);let a=_0(o);if(a)return a;const h=o.split("-")[0];if(a=_0(h),a)return a;if("en"===h)return j1;throw new vn(701,!1)}function g0(r){return X_(r)[wi.PluralCase]}function _0(r){return r in Rp||(Rp[r]=Pn.ng&&Pn.ng.common&&Pn.ng.common.locales&&Pn.ng.common.locales[r]),Rp[r]}var wi=(()=>((wi=wi||{})[wi.LocaleId=0]="LocaleId",wi[wi.DayPeriodsFormat=1]="DayPeriodsFormat",wi[wi.DayPeriodsStandalone=2]="DayPeriodsStandalone",wi[wi.DaysFormat=3]="DaysFormat",wi[wi.DaysStandalone=4]="DaysStandalone",wi[wi.MonthsFormat=5]="MonthsFormat",wi[wi.MonthsStandalone=6]="MonthsStandalone",wi[wi.Eras=7]="Eras",wi[wi.FirstDayOfWeek=8]="FirstDayOfWeek",wi[wi.WeekendRange=9]="WeekendRange",wi[wi.DateFormat=10]="DateFormat",wi[wi.TimeFormat=11]="TimeFormat",wi[wi.DateTimeFormat=12]="DateTimeFormat",wi[wi.NumberSymbols=13]="NumberSymbols",wi[wi.NumberFormats=14]="NumberFormats",wi[wi.CurrencyCode=15]="CurrencyCode",wi[wi.CurrencySymbol=16]="CurrencySymbol",wi[wi.CurrencyName=17]="CurrencyName",wi[wi.Currencies=18]="Currencies",wi[wi.Directionality=19]="Directionality",wi[wi.PluralCase=20]="PluralCase",wi[wi.ExtraData=21]="ExtraData",wi))();const $1=["zero","one","two","few","many"],Np="en-US",Xg={marker:"element"},Jg={marker:"ICU"};var Es=(()=>((Es=Es||{})[Es.SHIFT=2]="SHIFT",Es[Es.APPEND_EAGERLY=1]="APPEND_EAGERLY",Es[Es.COMMENT=2]="COMMENT",Es))();let y0=Np;function v0(r){(function oi(r,o){null==r&&ei(o,r,null,"!=")})(r,"Expected localeId to be defined"),"string"==typeof r&&(y0=r.toLowerCase().replace(/_/g,"-"))}function b0(r,o,a){const h=o.insertBeforeIndex,v=Array.isArray(h)?h[0]:h;return null===v?Nd(r,0,a):mr(a[v])}function x0(r,o,a,h,v){const D=o.insertBeforeIndex;if(Array.isArray(D)){let I=h,L=null;if(3&o.type||(L=I,I=v),null!==I&&0==(2&o.flags))for(let V=1;V<D.length;V++)Oc(r,I,a[D[V]],L,!1)}}function w0(r,o){if(r.push(o),r.length>1)for(let a=r.length-2;a>=0;a--){const h=r[a];D0(h)||q1(h,o)&&null===Y1(h)&&X1(h,o.index)}}function D0(r){return!(64&r.type)}function q1(r,o){return D0(o)||r.index>o.index}function Y1(r){const o=r.insertBeforeIndex;return Array.isArray(o)?o[0]:o}function X1(r,o){const a=r.insertBeforeIndex;Array.isArray(a)?a[0]=o:(op(b0,x0),r.insertBeforeIndex=o)}function Bm(r,o){const a=r.data[o];return null===a||"string"==typeof a?null:a.hasOwnProperty("currentCaseLViewIndex")?a:a.value}function Q1(r,o,a){const h=bm(r,a,64,null,null);return w0(o,h),h}function Kg(r,o){const a=o[r.currentCaseLViewIndex];return null===a?a:a<0?~a:a}function T0(r){return r>>>17}function C0(r){return(131070&r)>>>1}let zm=0,Vm=0;function M0(r,o,a,h){const v=a[11];let I,D=null;for(let L=0;L<o.length;L++){const V=o[L];if("string"==typeof V){const ee=o[++L];null===a[ee]&&(a[ee]=oo(v,V))}else if("number"==typeof V)switch(1&V){case 0:const ee=T0(V);let le,Me;if(null===D&&(D=ee,I=au(v,h)),ee===D?(le=h,Me=I):(le=null,Me=mr(a[ee])),null!==Me){const mn=C0(V);Oc(v,Me,a[mn],le,!1);const Wn=Bm(r,mn);if(null!==Wn&&"object"==typeof Wn){const hi=Kg(Wn,a);null!==hi&&M0(r,Wn.create[hi],a,a[Wn.anchorIdx])}}break;case 1:const ht=o[++L],$t=o[++L];wp(v,ga(V>>>1,a),null,null,ht,$t,null)}else switch(V){case Jg:const ee=o[++L],le=o[++L];null===a[le]&&Xr(a[le]=hr(v,ee),a);break;case Xg:const Me=o[++L],Qe=o[++L];null===a[Qe]&&Xr(a[Qe]=lr(v,Me,null),a)}}}function S0(r,o,a,h,v){for(let D=0;D<a.length;D++){const I=a[D],L=a[++D];if(I&v){let V="";for(let ee=D+1;ee<=D+L;ee++){const le=a[ee];if("string"==typeof le)V+=le;else if("number"==typeof le)if(le<0)V+=At(o[h-le]);else{const Me=le>>>2;switch(3&le){case 1:const Qe=a[++ee],ht=a[++ee],$t=r.data[Me];"string"==typeof $t?wp(o[11],o[Me],null,$t,Qe,V,ht):dl(r,$t,o,Qe,V,o[11],ht,!1);break;case 0:const mn=o[Me];null!==mn&&ar(o[11],mn,V);break;case 2:rb(r,Bm(r,Me),o,V);break;case 3:I0(r,Bm(r,Me),h,o)}}}}else{const V=a[D+1];if(V>0&&3==(3&V)){const le=Bm(r,V>>>2);o[le.currentCaseLViewIndex]<0&&I0(r,le,h,o)}}D+=L}}function I0(r,o,a,h){let v=h[o.currentCaseLViewIndex];if(null!==v){let D=zm;v<0&&(v=h[o.currentCaseLViewIndex]=~v,D=-1),S0(r,h,o.update[v],a,D)}}function rb(r,o,a,h){const v=function ob(r,o){let a=r.cases.indexOf(o);if(-1===a)switch(r.type){case 1:{const h=function H1(r,o){const a=g0(o)(parseInt(r,10)),h=$1[a];return void 0!==h?h:"other"}(o,function Z1(){return y0}());a=r.cases.indexOf(h),-1===a&&"other"!==h&&(a=r.cases.indexOf("other"));break}case 0:a=r.cases.indexOf("other")}return-1===a?null:a}(o,h);if(Kg(o,a)!==v&&(A0(r,o,a),a[o.currentCaseLViewIndex]=null===v?null:~v,null!==v)){const I=a[o.anchorIdx];I&&M0(r,o.create[v],a,I)}}function A0(r,o,a){let h=Kg(o,a);if(null!==h){const v=o.remove[h];for(let D=0;D<v.length;D++){const I=v[D];if(I>0){const L=ga(I,a);null!==L&&xh(a[11],L)}else A0(r,Bm(r,~I),a)}}}function sb(){const r=[];let a,h,o=-1;function D(L,V){o=0;const ee=Kg(L,V);h=null!==ee?L.remove[ee]:wn}function I(){if(o<h.length){const L=h[o++];return L>0?a[L]:(r.push(o,h),D(a[1].data[~L],a),I())}return 0===r.length?null:(h=r.pop(),o=r.pop(),I())}return function v(L,V){for(a=V;r.length;)r.pop();return D(L.value,V),I}}const Qg=/\ufffd(\d+):?\d*\ufffd/gi,lb=/\ufffd(\d+)\ufffd/,O0=/^\s*(\ufffd\d+:?\d*\ufffd)\s*,\s*(select|plural)\s*,/,cb=/\ufffd\/?\*(\d+:\d+)\ufffd/gi,ub=/\ufffd(\/?[#*]\d+):?\d*\ufffd/gi,db=/\uE500/g;function R0(r,o,a,h,v,D,I){const L=_d(r,h,1,null);let V=L<<Es.SHIFT,ee=xa();o===ee&&(ee=null),null===ee&&(V|=Es.APPEND_EAGERLY),I&&(V|=Es.COMMENT,function Xe(r){void 0===Te&&(Te=r())}(sb)),v.push(V,null===D?"":D);const le=bm(r,L,I?32:1,null===D?"":D,null);w0(a,le);const Me=le.index;return Bo(le,!1),null!==ee&&o!==ee&&function K1(r,o){let a=r.insertBeforeIndex;null===a?(op(b0,x0),a=r.insertBeforeIndex=[null,o]):(function dt(r,o,a){r!=o&&ei(a,r,o,"==")}(Array.isArray(a),!0,"Expecting array here"),a.push(o))}(ee,Me),le}function pb(r,o,a,h,v,D,I){const L=I.match(Qg),V=R0(r,o,a,D,h,L?null:I,!1);L&&jm(v,I,V.index,null,0,null)}function jm(r,o,a,h,v,D){const I=r.length,L=I+1;r.push(null,null);const V=I+2,ee=o.split(Qg);let le=0;for(let Me=0;Me<ee.length;Me++){const Qe=ee[Me];if(1&Me){const ht=v+parseInt(Qe,10);r.push(-1-ht),le|=N0(ht)}else""!==Qe&&r.push(Qe)}return r.push(a<<2|(h?1:0)),h&&r.push(h,D),r[I]=le,r[L]=r.length-V,le}function N0(r){return 1<<Math.min(r,31)}function k0(r){let o,D,a="",h=0,v=!1;for(;null!==(o=cb.exec(r));)v?o[0]===`\ufffd/*${D}\ufffd`&&(h=o.index,v=!1):(a+=r.substring(h,o.index+o[0].length),D=o[1],v=!0);return a+=r.slice(h),a}function F0(r,o,a,h,v,D){let I=0;const L={type:v.type,currentCaseLViewIndex:_d(r,o,1,null),anchorIdx:D,cases:[],create:[],remove:[],update:[]};(function wb(r,o,a){r.push(N0(o.mainBinding),2,-1-o.mainBinding,a<<2|2)})(a,v,D),function J1(r,o,a){const h=r.data[o];null===h?r.data[o]=a:h.value=a}(r,D,L);const V=v.values;for(let ee=0;ee<V.length;ee++){const le=V[ee],Me=[];for(let Qe=0;Qe<le.length;Qe++){const ht=le[Qe];if("string"!=typeof ht){const $t=Me.push(ht)-1;le[Qe]=`\x3c!--\ufffd${$t}\ufffd--\x3e`}}I=bb(r,L,o,a,h,v.cases[ee],le.join(""),Me)|I}I&&function Db(r,o,a){r.push(o,1,a<<2|3)}(a,I,D)}function vb(r){const o=[],a=[];let h=1,v=0;const D=J_(r=r.replace(O0,function(I,L,V){return h="select"===V?0:1,v=parseInt(L.slice(1),10),""}));for(let I=0;I<D.length;){let L=D[I++].trim();1===h&&(L=L.replace(/\s*(?:=)?(\w+)\s*/,"$1")),L.length&&o.push(L);const V=J_(D[I++]);o.length>a.length&&a.push(V)}return{type:h,mainBinding:v,cases:o,values:a}}function J_(r){if(!r)return[];let o=0;const a=[],h=[],v=/[{}]/g;let D;for(v.lastIndex=0;D=v.exec(r);){const L=D.index;if("}"==D[0]){if(a.pop(),0==a.length){const V=r.substring(o,L);O0.test(V)?h.push(vb(V)):h.push(V),o=L+1}}else{if(0==a.length){const V=r.substring(o,L);h.push(V),o=L+1}a.push("{")}}const I=r.substring(o);return h.push(I),h}function bb(r,o,a,h,v,D,I,L){const V=[],ee=[],le=[];o.cases.push(D),o.create.push(V),o.remove.push(ee),o.update.push(le);const Qe=function $p(r){const o=new Vf(r);return function sh(){try{return!!(new window.DOMParser).parseFromString(sr(""),"text/html")}catch{return!1}}()?new Hp(o):o}(function bi(){return void 0!==Ir?Ir:typeof document<"u"?document:void 0}()).getInertBodyElement(I),ht=function Tc(r){return"content"in r&&function jf(r){return r.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===r.nodeName}(r)?r.content:null}(Qe)||Qe;return ht?L0(r,o,a,h,V,ee,le,ht,v,L,0):0}function L0(r,o,a,h,v,D,I,L,V,ee,le){let Me=0,Qe=L.firstChild;for(;Qe;){const ht=_d(r,a,1,null);switch(Qe.nodeType){case Node.ELEMENT_NODE:const $t=Qe,mn=$t.tagName.toLowerCase();if(Ku.hasOwnProperty(mn)){K_(v,Xg,mn,V,ht),r.data[ht]=mn;const cn=$t.attributes;for(let Ri=0;Ri<cn.length;Ri++){const ao=cn.item(Ri),es=ao.name.toLowerCase();ao.value.match(Qg)?Eu.hasOwnProperty(es)&&jm(I,ao.value,ht,ao.name,0,lh[es]?Zr:null):Tb(v,ht,ao)}Me=L0(r,o,a,h,v,D,I,Qe,ht,ee,le+1)|Me,B0(D,ht,le)}break;case Node.TEXT_NODE:const kn=Qe.textContent||"",Wn=kn.match(Qg);K_(v,null,Wn?"":kn,V,ht),B0(D,ht,le),Wn&&(Me=jm(I,kn,ht,null,0,null)|Me);break;case Node.COMMENT_NODE:const hi=lb.exec(Qe.textContent||"");if(hi){const Ri=ee[parseInt(hi[1],10)];K_(v,Jg,"",V,ht),F0(r,a,h,V,Ri,ht),xb(D,ht,le)}}Qe=Qe.nextSibling}return Me}function B0(r,o,a){0===a&&r.push(o)}function xb(r,o,a){0===a&&(r.push(~o),r.push(o))}function K_(r,o,a,h,v){null!==o&&r.push(o),r.push(a,v,function eb(r,o,a){return r|o<<17|a<<1}(0,h,v))}function Tb(r,o,a){r.push(o<<1|1,a.name,a.value)}function V0(r,o,a=-1){const h=Ei(),v=Jt(),D=22+r,I=Sr(h.consts,o),L=xa();h.firstCreatePass&&function fb(r,o,a,h,v,D){const I=xa(),L=[],V=[],ee=[[]];v=function yb(r,o){if(function _b(r){return-1===r}(o))return k0(r);{const a=r.indexOf(`:${o}\ufffd`)+2+o.toString().length,h=r.search(new RegExp(`\ufffd\\/\\*\\d+:${o}\ufffd`));return k0(r.substring(a,h))}}(v,D);const le=function hb(r){return r.replace(db," ")}(v).split(ub);for(let Me=0;Me<le.length;Me++){let Qe=le[Me];if(0==(1&Me)){const ht=J_(Qe);for(let $t=0;$t<ht.length;$t++){let mn=ht[$t];if(0==(1&$t)){const kn=mn;""!==kn&&pb(r,I,ee[0],L,V,a,kn)}else{const kn=mn;if("object"!=typeof kn)throw new Error(`Unable to parse ICU expression in "${v}" message.`);F0(r,a,V,o,kn,R0(r,I,ee[0],a,L,"",!0).index)}}}else{const ht=47===Qe.charCodeAt(0),mn=(Qe.charCodeAt(ht?1:0),22+Number.parseInt(Qe.substring(ht?2:1)));if(ht)ee.shift(),Bo(xa(),!1);else{const kn=Q1(r,ee[0],mn);ee.unshift([]),Bo(kn,!0)}}}r.data[h]={create:L,update:V}}(h,null===L?0:L.index,v,D,I,a);const V=h.data[D],le=ad(h,L===v[6]?null:L,v);(function ib(r,o,a,h){const v=r[11];for(let D=0;D<o.length;D++){const I=o[D++],L=o[D],V=(I&Es.COMMENT)===Es.COMMENT,ee=(I&Es.APPEND_EAGERLY)===Es.APPEND_EAGERLY,le=I>>>Es.SHIFT;let Me=r[le];null===Me&&(Me=r[le]=V?v.createComment(L):oo(v,L)),ee&&null!==a&&Oc(v,a,Me,h,!1)}})(v,V.create,le,L&&8&L.type?v[L.index]:null),ka(!0)}function j0(r,o,a){V0(r,o,a),function U0(){ka(!1)}()}function Q_(r){return function tb(r){r&&(zm|=1<<Math.min(Vm,31)),Vm++}(Xs(Jt(),ws(),r)),Q_}function G0(r){!function nb(r,o,a){if(Vm>0){const h=r.data[a];S0(r,o,Array.isArray(h)?h:h.update,to()-Vm-1,zm)}zm=0,Vm=0}(Ei(),Jt(),r+22)}function ey(r,o,a,h,v){if(r=Gt(r),Array.isArray(r))for(let D=0;D<r.length;D++)ey(r[D],o,a,h,v);else{const D=Ei(),I=Jt();let L=Su(r)?r:Gt(r.provide),V=Hh(r);const ee=Lr(),le=1048575&ee.providerIndexes,Me=ee.directiveStart,Qe=ee.providerIndexes>>20;if(Su(r)||!r.multi){const ht=new mc(V,v,Fu),$t=ny(L,o,v?le:le+Qe,Me);-1===$t?(nl(wl(ee,I),D,L),ty(D,r,o.length),o.push(L),ee.directiveStart++,ee.directiveEnd++,v&&(ee.providerIndexes+=1048576),a.push(ht),I.push(ht)):(a[$t]=ht,I[$t]=ht)}else{const ht=ny(L,o,le+Qe,Me),$t=ny(L,o,le,le+Qe),mn=ht>=0&&a[ht],kn=$t>=0&&a[$t];if(v&&!kn||!v&&!mn){nl(wl(ee,I),D,L);const Wn=function Bb(r,o,a,h,v){const D=new mc(r,a,Fu);return D.multi=[],D.index=o,D.componentProviders=0,$0(D,v,h&&!a),D}(v?Lb:Fb,a.length,v,h,V);!v&&kn&&(a[$t].providerFactory=Wn),ty(D,r,o.length,0),o.push(L),ee.directiveStart++,ee.directiveEnd++,v&&(ee.providerIndexes+=1048576),a.push(Wn),I.push(Wn)}else ty(D,r,ht>-1?ht:$t,$0(a[v?$t:ht],V,!v&&h));!v&&h&&kn&&a[$t].componentProviders++}}}function ty(r,o,a,h){const v=Su(o),D=function qp(r){return!!r.useClass}(o);if(v||D){const V=(D?Gt(o.useClass):o).prototype.ngOnDestroy;if(V){const ee=r.destroyHooks||(r.destroyHooks=[]);if(!v&&o.multi){const le=ee.indexOf(a);-1===le?ee.push(a,[h,V]):ee[le+1].push(h,V)}else ee.push(a,V)}}}function $0(r,o,a){return a&&r.componentProviders++,r.multi.push(o)-1}function ny(r,o,a,h){for(let v=a;v<h;v++)if(o[v]===r)return v;return-1}function Fb(r,o,a,h){return iy(this.multi,[])}function Lb(r,o,a,h){const v=this.multi;let D;if(this.providerFactory){const I=this.providerFactory.componentProviders,L=ho(a,a[1],this.providerFactory.index,h);D=L.slice(0,I),iy(v,D);for(let V=I;V<L.length;V++)D.push(L[V])}else D=[],iy(v,D);return D}function iy(r,o){for(let a=0;a<r.length;a++)o.push((0,r[a])());return o}function H0(r,o=[]){return a=>{a.providersResolver=(h,v)=>function kb(r,o,a){const h=Ei();if(h.firstCreatePass){const v=_o(r);ey(a,h.data,h.blueprint,v,!0),ey(o,h.data,h.blueprint,v,!1)}}(h,v?v(r):r,o)}}class kp{}class W0{}function zb(r,o){return new Z0(r,o??null)}class Z0 extends kp{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Pf(this);const h=be(o);this._bootstrapComponents=Sc(h.bootstrap),this._r3Injector=pg(o,a,[{provide:kp,useValue:this},{provide:Ec,useValue:this.componentFactoryResolver}],lt(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ry extends W0{constructor(o){super(),this.moduleType=o}create(o){return new Z0(this.moduleType,o)}}class Vb extends kp{constructor(o,a,h){super(),this.componentFactoryResolver=new Pf(this),this.instance=null;const v=new Hf([...o,{provide:kp,useValue:this},{provide:Ec,useValue:this.componentFactoryResolver}],a||td(),h,new Set(["environment"]));this.injector=v,v.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function oy(r,o,a=null){return new Vb(r,o,a).injector}let Ub=(()=>{class r{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a.id)){const h=Ga(0,a.type),v=h.length>0?oy([h],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a.id,v)}return this.cachedInjectors.get(a.id)}ngOnDestroy(){try{for(const a of this.cachedInjectors.values())null!==a&&a.destroy()}finally{this.cachedInjectors.clear()}}}return r.\u0275prov=vr({token:r,providedIn:"environment",factory:()=>new r(de(iu))}),r})();function q0(r){r.getStandaloneInjector=o=>o.get(Ub).getOrCreateStandaloneInjector(r)}function tv(r,o,a){const h=Mi()+r,v=Jt();return v[h]===Gi?cc(v,h,a?o.call(a):o()):function hl(r,o){return r[o]}(v,h)}function nv(r,o,a,h){return function ov(r,o,a,h,v,D){const I=o+a;return Xs(r,I,v)?cc(r,I+1,D?h.call(D,v):h(v)):Gm(r,I+1)}(Jt(),Mi(),r,o,a,h)}function iv(r,o,a,h,v){return sv(Jt(),Mi(),r,o,a,h,v)}function rv(r,o,a,h,v,D){return function av(r,o,a,h,v,D,I,L){const V=o+a;return function fl(r,o,a,h,v){const D=Uu(r,o,a,h);return Xs(r,o+2,v)||D}(r,V,v,D,I)?cc(r,V+3,L?h.call(L,v,D,I):h(v,D,I)):Gm(r,V+3)}(Jt(),Mi(),r,o,a,h,v,D)}function Gm(r,o){const a=r[o];return a===Gi?void 0:a}function sv(r,o,a,h,v,D,I){const L=o+a;return Uu(r,L,v,D)?cc(r,L+2,I?h.call(I,v,D):h(v,D)):Gm(r,L+2)}function uv(r,o){const a=Ei();let h;const v=r+22;a.firstCreatePass?(h=function nx(r,o){if(o)for(let a=o.length-1;a>=0;a--){const h=o[a];if(r===h.name)return h}}(o,a.pipeRegistry),a.data[v]=h,h.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(v,h.onDestroy)):h=a.data[v];const D=h.factory||(h.factory=ns(h.type)),I=Mt(Fu);try{const L=xl(!1),V=D();return xl(L),function N(r,o,a,h){a>=r.data.length&&(r.data[a]=null,r.blueprint[a]=null),o[a]=h}(a,Jt(),v,V),V}finally{Mt(I)}}function dv(r,o,a,h){const v=r+22,D=Jt(),I=_i(D,v);return function $m(r,o){return r[1].data[o].pure}(D,v)?sv(D,Mi(),o,I.transform,a,h,I):I.transform(a,h)}function ay(r){return o=>{setTimeout(r,void 0,o)}}const Dd=class ax extends _.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,h){let v=o,D=a||(()=>null),I=h;if(o&&"object"==typeof o){const V=o;v=V.next?.bind(V),D=V.error?.bind(V),I=V.complete?.bind(V)}this.__isAsync&&(D=ay(D),v&&(v=ay(v)),I&&(I=ay(I)));const L=super.subscribe({next:v,error:D,complete:I});return o instanceof Q.w0&&o.add(L),L}};function lx(){return this._results[vd()]()}class ly{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=vd(),h=ly.prototype;h[a]||(h[a]=lx)}get changes(){return this._changes||(this._changes=new Dd)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const h=this;h.dirty=!1;const v=vo(o);(this._changesDetected=!function Qc(r,o,a){if(r.length!==o.length)return!1;for(let h=0;h<r.length;h++){let v=r[h],D=o[h];if(a&&(v=a(v),D=a(D)),D!==v)return!1}return!0}(h._results,v,a))&&(h._results=v,h.length=v.length,h.last=v[this.length-1],h.first=v[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Hm=(()=>{class r{}return r.__NG_ELEMENT_ID__=dx,r})();const cx=Hm,ux=class extends cx{constructor(o,a,h){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=h}createEmbeddedView(o,a){const h=this._declarationTContainer.tViews,v=xp(this._declarationLView,h,o,16,null,h.declTNode,null,null,null,null,a||null);v[17]=this._declarationLView[this._declarationTContainer.index];const I=this._declarationLView[19];return null!==I&&(v[19]=I.createEmbeddedView(h)),lc(h,v,o),new If(v)}};function dx(){return e_(Lr(),Jt())}function e_(r,o){return 4&r.type?new ux(o,r,ou(r,o)):null}let t_=(()=>{class r{}return r.__NG_ELEMENT_ID__=hx,r})();function hx(){return pv(Lr(),Jt())}const fx=t_,hv=class extends fx{constructor(o,a,h){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=h}get element(){return ou(this._hostTNode,this._hostLView)}get injector(){return new Wl(this._hostTNode,this._hostLView)}get parentInjector(){const o=tl(this._hostTNode,this._hostLView);if(Hc(o)){const a=Vo(o,this._hostLView),h=La(o);return new Wl(a[1].data[h+8],a)}return new Wl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=fv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,h){let v,D;"number"==typeof h?v=h:null!=h&&(v=h.index,D=h.injector);const I=o.createEmbeddedView(a||{},D);return this.insert(I,v),I}createComponent(o,a,h,v,D){const I=o&&!function wa(r){return"function"==typeof r}(o);let L;if(I)L=a;else{const Me=a||{};L=Me.index,h=Me.injector,v=Me.projectableNodes,D=Me.environmentInjector||Me.ngModuleRef}const V=I?o:new Of(Ke(o)),ee=h||this.parentInjector;if(!D&&null==V.ngModule){const Qe=(I?ee:this.parentInjector).get(iu,null);Qe&&(D=Qe)}const le=V.create(ee,v,void 0,D);return this.insert(le.hostView,L),le}insert(o,a){const h=o._lView,v=h[1];if(function Ti(r){return eo(r[3])}(h)){const le=this.indexOf(o);if(-1!==le)this.detach(le);else{const Me=h[3],Qe=new hv(Me,Me[6],Me[3]);Qe.detach(Qe.indexOf(o))}}const D=this._adjustIndex(a),I=this._lContainer;!function $o(r,o,a,h){const v=10+h,D=a.length;h>0&&(a[v-1][4]=o),h<D-10?(o[4]=a[v],Va(a,10+h,o)):(a.push(o),o[4]=null),o[3]=a;const I=o[17];null!==I&&a!==I&&function Sl(r,o){const a=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===a?r[9]=[o]:a.push(o)}(I,o);const L=o[19];null!==L&&L.insertView(r),o[2]|=64}(v,h,I,D);const L=Fd(D,I),V=h[11],ee=au(V,I[7]);return null!==ee&&function Ar(r,o,a,h,v,D){h[0]=v,h[6]=o,Ld(r,h,a,1,v,D)}(v,I[6],V,h,ee,L),o.attachToViewContainerRef(),Va(cy(I),D,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=fv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),h=Ic(this._lContainer,a);h&&(Ua(cy(this._lContainer),a),Ac(h[1],h))}detach(o){const a=this._adjustIndex(o,-1),h=Ic(this._lContainer,a);return h&&null!=Ua(cy(this._lContainer),a)?new If(h):null}_adjustIndex(o,a=0){return o??this.length+a}};function fv(r){return r[8]}function cy(r){return r[8]||(r[8]=[])}function pv(r,o){let a;const h=o[r.index];if(eo(h))a=h;else{let v;if(8&r.type)v=mr(h);else{const D=o[11];v=D.createComment("");const I=rr(r,o);Oc(D,au(D,I),v,function lu(r,o){return r.nextSibling(o)}(D,I),!1)}o[r.index]=a=Em(h,o,v,r),qd(o,a)}return new hv(a,r,o)}class uy{constructor(o){this.queryList=o,this.matches=null}clone(){return new uy(this.queryList)}setDirty(){this.queryList.setDirty()}}class dy{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const h=null!==o.contentQueries?o.contentQueries[0]:a.length,v=[];for(let D=0;D<h;D++){const I=a.getByIndex(D);v.push(this.queries[I.indexInDeclarationView].clone())}return new dy(v)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Dv(o,a).matches&&this.queries[a].setDirty()}}class mv{constructor(o,a,h=null){this.predicate=o,this.flags=a,this.read=h}}class hy{constructor(o=[]){this.queries=o}elementStart(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let h=0;h<this.length;h++){const v=null!==a?a.length:0,D=this.getByIndex(h).embeddedTView(o,v);D&&(D.indexInDeclarationView=h,null!==a?a.push(D):a=[D])}return null!==a?new hy(a):null}template(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class fy{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new fy(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==a;)h=h.parent;return a===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const h=this.metadata.predicate;if(Array.isArray(h))for(let v=0;v<h.length;v++){const D=h[v];this.matchTNodeWithReadOption(o,a,gx(a,D)),this.matchTNodeWithReadOption(o,a,yo(a,o,D,!1,!1))}else h===Hm?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,yo(a,o,h,!1,!1))}matchTNodeWithReadOption(o,a,h){if(null!==h){const v=this.metadata.read;if(null!==v)if(v===ua||v===t_||v===Hm&&4&a.type)this.addMatch(a.index,-2);else{const D=yo(a,o,v,!1,!1);null!==D&&this.addMatch(a.index,D)}else this.addMatch(a.index,h)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function gx(r,o){const a=r.localNames;if(null!==a)for(let h=0;h<a.length;h+=2)if(a[h]===o)return a[h+1];return null}function yx(r,o,a,h){return-1===a?function _x(r,o){return 11&r.type?ou(r,o):4&r.type?e_(r,o):null}(o,r):-2===a?function vx(r,o,a){return a===ua?ou(o,r):a===Hm?e_(o,r):a===t_?pv(o,r):void 0}(r,o,h):ho(r,r[1],a,o)}function gv(r,o,a,h){const v=o[19].queries[h];if(null===v.matches){const D=r.data,I=a.matches,L=[];for(let V=0;V<I.length;V+=2){const ee=I[V];L.push(ee<0?null:yx(o,D[ee],I[V+1],a.metadata.read))}v.matches=L}return v.matches}function py(r,o,a,h){const v=r.queries.getByIndex(a),D=v.matches;if(null!==D){const I=gv(r,o,v,a);for(let L=0;L<D.length;L+=2){const V=D[L];if(V>0)h.push(I[L/2]);else{const ee=D[L+1],le=o[-V];for(let Me=10;Me<le.length;Me++){const Qe=le[Me];Qe[17]===Qe[3]&&py(Qe[1],Qe,ee,h)}if(null!==le[9]){const Me=le[9];for(let Qe=0;Qe<Me.length;Qe++){const ht=Me[Qe];py(ht[1],ht,ee,h)}}}}}return h}function _v(r){const o=Jt(),a=Ei(),h=Fl();bl(h+1);const v=Dv(a,h);if(r.dirty&&function Ja(r){return 4==(4&r[2])}(o)===(2==(2&v.metadata.flags))){if(null===v.matches)r.reset([]);else{const D=v.crossesNgTemplate?py(a,o,h,[]):gv(a,o,v,h);r.reset(D,mh),r.notifyOnChanges()}return!0}return!1}function yv(r,o,a){const h=Ei();h.firstCreatePass&&(wv(h,new mv(r,o,a),-1),2==(2&o)&&(h.staticViewQueries=!0)),xv(h,Jt(),o)}function vv(r,o,a,h){const v=Ei();if(v.firstCreatePass){const D=Lr();wv(v,new mv(o,a,h),D.index),function xx(r,o){const a=r.contentQueries||(r.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(r.queries.length-1,o)}(v,r),2==(2&a)&&(v.staticContentQueries=!0)}xv(v,Jt(),a)}function bv(){return function bx(r,o){return r[19].queries[o].queryList}(Jt(),Fl())}function xv(r,o,a){const h=new ly(4==(4&a));Ah(r,o,h,h.destroy),null===o[19]&&(o[19]=new dy),o[19].queries.push(new uy(h))}function wv(r,o,a){null===r.queries&&(r.queries=new hy),r.queries.track(new fy(o,a))}function Dv(r,o){return r.queries.getByIndex(o)}function Tv(r,o){return e_(r,o)}function i_(...r){}const Gv=new Qi("Application Initializer");let r_=(()=>{class r{constructor(a){this.appInits=a,this.resolve=i_,this.reject=i_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,v)=>{this.resolve=h,this.reject=v})}runInitializers(){if(this.initialized)return;const a=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const D=this.appInits[v]();if(mt(D))a.push(D);else if(Ot(D)){const I=new Promise((L,V)=>{D.subscribe({complete:L,error:V})});a.push(I)}}Promise.all(a).then(()=>{h()}).catch(v=>{this.reject(v)}),0===a.length&&h(),this.initialized=!0}}return r.\u0275fac=function(a){return new(a||r)(de(Gv,8))},r.\u0275prov=vr({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const $v=new Qi("AppId",{providedIn:"root",factory:function Hv(){return`${vy()}${vy()}${vy()}`}});function vy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Wv=new Qi("Platform Initializer"),Ux=new Qi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Zv=new Qi("appBootstrapListener");let jx=(()=>{class r{log(a){console.log(a)}warn(a){console.warn(a)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=vr({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const o_=new Qi("LocaleId",{providedIn:"root",factory:()=>ge(o_,zn.Optional|zn.SkipSelf)||function Gx(){return typeof $localize<"u"&&$localize.locale||Np}()}),$x=new Qi("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class Hx{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let Wx=(()=>{class r{compileModuleSync(a){return new ry(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const h=this.compileModuleSync(a),D=Sc(be(a).declarations).reduce((I,L)=>{const V=Ke(L);return V&&I.push(new Of(V)),I},[]);return new Hx(h,D)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=vr({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const Yx=(()=>Promise.resolve(0))();function by(r){typeof Zone>"u"?Yx.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class gu{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Dd(!1),this.onMicrotaskEmpty=new Dd(!1),this.onStable=new Dd(!1),this.onError=new Dd(!1),typeof Zone>"u")throw new vn(908,!1);Zone.assertZonePatched();const v=this;if(v._nesting=0,v._outer=v._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const D=Zone.AsyncStackTaggingZoneSpec;v._inner=v._inner.fork(new D("Angular"))}Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!h&&a,v.shouldCoalesceRunChangeDetection=h,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function Xx(){let r=Pn.requestAnimationFrame,o=Pn.cancelAnimationFrame;if(typeof Zone<"u"&&r&&o){const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Qx(r){const o=()=>{!function Kx(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Pn,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,wy(r),r.isCheckStableRunning=!0,xy(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),wy(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,h,v,D,I,L)=>{try{return Xv(r),a.invokeTask(v,D,I,L)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===D.type||r.shouldCoalesceRunChangeDetection)&&o(),Jv(r)}},onInvoke:(a,h,v,D,I,L,V)=>{try{return Xv(r),a.invoke(v,D,I,L,V)}finally{r.shouldCoalesceRunChangeDetection&&o(),Jv(r)}},onHasTask:(a,h,v,D)=>{a.hasTask(v,D),h===v&&("microTask"==D.change?(r._hasPendingMicrotasks=D.microTask,wy(r),xy(r)):"macroTask"==D.change&&(r.hasPendingMacrotasks=D.macroTask))},onHandleError:(a,h,v,D)=>(a.handleError(v,D),r.runOutsideAngular(()=>r.onError.emit(D)),!1)})}(v)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!gu.isInAngularZone())throw new vn(909,!1)}static assertNotInAngularZone(){if(gu.isInAngularZone())throw new vn(909,!1)}run(o,a,h){return this._inner.run(o,a,h)}runTask(o,a,h,v){const D=this._inner,I=D.scheduleEventTask("NgZoneEvent: "+v,o,Jx,i_,i_);try{return D.runTask(I,a,h)}finally{D.cancelTask(I)}}runGuarded(o,a,h){return this._inner.runGuarded(o,a,h)}runOutsideAngular(o){return this._outer.run(o)}}const Jx={};function xy(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function wy(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function Xv(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Jv(r){r._nesting--,xy(r)}class ew{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Dd,this.onMicrotaskEmpty=new Dd,this.onStable=new Dd,this.onError=new Dd}run(o,a,h){return o.apply(a,h)}runGuarded(o,a,h){return o.apply(a,h)}runOutsideAngular(o){return o()}runTask(o,a,h,v){return o.apply(a,h)}}const Kv=new Qi(""),Qv=new Qi("");let Dy,tw=(()=>{class r{constructor(a,h,v){this._ngZone=a,this.registry=h,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Dy||(function nw(r){Dy=r}(v),v.addToWindow(h)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{gu.assertNotInAngularZone(),by(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())by(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(a)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,h,v){let D=-1;h&&h>0&&(D=setTimeout(()=>{this._callbacks=this._callbacks.filter(I=>I.timeoutId!==D),a(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:a,timeoutId:D,updateCb:v})}whenStable(a,h,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,h,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,h,v){return[]}}return r.\u0275fac=function(a){return new(a||r)(de(gu),de(e1),de(Qv))},r.\u0275prov=vr({token:r,factory:r.\u0275fac}),r})(),e1=(()=>{class r{constructor(){this._applications=new Map}registerApplication(a,h){this._applications.set(a,h)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,h=!0){return Dy?.findTestabilityInTree(this,a,h)??null}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=vr({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})(),zh=null;const t1=new Qi("AllowMultipleToken"),Ty=new Qi("PlatformDestroyListeners");class ow{constructor(o,a){this.name=o,this.token=a}}function i1(r,o,a=[]){const h=`Platform: ${o}`,v=new Qi(h);return(D=[])=>{let I=Cy();if(!I||I.injector.get(t1,!1)){const L=[...a,...D,{provide:v,useValue:!0}];r?r(L):function sw(r){if(zh&&!zh.get(t1,!1))throw new vn(400,!1);zh=r;const o=r.get(o1);(function n1(r){const o=r.get(Wv,null);o&&o.forEach(a=>a())})(r)}(function r1(r=[],o){return pd.create({name:o,providers:[{provide:al,useValue:"platform"},{provide:Ty,useValue:new Set([()=>zh=null])},...r]})}(L,h))}return function lw(r){const o=Cy();if(!o)throw new vn(401,!1);return o}()}}function Cy(){return zh?.get(o1)??null}let o1=(()=>{class r{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,h){const v=function a1(r,o){let a;return a="noop"===r?new ew:("zone.js"===r?void 0:r)||new gu(o),a}(h?.ngZone,function s1(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!r||!r.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!r||!r.ngZoneRunCoalescing)||!1}}(h)),D=[{provide:gu,useValue:v}];return v.run(()=>{const I=pd.create({providers:D,parent:this.injector,name:a.moduleType.name}),L=a.create(I),V=L.injector.get(Pd,null);if(!V)throw new vn(402,!1);return v.runOutsideAngular(()=>{const ee=v.onError.subscribe({next:le=>{V.handleError(le)}});L.onDestroy(()=>{a_(this._modules,L),ee.unsubscribe()})}),function l1(r,o,a){try{const h=a();return mt(h)?h.catch(v=>{throw o.runOutsideAngular(()=>r.handleError(v)),v}):h}catch(h){throw o.runOutsideAngular(()=>r.handleError(h)),h}}(V,v,()=>{const ee=L.injector.get(r_);return ee.runInitializers(),ee.donePromise.then(()=>(v0(L.injector.get(o_,Np)||Np),this._moduleDoBootstrap(L),L))})})}bootstrapModule(a,h=[]){const v=c1({},h);return function iw(r,o,a){const h=new ry(a);return Promise.resolve(h)}(0,0,a).then(D=>this.bootstrapModuleFactory(D,v))}_moduleDoBootstrap(a){const h=a.injector.get(s_);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(v=>h.bootstrap(v));else{if(!a.instance.ngDoBootstrap)throw new vn(403,!1);a.instance.ngDoBootstrap(h)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new vn(404,!1);this._modules.slice().forEach(h=>h.destroy()),this._destroyListeners.forEach(h=>h());const a=this._injector.get(Ty,null);a&&(a.forEach(h=>h()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(a){return new(a||r)(de(pd))},r.\u0275prov=vr({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function c1(r,o){return Array.isArray(o)?o.reduce(c1,r):{...r,...o}}let s_=(()=>{class r{constructor(a,h,v){this._zone=a,this._injector=h,this._exceptionHandler=v,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const D=new ot.y(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),I=new ot.y(L=>{let V;this._zone.runOutsideAngular(()=>{V=this._zone.onStable.subscribe(()=>{gu.assertNotInAngularZone(),by(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const ee=this._zone.onUnstable.subscribe(()=>{gu.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{V.unsubscribe(),ee.unsubscribe()}});this.isStable=(0,c.T)(D,I.pipe(function st(r={}){const{connector:o=(()=>new _.x),resetOnError:a=!0,resetOnComplete:h=!0,resetOnRefCountZero:v=!0}=r;return D=>{let I,L,V,ee=0,le=!1,Me=!1;const Qe=()=>{L?.unsubscribe(),L=void 0},ht=()=>{Qe(),I=V=void 0,le=Me=!1},$t=()=>{const mn=I;ht(),mn?.unsubscribe()};return(0,Ft.e)((mn,kn)=>{ee++,!Me&&!le&&Qe();const Wn=V=V??o();kn.add(()=>{ee--,0===ee&&!Me&&!le&&(L=xt($t,v))}),Wn.subscribe(kn),!I&&ee>0&&(I=new Vt.Hp({next:hi=>Wn.next(hi),error:hi=>{Me=!0,Qe(),L=xt(ht,a,hi),Wn.error(hi)},complete:()=>{le=!0,Qe(),L=xt(ht,h),Wn.complete()}}),(0,ze.Xf)(mn).subscribe(I))})(D)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(a,h){const v=a instanceof Iu;if(!this._injector.get(r_).done)throw!v&&ye(a),new vn(405,false);let I;I=v?a:this._injector.get(Ec).resolveComponentFactory(a),this.componentTypes.push(I.componentType);const L=function rw(r){return r.isBoundToModule}(I)?void 0:this._injector.get(kp),ee=I.create(pd.NULL,[],h||I.selector,L),le=ee.location.nativeElement,Me=ee.injector.get(Kv,null);return Me?.registerApplication(le),ee.onDestroy(()=>{this.detachView(ee.hostView),a_(this.components,ee),Me?.unregisterApplication(le)}),this._loadComponent(ee),ee}tick(){if(this._runningTick)throw new vn(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const h=a;this._views.push(h),h.attachToAppRef(this)}detachView(a){const h=a;a_(this._views,h),h.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(Zv,[]).concat(this._bootstrapListeners).forEach(v=>v(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>a_(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new vn(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return r.\u0275fac=function(a){return new(a||r)(de(gu),de(iu),de(Pd))},r.\u0275prov=vr({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function a_(r,o){const a=r.indexOf(o);a>-1&&r.splice(a,1)}let d1=!0;function uw(){d1=!1}let dw=(()=>{class r{}return r.__NG_ELEMENT_ID__=hw,r})();function hw(r){return function fw(r,o,a){if(Ui(r)&&!a){const h=uo(r.index,o);return new If(h,h)}return 47&r.type?new If(o[16],o):null}(Lr(),Jt(),16==(16&r))}class g1{constructor(){}supports(o){return kh(o)}create(o){return new vw(o)}}const yw=(r,o)=>o;class vw{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||yw}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,h=this._removalsHead,v=0,D=null;for(;a||h;){const I=!h||a&&a.currentIndex<y1(h,v,D)?a:h,L=y1(I,v,D),V=I.currentIndex;if(I===h)v--,h=h._nextRemoved;else if(a=a._next,null==I.previousIndex)v++;else{D||(D=[]);const ee=L-v,le=V-v;if(ee!=le){for(let Qe=0;Qe<ee;Qe++){const ht=Qe<D.length?D[Qe]:D[Qe]=0,$t=ht+Qe;le<=$t&&$t<ee&&(D[Qe]=ht+1)}D[I.previousIndex]=le-ee}}L!==V&&o(I,L,V)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!kh(o))throw new vn(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let v,D,I,a=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let L=0;L<this.length;L++)D=o[L],I=this._trackByFn(L,D),null!==a&&Object.is(a.trackById,I)?(h&&(a=this._verifyReinsertion(a,D,I,L)),Object.is(a.item,D)||this._addIdentityChange(a,D)):(a=this._mismatch(a,D,I,L),h=!0),a=a._next}else v=0,function H_(r,o){if(Array.isArray(r))for(let a=0;a<r.length;a++)o(r[a]);else{const a=r[vd()]();let h;for(;!(h=a.next()).done;)o(h.value)}}(o,L=>{I=this._trackByFn(v,L),null!==a&&Object.is(a.trackById,I)?(h&&(a=this._verifyReinsertion(a,L,I,v)),Object.is(a.item,L)||this._addIdentityChange(a,L)):(a=this._mismatch(a,L,I,v),h=!0),a=a._next,v++}),this.length=v;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,h,v){let D;return null===o?D=this._itTail:(D=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,D,v)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,v))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,D,v)):o=this._addAfter(new bw(a,h),D,v),o}_verifyReinsertion(o,a,h,v){let D=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==D?o=this._reinsertAfter(D,o._prev,v):o.currentIndex!=v&&(o.currentIndex=v,this._addToMoves(o,v)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const v=o._prevRemoved,D=o._nextRemoved;return null===v?this._removalsHead=D:v._nextRemoved=D,null===D?this._removalsTail=v:D._prevRemoved=v,this._insertAfter(o,a,h),this._addToMoves(o,h),o}_moveAfter(o,a,h){return this._unlink(o),this._insertAfter(o,a,h),this._addToMoves(o,h),o}_addAfter(o,a,h){return this._insertAfter(o,a,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,h){const v=null===a?this._itHead:a._next;return o._next=v,o._prev=a,null===v?this._itTail=o:v._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new _1),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,h=o._next;return null===a?this._itHead=h:a._next=h,null===h?this._itTail=a:h._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new _1),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class bw{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class xw{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===a||a<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const a=o._prevDup,h=o._nextDup;return null===a?this._head=h:a._nextDup=h,null===h?this._tail=a:h._prevDup=a,null===this._head}}class _1{constructor(){this.map=new Map}put(o){const a=o.trackById;let h=this.map.get(a);h||(h=new xw,this.map.set(a,h)),h.add(o)}get(o,a){const v=this.map.get(o);return v?v.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function y1(r,o,a){const h=r.previousIndex;if(null===h)return h;let v=0;return a&&h<a.length&&(v=a[h]),h+o+v}class v1{constructor(){}supports(o){return o instanceof Map||bd(o)}create(){return new ww}}class ww{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||bd(o)))throw new vn(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,v)=>{if(a&&a.key===v)this._maybeAddToChanges(a,h),this._appendAfter=a,a=a._next;else{const D=this._getOrCreateRecordForKey(v,h);a=this._insertBeforeOrAppend(a,D)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let h=a;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const h=o._prev;return a._next=o,a._prev=h,o._prev=a,h&&(h._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const v=this._records.get(o);this._maybeAddToChanges(v,a);const D=v._prev,I=v._next;return D&&(D._next=I),I&&(I._prev=D),v._next=null,v._prev=null,v}const h=new Dw(o);return this._records.set(o,h),h.currentValue=a,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(h=>a(o[h],h))}}class Dw{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function b1(){return new Ay([new g1])}let Ay=(()=>{class r{constructor(a){this.factories=a}static create(a,h){if(null!=h){const v=h.factories.slice();a=a.concat(v)}return new r(a)}static extend(a){return{provide:r,useFactory:h=>r.create(a,h||b1()),deps:[[r,new Je,new je]]}}find(a){const h=this.factories.find(v=>v.supports(a));if(null!=h)return h;throw new vn(901,!1)}}return r.\u0275prov=vr({token:r,providedIn:"root",factory:b1}),r})();function x1(){return new Py([new v1])}let Py=(()=>{class r{constructor(a){this.factories=a}static create(a,h){if(h){const v=h.factories.slice();a=a.concat(v)}return new r(a)}static extend(a){return{provide:r,useFactory:h=>r.create(a,h||x1()),deps:[[r,new Je,new je]]}}find(a){const h=this.factories.find(v=>v.supports(a));if(h)return h;throw new vn(901,!1)}}return r.\u0275prov=vr({token:r,providedIn:"root",factory:x1}),r})();const Ew=i1(null,"core",[]);let Mw=(()=>{class r{constructor(a){}}return r.\u0275fac=function(a){return new(a||r)(de(s_))},r.\u0275mod=Se({type:r}),r.\u0275inj=ai({}),r})();function Sw(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}function Aw(r,o){const a=Ke(r),h=o.elementInjector||td();return new Of(a).create(h,o.projectableNodes,o.hostElement,o.environmentInjector)}},433:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Wl:()=>xn,Fj:()=>At,qu:()=>Lr,u:()=>Ss,sg:()=>wo,u5:()=>va,Cf:()=>tn,JU:()=>Xt,JJ:()=>Mt,JL:()=>Ve,YN:()=>Ia,_:()=>_s,UX:()=>Qa,EJ:()=>ma,kI:()=>it,_Y:()=>gl,Kr:()=>Is});var _=he(1571),Q=he(6895),ot=he(2076),c=he(9751),ze=he(4742),Vt=he(8421),Ft=he(3269),st=he(5403),xt=he(3268),ut=he(1810),lt=he(4004);let dn=(()=>{class J{constructor(G,ue){this._renderer=G,this._elementRef=ue,this.onChange=gt=>{},this.onTouched=()=>{}}setProperty(G,ue){this._renderer.setProperty(this._elementRef.nativeElement,G,ue)}registerOnTouched(G){this.onTouched=G}registerOnChange(G){this.onChange=G}setDisabledState(G){this.setProperty("disabled",G)}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(_.Qsj),_.Y36(_.SBq))},J.\u0275dir=_.lG2({type:J}),J})(),jt=(()=>{class J extends dn{}return J.\u0275fac=function(){let q;return function(ue){return(q||(q=_.n5z(J)))(ue||J)}}(),J.\u0275dir=_.lG2({type:J,features:[_.qOj]}),J})();const Xt=new _.OlP("NgValueAccessor"),Gt={provide:Xt,useExisting:(0,_.Gpc)(()=>xn),multi:!0};let xn=(()=>{class J extends jt{writeValue(G){this.setProperty("checked",G)}}return J.\u0275fac=function(){let q;return function(ue){return(q||(q=_.n5z(J)))(ue||J)}}(),J.\u0275dir=_.lG2({type:J,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(G,ue){1&G&&_.NdJ("change",function(On){return ue.onChange(On.target.checked)})("blur",function(){return ue.onTouched()})},features:[_._Bn([Gt]),_.qOj]}),J})();const on={provide:Xt,useExisting:(0,_.Gpc)(()=>At),multi:!0},ki=new _.OlP("CompositionEventMode");let At=(()=>{class J extends dn{constructor(G,ue,gt){super(G,ue),this._compositionMode=gt,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function vn(){const J=(0,Q.q)()?(0,Q.q)().getUserAgent():"";return/android (\d+)/.test(J.toLowerCase())}())}writeValue(G){this.setProperty("value",G??"")}_handleInput(G){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(G)}_compositionStart(){this._composing=!0}_compositionEnd(G){this._composing=!1,this._compositionMode&&this.onChange(G)}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(_.Qsj),_.Y36(_.SBq),_.Y36(ki,8))},J.\u0275dir=_.lG2({type:J,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(G,ue){1&G&&_.NdJ("input",function(On){return ue._handleInput(On.target.value)})("blur",function(){return ue.onTouched()})("compositionstart",function(){return ue._compositionStart()})("compositionend",function(On){return ue._compositionEnd(On.target.value)})},features:[_._Bn([on]),_.qOj]}),J})();function Zt(J){return null==J||("string"==typeof J||Array.isArray(J))&&0===J.length}function Qt(J){return null!=J&&"number"==typeof J.length}const tn=new _.OlP("NgValidators"),Rt=new _.OlP("NgAsyncValidators"),Kt=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class it{static min(q){return function ct(J){return q=>{if(Zt(q.value)||Zt(J))return null;const G=parseFloat(q.value);return!isNaN(G)&&G<J?{min:{min:J,actual:q.value}}:null}}(q)}static max(q){return function It(J){return q=>{if(Zt(q.value)||Zt(J))return null;const G=parseFloat(q.value);return!isNaN(G)&&G>J?{max:{max:J,actual:q.value}}:null}}(q)}static required(q){return function dt(J){return Zt(J.value)?{required:!0}:null}(q)}static requiredTrue(q){return function _n(J){return!0===J.value?null:{required:!0}}(q)}static email(q){return function rn(J){return Zt(J.value)||Kt.test(J.value)?null:{email:!0}}(q)}static minLength(q){return function Zn(J){return q=>Zt(q.value)||!Qt(q.value)?null:q.value.length<J?{minlength:{requiredLength:J,actualLength:q.value.length}}:null}(q)}static maxLength(q){return function An(J){return q=>Qt(q.value)&&q.value.length>J?{maxlength:{requiredLength:J,actualLength:q.value.length}}:null}(q)}static pattern(q){return function Di(J){if(!J)return Kn;let q,G;return"string"==typeof J?(G="","^"!==J.charAt(0)&&(G+="^"),G+=J,"$"!==J.charAt(J.length-1)&&(G+="$"),q=new RegExp(G)):(G=J.toString(),q=J),ue=>{if(Zt(ue.value))return null;const gt=ue.value;return q.test(gt)?null:{pattern:{requiredPattern:G,actualValue:gt}}}}(q)}static nullValidator(q){return null}static compose(q){return Ao(q)}static composeAsync(q){return ti(q)}}function Kn(J){return null}function Ni(J){return null!=J}function kr(J){return(0,_.QGY)(J)?(0,ot.D)(J):J}function oi(J){let q={};return J.forEach(G=>{q=null!=G?{...q,...G}:q}),0===Object.keys(q).length?null:q}function ei(J,q){return q.map(G=>G(J))}function Xi(J){return J.map(q=>function ko(J){return!J.validate}(q)?q:G=>q.validate(G))}function Ao(J){if(!J)return null;const q=J.filter(Ni);return 0==q.length?null:function(G){return oi(ei(G,q))}}function vr(J){return null!=J?Ao(Xi(J)):null}function ti(J){if(!J)return null;const q=J.filter(Ni);return 0==q.length?null:function(G){return function Et(...J){const q=(0,Ft.jO)(J),{args:G,keys:ue}=(0,ze.D)(J),gt=new c.y(On=>{const{length:Mi}=G;if(!Mi)return void On.complete();const to=new Array(Mi);let Ps=Mi,ws=Mi;for(let Oo=0;Oo<Mi;Oo++){let Rl=!1;(0,Vt.Xf)(G[Oo]).subscribe((0,st.x)(On,ka=>{Rl||(Rl=!0,ws--),to[Oo]=ka},()=>Ps--,void 0,()=>{(!Ps||!Rl)&&(ws||On.next(ue?(0,ut.n)(ue,to):to),On.complete())}))}});return q?gt.pipe((0,xt.Z)(q)):gt}(ei(G,q).map(kr)).pipe((0,lt.U)(oi))}}function ai(J){return null!=J?ti(Xi(J)):null}function Ur(J,q){return null===J?[q]:Array.isArray(J)?[...J,q]:[J,q]}function vi(J){return J._rawValidators}function cr(J){return J._rawAsyncValidators}function Hi(J){return J?Array.isArray(J)?J:[J]:[]}function nr(J,q){return Array.isArray(J)?J.includes(q):J===q}function si(J,q){const G=Hi(q);return Hi(J).forEach(gt=>{nr(G,gt)||G.push(gt)}),G}function Ji(J,q){return Hi(q).filter(G=>!nr(J,G))}class jr{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(q){this._rawValidators=q||[],this._composedValidatorFn=vr(this._rawValidators)}_setAsyncValidators(q){this._rawAsyncValidators=q||[],this._composedAsyncValidatorFn=ai(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(q){this._onDestroyCallbacks.push(q)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(q=>q()),this._onDestroyCallbacks=[]}reset(q){this.control&&this.control.reset(q)}hasError(q,G){return!!this.control&&this.control.hasError(q,G)}getError(q,G){return this.control?this.control.getError(q,G):null}}class pr extends jr{get formDirective(){return null}get path(){return null}}class zi extends jr{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class zn{constructor(q){this._cd=q}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Mt=(()=>{class J extends zn{constructor(G){super(G)}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(zi,2))},J.\u0275dir=_.lG2({type:J,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(G,ue){2&G&&_.ekj("ng-untouched",ue.isUntouched)("ng-touched",ue.isTouched)("ng-pristine",ue.isPristine)("ng-dirty",ue.isDirty)("ng-valid",ue.isValid)("ng-invalid",ue.isInvalid)("ng-pending",ue.isPending)},features:[_.qOj]}),J})(),Ve=(()=>{class J extends zn{constructor(G){super(G)}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(pr,10))},J.\u0275dir=_.lG2({type:J,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(G,ue){2&G&&_.ekj("ng-untouched",ue.isUntouched)("ng-touched",ue.isTouched)("ng-pristine",ue.isPristine)("ng-dirty",ue.isDirty)("ng-valid",ue.isValid)("ng-invalid",ue.isInvalid)("ng-pending",ue.isPending)("ng-submitted",ue.isSubmitted)},features:[_.qOj]}),J})();const _e="VALID",te="INVALID",re="PENDING",xe="DISABLED";function Se(J){return(We(J)?J.validators:J)||null}function $e(J){return Array.isArray(J)?vr(J):J||null}function nt(J,q){return(We(q)?q.asyncValidators:J)||null}function et(J){return Array.isArray(J)?ai(J):J||null}function We(J){return null!=J&&!Array.isArray(J)&&"object"==typeof J}function Ke(J,q,G){const ue=J.controls;if(!(q?Object.keys(ue):ue).length)throw new _.vHH(1e3,"");if(!ue[G])throw new _.vHH(1001,"")}function wt(J,q,G){J._forEachChild((ue,gt)=>{if(void 0===G[gt])throw new _.vHH(1002,"")})}class Ae{constructor(q,G){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=q,this._rawAsyncValidators=G,this._composedValidatorFn=$e(this._rawValidators),this._composedAsyncValidatorFn=et(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(q){this._rawValidators=this._composedValidatorFn=q}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(q){this._rawAsyncValidators=this._composedAsyncValidatorFn=q}get parent(){return this._parent}get valid(){return this.status===_e}get invalid(){return this.status===te}get pending(){return this.status==re}get disabled(){return this.status===xe}get enabled(){return this.status!==xe}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(q){this._rawValidators=q,this._composedValidatorFn=$e(q)}setAsyncValidators(q){this._rawAsyncValidators=q,this._composedAsyncValidatorFn=et(q)}addValidators(q){this.setValidators(si(q,this._rawValidators))}addAsyncValidators(q){this.setAsyncValidators(si(q,this._rawAsyncValidators))}removeValidators(q){this.setValidators(Ji(q,this._rawValidators))}removeAsyncValidators(q){this.setAsyncValidators(Ji(q,this._rawAsyncValidators))}hasValidator(q){return nr(this._rawValidators,q)}hasAsyncValidator(q){return nr(this._rawAsyncValidators,q)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(q={}){this.touched=!0,this._parent&&!q.onlySelf&&this._parent.markAsTouched(q)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(q=>q.markAllAsTouched())}markAsUntouched(q={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(G=>{G.markAsUntouched({onlySelf:!0})}),this._parent&&!q.onlySelf&&this._parent._updateTouched(q)}markAsDirty(q={}){this.pristine=!1,this._parent&&!q.onlySelf&&this._parent.markAsDirty(q)}markAsPristine(q={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(G=>{G.markAsPristine({onlySelf:!0})}),this._parent&&!q.onlySelf&&this._parent._updatePristine(q)}markAsPending(q={}){this.status=re,!1!==q.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!q.onlySelf&&this._parent.markAsPending(q)}disable(q={}){const G=this._parentMarkedDirty(q.onlySelf);this.status=xe,this.errors=null,this._forEachChild(ue=>{ue.disable({...q,onlySelf:!0})}),this._updateValue(),!1!==q.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...q,skipPristineCheck:G}),this._onDisabledChange.forEach(ue=>ue(!0))}enable(q={}){const G=this._parentMarkedDirty(q.onlySelf);this.status=_e,this._forEachChild(ue=>{ue.enable({...q,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:q.emitEvent}),this._updateAncestors({...q,skipPristineCheck:G}),this._onDisabledChange.forEach(ue=>ue(!1))}_updateAncestors(q){this._parent&&!q.onlySelf&&(this._parent.updateValueAndValidity(q),q.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(q){this._parent=q}getRawValue(){return this.value}updateValueAndValidity(q={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===_e||this.status===re)&&this._runAsyncValidator(q.emitEvent)),!1!==q.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!q.onlySelf&&this._parent.updateValueAndValidity(q)}_updateTreeValidity(q={emitEvent:!0}){this._forEachChild(G=>G._updateTreeValidity(q)),this.updateValueAndValidity({onlySelf:!0,emitEvent:q.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?xe:_e}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(q){if(this.asyncValidator){this.status=re,this._hasOwnPendingAsyncValidator=!0;const G=kr(this.asyncValidator(this));this._asyncValidationSubscription=G.subscribe(ue=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(ue,{emitEvent:q})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(q,G={}){this.errors=q,this._updateControlsErrors(!1!==G.emitEvent)}get(q){let G=q;return null==G||(Array.isArray(G)||(G=G.split(".")),0===G.length)?null:G.reduce((ue,gt)=>ue&&ue._find(gt),this)}getError(q,G){const ue=G?this.get(G):this;return ue&&ue.errors?ue.errors[q]:null}hasError(q,G){return!!this.getError(q,G)}get root(){let q=this;for(;q._parent;)q=q._parent;return q}_updateControlsErrors(q){this.status=this._calculateStatus(),q&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(q)}_initObservables(){this.valueChanges=new _.vpe,this.statusChanges=new _.vpe}_calculateStatus(){return this._allControlsDisabled()?xe:this.errors?te:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(re)?re:this._anyControlsHaveStatus(te)?te:_e}_anyControlsHaveStatus(q){return this._anyControls(G=>G.status===q)}_anyControlsDirty(){return this._anyControls(q=>q.dirty)}_anyControlsTouched(){return this._anyControls(q=>q.touched)}_updatePristine(q={}){this.pristine=!this._anyControlsDirty(),this._parent&&!q.onlySelf&&this._parent._updatePristine(q)}_updateTouched(q={}){this.touched=this._anyControlsTouched(),this._parent&&!q.onlySelf&&this._parent._updateTouched(q)}_registerOnCollectionChange(q){this._onCollectionChange=q}_setUpdateStrategy(q){We(q)&&null!=q.updateOn&&(this._updateOn=q.updateOn)}_parentMarkedDirty(q){return!q&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(q){return null}}class ye extends Ae{constructor(q,G,ue){super(Se(G),nt(ue,G)),this.controls=q,this._initObservables(),this._setUpdateStrategy(G),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(q,G){return this.controls[q]?this.controls[q]:(this.controls[q]=G,G.setParent(this),G._registerOnCollectionChange(this._onCollectionChange),G)}addControl(q,G,ue={}){this.registerControl(q,G),this.updateValueAndValidity({emitEvent:ue.emitEvent}),this._onCollectionChange()}removeControl(q,G={}){this.controls[q]&&this.controls[q]._registerOnCollectionChange(()=>{}),delete this.controls[q],this.updateValueAndValidity({emitEvent:G.emitEvent}),this._onCollectionChange()}setControl(q,G,ue={}){this.controls[q]&&this.controls[q]._registerOnCollectionChange(()=>{}),delete this.controls[q],G&&this.registerControl(q,G),this.updateValueAndValidity({emitEvent:ue.emitEvent}),this._onCollectionChange()}contains(q){return this.controls.hasOwnProperty(q)&&this.controls[q].enabled}setValue(q,G={}){wt(this,0,q),Object.keys(q).forEach(ue=>{Ke(this,!0,ue),this.controls[ue].setValue(q[ue],{onlySelf:!0,emitEvent:G.emitEvent})}),this.updateValueAndValidity(G)}patchValue(q,G={}){null!=q&&(Object.keys(q).forEach(ue=>{const gt=this.controls[ue];gt&&gt.patchValue(q[ue],{onlySelf:!0,emitEvent:G.emitEvent})}),this.updateValueAndValidity(G))}reset(q={},G={}){this._forEachChild((ue,gt)=>{ue.reset(q[gt],{onlySelf:!0,emitEvent:G.emitEvent})}),this._updatePristine(G),this._updateTouched(G),this.updateValueAndValidity(G)}getRawValue(){return this._reduceChildren({},(q,G,ue)=>(q[ue]=G.getRawValue(),q))}_syncPendingControls(){let q=this._reduceChildren(!1,(G,ue)=>!!ue._syncPendingControls()||G);return q&&this.updateValueAndValidity({onlySelf:!0}),q}_forEachChild(q){Object.keys(this.controls).forEach(G=>{const ue=this.controls[G];ue&&q(ue,G)})}_setUpControls(){this._forEachChild(q=>{q.setParent(this),q._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(q){for(const[G,ue]of Object.entries(this.controls))if(this.contains(G)&&q(ue))return!0;return!1}_reduceValue(){return this._reduceChildren({},(G,ue,gt)=>((ue.enabled||this.disabled)&&(G[gt]=ue.value),G))}_reduceChildren(q,G){let ue=q;return this._forEachChild((gt,On)=>{ue=G(ue,gt,On)}),ue}_allControlsDisabled(){for(const q of Object.keys(this.controls))if(this.controls[q].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(q){return this.controls.hasOwnProperty(q)?this.controls[q]:null}}class Pe extends ye{}function Rn(J,q){at(J,q),q.valueAccessor.writeValue(J.value),J.disabled&&q.valueAccessor.setDisabledState?.(!0),function $i(J,q){q.valueAccessor.registerOnChange(G=>{J._pendingValue=G,J._pendingChange=!0,J._pendingDirty=!0,"change"===J.updateOn&&xo(J,q)})}(J,q),function Tr(J,q){const G=(ue,gt)=>{q.valueAccessor.writeValue(ue),gt&&q.viewToModelUpdate(ue)};J.registerOnChange(G),q._registerOnDestroy(()=>{J._unregisterOnChange(G)})}(J,q),function Xn(J,q){q.valueAccessor.registerOnTouched(()=>{J._pendingTouched=!0,"blur"===J.updateOn&&J._pendingChange&&xo(J,q),"submit"!==J.updateOn&&J.markAsTouched()})}(J,q),function In(J,q){if(q.valueAccessor.setDisabledState){const G=ue=>{q.valueAccessor.setDisabledState(ue)};J.registerOnDisabledChange(G),q._registerOnDestroy(()=>{J._unregisterOnDisabledChange(G)})}}(J,q)}function Vn(J,q,G=!0){const ue=()=>{};q.valueAccessor&&(q.valueAccessor.registerOnChange(ue),q.valueAccessor.registerOnTouched(ue)),$r(J,q),J&&(q._invokeOnDestroyCallbacks(),J._registerOnCollectionChange(()=>{}))}function jn(J,q){J.forEach(G=>{G.registerOnValidatorChange&&G.registerOnValidatorChange(q)})}function at(J,q){const G=vi(J);null!==q.validator?J.setValidators(Ur(G,q.validator)):"function"==typeof G&&J.setValidators([G]);const ue=cr(J);null!==q.asyncValidator?J.setAsyncValidators(Ur(ue,q.asyncValidator)):"function"==typeof ue&&J.setAsyncValidators([ue]);const gt=()=>J.updateValueAndValidity();jn(q._rawValidators,gt),jn(q._rawAsyncValidators,gt)}function $r(J,q){let G=!1;if(null!==J){if(null!==q.validator){const gt=vi(J);if(Array.isArray(gt)&&gt.length>0){const On=gt.filter(Mi=>Mi!==q.validator);On.length!==gt.length&&(G=!0,J.setValidators(On))}}if(null!==q.asyncValidator){const gt=cr(J);if(Array.isArray(gt)&&gt.length>0){const On=gt.filter(Mi=>Mi!==q.asyncValidator);On.length!==gt.length&&(G=!0,J.setAsyncValidators(On))}}}const ue=()=>{};return jn(q._rawValidators,ue),jn(q._rawAsyncValidators,ue),G}function xo(J,q){J._pendingDirty&&J.markAsDirty(),J.setValue(J._pendingValue,{emitModelToViewChange:!1}),q.viewToModelUpdate(J._pendingValue),J._pendingChange=!1}function Cr(J,q){const G=J.indexOf(q);G>-1&&J.splice(G,1)}function Dr(J){return"object"==typeof J&&null!==J&&2===Object.keys(J).length&&"value"in J&&"disabled"in J}const Er=class extends Ae{constructor(q=null,G,ue){super(Se(G),nt(ue,G)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(q),this._setUpdateStrategy(G),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),We(G)&&(G.nonNullable||G.initialValueIsDefault)&&(this.defaultValue=Dr(q)?q.value:q)}setValue(q,G={}){this.value=this._pendingValue=q,this._onChange.length&&!1!==G.emitModelToViewChange&&this._onChange.forEach(ue=>ue(this.value,!1!==G.emitViewToModelChange)),this.updateValueAndValidity(G)}patchValue(q,G={}){this.setValue(q,G)}reset(q=this.defaultValue,G={}){this._applyFormState(q),this.markAsPristine(G),this.markAsUntouched(G),this.setValue(this.value,G),this._pendingChange=!1}_updateValue(){}_anyControls(q){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(q){this._onChange.push(q)}_unregisterOnChange(q){Cr(this._onChange,q)}registerOnDisabledChange(q){this._onDisabledChange.push(q)}_unregisterOnDisabledChange(q){Cr(this._onDisabledChange,q)}_forEachChild(q){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(q){Dr(q)?(this.value=this._pendingValue=q.value,q.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=q}};let gl=(()=>{class J{}return J.\u0275fac=function(G){return new(G||J)},J.\u0275dir=_.lG2({type:J,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),J})();const Ma={provide:Xt,useExisting:(0,_.Gpc)(()=>_s),multi:!0};let Po=(()=>{class J{}return J.\u0275fac=function(G){return new(G||J)},J.\u0275mod=_.oAB({type:J}),J.\u0275inj=_.cJS({}),J})(),Lo=(()=>{class J{constructor(){this._accessors=[]}add(G,ue){this._accessors.push([G,ue])}remove(G){for(let ue=this._accessors.length-1;ue>=0;--ue)if(this._accessors[ue][1]===G)return void this._accessors.splice(ue,1)}select(G){this._accessors.forEach(ue=>{this._isSameGroup(ue,G)&&ue[1]!==G&&ue[1].fireUncheck(G.value)})}_isSameGroup(G,ue){return!!G[0].control&&G[0]._parent===ue._control._parent&&G[1].name===ue.name}}return J.\u0275fac=function(G){return new(G||J)},J.\u0275prov=_.Yz7({token:J,factory:J.\u0275fac,providedIn:Po}),J})(),_s=(()=>{class J extends jt{constructor(G,ue,gt,On){super(G,ue),this._registry=gt,this._injector=On,this.onChange=()=>{}}ngOnInit(){this._control=this._injector.get(zi),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(G){this._state=G===this.value,this.setProperty("checked",this._state)}registerOnChange(G){this._fn=G,this.onChange=()=>{G(this.value),this._registry.select(this)}}fireUncheck(G){this.writeValue(G)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(_.Qsj),_.Y36(_.SBq),_.Y36(Lo),_.Y36(_.zs3))},J.\u0275dir=_.lG2({type:J,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(G,ue){1&G&&_.NdJ("change",function(){return ue.onChange()})("blur",function(){return ue.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[_._Bn([Ma]),_.qOj]}),J})();const na=new _.OlP("NgModelWithFormControlWarning"),ys={provide:pr,useExisting:(0,_.Gpc)(()=>wo)};let wo=(()=>{class J extends pr{constructor(G,ue){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new _.vpe,this._setValidators(G),this._setAsyncValidators(ue)}ngOnChanges(G){this._checkFormPresent(),G.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&($r(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(G){const ue=this.form.get(G.path);return Rn(ue,G),ue.updateValueAndValidity({emitEvent:!1}),this.directives.push(G),ue}getControl(G){return this.form.get(G.path)}removeControl(G){Vn(G.control||null,G,!1),function ps(J,q){const G=J.indexOf(q);G>-1&&J.splice(G,1)}(this.directives,G)}addFormGroup(G){this._setUpFormContainer(G)}removeFormGroup(G){this._cleanUpFormContainer(G)}getFormGroup(G){return this.form.get(G.path)}addFormArray(G){this._setUpFormContainer(G)}removeFormArray(G){this._cleanUpFormContainer(G)}getFormArray(G){return this.form.get(G.path)}updateModel(G,ue){this.form.get(G.path).setValue(ue)}onSubmit(G){return this.submitted=!0,function Sn(J,q){J._syncPendingControls(),q.forEach(G=>{const ue=G.control;"submit"===ue.updateOn&&ue._pendingChange&&(G.viewToModelUpdate(ue._pendingValue),ue._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(G),"dialog"===G?.target?.method}onReset(){this.resetForm()}resetForm(G){this.form.reset(G),this.submitted=!1}_updateDomValue(){this.directives.forEach(G=>{const ue=G.control,gt=this.form.get(G.path);ue!==gt&&(Vn(ue||null,G),(J=>J instanceof Er)(gt)&&(Rn(gt,G),G.control=gt))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(G){const ue=this.form.get(G.path);(function go(J,q){at(J,q)})(ue,G),ue.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(G){if(this.form){const ue=this.form.get(G.path);ue&&function zs(J,q){return $r(J,q)}(ue,G)&&ue.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){at(this.form,this),this._oldForm&&$r(this._oldForm,this)}_checkFormPresent(){}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(tn,10),_.Y36(Rt,10))},J.\u0275dir=_.lG2({type:J,selectors:[["","formGroup",""]],hostBindings:function(G,ue){1&G&&_.NdJ("submit",function(On){return ue.onSubmit(On)})("reset",function(){return ue.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[_._Bn([ys]),_.qOj,_.TTD]}),J})();const hc={provide:zi,useExisting:(0,_.Gpc)(()=>Ss)};let Ss=(()=>{class J extends zi{constructor(G,ue,gt,On,Mi){super(),this._ngModelWarningConfig=Mi,this._added=!1,this.update=new _.vpe,this._ngModelWarningSent=!1,this._parent=G,this._setValidators(ue),this._setAsyncValidators(gt),this.valueAccessor=function Wo(J,q){if(!q)return null;let G,ue,gt;return Array.isArray(q),q.forEach(On=>{On.constructor===At?G=On:function Fo(J){return Object.getPrototypeOf(J.constructor)===jt}(On)?ue=On:gt=On}),gt||ue||G||null}(0,On)}set isDisabled(G){}ngOnChanges(G){this._added||this._setUpControl(),function wr(J,q){if(!J.hasOwnProperty("model"))return!1;const G=J.model;return!!G.isFirstChange()||!Object.is(q,G.currentValue)}(G,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(G){this.viewModel=G,this.update.emit(G)}get path(){return function qt(J,q){return[...q.path,J]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return J._ngModelWarningSentOnce=!1,J.\u0275fac=function(G){return new(G||J)(_.Y36(pr,13),_.Y36(tn,10),_.Y36(Rt,10),_.Y36(Xt,10),_.Y36(na,8))},J.\u0275dir=_.lG2({type:J,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[_._Bn([hc]),_.qOj,_.TTD]}),J})();const Us={provide:Xt,useExisting:(0,_.Gpc)(()=>ma),multi:!0};function Ya(J,q){return null==J?`${q}`:(q&&"object"==typeof q&&(q="Object"),`${J}: ${q}`.slice(0,50))}let ma=(()=>{class J extends jt{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(G){this._compareWith=G}writeValue(G){this.value=G;const gt=Ya(this._getOptionId(G),G);this.setProperty("value",gt)}registerOnChange(G){this.onChange=ue=>{this.value=this._getOptionValue(ue),G(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(G){for(const ue of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(ue),G))return ue;return null}_getOptionValue(G){const ue=function Xa(J){return J.split(":")[0]}(G);return this._optionMap.has(ue)?this._optionMap.get(ue):G}}return J.\u0275fac=function(){let q;return function(ue){return(q||(q=_.n5z(J)))(ue||J)}}(),J.\u0275dir=_.lG2({type:J,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(G,ue){1&G&&_.NdJ("change",function(On){return ue.onChange(On.target.value)})("blur",function(){return ue.onTouched()})},inputs:{compareWith:"compareWith"},features:[_._Bn([Us]),_.qOj]}),J})(),Ia=(()=>{class J{constructor(G,ue,gt){this._element=G,this._renderer=ue,this._select=gt,this._select&&(this.id=this._select._registerOption())}set ngValue(G){null!=this._select&&(this._select._optionMap.set(this.id,G),this._setElementValue(Ya(this.id,G)),this._select.writeValue(this._select.value))}set value(G){this._setElementValue(G),this._select&&this._select.writeValue(this._select.value)}_setElementValue(G){this._renderer.setProperty(this._element.nativeElement,"value",G)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(_.SBq),_.Y36(_.Qsj),_.Y36(ma,9))},J.\u0275dir=_.lG2({type:J,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),J})();const qo={provide:Xt,useExisting:(0,_.Gpc)(()=>bs),multi:!0};function Co(J,q){return null==J?`${q}`:("string"==typeof q&&(q=`'${q}'`),q&&"object"==typeof q&&(q="Object"),`${J}: ${q}`.slice(0,50))}let bs=(()=>{class J extends jt{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(G){this._compareWith=G}writeValue(G){let ue;if(this.value=G,Array.isArray(G)){const gt=G.map(On=>this._getOptionId(On));ue=(On,Mi)=>{On._setSelected(gt.indexOf(Mi.toString())>-1)}}else ue=(gt,On)=>{gt._setSelected(!1)};this._optionMap.forEach(ue)}registerOnChange(G){this.onChange=ue=>{const gt=[],On=ue.selectedOptions;if(void 0!==On){const Mi=On;for(let to=0;to<Mi.length;to++){const ws=this._getOptionValue(Mi[to].value);gt.push(ws)}}else{const Mi=ue.options;for(let to=0;to<Mi.length;to++){const Ps=Mi[to];if(Ps.selected){const ws=this._getOptionValue(Ps.value);gt.push(ws)}}}this.value=gt,G(gt)}}_registerOption(G){const ue=(this._idCounter++).toString();return this._optionMap.set(ue,G),ue}_getOptionId(G){for(const ue of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(ue)._value,G))return ue;return null}_getOptionValue(G){const ue=function Aa(J){return J.split(":")[0]}(G);return this._optionMap.has(ue)?this._optionMap.get(ue)._value:G}}return J.\u0275fac=function(){let q;return function(ue){return(q||(q=_.n5z(J)))(ue||J)}}(),J.\u0275dir=_.lG2({type:J,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(G,ue){1&G&&_.NdJ("change",function(On){return ue.onChange(On.target)})("blur",function(){return ue.onTouched()})},inputs:{compareWith:"compareWith"},features:[_._Bn([qo]),_.qOj]}),J})(),Is=(()=>{class J{constructor(G,ue,gt){this._element=G,this._renderer=ue,this._select=gt,this._select&&(this.id=this._select._registerOption(this))}set ngValue(G){null!=this._select&&(this._value=G,this._setElementValue(Co(this.id,G)),this._select.writeValue(this._select.value))}set value(G){this._select?(this._value=G,this._setElementValue(Co(this.id,G)),this._select.writeValue(this._select.value)):this._setElementValue(G)}_setElementValue(G){this._renderer.setProperty(this._element.nativeElement,"value",G)}_setSelected(G){this._renderer.setProperty(this._element.nativeElement,"selected",G)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return J.\u0275fac=function(G){return new(G||J)(_.Y36(_.SBq),_.Y36(_.Qsj),_.Y36(bs,9))},J.\u0275dir=_.lG2({type:J,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),J})(),rs=(()=>{class J{}return J.\u0275fac=function(G){return new(G||J)},J.\u0275mod=_.oAB({type:J}),J.\u0275inj=_.cJS({imports:[Po]}),J})(),va=(()=>{class J{}return J.\u0275fac=function(G){return new(G||J)},J.\u0275mod=_.oAB({type:J}),J.\u0275inj=_.cJS({imports:[rs]}),J})(),Qa=(()=>{class J{static withConfig(G){return{ngModule:J,providers:[{provide:na,useValue:G.warnOnNgModelWithFormControl}]}}}return J.\u0275fac=function(G){return new(G||J)},J.\u0275mod=_.oAB({type:J}),J.\u0275inj=_.cJS({imports:[rs]}),J})();class Jt extends Ae{constructor(q,G,ue){super(Se(G),nt(ue,G)),this.controls=q,this._initObservables(),this._setUpdateStrategy(G),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(q){return this.controls[this._adjustIndex(q)]}push(q,G={}){this.controls.push(q),this._registerControl(q),this.updateValueAndValidity({emitEvent:G.emitEvent}),this._onCollectionChange()}insert(q,G,ue={}){this.controls.splice(q,0,G),this._registerControl(G),this.updateValueAndValidity({emitEvent:ue.emitEvent})}removeAt(q,G={}){let ue=this._adjustIndex(q);ue<0&&(ue=0),this.controls[ue]&&this.controls[ue]._registerOnCollectionChange(()=>{}),this.controls.splice(ue,1),this.updateValueAndValidity({emitEvent:G.emitEvent})}setControl(q,G,ue={}){let gt=this._adjustIndex(q);gt<0&&(gt=0),this.controls[gt]&&this.controls[gt]._registerOnCollectionChange(()=>{}),this.controls.splice(gt,1),G&&(this.controls.splice(gt,0,G),this._registerControl(G)),this.updateValueAndValidity({emitEvent:ue.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(q,G={}){wt(this,0,q),q.forEach((ue,gt)=>{Ke(this,!1,gt),this.at(gt).setValue(ue,{onlySelf:!0,emitEvent:G.emitEvent})}),this.updateValueAndValidity(G)}patchValue(q,G={}){null!=q&&(q.forEach((ue,gt)=>{this.at(gt)&&this.at(gt).patchValue(ue,{onlySelf:!0,emitEvent:G.emitEvent})}),this.updateValueAndValidity(G))}reset(q=[],G={}){this._forEachChild((ue,gt)=>{ue.reset(q[gt],{onlySelf:!0,emitEvent:G.emitEvent})}),this._updatePristine(G),this._updateTouched(G),this.updateValueAndValidity(G)}getRawValue(){return this.controls.map(q=>q.getRawValue())}clear(q={}){this.controls.length<1||(this._forEachChild(G=>G._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:q.emitEvent}))}_adjustIndex(q){return q<0?q+this.length:q}_syncPendingControls(){let q=this.controls.reduce((G,ue)=>!!ue._syncPendingControls()||G,!1);return q&&this.updateValueAndValidity({onlySelf:!0}),q}_forEachChild(q){this.controls.forEach((G,ue)=>{q(G,ue)})}_updateValue(){this.value=this.controls.filter(q=>q.enabled||this.disabled).map(q=>q.value)}_anyControls(q){return this.controls.some(G=>G.enabled&&q(G))}_setUpControls(){this._forEachChild(q=>this._registerControl(q))}_allControlsDisabled(){for(const q of this.controls)if(q.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(q){q.setParent(this),q._registerOnCollectionChange(this._onCollectionChange)}_find(q){return this.at(q)??null}}function el(J){return!!J&&(void 0!==J.asyncValidators||void 0!==J.validators||void 0!==J.updateOn)}let Lr=(()=>{class J{constructor(){this.useNonNullable=!1}get nonNullable(){const G=new J;return G.useNonNullable=!0,G}group(G,ue=null){const gt=this._reduceControls(G);let On={};return el(ue)?On=ue:null!==ue&&(On.validators=ue.validator,On.asyncValidators=ue.asyncValidator),new ye(gt,On)}record(G,ue=null){const gt=this._reduceControls(G);return new Pe(gt,ue)}control(G,ue,gt){let On={};return this.useNonNullable?(el(ue)?On=ue:(On.validators=ue,On.asyncValidators=gt),new Er(G,{...On,nonNullable:!0})):new Er(G,ue,gt)}array(G,ue,gt){const On=G.map(Mi=>this._createControl(Mi));return new Jt(On,ue,gt)}_reduceControls(G){const ue={};return Object.keys(G).forEach(gt=>{ue[gt]=this._createControl(G[gt])}),ue}_createControl(G){return G instanceof Er||G instanceof Ae?G:Array.isArray(G)?this.control(G[0],G.length>1?G[1]:null,G.length>2?G[2]:null):this.control(G)}}return J.\u0275fac=function(G){return new(G||J)},J.\u0275prov=_.Yz7({token:J,factory:J.\u0275fac,providedIn:Qa}),J})()},1481:(Yn,Ut,he)=>{"use strict";he.d(Ut,{Dx:()=>Mt,b2:()=>pr,q6:()=>nr});var _=he(6895),Q=he(1571);class ot extends _.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends ot{static makeCurrent(){(0,_.HT)(new c)}onAndCancel(ye,be,Ze){return ye.addEventListener(be,Ze,!1),()=>{ye.removeEventListener(be,Ze,!1)}}dispatchEvent(ye,be){ye.dispatchEvent(be)}remove(ye){ye.parentNode&&ye.parentNode.removeChild(ye)}createElement(ye,be){return(be=be||this.getDefaultDocument()).createElement(ye)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ye){return ye.nodeType===Node.ELEMENT_NODE}isShadowRoot(ye){return ye instanceof DocumentFragment}getGlobalEventTarget(ye,be){return"window"===be?window:"document"===be?ye:"body"===be?ye.body:null}getBaseHref(ye){const be=function Vt(){return ze=ze||document.querySelector("base"),ze?ze.getAttribute("href"):null}();return null==be?null:function st(Ae){Ft=Ft||document.createElement("a"),Ft.setAttribute("href",Ae);const ye=Ft.pathname;return"/"===ye.charAt(0)?ye:`/${ye}`}(be)}resetBaseElement(){ze=null}getUserAgent(){return window.navigator.userAgent}getCookie(ye){return(0,_.Mx)(document.cookie,ye)}}let Ft,ze=null;const xt=new Q.OlP("TRANSITION_ID"),Et=[{provide:Q.ip1,useFactory:function ut(Ae,ye,be){return()=>{be.get(Q.CZH).donePromise.then(()=>{const Ze=(0,_.q)(),Pe=ye.querySelectorAll(`style[ng-transition="${Ae}"]`);for(let ft=0;ft<Pe.length;ft++)Ze.remove(Pe[ft])})}},deps:[xt,_.K0,Q.zs3],multi:!0}];let dn=(()=>{class Ae{build(){return new XMLHttpRequest}}return Ae.\u0275fac=function(be){return new(be||Ae)},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})();const jt=new Q.OlP("EventManagerPlugins");let Xt=(()=>{class Ae{constructor(be,Ze){this._zone=Ze,this._eventNameToPlugin=new Map,be.forEach(Pe=>Pe.manager=this),this._plugins=be.slice().reverse()}addEventListener(be,Ze,Pe){return this._findPluginFor(Ze).addEventListener(be,Ze,Pe)}addGlobalEventListener(be,Ze,Pe){return this._findPluginFor(Ze).addGlobalEventListener(be,Ze,Pe)}getZone(){return this._zone}_findPluginFor(be){const Ze=this._eventNameToPlugin.get(be);if(Ze)return Ze;const Pe=this._plugins;for(let ft=0;ft<Pe.length;ft++){const qt=Pe[ft];if(qt.supports(be))return this._eventNameToPlugin.set(be,qt),qt}throw new Error(`No event manager plugin found for event ${be}`)}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(jt),Q.LFG(Q.R0b))},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})();class Gt{constructor(ye){this._doc=ye}addGlobalEventListener(ye,be,Ze){const Pe=(0,_.q)().getGlobalEventTarget(this._doc,ye);if(!Pe)throw new Error(`Unsupported event target ${Pe} for event ${be}`);return this.addEventListener(Pe,be,Ze)}}let xn=(()=>{class Ae{constructor(){this._stylesSet=new Set}addStyles(be){const Ze=new Set;be.forEach(Pe=>{this._stylesSet.has(Pe)||(this._stylesSet.add(Pe),Ze.add(Pe))}),this.onStylesAdded(Ze)}onStylesAdded(be){}getAllStyles(){return Array.from(this._stylesSet)}}return Ae.\u0275fac=function(be){return new(be||Ae)},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})(),on=(()=>{class Ae extends xn{constructor(be){super(),this._doc=be,this._hostNodes=new Map,this._hostNodes.set(be.head,[])}_addStylesToHost(be,Ze,Pe){be.forEach(ft=>{const qt=this._doc.createElement("style");qt.textContent=ft,Pe.push(Ze.appendChild(qt))})}addHost(be){const Ze=[];this._addStylesToHost(this._stylesSet,be,Ze),this._hostNodes.set(be,Ze)}removeHost(be){const Ze=this._hostNodes.get(be);Ze&&Ze.forEach(vn),this._hostNodes.delete(be)}onStylesAdded(be){this._hostNodes.forEach((Ze,Pe)=>{this._addStylesToHost(be,Pe,Ze)})}ngOnDestroy(){this._hostNodes.forEach(be=>be.forEach(vn))}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(_.K0))},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})();function vn(Ae){(0,_.q)().remove(Ae)}const ki={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},At=/%COMP%/g;function it(Ae,ye,be){for(let Ze=0;Ze<ye.length;Ze++){let Pe=ye[Ze];Array.isArray(Pe)?it(Ae,Pe,be):(Pe=Pe.replace(At,Ae),be.push(Pe))}return be}function ct(Ae){return ye=>{if("__ngUnwrap__"===ye)return Ae;!1===Ae(ye)&&(ye.preventDefault(),ye.returnValue=!1)}}let dt=(()=>{class Ae{constructor(be,Ze,Pe){this.eventManager=be,this.sharedStylesHost=Ze,this.appId=Pe,this.rendererByCompId=new Map,this.defaultRenderer=new _n(be)}createRenderer(be,Ze){if(!be||!Ze)return this.defaultRenderer;switch(Ze.encapsulation){case Q.ifc.Emulated:{let Pe=this.rendererByCompId.get(Ze.id);return Pe||(Pe=new Di(this.eventManager,this.sharedStylesHost,Ze,this.appId),this.rendererByCompId.set(Ze.id,Pe)),Pe.applyToHost(be),Pe}case 1:case Q.ifc.ShadowDom:return new Kn(this.eventManager,this.sharedStylesHost,be,Ze);default:if(!this.rendererByCompId.has(Ze.id)){const Pe=it(Ze.id,Ze.styles,[]);this.sharedStylesHost.addStyles(Pe),this.rendererByCompId.set(Ze.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(Xt),Q.LFG(on),Q.LFG(Q.AFp))},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})();class _n{constructor(ye){this.eventManager=ye,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ye,be){return be?document.createElementNS(ki[be]||be,ye):document.createElement(ye)}createComment(ye){return document.createComment(ye)}createText(ye){return document.createTextNode(ye)}appendChild(ye,be){(An(ye)?ye.content:ye).appendChild(be)}insertBefore(ye,be,Ze){ye&&(An(ye)?ye.content:ye).insertBefore(be,Ze)}removeChild(ye,be){ye&&ye.removeChild(be)}selectRootElement(ye,be){let Ze="string"==typeof ye?document.querySelector(ye):ye;if(!Ze)throw new Error(`The selector "${ye}" did not match any elements`);return be||(Ze.textContent=""),Ze}parentNode(ye){return ye.parentNode}nextSibling(ye){return ye.nextSibling}setAttribute(ye,be,Ze,Pe){if(Pe){be=Pe+":"+be;const ft=ki[Pe];ft?ye.setAttributeNS(ft,be,Ze):ye.setAttribute(be,Ze)}else ye.setAttribute(be,Ze)}removeAttribute(ye,be,Ze){if(Ze){const Pe=ki[Ze];Pe?ye.removeAttributeNS(Pe,be):ye.removeAttribute(`${Ze}:${be}`)}else ye.removeAttribute(be)}addClass(ye,be){ye.classList.add(be)}removeClass(ye,be){ye.classList.remove(be)}setStyle(ye,be,Ze,Pe){Pe&(Q.JOm.DashCase|Q.JOm.Important)?ye.style.setProperty(be,Ze,Pe&Q.JOm.Important?"important":""):ye.style[be]=Ze}removeStyle(ye,be,Ze){Ze&Q.JOm.DashCase?ye.style.removeProperty(be):ye.style[be]=""}setProperty(ye,be,Ze){ye[be]=Ze}setValue(ye,be){ye.nodeValue=be}listen(ye,be,Ze){return"string"==typeof ye?this.eventManager.addGlobalEventListener(ye,be,ct(Ze)):this.eventManager.addEventListener(ye,be,ct(Ze))}}function An(Ae){return"TEMPLATE"===Ae.tagName&&void 0!==Ae.content}class Di extends _n{constructor(ye,be,Ze,Pe){super(ye),this.component=Ze;const ft=it(Pe+"-"+Ze.id,Ze.styles,[]);be.addStyles(ft),this.contentAttr=function Rt(Ae){return"_ngcontent-%COMP%".replace(At,Ae)}(Pe+"-"+Ze.id),this.hostAttr=function Kt(Ae){return"_nghost-%COMP%".replace(At,Ae)}(Pe+"-"+Ze.id)}applyToHost(ye){super.setAttribute(ye,this.hostAttr,"")}createElement(ye,be){const Ze=super.createElement(ye,be);return super.setAttribute(Ze,this.contentAttr,""),Ze}}class Kn extends _n{constructor(ye,be,Ze,Pe){super(ye),this.sharedStylesHost=be,this.hostEl=Ze,this.shadowRoot=Ze.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const ft=it(Pe.id,Pe.styles,[]);for(let qt=0;qt<ft.length;qt++){const Rn=document.createElement("style");Rn.textContent=ft[qt],this.shadowRoot.appendChild(Rn)}}nodeOrShadowRoot(ye){return ye===this.hostEl?this.shadowRoot:ye}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(ye,be){return super.appendChild(this.nodeOrShadowRoot(ye),be)}insertBefore(ye,be,Ze){return super.insertBefore(this.nodeOrShadowRoot(ye),be,Ze)}removeChild(ye,be){return super.removeChild(this.nodeOrShadowRoot(ye),be)}parentNode(ye){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ye)))}}let Ni=(()=>{class Ae extends Gt{constructor(be){super(be)}supports(be){return!0}addEventListener(be,Ze,Pe){return be.addEventListener(Ze,Pe,!1),()=>this.removeEventListener(be,Ze,Pe)}removeEventListener(be,Ze,Pe){return be.removeEventListener(Ze,Pe)}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(_.K0))},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})();const kr=["alt","control","meta","shift"],oi={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ei={alt:Ae=>Ae.altKey,control:Ae=>Ae.ctrlKey,meta:Ae=>Ae.metaKey,shift:Ae=>Ae.shiftKey};let ko=(()=>{class Ae extends Gt{constructor(be){super(be)}supports(be){return null!=Ae.parseEventName(be)}addEventListener(be,Ze,Pe){const ft=Ae.parseEventName(Ze),qt=Ae.eventCallback(ft.fullKey,Pe,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,_.q)().onAndCancel(be,ft.domEventName,qt))}static parseEventName(be){const Ze=be.toLowerCase().split("."),Pe=Ze.shift();if(0===Ze.length||"keydown"!==Pe&&"keyup"!==Pe)return null;const ft=Ae._normalizeKey(Ze.pop());let qt="",Rn=Ze.indexOf("code");if(Rn>-1&&(Ze.splice(Rn,1),qt="code."),kr.forEach(jn=>{const In=Ze.indexOf(jn);In>-1&&(Ze.splice(In,1),qt+=jn+".")}),qt+=ft,0!=Ze.length||0===ft.length)return null;const Vn={};return Vn.domEventName=Pe,Vn.fullKey=qt,Vn}static matchEventFullKeyCode(be,Ze){let Pe=oi[be.key]||be.key,ft="";return Ze.indexOf("code.")>-1&&(Pe=be.code,ft="code."),!(null==Pe||!Pe)&&(Pe=Pe.toLowerCase()," "===Pe?Pe="space":"."===Pe&&(Pe="dot"),kr.forEach(qt=>{qt!==Pe&&(0,ei[qt])(be)&&(ft+=qt+".")}),ft+=Pe,ft===Ze)}static eventCallback(be,Ze,Pe){return ft=>{Ae.matchEventFullKeyCode(ft,be)&&Pe.runGuarded(()=>Ze(ft))}}static _normalizeKey(be){return"esc"===be?"escape":be}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(_.K0))},Ae.\u0275prov=Q.Yz7({token:Ae,factory:Ae.\u0275fac}),Ae})();const nr=(0,Q.eFA)(Q._c5,"browser",[{provide:Q.Lbi,useValue:_.bD},{provide:Q.g9A,useValue:function Ur(){c.makeCurrent()},multi:!0},{provide:_.K0,useFactory:function cr(){return(0,Q.RDi)(document),document},deps:[]}]),si=new Q.OlP(""),Ji=[{provide:Q.rWj,useClass:class lt{addToWindow(ye){Q.dqk.getAngularTestability=(Ze,Pe=!0)=>{const ft=ye.findTestabilityInTree(Ze,Pe);if(null==ft)throw new Error("Could not find testability for element.");return ft},Q.dqk.getAllAngularTestabilities=()=>ye.getAllTestabilities(),Q.dqk.getAllAngularRootElements=()=>ye.getAllRootElements(),Q.dqk.frameworkStabilizers||(Q.dqk.frameworkStabilizers=[]),Q.dqk.frameworkStabilizers.push(Ze=>{const Pe=Q.dqk.getAllAngularTestabilities();let ft=Pe.length,qt=!1;const Rn=function(Vn){qt=qt||Vn,ft--,0==ft&&Ze(qt)};Pe.forEach(function(Vn){Vn.whenStable(Rn)})})}findTestabilityInTree(ye,be,Ze){return null==be?null:ye.getTestability(be)??(Ze?(0,_.q)().isShadowRoot(be)?this.findTestabilityInTree(ye,be.host,!0):this.findTestabilityInTree(ye,be.parentElement,!0):null)}},deps:[]},{provide:Q.lri,useClass:Q.dDg,deps:[Q.R0b,Q.eoX,Q.rWj]},{provide:Q.dDg,useClass:Q.dDg,deps:[Q.R0b,Q.eoX,Q.rWj]}],jr=[{provide:Q.zSh,useValue:"root"},{provide:Q.qLn,useFactory:function vi(){return new Q.qLn},deps:[]},{provide:jt,useClass:Ni,multi:!0,deps:[_.K0,Q.R0b,Q.Lbi]},{provide:jt,useClass:ko,multi:!0,deps:[_.K0]},{provide:dt,useClass:dt,deps:[Xt,on,Q.AFp]},{provide:Q.FYo,useExisting:dt},{provide:xn,useExisting:on},{provide:on,useClass:on,deps:[_.K0]},{provide:Xt,useClass:Xt,deps:[jt,Q.R0b]},{provide:_.JF,useClass:dn,deps:[]},[]];let pr=(()=>{class Ae{constructor(be){}static withServerTransition(be){return{ngModule:Ae,providers:[{provide:Q.AFp,useValue:be.appId},{provide:xt,useExisting:Q.AFp},Et]}}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(si,12))},Ae.\u0275mod=Q.oAB({type:Ae}),Ae.\u0275inj=Q.cJS({providers:[...jr,...Ji],imports:[_.ez,Q.hGG]}),Ae})(),Mt=(()=>{class Ae{constructor(be){this._doc=be}getTitle(){return this._doc.title}setTitle(be){this._doc.title=be||""}}return Ae.\u0275fac=function(be){return new(be||Ae)(Q.LFG(_.K0))},Ae.\u0275prov=Q.Yz7({token:Ae,factory:function(be){let Ze=null;return Ze=be?new be:function ts(){return new Mt((0,Q.LFG)(_.K0))}(),Ze},providedIn:"root"}),Ae})();typeof window<"u"&&window},9371:(Yn,Ut,he)=>{"use strict";he.d(Ut,{F0:()=>no,rH:()=>ss,yS:()=>Ba,Bz:()=>Kc,lC:()=>Is});var _=he(1571),Q=he(2076),ot=he(9646),c=he(1135);const Vt=(0,he(3888).d)(O=>function(){O(this),this.name="EmptyError",this.message="no elements in sequence"});var Ft=he(9841),st=he(7272),xt=he(9751),ut=he(8421);function Et(O){return new xt.y(k=>{(0,ut.Xf)(O()).subscribe(k)})}var lt=he(9635),dn=he(576);function jt(O,k){const A=(0,dn.m)(O)?O:()=>O,U=Y=>Y.error(A());return new xt.y(k?Y=>k.schedule(U,0,Y):U)}var Xt=he(515),Gt=he(727),xn=he(4482),on=he(5403);function vn(){return(0,xn.e)((O,k)=>{let A=null;O._refCount++;const U=(0,on.x)(k,void 0,void 0,void 0,()=>{if(!O||O._refCount<=0||0<--O._refCount)return void(A=null);const Y=O._connection,ae=A;A=null,Y&&(!ae||Y===ae)&&Y.unsubscribe(),k.unsubscribe()});O.subscribe(U),U.closed||(A=O.connect())})}class ki extends xt.y{constructor(k,A){super(),this.source=k,this.subjectFactory=A,this._subject=null,this._refCount=0,this._connection=null,(0,xn.A)(k)&&(this.lift=k.lift)}_subscribe(k){return this.getSubject().subscribe(k)}getSubject(){const k=this._subject;return(!k||k.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:k}=this;this._subject=this._connection=null,k?.unsubscribe()}connect(){let k=this._connection;if(!k){k=this._connection=new Gt.w0;const A=this.getSubject();k.add(this.source.subscribe((0,on.x)(A,void 0,()=>{this._teardown(),A.complete()},U=>{this._teardown(),A.error(U)},()=>this._teardown()))),k.closed&&(this._connection=null,k=Gt.w0.EMPTY)}return k}refCount(){return vn()(this)}}var At=he(7579),St=he(6895),Zt=he(4004),Qt=he(3900),tn=he(5698),Rt=he(8675),Kt=he(9300),it=he(5577);function ct(O){return(0,xn.e)((k,A)=>{let U=!1;k.subscribe((0,on.x)(A,Y=>{U=!0,A.next(Y)},()=>{U||A.next(O),A.complete()}))})}function It(O=dt){return(0,xn.e)((k,A)=>{let U=!1;k.subscribe((0,on.x)(A,Y=>{U=!0,A.next(Y)},()=>U?A.complete():A.error(O())))})}function dt(){return new Vt}var _n=he(4671);function rn(O,k){const A=arguments.length>=2;return U=>U.pipe(O?(0,Kt.h)((Y,ae)=>O(Y,ae,U)):_n.y,(0,tn.q)(1),A?ct(k):It(()=>new Vt))}var Zn=he(4351),An=he(8505),Di=he(262);function Kn(O,k,A,U,Y){return(ae,Ie)=>{let ke=A,Tt=k,En=0;ae.subscribe((0,on.x)(Ie,gi=>{const gn=En++;Tt=ke?O(Tt,gi,gn):(ke=!0,gi),U&&Ie.next(Tt)},Y&&(()=>{ke&&Ie.next(Tt),Ie.complete()})))}}function Ni(O,k){return(0,xn.e)(Kn(O,k,arguments.length>=2,!0))}function kr(O){return O<=0?()=>Xt.E:(0,xn.e)((k,A)=>{let U=[];k.subscribe((0,on.x)(A,Y=>{U.push(Y),O<U.length&&U.shift()},()=>{for(const Y of U)A.next(Y);A.complete()},void 0,()=>{U=null}))})}function oi(O,k){const A=arguments.length>=2;return U=>U.pipe(O?(0,Kt.h)((Y,ae)=>O(Y,ae,U)):_n.y,kr(1),A?ct(k):It(()=>new Vt))}var ko=he(9718);function Xi(O){return(0,xn.e)((k,A)=>{try{k.subscribe(A)}finally{A.add(O)}})}var Ao=he(8189),vr=he(1481);const ti="primary",ai=Symbol("RouteTitle");class Ur{constructor(k){this.params=k||{}}has(k){return Object.prototype.hasOwnProperty.call(this.params,k)}get(k){if(this.has(k)){const A=this.params[k];return Array.isArray(A)?A[0]:A}return null}getAll(k){if(this.has(k)){const A=this.params[k];return Array.isArray(A)?A:[A]}return[]}get keys(){return Object.keys(this.params)}}function vi(O){return new Ur(O)}function cr(O,k,A){const U=A.path.split("/");if(U.length>O.length||"full"===A.pathMatch&&(k.hasChildren()||U.length<O.length))return null;const Y={};for(let ae=0;ae<U.length;ae++){const Ie=U[ae],ke=O[ae];if(Ie.startsWith(":"))Y[Ie.substring(1)]=ke;else if(Ie!==ke.path)return null}return{consumed:O.slice(0,U.length),posParams:Y}}function nr(O,k){const A=O?Object.keys(O):void 0,U=k?Object.keys(k):void 0;if(!A||!U||A.length!=U.length)return!1;let Y;for(let ae=0;ae<A.length;ae++)if(Y=A[ae],!si(O[Y],k[Y]))return!1;return!0}function si(O,k){if(Array.isArray(O)&&Array.isArray(k)){if(O.length!==k.length)return!1;const A=[...O].sort(),U=[...k].sort();return A.every((Y,ae)=>U[ae]===Y)}return O===k}function Ji(O){return Array.prototype.concat.apply([],O)}function jr(O){return O.length>0?O[O.length-1]:null}function zi(O,k){for(const A in O)O.hasOwnProperty(A)&&k(O[A],A)}function zn(O){return(0,_.CqO)(O)?O:(0,_.QGY)(O)?(0,Q.D)(Promise.resolve(O)):(0,ot.of)(O)}const Mt={exact:function Nt(O,k,A){if(!di(O.segments,k.segments)||!Pn(O.segments,k.segments,A)||O.numberOfChildren!==k.numberOfChildren)return!1;for(const U in k.children)if(!O.children[U]||!Nt(O.children[U],k.children[U],A))return!1;return!0},subset:ni},Ve={exact:function Ct(O,k){return nr(O,k)},subset:function Un(O,k){return Object.keys(k).length<=Object.keys(O).length&&Object.keys(k).every(A=>si(O[A],k[A]))},ignored:()=>!0};function Oe(O,k,A){return Mt[A.paths](O.root,k.root,A.matrixParams)&&Ve[A.queryParams](O.queryParams,k.queryParams)&&!("exact"===A.fragment&&O.fragment!==k.fragment)}function ni(O,k,A){return ui(O,k,k.segments,A)}function ui(O,k,A,U){if(O.segments.length>A.length){const Y=O.segments.slice(0,A.length);return!(!di(Y,A)||k.hasChildren()||!Pn(Y,A,U))}if(O.segments.length===A.length){if(!di(O.segments,A)||!Pn(O.segments,A,U))return!1;for(const Y in k.children)if(!O.children[Y]||!ni(O.children[Y],k.children[Y],U))return!1;return!0}{const Y=A.slice(0,O.segments.length),ae=A.slice(O.segments.length);return!!(di(O.segments,Y)&&Pn(O.segments,Y,U)&&O.children[ti])&&ui(O.children[ti],k,ae,U)}}function Pn(O,k,A){return k.every((U,Y)=>Ve[A](O[Y].parameters,U.parameters))}class Ki{constructor(k,A,U){this.root=k,this.queryParams=A,this.fragment=U}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vi(this.queryParams)),this._queryParamMap}toString(){return Wi.serialize(this)}}class Tn{constructor(k,A){this.segments=k,this.children=A,this.parent=null,zi(A,(U,Y)=>U.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return dr(this)}}class qi{constructor(k,A){this.path=k,this.parameters=A}get parameterMap(){return this._parameterMap||(this._parameterMap=vi(this.parameters)),this._parameterMap}toString(){return nt(this)}}function di(O,k){return O.length===k.length&&O.every((A,U)=>A.path===k[U].path)}let br=(()=>{class O{}return O.\u0275fac=function(A){return new(A||O)},O.\u0275prov=_.Yz7({token:O,factory:function(){return new Gr},providedIn:"root"}),O})();class Gr{parse(k){const A=new Pe(k);return new Ki(A.parseRootSegment(),A.parseQueryParams(),A.parseFragment())}serialize(k){const A=`/${mo(k.root,!0)}`,U=function We(O){const k=Object.keys(O).map(A=>{const U=O[A];return Array.isArray(U)?U.map(Y=>`${te(A)}=${te(Y)}`).join("&"):`${te(A)}=${te(U)}`}).filter(A=>!!A);return k.length?`?${k.join("&")}`:""}(k.queryParams);return`${A}${U}${"string"==typeof k.fragment?`#${function re(O){return encodeURI(O)}(k.fragment)}`:""}`}}const Wi=new Gr;function dr(O){return O.segments.map(k=>nt(k)).join("/")}function mo(O,k){if(!O.hasChildren())return dr(O);if(k){const A=O.children[ti]?mo(O.children[ti],!1):"",U=[];return zi(O.children,(Y,ae)=>{ae!==ti&&U.push(`${ae}:${mo(Y,!1)}`)}),U.length>0?`${A}(${U.join("//")})`:A}{const A=function Ci(O,k){let A=[];return zi(O.children,(U,Y)=>{Y===ti&&(A=A.concat(k(U,Y)))}),zi(O.children,(U,Y)=>{Y!==ti&&(A=A.concat(k(U,Y)))}),A}(O,(U,Y)=>Y===ti?[mo(O.children[ti],!1)]:[`${Y}:${mo(U,!1)}`]);return 1===Object.keys(O.children).length&&null!=O.children[ti]?`${dr(O)}/${A[0]}`:`${dr(O)}/(${A.join("//")})`}}function _e(O){return encodeURIComponent(O).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function te(O){return _e(O).replace(/%3B/gi,";")}function xe(O){return _e(O).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Se(O){return decodeURIComponent(O)}function $e(O){return Se(O.replace(/\+/g,"%20"))}function nt(O){return`${xe(O.path)}${function et(O){return Object.keys(O).map(k=>`;${xe(k)}=${xe(O[k])}`).join("")}(O.parameters)}`}const Ke=/^[^\/()?;=#]+/;function wt(O){const k=O.match(Ke);return k?k[0]:""}const Ae=/^[^=?&#]+/,be=/^[^&#]+/;class Pe{constructor(k){this.url=k,this.remaining=k}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Tn([],{}):new Tn([],this.parseChildren())}parseQueryParams(){const k={};if(this.consumeOptional("?"))do{this.parseQueryParam(k)}while(this.consumeOptional("&"));return k}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const k=[];for(this.peekStartsWith("(")||k.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),k.push(this.parseSegment());let A={};this.peekStartsWith("/(")&&(this.capture("/"),A=this.parseParens(!0));let U={};return this.peekStartsWith("(")&&(U=this.parseParens(!1)),(k.length>0||Object.keys(A).length>0)&&(U[ti]=new Tn(k,A)),U}parseSegment(){const k=wt(this.remaining);if(""===k&&this.peekStartsWith(";"))throw new _.vHH(4009,!1);return this.capture(k),new qi(Se(k),this.parseMatrixParams())}parseMatrixParams(){const k={};for(;this.consumeOptional(";");)this.parseParam(k);return k}parseParam(k){const A=wt(this.remaining);if(!A)return;this.capture(A);let U="";if(this.consumeOptional("=")){const Y=wt(this.remaining);Y&&(U=Y,this.capture(U))}k[Se(A)]=Se(U)}parseQueryParam(k){const A=function ye(O){const k=O.match(Ae);return k?k[0]:""}(this.remaining);if(!A)return;this.capture(A);let U="";if(this.consumeOptional("=")){const Ie=function Ze(O){const k=O.match(be);return k?k[0]:""}(this.remaining);Ie&&(U=Ie,this.capture(U))}const Y=$e(A),ae=$e(U);if(k.hasOwnProperty(Y)){let Ie=k[Y];Array.isArray(Ie)||(Ie=[Ie],k[Y]=Ie),Ie.push(ae)}else k[Y]=ae}parseParens(k){const A={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const U=wt(this.remaining),Y=this.remaining[U.length];if("/"!==Y&&")"!==Y&&";"!==Y)throw new _.vHH(4010,!1);let ae;U.indexOf(":")>-1?(ae=U.slice(0,U.indexOf(":")),this.capture(ae),this.capture(":")):k&&(ae=ti);const Ie=this.parseChildren();A[ae]=1===Object.keys(Ie).length?Ie[ti]:new Tn([],Ie),this.consumeOptional("//")}return A}peekStartsWith(k){return this.remaining.startsWith(k)}consumeOptional(k){return!!this.peekStartsWith(k)&&(this.remaining=this.remaining.substring(k.length),!0)}capture(k){if(!this.consumeOptional(k))throw new _.vHH(4011,!1)}}function ft(O){return O.segments.length>0?new Tn([],{[ti]:O}):O}function qt(O){const k={};for(const U of Object.keys(O.children)){const ae=qt(O.children[U]);(ae.segments.length>0||ae.hasChildren())&&(k[U]=ae)}return function Rn(O){if(1===O.numberOfChildren&&O.children[ti]){const k=O.children[ti];return new Tn(O.segments.concat(k.segments),k.children)}return O}(new Tn(O.segments,k))}function Vn(O){return O instanceof Ki}function $i(O,k,A,U,Y){if(0===A.length)return Tr(k.root,k.root,k.root,U,Y);const ae=function ir(O){if("string"==typeof O[0]&&1===O.length&&"/"===O[0])return new zs(!0,0,O);let k=0,A=!1;const U=O.reduce((Y,ae,Ie)=>{if("object"==typeof ae&&null!=ae){if(ae.outlets){const ke={};return zi(ae.outlets,(Tt,En)=>{ke[En]="string"==typeof Tt?Tt.split("/"):Tt}),[...Y,{outlets:ke}]}if(ae.segmentPath)return[...Y,ae.segmentPath]}return"string"!=typeof ae?[...Y,ae]:0===Ie?(ae.split("/").forEach((ke,Tt)=>{0==Tt&&"."===ke||(0==Tt&&""===ke?A=!0:".."===ke?k++:""!=ke&&Y.push(ke))}),Y):[...Y,ae]},[]);return new zs(A,k,U)}(A);return ae.toRoot()?Tr(k.root,k.root,new Tn([],{}),U,Y):function Ie(Tt){const En=function Jn(O,k,A,U){if(O.isAbsolute)return new ln(k.root,!0,0);if(-1===U)return new ln(A,A===k.root,0);return function wr(O,k,A){let U=O,Y=k,ae=A;for(;ae>Y;){if(ae-=Y,U=U.parent,!U)throw new _.vHH(4005,!1);Y=U.segments.length}return new ln(U,!1,Y-ae)}(A,U+(Xn(O.commands[0])?0:1),O.numberOfDoubleDots)}(ae,k,O.snapshot?._urlSegment,Tt),gi=En.processChildren?Wo(En.segmentGroup,En.index,ae.commands):Sn(En.segmentGroup,En.index,ae.commands);return Tr(k.root,En.segmentGroup,gi,U,Y)}(O.snapshot?._lastPathIndex)}function Xn(O){return"object"==typeof O&&null!=O&&!O.outlets&&!O.segmentPath}function xo(O){return"object"==typeof O&&null!=O&&O.outlets}function Tr(O,k,A,U,Y){let Ie,ae={};U&&zi(U,(Tt,En)=>{ae[En]=Array.isArray(Tt)?Tt.map(gi=>`${gi}`):`${Tt}`}),Ie=O===k?A:go(O,k,A);const ke=ft(qt(Ie));return new Ki(ke,ae,Y)}function go(O,k,A){const U={};return zi(O.children,(Y,ae)=>{U[ae]=Y===k?A:go(Y,k,A)}),new Tn(O.segments,U)}class zs{constructor(k,A,U){if(this.isAbsolute=k,this.numberOfDoubleDots=A,this.commands=U,k&&U.length>0&&Xn(U[0]))throw new _.vHH(4003,!1);const Y=U.find(xo);if(Y&&Y!==jr(U))throw new _.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class ln{constructor(k,A,U){this.segmentGroup=k,this.processChildren=A,this.index=U}}function Sn(O,k,A){if(O||(O=new Tn([],{})),0===O.segments.length&&O.hasChildren())return Wo(O,k,A);const U=function ps(O,k,A){let U=0,Y=k;const ae={match:!1,pathIndex:0,commandIndex:0};for(;Y<O.segments.length;){if(U>=A.length)return ae;const Ie=O.segments[Y],ke=A[U];if(xo(ke))break;const Tt=`${ke}`,En=U<A.length-1?A[U+1]:null;if(Y>0&&void 0===Tt)break;if(Tt&&En&&"object"==typeof En&&void 0===En.outlets){if(!gs(Tt,En,Ie))return ae;U+=2}else{if(!gs(Tt,{},Ie))return ae;U++}Y++}return{match:!0,pathIndex:Y,commandIndex:U}}(O,k,A),Y=A.slice(U.commandIndex);if(U.match&&U.pathIndex<O.segments.length){const ae=new Tn(O.segments.slice(0,U.pathIndex),{});return ae.children[ti]=new Tn(O.segments.slice(U.pathIndex),O.children),Wo(ae,0,Y)}return U.match&&0===Y.length?new Tn(O.segments,{}):U.match&&!O.hasChildren()?ms(O,k,A):U.match?Wo(O,0,Y):ms(O,k,A)}function Wo(O,k,A){if(0===A.length)return new Tn(O.segments,{});{const U=function Fo(O){return xo(O[0])?O[0].outlets:{[ti]:O}}(A),Y={};return zi(U,(ae,Ie)=>{"string"==typeof ae&&(ae=[ae]),null!==ae&&(Y[Ie]=Sn(O.children[Ie],k,ae))}),zi(O.children,(ae,Ie)=>{void 0===U[Ie]&&(Y[Ie]=ae)}),new Tn(O.segments,Y)}}function ms(O,k,A){const U=O.segments.slice(0,k);let Y=0;for(;Y<A.length;){const ae=A[Y];if(xo(ae)){const Tt=lo(ae.outlets);return new Tn(U,Tt)}if(0===Y&&Xn(A[0])){U.push(new qi(O.segments[k].path,Vi(A[0]))),Y++;continue}const Ie=xo(ae)?ae.outlets[ti]:`${ae}`,ke=Y<A.length-1?A[Y+1]:null;Ie&&ke&&Xn(ke)?(U.push(new qi(Ie,Vi(ke))),Y+=2):(U.push(new qi(Ie,{})),Y++)}return new Tn(U,{})}function lo(O){const k={};return zi(O,(A,U)=>{"string"==typeof A&&(A=[A]),null!==A&&(k[U]=ms(new Tn([],{}),0,A))}),k}function Vi(O){const k={};return zi(O,(A,U)=>k[U]=`${A}`),k}function gs(O,k,A){return O==A.path&&nr(k,A.parameters)}class Cr{constructor(k,A){this.id=k,this.url=A}}class Dr extends Cr{constructor(k,A,U="imperative",Y=null){super(k,A),this.type=0,this.navigationTrigger=U,this.restoredState=Y}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Er extends Cr{constructor(k,A,U){super(k,A),this.urlAfterRedirects=U,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class qr extends Cr{constructor(k,A,U,Y){super(k,A),this.reason=U,this.code=Y,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class eo extends Cr{constructor(k,A,U,Y){super(k,A),this.error=U,this.target=Y,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Yr extends Cr{constructor(k,A,U,Y){super(k,A),this.urlAfterRedirects=U,this.state=Y,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ui extends Cr{constructor(k,A,U,Y){super(k,A),this.urlAfterRedirects=U,this.state=Y,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fa extends Cr{constructor(k,A,U,Y,ae){super(k,A),this.urlAfterRedirects=U,this.state=Y,this.shouldActivate=ae,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class _o extends Cr{constructor(k,A,U,Y){super(k,A),this.urlAfterRedirects=U,this.state=Y,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Zo extends Cr{constructor(k,A,U,Y){super(k,A),this.urlAfterRedirects=U,this.state=Y,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mr{constructor(k){this.route=k,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Wa{constructor(k){this.route=k,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Vs{constructor(k){this.snapshot=k,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fr{constructor(k){this.snapshot=k,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ms{constructor(k){this.snapshot=k,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gl{constructor(k){this.snapshot=k,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ta{constructor(k,A,U){this.routerEvent=k,this.position=A,this.anchor=U,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Ma{constructor(k){this._root=k}get root(){return this._root.value}parent(k){const A=this.pathFromRoot(k);return A.length>1?A[A.length-2]:null}children(k){const A=_l(k,this._root);return A?A.children.map(U=>U.value):[]}firstChild(k){const A=_l(k,this._root);return A&&A.children.length>0?A.children[0].value:null}siblings(k){const A=Po(k,this._root);return A.length<2?[]:A[A.length-2].children.map(Y=>Y.value).filter(Y=>Y!==k)}pathFromRoot(k){return Po(k,this._root).map(A=>A.value)}}function _l(O,k){if(O===k.value)return k;for(const A of k.children){const U=_l(O,A);if(U)return U}return null}function Po(O,k){if(O===k.value)return[k];for(const A of k.children){const U=Po(O,A);if(U.length)return U.unshift(k),U}return[]}class Lo{constructor(k,A){this.value=k,this.children=A}toString(){return`TreeNode(${this.value})`}}function _s(O){const k={};return O&&O.children.forEach(A=>k[A.value.outlet]=A),k}class dc extends Ma{constructor(k,A){super(k),this.snapshot=A,vs(this,k)}toString(){return this.snapshot.toString()}}function Za(O,k){const A=function na(O,k){const Ie=new wo([],{},{},"",{},ti,k,null,O.root,-1,{});return new qa("",new Lo(Ie,[]))}(O,k),U=new c.X([new qi("",{})]),Y=new c.X({}),ae=new c.X({}),Ie=new c.X({}),ke=new c.X(""),Tt=new pa(U,Y,Ie,ke,ae,ti,k,A.root);return Tt.snapshot=A.root,new dc(new Lo(Tt,[]),A)}class pa{constructor(k,A,U,Y,ae,Ie,ke,Tt){this.url=k,this.params=A,this.queryParams=U,this.fragment=Y,this.data=ae,this.outlet=Ie,this.component=ke,this.title=this.data?.pipe((0,Zt.U)(En=>En[ai]))??(0,ot.of)(void 0),this._futureSnapshot=Tt}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Zt.U)(k=>vi(k)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Zt.U)(k=>vi(k)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Sa(O,k="emptyOnly"){const A=O.pathFromRoot;let U=0;if("always"!==k)for(U=A.length-1;U>=1;){const Y=A[U],ae=A[U-1];if(Y.routeConfig&&""===Y.routeConfig.path)U--;else{if(ae.component)break;U--}}return function ys(O){return O.reduce((k,A)=>({params:{...k.params,...A.params},data:{...k.data,...A.data},resolve:{...A.data,...k.resolve,...A.routeConfig?.data,...A._resolvedData}}),{params:{},data:{},resolve:{}})}(A.slice(U))}class wo{constructor(k,A,U,Y,ae,Ie,ke,Tt,En,gi,gn,er){this.url=k,this.params=A,this.queryParams=U,this.fragment=Y,this.data=ae,this.outlet=Ie,this.component=ke,this.title=this.data?.[ai],this.routeConfig=Tt,this._urlSegment=En,this._lastPathIndex=gi,this._correctedLastPathIndex=er??gi,this._resolve=gn}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=vi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(U=>U.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class qa extends Ma{constructor(k,A){super(A),this.url=k,vs(this,A)}toString(){return ns(this._root)}}function vs(O,k){k.value._routerState=O,k.children.forEach(A=>vs(O,A))}function ns(O){const k=O.children.length>0?` { ${O.children.map(ns).join(", ")} } `:"";return`${O.value}${k}`}function is(O){if(O.snapshot){const k=O.snapshot,A=O._futureSnapshot;O.snapshot=A,nr(k.queryParams,A.queryParams)||O.queryParams.next(A.queryParams),k.fragment!==A.fragment&&O.fragment.next(A.fragment),nr(k.params,A.params)||O.params.next(A.params),function Hi(O,k){if(O.length!==k.length)return!1;for(let A=0;A<O.length;++A)if(!nr(O[A],k[A]))return!1;return!0}(k.url,A.url)||O.url.next(A.url),nr(k.data,A.data)||O.data.next(A.data)}else O.snapshot=O._futureSnapshot,O.data.next(O._futureSnapshot.data)}function ia(O,k){const A=nr(O.params,k.params)&&function wn(O,k){return di(O,k)&&O.every((A,U)=>nr(A.parameters,k[U].parameters))}(O.url,k.url);return A&&!(!O.parent!=!k.parent)&&(!O.parent||ia(O.parent,k.parent))}function Ss(O,k,A){if(A&&O.shouldReuseRoute(k.value,A.value.snapshot)){const U=A.value;U._futureSnapshot=k.value;const Y=function Us(O,k,A){return k.children.map(U=>{for(const Y of A.children)if(O.shouldReuseRoute(U.value,Y.value.snapshot))return Ss(O,U,Y);return Ss(O,U)})}(O,k,A);return new Lo(U,Y)}{if(O.shouldAttach(k.value)){const ae=O.retrieve(k.value);if(null!==ae){const Ie=ae.route;return Ie.value._futureSnapshot=k.value,Ie.children=k.children.map(ke=>Ss(O,ke)),Ie}}const U=function Ya(O){return new pa(new c.X(O.url),new c.X(O.params),new c.X(O.queryParams),new c.X(O.fragment),new c.X(O.data),O.outlet,O.component,O)}(k.value),Y=k.children.map(ae=>Ss(O,ae));return new Lo(U,Y)}}const Xa="ngNavigationCancelingError";function ma(O,k){const{redirectTo:A,navigationBehaviorOptions:U}=Vn(k)?{redirectTo:k,navigationBehaviorOptions:void 0}:k,Y=Ia(!1,0,k);return Y.url=A,Y.navigationBehaviorOptions=U,Y}function Ia(O,k,A){const U=new Error("NavigationCancelingError: "+(O||""));return U[Xa]=!0,U.cancellationCode=k,A&&(U.url=A),U}function qo(O){return Co(O)&&Vn(O.url)}function Co(O){return O&&O[Xa]}class Aa{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Pa,this.attachRef=null}}let Pa=(()=>{class O{constructor(){this.contexts=new Map}onChildOutletCreated(A,U){const Y=this.getOrCreateContext(A);Y.outlet=U,this.contexts.set(A,Y)}onChildOutletDestroyed(A){const U=this.getContext(A);U&&(U.outlet=null,U.attachRef=null)}onOutletDeactivated(){const A=this.contexts;return this.contexts=new Map,A}onOutletReAttached(A){this.contexts=A}getOrCreateContext(A){let U=this.getContext(A);return U||(U=new Aa,this.contexts.set(A,U)),U}getContext(A){return this.contexts.get(A)||null}}return O.\u0275fac=function(A){return new(A||O)},O.\u0275prov=_.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})();const bs=!1;let Is=(()=>{class O{constructor(A,U,Y,ae,Ie){this.parentContexts=A,this.location=U,this.changeDetector=ae,this.environmentInjector=Ie,this.activated=null,this._activatedRoute=null,this.activateEvents=new _.vpe,this.deactivateEvents=new _.vpe,this.attachEvents=new _.vpe,this.detachEvents=new _.vpe,this.name=Y||ti,A.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const A=this.parentContexts.getContext(this.name);A&&A.route&&(A.attachRef?this.attach(A.attachRef,A.route):this.activateWith(A.route,A.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new _.vHH(4012,bs);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new _.vHH(4012,bs);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new _.vHH(4012,bs);this.location.detach();const A=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(A.instance),A}attach(A,U){this.activated=A,this._activatedRoute=U,this.location.insert(A.hostView),this.attachEvents.emit(A.instance)}deactivate(){if(this.activated){const A=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(A)}}activateWith(A,U){if(this.isActivated)throw new _.vHH(4013,bs);this._activatedRoute=A;const Y=this.location,Ie=A._futureSnapshot.component,ke=this.parentContexts.getOrCreateContext(this.name).children,Tt=new Oa(A,ke,Y.injector);if(U&&function mr(O){return!!O.resolveComponentFactory}(U)){const En=U.resolveComponentFactory(Ie);this.activated=Y.createComponent(En,Y.length,Tt)}else this.activated=Y.createComponent(Ie,{index:Y.length,injector:Tt,environmentInjector:U??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return O.\u0275fac=function(A){return new(A||O)(_.Y36(Pa),_.Y36(_.s_b),_.$8M("name"),_.Y36(_.sBO),_.Y36(_.lqb))},O.\u0275dir=_.lG2({type:O,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),O})();class Oa{constructor(k,A,U){this.route=k,this.childContexts=A,this.parent=U}get(k,A){return k===pa?this.route:k===Pa?this.childContexts:this.parent.get(k,A)}}let Eo=(()=>{class O{}return O.\u0275fac=function(A){return new(A||O)},O.\u0275cmp=_.Xpm({type:O,selectors:[["ng-component"]],standalone:!0,features:[_.jDz],decls:1,vars:0,template:function(A,U){1&A&&_._UZ(0,"router-outlet")},dependencies:[Is],encapsulation:2}),O})();function Ra(O,k){return O.providers&&!O._injector&&(O._injector=(0,_.MMx)(O.providers,k,`Route: ${O.path}`)),O._injector??k}function Ti(O){const k=O.children&&O.children.map(Ti),A=k?{...O,children:k}:{...O};return!A.component&&!A.loadComponent&&(k||A.loadChildren)&&A.outlet&&A.outlet!==ti&&(A.component=Eo),A}function Sr(O){return O.outlet||ti}function ya(O,k){const A=O.filter(U=>Sr(U)===k);return A.push(...O.filter(U=>Sr(U)!==k)),A}function As(O){if(!O)return null;if(O.routeConfig?._injector)return O.routeConfig._injector;for(let k=O.parent;k;k=k.parent){const A=k.routeConfig;if(A?._loadedInjector)return A._loadedInjector;if(A?._injector)return A._injector}return null}class Ka{constructor(k,A,U,Y){this.routeReuseStrategy=k,this.futureState=A,this.currState=U,this.forwardEvent=Y}activate(k){const A=this.futureState._root,U=this.currState?this.currState._root:null;this.deactivateChildRoutes(A,U,k),is(this.futureState.root),this.activateChildRoutes(A,U,k)}deactivateChildRoutes(k,A,U){const Y=_s(A);k.children.forEach(ae=>{const Ie=ae.value.outlet;this.deactivateRoutes(ae,Y[Ie],U),delete Y[Ie]}),zi(Y,(ae,Ie)=>{this.deactivateRouteAndItsChildren(ae,U)})}deactivateRoutes(k,A,U){const Y=k.value,ae=A?A.value:null;if(Y===ae)if(Y.component){const Ie=U.getContext(Y.outlet);Ie&&this.deactivateChildRoutes(k,A,Ie.children)}else this.deactivateChildRoutes(k,A,U);else ae&&this.deactivateRouteAndItsChildren(A,U)}deactivateRouteAndItsChildren(k,A){k.value.component&&this.routeReuseStrategy.shouldDetach(k.value.snapshot)?this.detachAndStoreRouteSubtree(k,A):this.deactivateRouteAndOutlet(k,A)}detachAndStoreRouteSubtree(k,A){const U=A.getContext(k.value.outlet),Y=U&&k.value.component?U.children:A,ae=_s(k);for(const Ie of Object.keys(ae))this.deactivateRouteAndItsChildren(ae[Ie],Y);if(U&&U.outlet){const Ie=U.outlet.detach(),ke=U.children.onOutletDeactivated();this.routeReuseStrategy.store(k.value.snapshot,{componentRef:Ie,route:k,contexts:ke})}}deactivateRouteAndOutlet(k,A){const U=A.getContext(k.value.outlet),Y=U&&k.value.component?U.children:A,ae=_s(k);for(const Ie of Object.keys(ae))this.deactivateRouteAndItsChildren(ae[Ie],Y);U&&U.outlet&&(U.outlet.deactivate(),U.children.onOutletDeactivated(),U.attachRef=null,U.resolver=null,U.route=null)}activateChildRoutes(k,A,U){const Y=_s(A);k.children.forEach(ae=>{this.activateRoutes(ae,Y[ae.value.outlet],U),this.forwardEvent(new gl(ae.value.snapshot))}),k.children.length&&this.forwardEvent(new Fr(k.value.snapshot))}activateRoutes(k,A,U){const Y=k.value,ae=A?A.value:null;if(is(Y),Y===ae)if(Y.component){const Ie=U.getOrCreateContext(Y.outlet);this.activateChildRoutes(k,A,Ie.children)}else this.activateChildRoutes(k,A,U);else if(Y.component){const Ie=U.getOrCreateContext(Y.outlet);if(this.routeReuseStrategy.shouldAttach(Y.snapshot)){const ke=this.routeReuseStrategy.retrieve(Y.snapshot);this.routeReuseStrategy.store(Y.snapshot,null),Ie.children.onOutletReAttached(ke.contexts),Ie.attachRef=ke.componentRef,Ie.route=ke.route.value,Ie.outlet&&Ie.outlet.attach(ke.componentRef,ke.route.value),is(ke.route.value),this.activateChildRoutes(k,null,Ie.children)}else{const ke=As(Y.snapshot),Tt=ke?.get(_._Vd)??null;Ie.attachRef=null,Ie.route=Y,Ie.resolver=Tt,Ie.injector=ke,Ie.outlet&&Ie.outlet.activateWith(Y,Ie.injector),this.activateChildRoutes(k,null,Ie.children)}}else this.activateChildRoutes(k,null,U)}}class Yo{constructor(k){this.path=k,this.route=this.path[this.path.length-1]}}class ra{constructor(k,A){this.component=k,this.route=A}}function $c(O,k,A){const U=O._root;return va(U,k?k._root:null,A,[U.value])}function rs(O,k){const A=Symbol(),U=k.get(O,A);return U===A?"function"!=typeof O||(0,_.Z0I)(O)?k.get(O):O:U}function va(O,k,A,U,Y={canDeactivateChecks:[],canActivateChecks:[]}){const ae=_s(k);return O.children.forEach(Ie=>{(function Qa(O,k,A,U,Y={canDeactivateChecks:[],canActivateChecks:[]}){const ae=O.value,Ie=k?k.value:null,ke=A?A.getContext(O.value.outlet):null;if(Ie&&ae.routeConfig===Ie.routeConfig){const Tt=function Jt(O,k,A){if("function"==typeof A)return A(O,k);switch(A){case"pathParamsChange":return!di(O.url,k.url);case"pathParamsOrQueryParamsChange":return!di(O.url,k.url)||!nr(O.queryParams,k.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ia(O,k)||!nr(O.queryParams,k.queryParams);default:return!ia(O,k)}}(Ie,ae,ae.routeConfig.runGuardsAndResolvers);Tt?Y.canActivateChecks.push(new Yo(U)):(ae.data=Ie.data,ae._resolvedData=Ie._resolvedData),va(O,k,ae.component?ke?ke.children:null:A,U,Y),Tt&&ke&&ke.outlet&&ke.outlet.isActivated&&Y.canDeactivateChecks.push(new ra(ke.outlet.component,Ie))}else Ie&&Ei(k,ke,Y),Y.canActivateChecks.push(new Yo(U)),va(O,null,ae.component?ke?ke.children:null:A,U,Y)})(Ie,ae[Ie.value.outlet],A,U.concat([Ie.value]),Y),delete ae[Ie.value.outlet]}),zi(ae,(Ie,ke)=>Ei(Ie,A.getContext(ke),Y)),Y}function Ei(O,k,A){const U=_s(O),Y=O.value;zi(U,(ae,Ie)=>{Ei(ae,Y.component?k?k.children.getContext(Ie):null:k,A)}),A.canDeactivateChecks.push(new ra(Y.component&&k&&k.outlet&&k.outlet.isActivated?k.outlet.component:null,Y))}function ba(O){return"function"==typeof O}function ue(O){return O instanceof Vt||"EmptyError"===O?.name}const gt=Symbol("INITIAL_VALUE");function On(){return(0,Qt.w)(O=>(0,Ft.a)(O.map(k=>k.pipe((0,tn.q)(1),(0,Rt.O)(gt)))).pipe((0,Zt.U)(k=>{for(const A of k)if(!0!==A){if(A===gt)return gt;if(!1===A||A instanceof Ki)return A}return!0}),(0,Kt.h)(k=>k!==gt),(0,tn.q)(1)))}function kl(O){return(0,lt.z)((0,An.b)(k=>{if(Vn(k))throw ma(0,k)}),(0,Zt.U)(k=>!0===k))}const Fl={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function bl(O,k,A,U,Y){const ae=Ll(O,k,A);return ae.matched?function vl(O,k,A,U){const Y=k.canMatch;if(!Y||0===Y.length)return(0,ot.of)(!0);const ae=Y.map(Ie=>{const ke=rs(Ie,O);return zn(function J(O){return O&&ba(O.canMatch)}(ke)?ke.canMatch(k,A):O.runInContext(()=>ke(k,A)))});return(0,ot.of)(ae).pipe(On(),kl())}(U=Ra(k,U),k,A).pipe((0,Zt.U)(Ie=>!0===Ie?ae:{...Fl})):(0,ot.of)(ae)}function Ll(O,k,A){if(""===k.path)return"full"===k.pathMatch&&(O.hasChildren()||A.length>0)?{...Fl}:{matched:!0,consumedSegments:[],remainingSegments:A,parameters:{},positionalParamSegments:{}};const Y=(k.matcher||cr)(A,O,k);if(!Y)return{...Fl};const ae={};zi(Y.posParams,(ke,Tt)=>{ae[Tt]=ke.path});const Ie=Y.consumed.length>0?{...ae,...Y.consumed[Y.consumed.length-1].parameters}:ae;return{matched:!0,consumedSegments:Y.consumed,remainingSegments:A.slice(Y.consumed.length),parameters:Ie,positionalParamSegments:Y.posParams??{}}}function oa(O,k,A,U,Y="corrected"){if(A.length>0&&function H(O,k,A){return A.some(U=>He(O,k,U)&&Sr(U)!==ti)}(O,A,U)){const Ie=new Tn(k,function ie(O,k,A,U){const Y={};Y[ti]=U,U._sourceSegment=O,U._segmentIndexShift=k.length;for(const ae of A)if(""===ae.path&&Sr(ae)!==ti){const Ie=new Tn([],{});Ie._sourceSegment=O,Ie._segmentIndexShift=k.length,Y[Sr(ae)]=Ie}return Y}(O,k,U,new Tn(A,O.children)));return Ie._sourceSegment=O,Ie._segmentIndexShift=k.length,{segmentGroup:Ie,slicedSegments:[]}}if(0===A.length&&function ce(O,k,A){return A.some(U=>He(O,k,U))}(O,A,U)){const Ie=new Tn(O.segments,function j(O,k,A,U,Y,ae){const Ie={};for(const ke of U)if(He(O,A,ke)&&!Y[Sr(ke)]){const Tt=new Tn([],{});Tt._sourceSegment=O,Tt._segmentIndexShift="legacy"===ae?O.segments.length:k.length,Ie[Sr(ke)]=Tt}return{...Y,...Ie}}(O,k,A,U,O.children,Y));return Ie._sourceSegment=O,Ie._segmentIndexShift=k.length,{segmentGroup:Ie,slicedSegments:A}}const ae=new Tn(O.segments,O.children);return ae._sourceSegment=O,ae._segmentIndexShift=k.length,{segmentGroup:ae,slicedSegments:A}}function He(O,k,A){return(!(O.hasChildren()||k.length>0)||"full"!==A.pathMatch)&&""===A.path}function Dt(O,k,A,U){return!!(Sr(O)===U||U!==ti&&He(k,A,O))&&("**"===O.path||Ll(k,O,A).matched)}function Yt(O,k,A){return 0===k.length&&!O.children[A]}const Ln=!1;class fi{constructor(k){this.segmentGroup=k||null}}class Si{constructor(k){this.urlTree=k}}function qn(O){return jt(new fi(O))}function Ii(O){return jt(new Si(O))}class Ds{constructor(k,A,U,Y,ae){this.injector=k,this.configLoader=A,this.urlSerializer=U,this.urlTree=Y,this.config=ae,this.allowRedirects=!0}apply(){const k=oa(this.urlTree.root,[],[],this.config).segmentGroup,A=new Tn(k.segments,k.children);return this.expandSegmentGroup(this.injector,this.config,A,ti).pipe((0,Zt.U)(ae=>this.createUrlTree(qt(ae),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,Di.K)(ae=>{if(ae instanceof Si)return this.allowRedirects=!1,this.match(ae.urlTree);throw ae instanceof fi?this.noMatchError(ae):ae}))}match(k){return this.expandSegmentGroup(this.injector,this.config,k.root,ti).pipe((0,Zt.U)(Y=>this.createUrlTree(qt(Y),k.queryParams,k.fragment))).pipe((0,Di.K)(Y=>{throw Y instanceof fi?this.noMatchError(Y):Y}))}noMatchError(k){return new _.vHH(4002,Ln)}createUrlTree(k,A,U){const Y=ft(k);return new Ki(Y,A,U)}expandSegmentGroup(k,A,U,Y){return 0===U.segments.length&&U.hasChildren()?this.expandChildren(k,A,U).pipe((0,Zt.U)(ae=>new Tn([],ae))):this.expandSegment(k,U,A,U.segments,Y,!0)}expandChildren(k,A,U){const Y=[];for(const ae of Object.keys(U.children))"primary"===ae?Y.unshift(ae):Y.push(ae);return(0,Q.D)(Y).pipe((0,Zn.b)(ae=>{const Ie=U.children[ae],ke=ya(A,ae);return this.expandSegmentGroup(k,ke,Ie,ae).pipe((0,Zt.U)(Tt=>({segment:Tt,outlet:ae})))}),Ni((ae,Ie)=>(ae[Ie.outlet]=Ie.segment,ae),{}),oi())}expandSegment(k,A,U,Y,ae,Ie){return(0,Q.D)(U).pipe((0,Zn.b)(ke=>this.expandSegmentAgainstRoute(k,A,U,ke,Y,ae,Ie).pipe((0,Di.K)(En=>{if(En instanceof fi)return(0,ot.of)(null);throw En}))),rn(ke=>!!ke),(0,Di.K)((ke,Tt)=>{if(ue(ke))return Yt(A,Y,ae)?(0,ot.of)(new Tn([],{})):qn(A);throw ke}))}expandSegmentAgainstRoute(k,A,U,Y,ae,Ie,ke){return Dt(Y,A,ae,Ie)?void 0===Y.redirectTo?this.matchSegmentAgainstRoute(k,A,Y,ae,Ie):ke&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(k,A,U,Y,ae,Ie):qn(A):qn(A)}expandSegmentAgainstRouteUsingRedirect(k,A,U,Y,ae,Ie){return"**"===Y.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(k,U,Y,Ie):this.expandRegularSegmentAgainstRouteUsingRedirect(k,A,U,Y,ae,Ie)}expandWildCardWithParamsAgainstRouteUsingRedirect(k,A,U,Y){const ae=this.applyRedirectCommands([],U.redirectTo,{});return U.redirectTo.startsWith("/")?Ii(ae):this.lineralizeSegments(U,ae).pipe((0,it.z)(Ie=>{const ke=new Tn(Ie,{});return this.expandSegment(k,ke,A,Ie,Y,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(k,A,U,Y,ae,Ie){const{matched:ke,consumedSegments:Tt,remainingSegments:En,positionalParamSegments:gi}=Ll(A,Y,ae);if(!ke)return qn(A);const gn=this.applyRedirectCommands(Tt,Y.redirectTo,gi);return Y.redirectTo.startsWith("/")?Ii(gn):this.lineralizeSegments(Y,gn).pipe((0,it.z)(er=>this.expandSegment(k,A,U,er.concat(En),Ie,!1)))}matchSegmentAgainstRoute(k,A,U,Y,ae){return"**"===U.path?(k=Ra(U,k),U.loadChildren?(U._loadedRoutes?(0,ot.of)({routes:U._loadedRoutes,injector:U._loadedInjector}):this.configLoader.loadChildren(k,U)).pipe((0,Zt.U)(ke=>(U._loadedRoutes=ke.routes,U._loadedInjector=ke.injector,new Tn(Y,{})))):(0,ot.of)(new Tn(Y,{}))):bl(A,U,Y,k).pipe((0,Qt.w)(({matched:Ie,consumedSegments:ke,remainingSegments:Tt})=>Ie?this.getChildConfig(k=U._injector??k,U,Y).pipe((0,it.z)(gi=>{const gn=gi.injector??k,er=gi.routes,{segmentGroup:ls,slicedSegments:$s}=oa(A,ke,Tt,er),la=new Tn(ls.segments,ls.children);if(0===$s.length&&la.hasChildren())return this.expandChildren(gn,er,la).pipe((0,Zt.U)(m=>new Tn(ke,m)));if(0===er.length&&0===$s.length)return(0,ot.of)(new Tn(ke,{}));const d=Sr(U)===ae;return this.expandSegment(gn,la,er,$s,d?ti:ae,!0).pipe((0,Zt.U)(l=>new Tn(ke.concat(l.segments),l.children)))})):qn(A)))}getChildConfig(k,A,U){return A.children?(0,ot.of)({routes:A.children,injector:k}):A.loadChildren?void 0!==A._loadedRoutes?(0,ot.of)({routes:A._loadedRoutes,injector:A._loadedInjector}):function Nl(O,k,A,U){const Y=k.canLoad;if(void 0===Y||0===Y.length)return(0,ot.of)(!0);const ae=Y.map(Ie=>{const ke=rs(Ie,O);return zn(function Lr(O){return O&&ba(O.canLoad)}(ke)?ke.canLoad(k,A):O.runInContext(()=>ke(k,A)))});return(0,ot.of)(ae).pipe(On(),kl())}(k,A,U).pipe((0,it.z)(Y=>Y?this.configLoader.loadChildren(k,A).pipe((0,An.b)(ae=>{A._loadedRoutes=ae.routes,A._loadedInjector=ae.injector})):function or(O){return jt(Ia(Ln,3))}())):(0,ot.of)({routes:[],injector:k})}lineralizeSegments(k,A){let U=[],Y=A.root;for(;;){if(U=U.concat(Y.segments),0===Y.numberOfChildren)return(0,ot.of)(U);if(Y.numberOfChildren>1||!Y.children[ti])return jt(new _.vHH(4e3,Ln));Y=Y.children[ti]}}applyRedirectCommands(k,A,U){return this.applyRedirectCreateUrlTree(A,this.urlSerializer.parse(A),k,U)}applyRedirectCreateUrlTree(k,A,U,Y){const ae=this.createSegmentGroup(k,A.root,U,Y);return new Ki(ae,this.createQueryParams(A.queryParams,this.urlTree.queryParams),A.fragment)}createQueryParams(k,A){const U={};return zi(k,(Y,ae)=>{if("string"==typeof Y&&Y.startsWith(":")){const ke=Y.substring(1);U[ae]=A[ke]}else U[ae]=Y}),U}createSegmentGroup(k,A,U,Y){const ae=this.createSegments(k,A.segments,U,Y);let Ie={};return zi(A.children,(ke,Tt)=>{Ie[Tt]=this.createSegmentGroup(k,ke,U,Y)}),new Tn(ae,Ie)}createSegments(k,A,U,Y){return A.map(ae=>ae.path.startsWith(":")?this.findPosParam(k,ae,Y):this.findOrReturn(ae,U))}findPosParam(k,A,U){const Y=U[A.path.substring(1)];if(!Y)throw new _.vHH(4001,Ln);return Y}findOrReturn(k,A){let U=0;for(const Y of A){if(Y.path===k.path)return A.splice(U),Y;U++}return k}}class os{}class Bl{constructor(k,A,U,Y,ae,Ie,ke,Tt){this.injector=k,this.rootComponentType=A,this.config=U,this.urlTree=Y,this.url=ae,this.paramsInheritanceStrategy=Ie,this.relativeLinkResolution=ke,this.urlSerializer=Tt}recognize(){const k=oa(this.urlTree.root,[],[],this.config.filter(A=>void 0===A.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,k,ti).pipe((0,Zt.U)(A=>{if(null===A)return null;const U=new wo([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ti,this.rootComponentType,null,this.urlTree.root,-1,{}),Y=new Lo(U,A),ae=new qa(this.url,Y);return this.inheritParamsAndData(ae._root),ae}))}inheritParamsAndData(k){const A=k.value,U=Sa(A,this.paramsInheritanceStrategy);A.params=Object.freeze(U.params),A.data=Object.freeze(U.data),k.children.forEach(Y=>this.inheritParamsAndData(Y))}processSegmentGroup(k,A,U,Y){return 0===U.segments.length&&U.hasChildren()?this.processChildren(k,A,U):this.processSegment(k,A,U,U.segments,Y)}processChildren(k,A,U){return(0,Q.D)(Object.keys(U.children)).pipe((0,Zn.b)(Y=>{const ae=U.children[Y],Ie=ya(A,Y);return this.processSegmentGroup(k,Ie,ae,Y)}),Ni((Y,ae)=>Y&&ae?(Y.push(...ae),Y):null),function ei(O,k=!1){return(0,xn.e)((A,U)=>{let Y=0;A.subscribe((0,on.x)(U,ae=>{const Ie=O(ae,Y++);(Ie||k)&&U.next(ae),!Ie&&U.complete()}))})}(Y=>null!==Y),ct(null),oi(),(0,Zt.U)(Y=>{if(null===Y)return null;const ae=Fa(Y);return function pc(O){O.sort((k,A)=>k.value.outlet===ti?-1:A.value.outlet===ti?1:k.value.outlet.localeCompare(A.value.outlet))}(ae),ae}))}processSegment(k,A,U,Y,ae){return(0,Q.D)(A).pipe((0,Zn.b)(Ie=>this.processSegmentAgainstRoute(Ie._injector??k,Ie,U,Y,ae)),rn(Ie=>!!Ie),(0,Di.K)(Ie=>{if(ue(Ie))return Yt(U,Y,ae)?(0,ot.of)([]):(0,ot.of)(null);throw Ie}))}processSegmentAgainstRoute(k,A,U,Y,ae){if(A.redirectTo||!Dt(A,U,Y,ae))return(0,ot.of)(null);let Ie;if("**"===A.path){const ke=Y.length>0?jr(Y).parameters:{},Tt=zl(U)+Y.length,En=new wo(Y,ke,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Vl(A),Sr(A),A.component??A._loadedComponent??null,A,aa(U),Tt,$u(A),Tt);Ie=(0,ot.of)({snapshot:En,consumedSegments:[],remainingSegments:[]})}else Ie=bl(U,A,Y,k).pipe((0,Zt.U)(({matched:ke,consumedSegments:Tt,remainingSegments:En,parameters:gi})=>{if(!ke)return null;const gn=zl(U)+Tt.length;return{snapshot:new wo(Tt,gi,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Vl(A),Sr(A),A.component??A._loadedComponent??null,A,aa(U),gn,$u(A),gn),consumedSegments:Tt,remainingSegments:En}}));return Ie.pipe((0,Qt.w)(ke=>{if(null===ke)return(0,ot.of)(null);const{snapshot:Tt,consumedSegments:En,remainingSegments:gi}=ke;k=A._injector??k;const gn=A._loadedInjector??k,er=function js(O){return O.children?O.children:O.loadChildren?O._loadedRoutes:[]}(A),{segmentGroup:ls,slicedSegments:$s}=oa(U,En,gi,er.filter(d=>void 0===d.redirectTo),this.relativeLinkResolution);if(0===$s.length&&ls.hasChildren())return this.processChildren(gn,er,ls).pipe((0,Zt.U)(d=>null===d?null:[new Lo(Tt,d)]));if(0===er.length&&0===$s.length)return(0,ot.of)([new Lo(Tt,[])]);const la=Sr(A)===ae;return this.processSegment(gn,er,ls,$s,la?ti:ae).pipe((0,Zt.U)(d=>null===d?null:[new Lo(Tt,d)]))}))}}function mc(O){const k=O.value.routeConfig;return k&&""===k.path&&void 0===k.redirectTo}function Fa(O){const k=[],A=new Set;for(const U of O){if(!mc(U)){k.push(U);continue}const Y=k.find(ae=>U.value.routeConfig===ae.value.routeConfig);void 0!==Y?(Y.children.push(...U.children),A.add(Y)):k.push(U)}for(const U of A){const Y=Fa(U.children);k.push(new Lo(U.value,Y))}return k.filter(U=>!A.has(U))}function aa(O){let k=O;for(;k._sourceSegment;)k=k._sourceSegment;return k}function zl(O){let k=O,A=k._segmentIndexShift??0;for(;k._sourceSegment;)k=k._sourceSegment,A+=k._segmentIndexShift??0;return A-1}function Vl(O){return O.data||{}}function $u(O){return O.resolve||{}}function Hc(O){return"string"==typeof O.title||null===O.title}function La(O){return(0,Qt.w)(k=>{const A=O(k);return A?(0,Q.D)(A).pipe((0,Zt.U)(()=>k)):(0,ot.of)(k)})}let $l=(()=>{class O{buildTitle(A){let U,Y=A.root;for(;void 0!==Y;)U=this.getResolvedTitleForRoute(Y)??U,Y=Y.children.find(ae=>ae.outlet===ti);return U}getResolvedTitleForRoute(A){return A.data[ai]}}return O.\u0275fac=function(A){return new(A||O)},O.\u0275prov=_.Yz7({token:O,factory:function(){return(0,_.f3M)(Vo)},providedIn:"root"}),O})(),Vo=(()=>{class O extends $l{constructor(A){super(),this.title=A}updateTitle(A){const U=this.buildTitle(A);void 0!==U&&this.title.setTitle(U)}}return O.\u0275fac=function(A){return new(A||O)(_.LFG(vr.Dx))},O.\u0275prov=_.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})();class xl{}class Hl extends class Wc{shouldDetach(k){return!1}store(k,A){}shouldAttach(k){return!1}retrieve(k){return null}shouldReuseRoute(k,A){return k.routeConfig===A.routeConfig}}{}const _c=new _.OlP("",{providedIn:"root",factory:()=>({})}),Wu=new _.OlP("ROUTES");let wl=(()=>{class O{constructor(A,U){this.injector=A,this.compiler=U,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(A){if(this.componentLoaders.get(A))return this.componentLoaders.get(A);if(A._loadedComponent)return(0,ot.of)(A._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(A);const U=zn(A.loadComponent()).pipe((0,An.b)(ae=>{this.onLoadEndListener&&this.onLoadEndListener(A),A._loadedComponent=ae}),Xi(()=>{this.componentLoaders.delete(A)})),Y=new ki(U,()=>new At.x).pipe(vn());return this.componentLoaders.set(A,Y),Y}loadChildren(A,U){if(this.childrenLoaders.get(U))return this.childrenLoaders.get(U);if(U._loadedRoutes)return(0,ot.of)({routes:U._loadedRoutes,injector:U._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(U);const ae=this.loadModuleFactoryOrRoutes(U.loadChildren).pipe((0,Zt.U)(ke=>{this.onLoadEndListener&&this.onLoadEndListener(U);let Tt,En,gi=!1;Array.isArray(ke)?En=ke:(Tt=ke.create(A).injector,En=Ji(Tt.get(Wu,[],_.XFs.Self|_.XFs.Optional)));return{routes:En.map(Ti),injector:Tt}}),Xi(()=>{this.childrenLoaders.delete(U)})),Ie=new ki(ae,()=>new At.x).pipe(vn());return this.childrenLoaders.set(U,Ie),Ie}loadModuleFactoryOrRoutes(A){return zn(A()).pipe((0,it.z)(U=>U instanceof _.YKP||Array.isArray(U)?(0,ot.of)(U):(0,Q.D)(this.compiler.compileModuleAsync(U))))}}return O.\u0275fac=function(A){return new(A||O)(_.LFG(_.zs3),_.LFG(_.Sil))},O.\u0275prov=_.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})();class Zc{}class yc{shouldProcessUrl(k){return!0}extract(k){return k}merge(k,A){return k}}function nl(O){throw O}function vc(O,k,A){return k.parse("/")}const Xo={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},To={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function qc(){const O=(0,_.f3M)(br),k=(0,_.f3M)(Pa),A=(0,_.f3M)(St.Ye),U=(0,_.f3M)(_.zs3),Y=(0,_.f3M)(_.Sil),ae=(0,_.f3M)(Wu,{optional:!0})??[],Ie=(0,_.f3M)(_c,{optional:!0})??{},ke=(0,_.f3M)(Vo),Tt=(0,_.f3M)($l,{optional:!0}),En=(0,_.f3M)(Zc,{optional:!0}),gi=(0,_.f3M)(xl,{optional:!0}),gn=new no(null,O,k,A,U,Y,Ji(ae));return En&&(gn.urlHandlingStrategy=En),gi&&(gn.routeReuseStrategy=gi),gn.titleStrategy=Tt??ke,function Zu(O,k){O.errorHandler&&(k.errorHandler=O.errorHandler),O.malformedUriErrorHandler&&(k.malformedUriErrorHandler=O.malformedUriErrorHandler),O.onSameUrlNavigation&&(k.onSameUrlNavigation=O.onSameUrlNavigation),O.paramsInheritanceStrategy&&(k.paramsInheritanceStrategy=O.paramsInheritanceStrategy),O.relativeLinkResolution&&(k.relativeLinkResolution=O.relativeLinkResolution),O.urlUpdateStrategy&&(k.urlUpdateStrategy=O.urlUpdateStrategy),O.canceledNavigationResolution&&(k.canceledNavigationResolution=O.canceledNavigationResolution)}(Ie,gn),gn}let no=(()=>{class O{constructor(A,U,Y,ae,Ie,ke,Tt){this.rootComponentType=A,this.urlSerializer=U,this.rootContexts=Y,this.location=ae,this.config=Tt,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new At.x,this.errorHandler=nl,this.malformedUriErrorHandler=vc,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>(0,ot.of)(void 0),this.urlHandlingStrategy=new yc,this.routeReuseStrategy=new Hl,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=Ie.get(wl),this.configLoader.onLoadEndListener=er=>this.triggerEvent(new Wa(er)),this.configLoader.onLoadStartListener=er=>this.triggerEvent(new Mr(er)),this.ngModule=Ie.get(_.h0i),this.console=Ie.get(_.c2e);const gn=Ie.get(_.R0b);this.isNgZoneEnabled=gn instanceof _.R0b&&_.R0b.isInAngularZone(),this.resetConfig(Tt),this.currentUrlTree=function ts(){return new Ki(new Tn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Za(this.currentUrlTree,this.rootComponentType),this.transitions=new c.X({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(A){const U=this.events;return A.pipe((0,Kt.h)(Y=>0!==Y.id),(0,Zt.U)(Y=>({...Y,extractedUrl:this.urlHandlingStrategy.extract(Y.rawUrl)})),(0,Qt.w)(Y=>{let ae=!1,Ie=!1;return(0,ot.of)(Y).pipe((0,An.b)(ke=>{this.currentNavigation={id:ke.id,initialUrl:ke.rawUrl,extractedUrl:ke.extractedUrl,trigger:ke.source,extras:ke.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,Qt.w)(ke=>{const Tt=this.browserUrlTree.toString(),En=!this.navigated||ke.extractedUrl.toString()!==Tt||Tt!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||En)&&this.urlHandlingStrategy.shouldProcessUrl(ke.rawUrl))return ho(ke.source)&&(this.browserUrlTree=ke.extractedUrl),(0,ot.of)(ke).pipe((0,Qt.w)(gn=>{const er=this.transitions.getValue();return U.next(new Dr(gn.id,this.serializeUrl(gn.extractedUrl),gn.source,gn.restoredState)),er!==this.transitions.getValue()?Xt.E:Promise.resolve(gn)}),function zo(O,k,A,U){return(0,Qt.w)(Y=>function Do(O,k,A,U,Y){return new Ds(O,k,A,U,Y).apply()}(O,k,A,Y.extractedUrl,U).pipe((0,Zt.U)(ae=>({...Y,urlAfterRedirects:ae}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),(0,An.b)(gn=>{this.currentNavigation={...this.currentNavigation,finalUrl:gn.urlAfterRedirects},Y.urlAfterRedirects=gn.urlAfterRedirects}),function vu(O,k,A,U,Y,ae){return(0,it.z)(Ie=>function sa(O,k,A,U,Y,ae,Ie="emptyOnly",ke="legacy"){return new Bl(O,k,A,U,Y,Ie,ke,ae).recognize().pipe((0,Qt.w)(Tt=>null===Tt?function Ai(O){return new xt.y(k=>k.error(O))}(new os):(0,ot.of)(Tt)))}(O,k,A,Ie.urlAfterRedirects,U.serialize(Ie.urlAfterRedirects),U,Y,ae).pipe((0,Zt.U)(ke=>({...Ie,targetSnapshot:ke}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),(0,An.b)(gn=>{if(Y.targetSnapshot=gn.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!gn.extras.skipLocationChange){const ls=this.urlHandlingStrategy.merge(gn.urlAfterRedirects,gn.rawUrl);this.setBrowserUrl(ls,gn)}this.browserUrlTree=gn.urlAfterRedirects}const er=new Yr(gn.id,this.serializeUrl(gn.extractedUrl),this.serializeUrl(gn.urlAfterRedirects),gn.targetSnapshot);U.next(er)}));if(En&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:er,extractedUrl:ls,source:$s,restoredState:la,extras:d}=ke,i=new Dr(er,this.serializeUrl(ls),$s,la);U.next(i);const l=Za(ls,this.rootComponentType).snapshot;return Y={...ke,targetSnapshot:l,urlAfterRedirects:ls,extras:{...d,skipLocationChange:!1,replaceUrl:!1}},(0,ot.of)(Y)}return this.rawUrlTree=ke.rawUrl,ke.resolve(null),Xt.E}),(0,An.b)(ke=>{const Tt=new Ui(ke.id,this.serializeUrl(ke.extractedUrl),this.serializeUrl(ke.urlAfterRedirects),ke.targetSnapshot);this.triggerEvent(Tt)}),(0,Zt.U)(ke=>Y={...ke,guards:$c(ke.targetSnapshot,ke.currentSnapshot,this.rootContexts)}),function Mi(O,k){return(0,it.z)(A=>{const{targetSnapshot:U,currentSnapshot:Y,guards:{canActivateChecks:ae,canDeactivateChecks:Ie}}=A;return 0===Ie.length&&0===ae.length?(0,ot.of)({...A,guardsResult:!0}):function to(O,k,A,U){return(0,Q.D)(O).pipe((0,it.z)(Y=>function _u(O,k,A,U,Y){const ae=k&&k.routeConfig?k.routeConfig.canDeactivate:null;if(!ae||0===ae.length)return(0,ot.of)(!0);const Ie=ae.map(ke=>{const Tt=As(k)??Y,En=rs(ke,Tt);return zn(function Bo(O){return O&&ba(O.canDeactivate)}(En)?En.canDeactivate(O,k,A,U):Tt.runInContext(()=>En(O,k,A,U))).pipe(rn())});return(0,ot.of)(Ie).pipe(On())}(Y.component,Y.route,A,k,U)),rn(Y=>!0!==Y,!0))}(Ie,U,Y,O).pipe((0,it.z)(ke=>ke&&function el(O){return"boolean"==typeof O}(ke)?function Ps(O,k,A,U){return(0,Q.D)(k).pipe((0,Zn.b)(Y=>(0,st.z)(function Oo(O,k){return null!==O&&k&&k(new Vs(O)),(0,ot.of)(!0)}(Y.route.parent,U),function ws(O,k){return null!==O&&k&&k(new Ms(O)),(0,ot.of)(!0)}(Y.route,U),function ka(O,k,A){const U=k[k.length-1],ae=k.slice(0,k.length-1).reverse().map(Ie=>function fc(O){const k=O.routeConfig?O.routeConfig.canActivateChild:null;return k&&0!==k.length?{node:O,guards:k}:null}(Ie)).filter(Ie=>null!==Ie).map(Ie=>Et(()=>{const ke=Ie.guards.map(Tt=>{const En=As(Ie.node)??A,gi=rs(Tt,En);return zn(function xa(O){return O&&ba(O.canActivateChild)}(gi)?gi.canActivateChild(U,O):En.runInContext(()=>gi(U,O))).pipe(rn())});return(0,ot.of)(ke).pipe(On())}));return(0,ot.of)(ae).pipe(On())}(O,Y.path,A),function Rl(O,k,A){const U=k.routeConfig?k.routeConfig.canActivate:null;if(!U||0===U.length)return(0,ot.of)(!0);const Y=U.map(ae=>Et(()=>{const Ie=As(k)??A,ke=rs(ae,Ie);return zn(function Na(O){return O&&ba(O.canActivate)}(ke)?ke.canActivate(k,O):Ie.runInContext(()=>ke(k,O))).pipe(rn())}));return(0,ot.of)(Y).pipe(On())}(O,Y.route,A))),rn(Y=>!0!==Y,!0))}(U,ae,O,k):(0,ot.of)(ke)),(0,Zt.U)(ke=>({...A,guardsResult:ke})))})}(this.ngModule.injector,ke=>this.triggerEvent(ke)),(0,An.b)(ke=>{if(Y.guardsResult=ke.guardsResult,Vn(ke.guardsResult))throw ma(0,ke.guardsResult);const Tt=new fa(ke.id,this.serializeUrl(ke.extractedUrl),this.serializeUrl(ke.urlAfterRedirects),ke.targetSnapshot,!!ke.guardsResult);this.triggerEvent(Tt)}),(0,Kt.h)(ke=>!!ke.guardsResult||(this.restoreHistory(ke),this.cancelNavigationTransition(ke,"",3),!1)),La(ke=>{if(ke.guards.canActivateChecks.length)return(0,ot.of)(ke).pipe((0,An.b)(Tt=>{const En=new _o(Tt.id,this.serializeUrl(Tt.extractedUrl),this.serializeUrl(Tt.urlAfterRedirects),Tt.targetSnapshot);this.triggerEvent(En)}),(0,Qt.w)(Tt=>{let En=!1;return(0,ot.of)(Tt).pipe(function Ul(O,k){return(0,it.z)(A=>{const{targetSnapshot:U,guards:{canActivateChecks:Y}}=A;if(!Y.length)return(0,ot.of)(A);let ae=0;return(0,Q.D)(Y).pipe((0,Zn.b)(Ie=>function jl(O,k,A,U){const Y=O.routeConfig,ae=O._resolve;return void 0!==Y?.title&&!Hc(Y)&&(ae[ai]=Y.title),function Gl(O,k,A,U){const Y=function bn(O){return[...Object.keys(O),...Object.getOwnPropertySymbols(O)]}(O);if(0===Y.length)return(0,ot.of)({});const ae={};return(0,Q.D)(Y).pipe((0,it.z)(Ie=>function Os(O,k,A,U){const Y=As(k)??U,ae=rs(O,Y);return zn(ae.resolve?ae.resolve(k,A):Y.runInContext(()=>ae(k,A)))}(O[Ie],k,A,U).pipe(rn(),(0,An.b)(ke=>{ae[Ie]=ke}))),kr(1),(0,ko.h)(ae),(0,Di.K)(Ie=>ue(Ie)?Xt.E:jt(Ie)))}(ae,O,k,U).pipe((0,Zt.U)(Ie=>(O._resolvedData=Ie,O.data=Sa(O,A).resolve,Y&&Hc(Y)&&(O.data[ai]=Y.title),null)))}(Ie.route,U,O,k)),(0,An.b)(()=>ae++),kr(1),(0,it.z)(Ie=>ae===Y.length?(0,ot.of)(A):Xt.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),(0,An.b)({next:()=>En=!0,complete:()=>{En||(this.restoreHistory(Tt),this.cancelNavigationTransition(Tt,"",2))}}))}),(0,An.b)(Tt=>{const En=new Zo(Tt.id,this.serializeUrl(Tt.extractedUrl),this.serializeUrl(Tt.urlAfterRedirects),Tt.targetSnapshot);this.triggerEvent(En)}))}),La(ke=>{const Tt=En=>{const gi=[];En.routeConfig?.loadComponent&&!En.routeConfig._loadedComponent&&gi.push(this.configLoader.loadComponent(En.routeConfig).pipe((0,An.b)(gn=>{En.component=gn}),(0,Zt.U)(()=>{})));for(const gn of En.children)gi.push(...Tt(gn));return gi};return(0,Ft.a)(Tt(ke.targetSnapshot.root)).pipe(ct(),(0,tn.q)(1))}),La(()=>this.afterPreactivation()),(0,Zt.U)(ke=>{const Tt=function hc(O,k,A){const U=Ss(O,k._root,A?A._root:void 0);return new dc(U,k)}(this.routeReuseStrategy,ke.targetSnapshot,ke.currentRouterState);return Y={...ke,targetRouterState:Tt}}),(0,An.b)(ke=>{this.currentUrlTree=ke.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(ke.urlAfterRedirects,ke.rawUrl),this.routerState=ke.targetRouterState,"deferred"===this.urlUpdateStrategy&&(ke.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,ke),this.browserUrlTree=ke.urlAfterRedirects)}),((O,k,A)=>(0,Zt.U)(U=>(new Ka(k,U.targetRouterState,U.currentRouterState,A).activate(O),U)))(this.rootContexts,this.routeReuseStrategy,ke=>this.triggerEvent(ke)),(0,An.b)({next(){ae=!0},complete(){ae=!0}}),Xi(()=>{ae||Ie||this.cancelNavigationTransition(Y,"",1),this.currentNavigation?.id===Y.id&&(this.currentNavigation=null)}),(0,Di.K)(ke=>{if(Ie=!0,Co(ke)){qo(ke)||(this.navigated=!0,this.restoreHistory(Y,!0));const Tt=new qr(Y.id,this.serializeUrl(Y.extractedUrl),ke.message,ke.cancellationCode);if(U.next(Tt),qo(ke)){const En=this.urlHandlingStrategy.merge(ke.url,this.rawUrlTree),gi={skipLocationChange:Y.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ho(Y.source)};this.scheduleNavigation(En,"imperative",null,gi,{resolve:Y.resolve,reject:Y.reject,promise:Y.promise})}else Y.resolve(!1)}else{this.restoreHistory(Y,!0);const Tt=new eo(Y.id,this.serializeUrl(Y.extractedUrl),ke,Y.targetSnapshot??void 0);U.next(Tt);try{Y.resolve(this.errorHandler(ke))}catch(En){Y.reject(En)}}return Xt.E}))}))}resetRootComponentType(A){this.rootComponentType=A,this.routerState.root.component=this.rootComponentType}setTransition(A){this.transitions.next({...this.transitions.value,...A})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(A=>{const U="popstate"===A.type?"popstate":"hashchange";"popstate"===U&&setTimeout(()=>{const Y={replaceUrl:!0},ae=A.state?.navigationId?A.state:null;if(ae){const ke={...ae};delete ke.navigationId,delete ke.\u0275routerPageId,0!==Object.keys(ke).length&&(Y.state=ke)}const Ie=this.parseUrl(A.url);this.scheduleNavigation(Ie,U,ae,Y)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(A){this.events.next(A)}resetConfig(A){this.config=A.map(Ti),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(A,U={}){const{relativeTo:Y,queryParams:ae,fragment:Ie,queryParamsHandling:ke,preserveFragment:Tt}=U,En=Y||this.routerState.root,gi=Tt?this.currentUrlTree.fragment:Ie;let gn=null;switch(ke){case"merge":gn={...this.currentUrlTree.queryParams,...ae};break;case"preserve":gn=this.currentUrlTree.queryParams;break;default:gn=ae||null}return null!==gn&&(gn=this.removeEmptyProps(gn)),$i(En,this.currentUrlTree,A,gn,gi??null)}navigateByUrl(A,U={skipLocationChange:!1}){const Y=Vn(A)?A:this.parseUrl(A),ae=this.urlHandlingStrategy.merge(Y,this.rawUrlTree);return this.scheduleNavigation(ae,"imperative",null,U)}navigate(A,U={skipLocationChange:!1}){return function yo(O){for(let k=0;k<O.length;k++){if(null==O[k])throw new _.vHH(4008,false)}}(A),this.navigateByUrl(this.createUrlTree(A,U),U)}serializeUrl(A){return this.urlSerializer.serialize(A)}parseUrl(A){let U;try{U=this.urlSerializer.parse(A)}catch(Y){U=this.malformedUriErrorHandler(Y,this.urlSerializer,A)}return U}isActive(A,U){let Y;if(Y=!0===U?{...Xo}:!1===U?{...To}:U,Vn(A))return Oe(this.currentUrlTree,A,Y);const ae=this.parseUrl(A);return Oe(this.currentUrlTree,ae,Y)}removeEmptyProps(A){return Object.keys(A).reduce((U,Y)=>{const ae=A[Y];return null!=ae&&(U[Y]=ae),U},{})}processNavigations(){this.navigations.subscribe(A=>{this.navigated=!0,this.lastSuccessfulId=A.id,this.currentPageId=A.targetPageId,this.events.next(new Er(A.id,this.serializeUrl(A.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),A.resolve(!0)},A=>{this.console.warn(`Unhandled Navigation Error: ${A}`)})}scheduleNavigation(A,U,Y,ae,Ie){if(this.disposed)return Promise.resolve(!1);let ke,Tt,En;Ie?(ke=Ie.resolve,Tt=Ie.reject,En=Ie.promise):En=new Promise((er,ls)=>{ke=er,Tt=ls});const gi=++this.navigationId;let gn;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(Y=this.location.getState()),gn=Y&&Y.\u0275routerPageId?Y.\u0275routerPageId:ae.replaceUrl||ae.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):gn=0,this.setTransition({id:gi,targetPageId:gn,source:U,restoredState:Y,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:A,extras:ae,resolve:ke,reject:Tt,promise:En,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),En.catch(er=>Promise.reject(er))}setBrowserUrl(A,U){const Y=this.urlSerializer.serialize(A),ae={...U.extras.state,...this.generateNgRouterState(U.id,U.targetPageId)};this.location.isCurrentPathEqualTo(Y)||U.extras.replaceUrl?this.location.replaceState(Y,"",ae):this.location.go(Y,"",ae)}restoreHistory(A,U=!1){if("computed"===this.canceledNavigationResolution){const Y=this.currentPageId-A.targetPageId;"popstate"!==A.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===Y?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===Y&&(this.resetState(A),this.browserUrlTree=A.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(Y)}else"replace"===this.canceledNavigationResolution&&(U&&this.resetState(A),this.resetUrlToCurrentUrlTree())}resetState(A){this.routerState=A.currentRouterState,this.currentUrlTree=A.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,A.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(A,U,Y){const ae=new qr(A.id,this.serializeUrl(A.extractedUrl),U,Y);this.triggerEvent(ae),A.resolve(!1)}generateNgRouterState(A,U){return"computed"===this.canceledNavigationResolution?{navigationId:A,\u0275routerPageId:U}:{navigationId:A}}}return O.\u0275fac=function(A){_.$Z()},O.\u0275prov=_.Yz7({token:O,factory:function(){return qc()},providedIn:"root"}),O})();function ho(O){return"imperative"!==O}let ss=(()=>{class O{constructor(A,U,Y,ae,Ie){this.router=A,this.route=U,this.tabIndexAttribute=Y,this.renderer=ae,this.el=Ie,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.onChanges=new At.x,this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(A){this._preserveFragment=(0,_.D6c)(A)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(A){this._skipLocationChange=(0,_.D6c)(A)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(A){this._replaceUrl=(0,_.D6c)(A)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(A){if(null!=this.tabIndexAttribute)return;const U=this.renderer,Y=this.el.nativeElement;null!==A?U.setAttribute(Y,"tabindex",A):U.removeAttribute(Y,"tabindex")}ngOnChanges(A){this.onChanges.next(this)}set routerLink(A){null!=A?(this.commands=Array.isArray(A)?A:[A],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){return null===this.urlTree||this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return O.\u0275fac=function(A){return new(A||O)(_.Y36(no),_.Y36(pa),_.$8M("tabindex"),_.Y36(_.Qsj),_.Y36(_.SBq))},O.\u0275dir=_.lG2({type:O,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(A,U){1&A&&_.NdJ("click",function(){return U.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[_.TTD]}),O})(),Ba=(()=>{class O{constructor(A,U,Y){this.router=A,this.route=U,this.locationStrategy=Y,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new At.x,this.subscription=A.events.subscribe(ae=>{ae instanceof Er&&this.updateTargetUrlAndHref()})}set preserveFragment(A){this._preserveFragment=(0,_.D6c)(A)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(A){this._skipLocationChange=(0,_.D6c)(A)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(A){this._replaceUrl=(0,_.D6c)(A)}get replaceUrl(){return this._replaceUrl}set routerLink(A){this.commands=null!=A?Array.isArray(A)?A:[A]:null}ngOnChanges(A){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(A,U,Y,ae,Ie){return!!(0!==A||U||Y||ae||Ie||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return O.\u0275fac=function(A){return new(A||O)(_.Y36(no),_.Y36(pa),_.Y36(St.S$))},O.\u0275dir=_.lG2({type:O,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(A,U){1&A&&_.NdJ("click",function(ae){return U.onClick(ae.button,ae.ctrlKey,ae.shiftKey,ae.altKey,ae.metaKey)}),2&A&&_.uIk("target",U.target)("href",U.href,_.LSH)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[_.TTD]}),O})();class Zl{}let Uo=(()=>{class O{constructor(A,U,Y,ae,Ie){this.router=A,this.injector=Y,this.preloadingStrategy=ae,this.loader=Ie}setUpPreloading(){this.subscription=this.router.events.pipe((0,Kt.h)(A=>A instanceof Er),(0,Zn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(A,U){const Y=[];for(const ae of U){ae.providers&&!ae._injector&&(ae._injector=(0,_.MMx)(ae.providers,A,`Route: ${ae.path}`));const Ie=ae._injector??A,ke=ae._loadedInjector??Ie;ae.loadChildren&&!ae._loadedRoutes&&void 0===ae.canLoad||ae.loadComponent&&!ae._loadedComponent?Y.push(this.preloadConfig(Ie,ae)):(ae.children||ae._loadedRoutes)&&Y.push(this.processRoutes(ke,ae.children??ae._loadedRoutes))}return(0,Q.D)(Y).pipe((0,Ao.J)())}preloadConfig(A,U){return this.preloadingStrategy.preload(U,()=>{let Y;Y=U.loadChildren&&void 0===U.canLoad?this.loader.loadChildren(A,U):(0,ot.of)(null);const ae=Y.pipe((0,it.z)(Ie=>null===Ie?(0,ot.of)(void 0):(U._loadedRoutes=Ie.routes,U._loadedInjector=Ie.injector,this.processRoutes(Ie.injector??A,Ie.routes))));if(U.loadComponent&&!U._loadedComponent){const Ie=this.loader.loadComponent(U);return(0,Q.D)([ae,Ie]).pipe((0,Ao.J)())}return ae})}}return O.\u0275fac=function(A){return new(A||O)(_.LFG(no),_.LFG(_.Sil),_.LFG(_.lqb),_.LFG(Zl),_.LFG(wl))},O.\u0275prov=_.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})();const xu=new _.OlP("");let Dl=(()=>{class O{constructor(A,U,Y={}){this.router=A,this.viewportScroller=U,this.options=Y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},Y.scrollPositionRestoration=Y.scrollPositionRestoration||"disabled",Y.anchorScrolling=Y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(A=>{A instanceof Dr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=A.navigationTrigger,this.restoredId=A.restoredState?A.restoredState.navigationId:0):A instanceof Er&&(this.lastId=A.id,this.scheduleScrollEvent(A,this.router.parseUrl(A.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(A=>{A instanceof ta&&(A.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(A.position):A.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(A.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(A,U){this.router.triggerEvent(new ta(A,"popstate"===this.lastSource?this.store[this.restoredId]:null,U))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return O.\u0275fac=function(A){_.$Z()},O.\u0275prov=_.Yz7({token:O,factory:O.\u0275fac}),O})();function Ns(O,k){return{\u0275kind:O,\u0275providers:k}}function Hr(O){return[{provide:Wu,multi:!0,useValue:O}]}function Xc(){const O=(0,_.f3M)(_.zs3);return k=>{const A=O.get(_.z2F);if(k!==A.components[0])return;const U=O.get(no),Y=O.get(Dn);1===O.get(Qi)&&U.initialNavigation(),O.get(wu,null,_.XFs.Optional)?.setUpPreloading(),O.get(xu,null,_.XFs.Optional)?.init(),U.resetRootComponentType(A.componentTypes[0]),Y.next(),Y.complete()}}const Dn=new _.OlP("",{factory:()=>new At.x}),Qi=new _.OlP("",{providedIn:"root",factory:()=>1});const wu=new _.OlP("");function Yu(O){return Ns(0,[{provide:wu,useExisting:Uo},{provide:Zl,useExisting:O}])}const Du=new _.OlP("ROUTER_FORROOT_GUARD"),Tu=[St.Ye,{provide:br,useClass:Gr},{provide:no,useFactory:qc},Pa,{provide:pa,useFactory:function as(O){return O.routerState.root},deps:[no]},wl];function io(){return new _.PXZ("Router",no)}let Kc=(()=>{class O{constructor(A){}static forRoot(A,U){return{ngModule:O,providers:[Tu,[],Hr(A),{provide:Du,useFactory:vo,deps:[[no,new _.FiY,new _.tp0]]},{provide:_c,useValue:U||{}},U?.useHash?{provide:St.S$,useClass:St.Do}:{provide:St.S$,useClass:St.b0},{provide:xu,useFactory:()=>{const O=(0,_.f3M)(no),k=(0,_.f3M)(St.EM),A=(0,_.f3M)(_c);return A.scrollOffset&&k.setOffset(A.scrollOffset),new Dl(O,k,A)}},U?.preloadingStrategy?Yu(U.preloadingStrategy).\u0275providers:[],{provide:_.PXZ,multi:!0,useFactory:io},U?.initialNavigation?Gs(U):[],[{provide:Va,useFactory:Xc},{provide:_.tb,multi:!0,useExisting:Va}]]}}static forChild(A){return{ngModule:O,providers:[Hr(A)]}}}return O.\u0275fac=function(A){return new(A||O)(_.LFG(Du,8))},O.\u0275mod=_.oAB({type:O}),O.\u0275inj=_.cJS({imports:[Eo]}),O})();function vo(O){return"guarded"}function Gs(O){return["disabled"===O.initialNavigation?Ns(3,[{provide:_.ip1,multi:!0,useFactory:()=>{const k=(0,_.f3M)(no);return()=>{k.setUpLocationChangeListener()}}},{provide:Qi,useValue:2}]).\u0275providers:[],"enabledBlocking"===O.initialNavigation?Ns(2,[{provide:Qi,useValue:0},{provide:_.ip1,multi:!0,deps:[_.zs3],useFactory:k=>{const A=k.get(St.V_,Promise.resolve());let U=!1;return()=>A.then(()=>new Promise(ae=>{const Ie=k.get(no),ke=k.get(Dn);(function Y(ae){k.get(no).events.pipe((0,Kt.h)(ke=>ke instanceof Er||ke instanceof qr||ke instanceof eo),(0,Zt.U)(ke=>ke instanceof Er||ke instanceof qr&&(0===ke.code||1===ke.code)&&null),(0,Kt.h)(ke=>null!==ke),(0,tn.q)(1)).subscribe(()=>{ae()})})(()=>{ae(!0),U=!0}),Ie.afterPreactivation=()=>(ae(!0),U||ke.closed?(0,ot.of)(void 0):ke),Ie.initialNavigation()}))}}]).\u0275providers:[]]}const Va=new _.OlP("")},9837:(Yn,Ut,he)=>{"use strict";he.d(Ut,{vL:()=>se,_D:()=>En,qj:()=>gn,NG:()=>Tl,jt:()=>Qu,TH:()=>Ga,Vi:()=>Sd,iD:()=>jh,J4:()=>il,IJ:()=>sm,M2:()=>dh,N9:()=>su});var _=he(1571),Q=he(6895),ot=he(9751),c=he(515),ze=he(9646),Vt=he(7579),Ft=he(8421),st=he(5577),xt=he(1144),ut=he(576),Et=he(3268);const lt=["addListener","removeListener"],dn=["addEventListener","removeEventListener"],jt=["on","off"];function Xt(y,C,p,T){if((0,ut.m)(p)&&(T=p,p=void 0),T)return Xt(y,C,p).pipe((0,Et.Z)(T));const[R,W]=function vn(y){return(0,ut.m)(y.addEventListener)&&(0,ut.m)(y.removeEventListener)}(y)?dn.map(Te=>Ge=>y[Te](C,Ge,p)):function xn(y){return(0,ut.m)(y.addListener)&&(0,ut.m)(y.removeListener)}(y)?lt.map(Gt(y,C)):function on(y){return(0,ut.m)(y.on)&&(0,ut.m)(y.off)}(y)?jt.map(Gt(y,C)):[];if(!R&&(0,xt.z)(y))return(0,st.z)(Te=>Xt(Te,C,p))((0,Ft.Xf)(y));if(!R)throw new TypeError("Invalid event target");return new ot.y(Te=>{const Ge=(...Xe)=>Te.next(1<Xe.length?Xe:Xe[0]);return R(Ge),()=>W(Ge)})}function Gt(y,C){return p=>T=>y[p](C,T)}var ki=he(727);class At extends ki.w0{constructor(C,p){super()}schedule(C,p=0){return this}}const St={setInterval(y,C,...p){const{delegate:T}=St;return T?.setInterval?T.setInterval(y,C,...p):setInterval(y,C,...p)},clearInterval(y){const{delegate:C}=St;return(C?.clearInterval||clearInterval)(y)},delegate:void 0};var Zt=he(8737);const tn={now:()=>(tn.delegate||Date).now(),delegate:void 0};class Rt{constructor(C,p=Rt.now){this.schedulerActionCtor=C,this.now=p}schedule(C,p=0,T){return new this.schedulerActionCtor(this,C).schedule(T,p)}}Rt.now=tn.now;const it=new class Kt extends Rt{constructor(C,p=Rt.now){super(C,p),this.actions=[],this._active=!1,this._scheduled=void 0}flush(C){const{actions:p}=this;if(this._active)return void p.push(C);let T;this._active=!0;do{if(T=C.execute(C.state,C.delay))break}while(C=p.shift());if(this._active=!1,T){for(;C=p.shift();)C.unsubscribe();throw T}}}(class Qt extends At{constructor(C,p){super(C,p),this.scheduler=C,this.work=p,this.pending=!1}schedule(C,p=0){if(this.closed)return this;this.state=C;const T=this.id,R=this.scheduler;return null!=T&&(this.id=this.recycleAsyncId(R,T,p)),this.pending=!0,this.delay=p,this.id=this.id||this.requestAsyncId(R,this.id,p),this}requestAsyncId(C,p,T=0){return St.setInterval(C.flush.bind(C,this),T)}recycleAsyncId(C,p,T=0){if(null!=T&&this.delay===T&&!1===this.pending)return p;St.clearInterval(p)}execute(C,p){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const T=this._execute(C,p);if(T)return T;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(C,p){let R,T=!1;try{this.work(C)}catch(W){T=!0,R=W||new Error("Scheduled action threw falsy error")}if(T)return this.unsubscribe(),R}unsubscribe(){if(!this.closed){const{id:C,scheduler:p}=this,{actions:T}=p;this.work=this.state=this.scheduler=null,this.pending=!1,(0,Zt.P)(T,this),null!=C&&(this.id=this.recycleAsyncId(p,C,null)),this.delay=null,super.unsubscribe()}}}),ct=it;var It=he(3532);function _n(y=0,C,p=ct){let T=-1;return null!=C&&((0,It.K)(C)?p=C:T=C),new ot.y(R=>{let W=function dt(y){return y instanceof Date&&!isNaN(y)}(y)?+y-p.now():y;W<0&&(W=0);let Te=0;return p.schedule(function(){R.closed||(R.next(Te++),0<=T?this.schedule(void 0,T):R.complete())},W)})}const{isArray:rn}=Array;function Zn(y){return 1===y.length&&rn(y[0])?y[0]:y}var An=he(5403);function Di(...y){return 1===(y=Zn(y)).length?(0,Ft.Xf)(y[0]):new ot.y(function Kn(y){return C=>{let p=[];for(let T=0;p&&!C.closed&&T<y.length;T++)p.push((0,Ft.Xf)(y[T]).subscribe((0,An.x)(C,R=>{if(p){for(let W=0;W<p.length;W++)W!==T&&p[W].unsubscribe();p=null}C.next(R)})))}}(y))}he(1135),he(9841);var oi=he(5032);new ot.y(oi.Z);var Xi=he(3269);function Ao(...y){const C=(0,Xi.jO)(y),p=Zn(y);return p.length?new ot.y(T=>{let R=p.map(()=>[]),W=p.map(()=>!1);T.add(()=>{R=W=null});for(let Te=0;!T.closed&&Te<p.length;Te++)(0,Ft.Xf)(p[Te]).subscribe((0,An.x)(T,Ge=>{if(R[Te].push(Ge),R.every(Xe=>Xe.length)){const Xe=R.map(yt=>yt.shift());T.next(C?C(...Xe):Xe),R.some((yt,bt)=>!yt.length&&W[bt])&&T.complete()}},()=>{W[Te]=!0,!R[Te].length&&T.complete()}));return()=>{R=W=null}}):c.E}var vr=he(6451),ti=he(7272),Ur=he(4482);function vi(y){return(0,Ur.e)((C,p)=>{(0,Ft.Xf)(y).subscribe((0,An.x)(p,()=>p.complete(),oi.Z)),!p.closed&&C.subscribe(p)})}var cr=he(9300),Hi=he(5698),nr=he(4004),Ji=(he(8675),he(4671)),zi=he(3900),zn=he(8505);function Ho(...y){const C=(0,Xi.jO)(y);return(0,Ur.e)((p,T)=>{const R=y.length,W=new Array(R);let Te=y.map(()=>!1),Ge=!1;for(let Xe=0;Xe<R;Xe++)(0,Ft.Xf)(y[Xe]).subscribe((0,An.x)(T,yt=>{W[Xe]=yt,!Ge&&!Te[Xe]&&(Te[Xe]=!0,(Ge=Te.every(Ji.y))&&(Te=null))},oi.Z));p.subscribe((0,An.x)(T,Xe=>{if(Ge){const yt=[Xe,...W];T.next(C?C(...yt):yt)}}))})}var Mt=he(9718);function Ve(y,C){return C?p=>(0,ti.z)(C.pipe((0,Hi.q)(1),function ts(){return(0,Ur.e)((y,C)=>{y.subscribe((0,An.x)(C,oi.Z))})}()),p.pipe(Ve(y))):(0,st.z)((p,T)=>y(p,T).pipe((0,Hi.q)(1),(0,Mt.h)(p)))}var Nt=he(433),Un={left:"right",right:"left",bottom:"top",top:"bottom"};function ni(y){return y.replace(/left|right|bottom|top/g,function(C){return Un[C]})}function ui(y){return y.split("-")[0]}var Pn={start:"end",end:"start"};function Ki(y){return y.replace(/start|end/g,function(C){return Pn[C]})}var Tn="top",qi="bottom",wn="right",di="left",Ci="auto",br=[Tn,qi,wn,di],Gr="start",Wi="end",mo="viewport",_e="popper",re=br.reduce(function(y,C){return y.concat([C+"-"+Gr,C+"-"+Wi])},[]),xe=[].concat(br,[Ci]).reduce(function(y,C){return y.concat([C,C+"-"+Gr,C+"-"+Wi])},[]),be=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Ze(y){if(null==y)return window;if("[object Window]"!==y.toString()){var C=y.ownerDocument;return C&&C.defaultView||window}return y}function Pe(y){return y instanceof Ze(y).Element||y instanceof Element}function ft(y){return y instanceof Ze(y).HTMLElement||y instanceof HTMLElement}function qt(y){return!(typeof ShadowRoot>"u")&&(y instanceof Ze(y).ShadowRoot||y instanceof ShadowRoot)}function Rn(y){return((Pe(y)?y.ownerDocument:y.document)||window.document).documentElement}var Vn=Math.max,jn=Math.min,In=Math.round;function at(){var y=navigator.userAgentData;return null!=y&&y.brands?y.brands.map(function(C){return C.brand+"/"+C.version}).join(" "):navigator.userAgent}function $r(){return!/^((?!chrome|android).)*safari/i.test(at())}function $i(y,C,p){void 0===C&&(C=!1),void 0===p&&(p=!1);var T=y.getBoundingClientRect(),R=1,W=1;C&&ft(y)&&(R=y.offsetWidth>0&&In(T.width)/y.offsetWidth||1,W=y.offsetHeight>0&&In(T.height)/y.offsetHeight||1);var Ge=(Pe(y)?Ze(y):window).visualViewport,Xe=!$r()&&p,yt=(T.left+(Xe&&Ge?Ge.offsetLeft:0))/R,bt=(T.top+(Xe&&Ge?Ge.offsetTop:0))/W,Nn=T.width/R,pn=T.height/W;return{width:Nn,height:pn,top:bt,right:yt+Nn,bottom:bt+pn,left:yt,x:yt,y:bt}}function Xn(y){var C=Ze(y);return{scrollLeft:C.pageXOffset,scrollTop:C.pageYOffset}}function xo(y){return $i(Rn(y)).left+Xn(y).scrollLeft}function go(y){return Ze(y).getComputedStyle(y)}function ir(y){return y?(y.nodeName||"").toLowerCase():null}function ln(y){return"html"===ir(y)?y:y.assignedSlot||y.parentNode||(qt(y)?y.host:null)||Rn(y)}function Qn(y){var C=go(y);return/auto|scroll|overlay|hidden/.test(C.overflow+C.overflowY+C.overflowX)}function Jn(y){return["html","body","#document"].indexOf(ir(y))>=0?y.ownerDocument.body:ft(y)&&Qn(y)?y:Jn(ln(y))}function wr(y,C){var p;void 0===C&&(C=[]);var T=Jn(y),R=T===(null==(p=y.ownerDocument)?void 0:p.body),W=Ze(T),Te=R?[W].concat(W.visualViewport||[],Qn(T)?T:[]):T,Ge=C.concat(Te);return R?Ge:Ge.concat(wr(ln(Te)))}function Fo(y){return["table","td","th"].indexOf(ir(y))>=0}function Sn(y){return ft(y)&&"fixed"!==go(y).position?y.offsetParent:null}function ps(y){for(var C=Ze(y),p=Sn(y);p&&Fo(p)&&"static"===go(p).position;)p=Sn(p);return p&&("html"===ir(p)||"body"===ir(p)&&"static"===go(p).position)?C:p||function Wo(y){var C=/firefox/i.test(at());if(/Trident/i.test(at())&&ft(y)&&"fixed"===go(y).position)return null;var R=ln(y);for(qt(R)&&(R=R.host);ft(R)&&["html","body"].indexOf(ir(R))<0;){var W=go(R);if("none"!==W.transform||"none"!==W.perspective||"paint"===W.contain||-1!==["transform","perspective"].indexOf(W.willChange)||C&&"filter"===W.willChange||C&&W.filter&&"none"!==W.filter)return R;R=R.parentNode}return null}(y)||C}function ms(y,C){var p=C.getRootNode&&C.getRootNode();if(y.contains(C))return!0;if(p&&qt(p)){var T=C;do{if(T&&y.isSameNode(T))return!0;T=T.parentNode||T.host}while(T)}return!1}function lo(y){return Object.assign({},y,{left:y.x,top:y.y,right:y.x+y.width,bottom:y.y+y.height})}function gs(y,C,p){return C===mo?lo(function Tr(y,C){var p=Ze(y),T=Rn(y),R=p.visualViewport,W=T.clientWidth,Te=T.clientHeight,Ge=0,Xe=0;if(R){W=R.width,Te=R.height;var yt=$r();(yt||!yt&&"fixed"===C)&&(Ge=R.offsetLeft,Xe=R.offsetTop)}return{width:W,height:Te,x:Ge+xo(y),y:Xe}}(y,p)):Pe(C)?function Vi(y,C){var p=$i(y,!1,"fixed"===C);return p.top=p.top+y.clientTop,p.left=p.left+y.clientLeft,p.bottom=p.top+y.clientHeight,p.right=p.left+y.clientWidth,p.width=y.clientWidth,p.height=y.clientHeight,p.x=p.left,p.y=p.top,p}(C,p):lo(function zs(y){var C,p=Rn(y),T=Xn(y),R=null==(C=y.ownerDocument)?void 0:C.body,W=Vn(p.scrollWidth,p.clientWidth,R?R.scrollWidth:0,R?R.clientWidth:0),Te=Vn(p.scrollHeight,p.clientHeight,R?R.scrollHeight:0,R?R.clientHeight:0),Ge=-T.scrollLeft+xo(y),Xe=-T.scrollTop;return"rtl"===go(R||p).direction&&(Ge+=Vn(p.clientWidth,R?R.clientWidth:0)-W),{width:W,height:Te,x:Ge,y:Xe}}(Rn(y)))}function Er(y){return y.split("-")[1]}function qr(y){return["top","bottom"].indexOf(y)>=0?"x":"y"}function eo(y){var Xe,C=y.reference,p=y.element,T=y.placement,R=T?ui(T):null,W=T?Er(T):null,Te=C.x+C.width/2-p.width/2,Ge=C.y+C.height/2-p.height/2;switch(R){case Tn:Xe={x:Te,y:C.y-p.height};break;case qi:Xe={x:Te,y:C.y+C.height};break;case wn:Xe={x:C.x+C.width,y:Ge};break;case di:Xe={x:C.x-p.width,y:Ge};break;default:Xe={x:C.x,y:C.y}}var yt=R?qr(R):null;if(null!=yt){var bt="y"===yt?"height":"width";switch(W){case Gr:Xe[yt]=Xe[yt]-(C[bt]/2-p[bt]/2);break;case Wi:Xe[yt]=Xe[yt]+(C[bt]/2-p[bt]/2)}}return Xe}function Ui(y){return Object.assign({},{top:0,right:0,bottom:0,left:0},y)}function fa(y,C){return C.reduce(function(p,T){return p[T]=y,p},{})}function _o(y,C){void 0===C&&(C={});var T=C.placement,R=void 0===T?y.placement:T,W=C.strategy,Te=void 0===W?y.strategy:W,Ge=C.boundary,Xe=void 0===Ge?"clippingParents":Ge,yt=C.rootBoundary,bt=void 0===yt?mo:yt,Nn=C.elementContext,pn=void 0===Nn?_e:Nn,Gn=C.altBoundary,Zi=void 0!==Gn&&Gn,ri=C.padding,Li=void 0===ri?0:ri,ur=Ui("number"!=typeof Li?Li:fa(Li,br)),oo=y.rects.popper,ar=y.elements[Zi?pn===_e?"reference":_e:pn],hr=function Dr(y,C,p,T){var R="clippingParents"===C?function Cr(y){var C=wr(ln(y)),T=["absolute","fixed"].indexOf(go(y).position)>=0&&ft(y)?ps(y):y;return Pe(T)?C.filter(function(R){return Pe(R)&&ms(R,T)&&"body"!==ir(R)}):[]}(y):[].concat(C),W=[].concat(R,[p]),Ge=W.reduce(function(Xe,yt){var bt=gs(y,yt,T);return Xe.top=Vn(bt.top,Xe.top),Xe.right=jn(bt.right,Xe.right),Xe.bottom=jn(bt.bottom,Xe.bottom),Xe.left=Vn(bt.left,Xe.left),Xe},gs(y,W[0],T));return Ge.width=Ge.right-Ge.left,Ge.height=Ge.bottom-Ge.top,Ge.x=Ge.left,Ge.y=Ge.top,Ge}(Pe(ar)?ar:ar.contextElement||Rn(y.elements.popper),Xe,bt,Te),lr=$i(y.elements.reference),Jr=eo({reference:lr,element:oo,strategy:"absolute",placement:R}),Ar=lo(Object.assign({},oo,Jr)),us=pn===_e?Ar:lr,ds={top:hr.top-us.top+ur.top,bottom:us.bottom-hr.bottom+ur.bottom,left:hr.left-us.left+ur.left,right:us.right-hr.right+ur.right},$o=y.modifiersData.offset;if(pn===_e&&$o){var Sl=$o[R];Object.keys(ds).forEach(function(qs){var Ic=[wn,qi].indexOf(qs)>=0?1:-1,Ac=[Tn,qi].indexOf(qs)>=0?"y":"x";ds[qs]+=Sl[Ac]*Ic})}return ds}const Vs={name:"flip",enabled:!0,phase:"main",fn:function Wa(y){var C=y.state,p=y.options,T=y.name;if(!C.modifiersData[T]._skip){for(var R=p.mainAxis,W=void 0===R||R,Te=p.altAxis,Ge=void 0===Te||Te,Xe=p.fallbackPlacements,yt=p.padding,bt=p.boundary,Nn=p.rootBoundary,pn=p.altBoundary,Gn=p.flipVariations,Zi=void 0===Gn||Gn,ri=p.allowedAutoPlacements,Li=C.options.placement,ur=ui(Li),oo=Xe||(ur!==Li&&Zi?function Mr(y){if(ui(y)===Ci)return[];var C=ni(y);return[Ki(y),C,Ki(C)]}(Li):[ni(Li)]),ar=[Li].concat(oo).reduce(function(Rc,Ru){return Rc.concat(ui(Ru)===Ci?function Zo(y,C){void 0===C&&(C={});var R=C.boundary,W=C.rootBoundary,Te=C.padding,Ge=C.flipVariations,Xe=C.allowedAutoPlacements,yt=void 0===Xe?xe:Xe,bt=Er(C.placement),Nn=bt?Ge?re:re.filter(function(Zi){return Er(Zi)===bt}):br,pn=Nn.filter(function(Zi){return yt.indexOf(Zi)>=0});0===pn.length&&(pn=Nn);var Gn=pn.reduce(function(Zi,ri){return Zi[ri]=_o(y,{placement:ri,boundary:R,rootBoundary:W,padding:Te})[ui(ri)],Zi},{});return Object.keys(Gn).sort(function(Zi,ri){return Gn[Zi]-Gn[ri]})}(C,{placement:Ru,boundary:bt,rootBoundary:Nn,padding:yt,flipVariations:Zi,allowedAutoPlacements:ri}):Ru)},[]),hr=C.rects.reference,lr=C.rects.popper,Jr=new Map,Ar=!0,us=ar[0],ds=0;ds<ar.length;ds++){var $o=ar[ds],Sl=ui($o),qs=Er($o)===Gr,Ic=[Tn,qi].indexOf(Sl)>=0,Ac=Ic?"width":"height",Qo=_o(C,{placement:$o,boundary:bt,rootBoundary:Nn,altBoundary:pn,padding:yt}),Il=Ic?qs?wn:di:qs?qi:Tn;hr[Ac]>lr[Ac]&&(Il=ni(Il));var bh=ni(Il),Pc=[];if(W&&Pc.push(Qo[Sl]<=0),Ge&&Pc.push(Qo[Il]<=0,Qo[bh]<=0),Pc.every(function(Rc){return Rc})){us=$o,Ar=!1;break}Jr.set($o,Pc)}if(Ar)for(var Oc=function(Ru){var au=ar.find(function(lu){var ul=Jr.get(lu);if(ul)return ul.slice(0,Ru).every(function(Nd){return Nd})});if(au)return us=au,"break"},ld=Zi?3:1;ld>0&&"break"!==Oc(ld);ld--);C.placement!==us&&(C.modifiersData[T]._skip=!0,C.placement=us,C.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Ms(y,C,p){return Vn(y,jn(C,p))}function ta(y){var C=$i(y),p=y.offsetWidth,T=y.offsetHeight;return Math.abs(C.width-p)<=1&&(p=C.width),Math.abs(C.height-T)<=1&&(T=C.height),{x:y.offsetLeft,y:y.offsetTop,width:p,height:T}}const Ma={name:"preventOverflow",enabled:!0,phase:"main",fn:function co(y){var C=y.state,p=y.options,T=y.name,R=p.mainAxis,W=void 0===R||R,Te=p.altAxis,Ge=void 0!==Te&&Te,pn=p.tether,Gn=void 0===pn||pn,Zi=p.tetherOffset,ri=void 0===Zi?0:Zi,Li=_o(C,{boundary:p.boundary,rootBoundary:p.rootBoundary,padding:p.padding,altBoundary:p.altBoundary}),ur=ui(C.placement),Pi=Er(C.placement),oo=!Pi,ar=qr(ur),hr=function Fr(y){return"x"===y?"y":"x"}(ar),lr=C.modifiersData.popperOffsets,Jr=C.rects.reference,Ar=C.rects.popper,us="function"==typeof ri?ri(Object.assign({},C.rects,{placement:C.placement})):ri,ds="number"==typeof us?{mainAxis:us,altAxis:us}:Object.assign({mainAxis:0,altAxis:0},us),$o=C.modifiersData.offset?C.modifiersData.offset[C.placement]:null,Sl={x:0,y:0};if(lr){if(W){var qs,Ic="y"===ar?Tn:di,Ac="y"===ar?qi:wn,Qo="y"===ar?"height":"width",Il=lr[ar],bh=Il+Li[Ic],Pc=Il-Li[Ac],ad=Gn?-Ar[Qo]/2:0,Oc=Pi===Gr?Jr[Qo]:Ar[Qo],ld=Pi===Gr?-Ar[Qo]:-Jr[Qo],Al=C.elements.arrow,Rc=Gn&&Al?ta(Al):{width:0,height:0},Ru=C.modifiersData["arrow#persistent"]?C.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},au=Ru[Ic],lu=Ru[Ac],ul=Ms(0,Jr[Qo],Rc[Qo]),Nd=oo?Jr[Qo]/2-ad-ul-au-ds.mainAxis:Oc-ul-au-ds.mainAxis,cd=oo?-Jr[Qo]/2+ad+ul+lu+ds.mainAxis:ld+ul+lu+ds.mainAxis,ud=C.elements.arrow&&ps(C.elements.arrow),dd=null!=(qs=$o?.[ar])?qs:0,lf=Il+cd-dd,Fd=Ms(Gn?jn(bh,Il+Nd-dd-(ud?"y"===ar?ud.clientTop||0:ud.clientLeft||0:0)):bh,Il,Gn?Vn(Pc,lf):Pc);lr[ar]=Fd,Sl[ar]=Fd-Il}if(Ge){var xh,Nu=lr[hr],hd="y"===hr?"height":"width",Bd=Nu+Li["x"===ar?Tn:di],cf=Nu-Li["x"===ar?qi:wn],hs=-1!==[Tn,di].indexOf(ur),cu=null!=(xh=$o?.[hr])?xh:0,ku=hs?Bd:Nu-Jr[hd]-Ar[hd]-cu+ds.altAxis,sp=hs?Nu+Jr[hd]+Ar[hd]-cu-ds.altAxis:cf,fd=Gn&&hs?function gl(y,C,p){var T=Ms(y,C,p);return T>p?p:T}(ku,Nu,sp):Ms(Gn?ku:Bd,Nu,Gn?sp:cf);lr[hr]=fd,Sl[hr]=fd-Nu}C.modifiersData[T]=Sl}},requiresIfExists:["offset"]},_s={name:"arrow",enabled:!0,phase:"main",fn:function Po(y){var C,p=y.state,T=y.name,R=y.options,W=p.elements.arrow,Te=p.modifiersData.popperOffsets,Ge=ui(p.placement),Xe=qr(Ge),bt=[di,wn].indexOf(Ge)>=0?"height":"width";if(W&&Te){var Nn=function(C,p){return Ui("number"!=typeof(C="function"==typeof C?C(Object.assign({},p.rects,{placement:p.placement})):C)?C:fa(C,br))}(R.padding,p),pn=ta(W),Gn="y"===Xe?Tn:di,Zi="y"===Xe?qi:wn,ri=p.rects.reference[bt]+p.rects.reference[Xe]-Te[Xe]-p.rects.popper[bt],Li=Te[Xe]-p.rects.reference[Xe],ur=ps(W),Pi=ur?"y"===Xe?ur.clientHeight||0:ur.clientWidth||0:0,lr=Pi/2-pn[bt]/2+(ri/2-Li/2),Jr=Ms(Nn[Gn],lr,Pi-pn[bt]-Nn[Zi]);p.modifiersData[T]=((C={})[Xe]=Jr,C.centerOffset=Jr-lr,C)}},effect:function Lo(y){var C=y.state,T=y.options.element,R=void 0===T?"[data-popper-arrow]":T;null!=R&&("string"==typeof R&&!(R=C.elements.popper.querySelector(R))||!ms(C.elements.popper,R)||(C.elements.arrow=R))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function pa(y,C,p){void 0===p&&(p=!1);var T=ft(C),R=ft(C)&&function na(y){var C=y.getBoundingClientRect(),p=In(C.width)/y.offsetWidth||1,T=In(C.height)/y.offsetHeight||1;return 1!==p||1!==T}(C),W=Rn(C),Te=$i(y,R,p),Ge={scrollLeft:0,scrollTop:0},Xe={x:0,y:0};return(T||!T&&!p)&&(("body"!==ir(C)||Qn(W))&&(Ge=function Za(y){return y!==Ze(y)&&ft(y)?function dc(y){return{scrollLeft:y.scrollLeft,scrollTop:y.scrollTop}}(y):Xn(y)}(C)),ft(C)?((Xe=$i(C,!0)).x+=C.clientLeft,Xe.y+=C.clientTop):W&&(Xe.x=xo(W))),{x:Te.left+Ge.scrollLeft-Xe.x,y:Te.top+Ge.scrollTop-Xe.y,width:Te.width,height:Te.height}}function Sa(y){var C=new Map,p=new Set,T=[];function R(W){p.add(W.name),[].concat(W.requires||[],W.requiresIfExists||[]).forEach(function(Ge){if(!p.has(Ge)){var Xe=C.get(Ge);Xe&&R(Xe)}}),T.push(W)}return y.forEach(function(W){C.set(W.name,W)}),y.forEach(function(W){p.has(W.name)||R(W)}),T}function wo(y){var C;return function(){return C||(C=new Promise(function(p){Promise.resolve().then(function(){C=void 0,p(y())})})),C}}var is={placement:"bottom",modifiers:[],strategy:"absolute"};function ia(){for(var y=arguments.length,C=new Array(y),p=0;p<y;p++)C[p]=arguments[p];return!C.some(function(T){return!(T&&"function"==typeof T.getBoundingClientRect)})}function hc(y){void 0===y&&(y={});var p=y.defaultModifiers,T=void 0===p?[]:p,R=y.defaultOptions,W=void 0===R?is:R;return function(Ge,Xe,yt){void 0===yt&&(yt=W);var bt={placement:"bottom",orderedModifiers:[],options:Object.assign({},is,W),modifiersData:{},elements:{reference:Ge,popper:Xe},attributes:{},styles:{}},Nn=[],pn=!1,Gn={state:bt,setOptions:function(ur){var Pi="function"==typeof ur?ur(bt.options):ur;ri(),bt.options=Object.assign({},W,bt.options,Pi),bt.scrollParents={reference:Pe(Ge)?wr(Ge):Ge.contextElement?wr(Ge.contextElement):[],popper:wr(Xe)};var oo=function ys(y){var C=Sa(y);return be.reduce(function(p,T){return p.concat(C.filter(function(R){return R.phase===T}))},[])}(function qa(y){var C=y.reduce(function(p,T){var R=p[T.name];return p[T.name]=R?Object.assign({},R,T,{options:Object.assign({},R.options,T.options),data:Object.assign({},R.data,T.data)}):T,p},{});return Object.keys(C).map(function(p){return C[p]})}([].concat(T,bt.options.modifiers)));return bt.orderedModifiers=oo.filter(function($o){return $o.enabled}),function Zi(){bt.orderedModifiers.forEach(function(Li){var Pi=Li.options,ar=Li.effect;if("function"==typeof ar){var hr=ar({state:bt,name:Li.name,instance:Gn,options:void 0===Pi?{}:Pi});Nn.push(hr||function(){})}})}(),Gn.update()},forceUpdate:function(){if(!pn){var ur=bt.elements,Pi=ur.reference,oo=ur.popper;if(ia(Pi,oo)){bt.rects={reference:pa(Pi,ps(oo),"fixed"===bt.options.strategy),popper:ta(oo)},bt.reset=!1,bt.placement=bt.options.placement,bt.orderedModifiers.forEach(function($o){return bt.modifiersData[$o.name]=Object.assign({},$o.data)});for(var hr=0;hr<bt.orderedModifiers.length;hr++)if(!0!==bt.reset){var lr=bt.orderedModifiers[hr],Jr=lr.fn,Ar=lr.options;"function"==typeof Jr&&(bt=Jr({state:bt,options:void 0===Ar?{}:Ar,name:lr.name,instance:Gn})||bt)}else bt.reset=!1,hr=-1}}},update:wo(function(){return new Promise(function(Li){Gn.forceUpdate(),Li(bt)})}),destroy:function(){ri(),pn=!0}};if(!ia(Ge,Xe))return Gn;function ri(){Nn.forEach(function(Li){return Li()}),Nn=[]}return Gn.setOptions(yt).then(function(Li){!pn&&yt.onFirstUpdate&&yt.onFirstUpdate(Li)}),Gn}}var Us={passive:!0},qo={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Aa(y){var C,p=y.popper,T=y.popperRect,R=y.placement,W=y.variation,Te=y.offsets,Ge=y.position,Xe=y.gpuAcceleration,yt=y.adaptive,bt=y.roundOffsets,Nn=y.isFixed,pn=Te.x,Gn=void 0===pn?0:pn,Zi=Te.y,ri=void 0===Zi?0:Zi,Li="function"==typeof bt?bt({x:Gn,y:ri}):{x:Gn,y:ri};Gn=Li.x,ri=Li.y;var ur=Te.hasOwnProperty("x"),Pi=Te.hasOwnProperty("y"),oo=di,ar=Tn,hr=window;if(yt){var lr=ps(p),Jr="clientHeight",Ar="clientWidth";lr===Ze(p)&&"static"!==go(lr=Rn(p)).position&&"absolute"===Ge&&(Jr="scrollHeight",Ar="scrollWidth"),(R===Tn||(R===di||R===wn)&&W===Wi)&&(ar=qi,ri-=(Nn&&lr===hr&&hr.visualViewport?hr.visualViewport.height:lr[Jr])-T.height,ri*=Xe?1:-1),R!==di&&(R!==Tn&&R!==qi||W!==Wi)||(oo=wn,Gn-=(Nn&&lr===hr&&hr.visualViewport?hr.visualViewport.width:lr[Ar])-T.width,Gn*=Xe?1:-1)}var qs,$o=Object.assign({position:Ge},yt&&qo),Sl=!0===bt?function Co(y){var p=y.y,R=window.devicePixelRatio||1;return{x:In(y.x*R)/R||0,y:In(p*R)/R||0}}({x:Gn,y:ri}):{x:Gn,y:ri};return Gn=Sl.x,ri=Sl.y,Object.assign({},$o,Xe?((qs={})[ar]=Pi?"0":"",qs[oo]=ur?"0":"",qs.transform=(hr.devicePixelRatio||1)<=1?"translate("+Gn+"px, "+ri+"px)":"translate3d("+Gn+"px, "+ri+"px, 0)",qs):((C={})[ar]=Pi?ri+"px":"",C[oo]=ur?Gn+"px":"",C.transform="",C))}var Ra=hc({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function Ya(y){var C=y.state,p=y.instance,T=y.options,R=T.scroll,W=void 0===R||R,Te=T.resize,Ge=void 0===Te||Te,Xe=Ze(C.elements.popper),yt=[].concat(C.scrollParents.reference,C.scrollParents.popper);return W&&yt.forEach(function(bt){bt.addEventListener("scroll",p.update,Us)}),Ge&&Xe.addEventListener("resize",p.update,Us),function(){W&&yt.forEach(function(bt){bt.removeEventListener("scroll",p.update,Us)}),Ge&&Xe.removeEventListener("resize",p.update,Us)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function ma(y){var C=y.state;C.modifiersData[y.name]=eo({reference:C.rects.reference,element:C.rects.popper,strategy:"absolute",placement:C.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function Pa(y){var C=y.state,p=y.options,T=p.gpuAcceleration,R=void 0===T||T,W=p.adaptive,Te=void 0===W||W,Ge=p.roundOffsets,Xe=void 0===Ge||Ge,bt={placement:ui(C.placement),variation:Er(C.placement),popper:C.elements.popper,popperRect:C.rects.popper,gpuAcceleration:R,isFixed:"fixed"===C.options.strategy};null!=C.modifiersData.popperOffsets&&(C.styles.popper=Object.assign({},C.styles.popper,Aa(Object.assign({},bt,{offsets:C.modifiersData.popperOffsets,position:C.options.strategy,adaptive:Te,roundOffsets:Xe})))),null!=C.modifiersData.arrow&&(C.styles.arrow=Object.assign({},C.styles.arrow,Aa(Object.assign({},bt,{offsets:C.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Xe})))),C.attributes.popper=Object.assign({},C.attributes.popper,{"data-popper-placement":C.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function Is(y){var C=y.state;Object.keys(C.elements).forEach(function(p){var T=C.styles[p]||{},R=C.attributes[p]||{},W=C.elements[p];!ft(W)||!ir(W)||(Object.assign(W.style,T),Object.keys(R).forEach(function(Te){var Ge=R[Te];!1===Ge?W.removeAttribute(Te):W.setAttribute(Te,!0===Ge?"":Ge)}))})},effect:function Oa(y){var C=y.state,p={popper:{position:C.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(C.elements.popper.style,p.popper),C.styles=p,C.elements.arrow&&Object.assign(C.elements.arrow.style,p.arrow),function(){Object.keys(C.elements).forEach(function(T){var R=C.elements[T],W=C.attributes[T]||{},Ge=Object.keys(C.styles.hasOwnProperty(T)?C.styles[T]:p[T]).reduce(function(Xe,yt){return Xe[yt]="",Xe},{});!ft(R)||!ir(R)||(Object.assign(R.style,Ge),Object.keys(W).forEach(function(Xe){R.removeAttribute(Xe)}))})}},requires:["computeStyles"]}]});const yl={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function rr(y){var C=y.state,T=y.name,R=y.options.offset,W=void 0===R?[0,0]:R,Te=xe.reduce(function(bt,Nn){return bt[Nn]=function ga(y,C,p){var T=ui(y),R=[di,Tn].indexOf(T)>=0?-1:1,W="function"==typeof p?p(Object.assign({},C,{placement:y})):p,Te=W[0],Ge=W[1];return Te=Te||0,Ge=(Ge||0)*R,[di,wn].indexOf(T)>=0?{x:Ge,y:Te}:{x:Te,y:Ge}}(Nn,C.rects,W),bt},{}),Ge=Te[C.placement],yt=Ge.y;null!=C.modifiersData.popperOffsets&&(C.modifiersData.popperOffsets.x+=Ge.x,C.modifiersData.popperOffsets.y+=yt),C.modifiersData[T]=Te}},As=["*"],fc=["month"],rs=["year"];function va(y,C){if(1&y&&(_.TgZ(0,"option",5),_._uU(1),_.qZA()),2&y){const p=C.$implicit,T=_.oxw();_.Q6J("value",p),_.uIk("aria-label",T.i18n.getMonthFullName(p,T.date.year)),_.xp6(1),_.Oqu(T.i18n.getMonthShortName(p,T.date.year))}}function Qa(y,C){if(1&y&&(_.TgZ(0,"option",5),_._uU(1),_.qZA()),2&y){const p=C.$implicit,T=_.oxw();_.Q6J("value",p),_.xp6(1),_.Oqu(T.i18n.getYearNumerals(p))}}function Jt(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"ngb-datepicker-navigation-select",7),_.NdJ("select",function(R){_.CHM(p);const W=_.oxw();return _.KtG(W.select.emit(R))}),_.qZA()}if(2&y){const p=_.oxw();_.Q6J("date",p.date)("disabled",p.disabled)("months",p.selectBoxes.months)("years",p.selectBoxes.years)}}function Ei(y,C){1&y&&_._UZ(0,"div",0)}function ba(y,C){1&y&&_._UZ(0,"div",0)}function el(y,C){if(1&y&&(_.YNc(0,Ei,1,0,"div",9),_.TgZ(1,"div",10),_._uU(2),_.qZA(),_.YNc(3,ba,1,0,"div",9)),2&y){const p=C.$implicit,T=C.index,R=_.oxw(2);_.Q6J("ngIf",T>0),_.xp6(2),_.hij(" ",R.i18n.getMonthLabel(p.firstDate)," "),_.xp6(1),_.Q6J("ngIf",T!==R.months.length-1)}}function Lr(y,C){if(1&y&&_.YNc(0,el,4,3,"ng-template",8),2&y){const p=_.oxw();_.Q6J("ngForOf",p.months)}}const Na=["ngbDatepickerDayView",""],xa=["defaultDayTemplate"],Bo=["content"];function J(y,C){if(1&y&&_._UZ(0,"div",7),2&y){const T=C.currentMonth,R=C.selected,W=C.disabled,Te=C.focused;_.Q6J("date",C.date)("currentMonth",T)("selected",R)("disabled",W)("focused",Te)}}function q(y,C){if(1&y&&(_.TgZ(0,"div",12),_._uU(1),_.qZA()),2&y){const p=_.oxw().$implicit,T=_.oxw(2);_.xp6(1),_.hij(" ",T.i18n.getMonthLabel(p.firstDate)," ")}}function G(y,C){if(1&y&&(_.TgZ(0,"div",9),_.YNc(1,q,2,1,"div",10),_._UZ(2,"ngb-datepicker-month",11),_.qZA()),2&y){const p=C.$implicit,T=_.oxw(2);_.xp6(1),_.Q6J("ngIf","none"===T.navigation||T.displayMonths>1&&"select"===T.navigation),_.xp6(1),_.Q6J("month",p.firstDate)}}function ue(y,C){if(1&y&&_.YNc(0,G,3,2,"div",8),2&y){const p=_.oxw();_.Q6J("ngForOf",p.model.months)}}function gt(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"ngb-datepicker-navigation",13),_.NdJ("navigate",function(R){_.CHM(p);const W=_.oxw();return _.KtG(W.onNavigateEvent(R))})("select",function(R){_.CHM(p);const W=_.oxw();return _.KtG(W.onNavigateDateSelect(R))}),_.qZA()}if(2&y){const p=_.oxw();_.Q6J("date",p.model.firstDate)("months",p.model.months)("disabled",p.model.disabled)("showSelect","select"===p.model.navigation)("prevDisabled",p.model.prevDisabled)("nextDisabled",p.model.nextDisabled)("selectBoxes",p.model.selectBoxes)}}function On(y,C){}function Mi(y,C){}function to(y,C){if(1&y&&(_.TgZ(0,"div",5),_._uU(1),_.qZA()),2&y){const p=_.oxw(2);_.xp6(1),_.Oqu(p.i18n.getWeekLabel())}}function Ps(y,C){if(1&y&&(_.TgZ(0,"div",6),_._uU(1),_.qZA()),2&y){const p=C.$implicit;_.xp6(1),_.Oqu(p)}}function ws(y,C){if(1&y&&(_.TgZ(0,"div",2),_.YNc(1,to,2,1,"div",3),_.YNc(2,Ps,2,1,"div",4),_.qZA()),2&y){const p=_.oxw();_.xp6(1),_.Q6J("ngIf",p.datepicker.showWeekNumbers),_.xp6(1),_.Q6J("ngForOf",p.viewModel.weekdays)}}function Oo(y,C){if(1&y&&(_.TgZ(0,"div",11),_._uU(1),_.qZA()),2&y){const p=_.oxw(2).$implicit,T=_.oxw();_.xp6(1),_.Oqu(T.i18n.getWeekNumerals(p.number))}}function Rl(y,C){}function ka(y,C){if(1&y&&_.YNc(0,Rl,0,0,"ng-template",14),2&y){const p=_.oxw().$implicit,T=_.oxw(3);_.Q6J("ngTemplateOutlet",T.datepicker.dayTemplate)("ngTemplateOutletContext",p.context)}}function _u(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"div",12),_.NdJ("click",function(R){const Te=_.CHM(p).$implicit;return _.oxw(3).doSelect(Te),_.KtG(R.preventDefault())}),_.YNc(1,ka,1,2,"ng-template",13),_.qZA()}if(2&y){const p=C.$implicit;_.ekj("disabled",p.context.disabled)("hidden",p.hidden)("ngb-dp-today",p.context.today),_.Q6J("tabindex",p.tabindex),_.uIk("aria-label",p.ariaLabel),_.xp6(1),_.Q6J("ngIf",!p.hidden)}}function Nl(y,C){if(1&y&&(_.TgZ(0,"div",8),_.YNc(1,Oo,2,1,"div",9),_.YNc(2,_u,2,9,"div",10),_.qZA()),2&y){const p=_.oxw().$implicit,T=_.oxw();_.xp6(1),_.Q6J("ngIf",T.datepicker.showWeekNumbers),_.xp6(1),_.Q6J("ngForOf",p.days)}}function kl(y,C){1&y&&_.YNc(0,Nl,3,2,"div",7),2&y&&_.Q6J("ngIf",!C.$implicit.collapsed)}const vl=["dialog"];function ie(y,C){1&y&&(_.TgZ(0,"span",9),_.SDv(1,10),_.qZA())}function H(y,C){1&y&&(_.TgZ(0,"span",9),_.SDv(1,11),_.qZA())}function ce(y,C){1&y&&(_.TgZ(0,"span",9),_.SDv(1,12),_.qZA())}function He(y,C){1&y&&(_.TgZ(0,"span",9),_.SDv(1,13),_.qZA())}function Dt(y,C){1&y&&_._uU(0,"...")}function Yt(y,C){1&y&&(_.TgZ(0,"span",15),_._uU(1,"(current)"),_.qZA())}function Ln(y,C){if(1&y&&(_._uU(0),_.YNc(1,Yt,2,0,"span",14)),2&y){const p=C.$implicit,T=C.currentPage;_.hij(" ",p," "),_.xp6(1),_.Q6J("ngIf",p===T)}}function fi(y,C){}const Si=function(y){return{disabled:!0,currentPage:y}};function qn(y,C){if(1&y&&(_.TgZ(0,"a",20),_.YNc(1,fi,0,0,"ng-template",8),_.qZA()),2&y){const p=_.oxw(2).$implicit,T=_.oxw(),R=_.MAs(9);_.xp6(1),_.Q6J("ngTemplateOutlet",(null==T.tplEllipsis?null:T.tplEllipsis.templateRef)||R)("ngTemplateOutletContext",_.VKq(2,Si,p))}}function Ii(y,C){}const xr=function(y,C,p){return{disabled:y,$implicit:C,currentPage:p}};function or(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"a",21),_.NdJ("click",function(R){_.CHM(p);const W=_.oxw().$implicit;return _.oxw(2).selectPage(W),_.KtG(R.preventDefault())}),_.YNc(1,Ii,0,0,"ng-template",8),_.qZA()}if(2&y){const p=_.oxw().$implicit,T=_.oxw(),R=T.disabled,W=T.$implicit,Te=_.oxw(),Ge=_.MAs(11);_.uIk("tabindex",R?"-1":null)("aria-disabled",R?"true":null),_.xp6(1),_.Q6J("ngTemplateOutlet",(null==Te.tplNumber?null:Te.tplNumber.templateRef)||Ge)("ngTemplateOutletContext",_.kEZ(4,xr,R,p,W))}}function Do(y,C){if(1&y&&(_.TgZ(0,"li",17),_.YNc(1,qn,2,4,"a",18),_.YNc(2,or,2,8,"a",19),_.qZA()),2&y){const p=C.$implicit,T=_.oxw(),R=T.$implicit,W=T.disabled,Te=_.oxw();_.ekj("active",p===R)("disabled",Te.isEllipsis(p)||W),_.uIk("aria-current",p===R?"page":null),_.xp6(1),_.Q6J("ngIf",Te.isEllipsis(p)),_.xp6(1),_.Q6J("ngIf",!Te.isEllipsis(p))}}function Ds(y,C){1&y&&_.YNc(0,Do,3,7,"li",16),2&y&&_.Q6J("ngForOf",C.pages)}function zo(y,C){}const Ro=function(y,C){return{disabled:y,currentPage:C}};function os(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"li",17)(1,"a",22),_.NdJ("click",function(R){return _.CHM(p),_.oxw().selectPage(1),_.KtG(R.preventDefault())}),_.YNc(2,zo,0,0,"ng-template",8),_.qZA()()}if(2&y){const p=_.oxw(),T=_.MAs(1);_.ekj("disabled",p.previousDisabled()),_.xp6(1),_.uIk("tabindex",p.previousDisabled()?"-1":null)("aria-disabled",p.previousDisabled()?"true":null),_.xp6(1),_.Q6J("ngTemplateOutlet",(null==p.tplFirst?null:p.tplFirst.templateRef)||T)("ngTemplateOutletContext",_.WLB(6,Ro,p.previousDisabled(),p.page))}}function Ai(y,C){}const sa=function(y){return{disabled:y}};function Bl(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"li",17)(1,"a",23),_.NdJ("click",function(R){_.CHM(p);const W=_.oxw();return W.selectPage(W.page-1),_.KtG(R.preventDefault())}),_.YNc(2,Ai,0,0,"ng-template",8),_.qZA()()}if(2&y){const p=_.oxw(),T=_.MAs(3);_.ekj("disabled",p.previousDisabled()),_.xp6(1),_.uIk("tabindex",p.previousDisabled()?"-1":null)("aria-disabled",p.previousDisabled()?"true":null),_.xp6(1),_.Q6J("ngTemplateOutlet",(null==p.tplPrevious?null:p.tplPrevious.templateRef)||T)("ngTemplateOutletContext",_.VKq(6,sa,p.previousDisabled()))}}function pc(y,C){}function js(y,C){}function mc(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"li",17)(1,"a",24),_.NdJ("click",function(R){_.CHM(p);const W=_.oxw();return W.selectPage(W.page+1),_.KtG(R.preventDefault())}),_.YNc(2,js,0,0,"ng-template",8),_.qZA()()}if(2&y){const p=_.oxw(),T=_.MAs(5);_.ekj("disabled",p.nextDisabled()),_.xp6(1),_.uIk("tabindex",p.nextDisabled()?"-1":null)("aria-disabled",p.nextDisabled()?"true":null),_.xp6(1),_.Q6J("ngTemplateOutlet",(null==p.tplNext?null:p.tplNext.templateRef)||T)("ngTemplateOutletContext",_.WLB(6,Ro,p.nextDisabled(),p.page))}}function Fa(y,C){}function yu(y,C){if(1&y){const p=_.EpF();_.TgZ(0,"li",17)(1,"a",25),_.NdJ("click",function(R){_.CHM(p);const W=_.oxw();return W.selectPage(W.pageCount),_.KtG(R.preventDefault())}),_.YNc(2,Fa,0,0,"ng-template",8),_.qZA()()}if(2&y){const p=_.oxw(),T=_.MAs(7);_.ekj("disabled",p.nextDisabled()),_.xp6(1),_.uIk("tabindex",p.nextDisabled()?"-1":null)("aria-disabled",p.nextDisabled()?"true":null),_.xp6(1),_.Q6J("ngTemplateOutlet",(null==p.tplLast?null:p.tplLast.templateRef)||T)("ngTemplateOutletContext",_.WLB(6,Ro,p.nextDisabled(),p.page))}}const aa=function(y,C,p){return{$implicit:y,pages:C,disabled:p}};function To(y){return parseInt(`${y}`,10)}function no(y){return"string"==typeof y}function yo(y){return!isNaN(To(y))}function ho(y){return"number"==typeof y&&isFinite(y)&&Math.floor(y)===y}function ss(y){return null!=y}function Yc(y){return yo(y)?`0${y}`.slice(-2):""}function Zl(y,C){return y&&y.className&&y.className.split&&y.className.split(/\s+/).indexOf(C)>=0}function za(y){return(y||document.body).getBoundingClientRect()}const Rs={animation:!0,transitionTimerDelayMs:5},ql=()=>{},{transitionTimerDelayMs:as}=Rs,Ns=new Map,Hr=(y,C,p,T)=>{let R=T.context||{};const W=Ns.get(C);if(W)switch(T.runningTransition){case"continue":return c.E;case"stop":y.run(()=>W.transition$.complete()),R=Object.assign(W.context,R),Ns.delete(C)}const Te=p(C,T.animation,R)||ql;if(!T.animation||"none"===window.getComputedStyle(C).transitionProperty)return y.run(()=>Te()),(0,ze.of)(void 0).pipe(function Uo(y){return C=>new ot.y(p=>C.subscribe({next:Te=>y.run(()=>p.next(Te)),error:Te=>y.run(()=>p.error(Te)),complete:()=>y.run(()=>p.complete())}))}(y));const Ge=new Vt.x,Xe=new Vt.x,yt=Ge.pipe(function ai(...y){return C=>(0,ti.z)(C,(0,ze.of)(...y))}(!0));Ns.set(C,{transition$:Ge,complete:()=>{Xe.next(),Xe.complete()},context:R});const bt=function Dl(y){const{transitionDelay:C,transitionDuration:p}=window.getComputedStyle(y);return 1e3*(parseFloat(C)+parseFloat(p))}(C);return y.runOutsideAngular(()=>{const Nn=Xt(C,"transitionend").pipe(vi(yt),(0,cr.h)(({target:Gn})=>Gn===C));Di(_n(bt+as).pipe(vi(yt)),Nn,Xe).pipe(vi(yt)).subscribe(()=>{Ns.delete(C),y.run(()=>{Te(),Ge.next(),Ge.complete()})})}),Ge.asObservable()},Dn=(y,C,p)=>{let{direction:T,maxHeight:R}=p;const{classList:W}=y;function Te(){W.add("collapse"),"show"===T?W.add("show"):W.remove("show")}if(C)return R||(R=function Xc(y){if(typeof navigator>"u")return"0px";const{classList:C}=y,p=C.contains("show");p||C.add("show"),y.style.height="";const T=y.getBoundingClientRect().height+"px";return p||C.remove("show"),T}(y),p.maxHeight=R,y.style.height="show"!==T?R:"0px",W.remove("collapse"),W.remove("collapsing"),W.remove("show"),za(y),W.add("collapsing")),y.style.height="show"===T?R:"0px",()=>{Te(),W.remove("collapsing"),y.style.height=""};Te()};let Qi=(()=>{class y{constructor(){this.animation=Rs.animation}}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),io=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Qc=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),ke=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Tt=(()=>{class y{constructor(p){this._ngbConfig=p}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(p){this._animation=p}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(Qi))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),En=(()=>{class y{constructor(p,T,R){this._element=p,this._zone=R,this.collapsed=!1,this.ngbCollapseChange=new _.vpe,this.shown=new _.vpe,this.hidden=new _.vpe,this.animation=T.animation}ngOnInit(){this._runTransition(this.collapsed,!1)}ngOnChanges({collapsed:p}){p.firstChange||this._runTransitionWithEvents(this.collapsed,this.animation)}toggle(p=this.collapsed){this.collapsed=!p,this.ngbCollapseChange.next(this.collapsed),this._runTransitionWithEvents(this.collapsed,this.animation)}_runTransition(p,T){return Hr(this._zone,this._element.nativeElement,Dn,{animation:T,runningTransition:"stop",context:{direction:p?"hide":"show"}})}_runTransitionWithEvents(p,T){this._runTransition(p,T).subscribe(()=>{p?this.hidden.emit():this.shown.emit()})}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.SBq),_.Y36(Tt),_.Y36(_.R0b))},y.\u0275dir=_.lG2({type:y,selectors:[["","ngbCollapse",""]],inputs:{animation:"animation",collapsed:["ngbCollapse","collapsed"]},outputs:{ngbCollapseChange:"ngbCollapseChange",shown:"shown",hidden:"hidden"},exportAs:["ngbCollapse"],features:[_.TTD]}),y})(),gi=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({}),y})();class gn{constructor(C,p,T){this.year=ho(C)?C:null,this.month=ho(p)?p:null,this.day=ho(T)?T:null}static from(C){return C instanceof gn?C:C?new gn(C.year,C.month,C.day):null}equals(C){return null!=C&&this.year===C.year&&this.month===C.month&&this.day===C.day}before(C){return!!C&&(this.year===C.year?this.month===C.month?this.day!==C.day&&this.day<C.day:this.month<C.month:this.year<C.year)}after(C){return!!C&&(this.year===C.year?this.month===C.month?this.day!==C.day&&this.day>C.day:this.month>C.month:this.year>C.year)}}function er(y,C){return!function $s(y,C){return!y&&!C||!!y&&!!C&&y.equals(C)}(y,C)}function ls(y,C){return!(!y&&!C||y&&C&&y.year===C.year&&y.month===C.month)}function d(y,C,p){return y&&C&&y.before(C)?C:y&&p&&y.after(p)?p:y||null}function i(y,C){const{minDate:p,maxDate:T,disabled:R,markDisabled:W}=C;return!(null==y||R||W&&W(y,{year:y.year,month:y.month})||p&&y.before(p)||T&&y.after(T))}function $(y){return new gn(y.getFullYear(),y.getMonth()+1,y.getDate())}function Z(y){const C=new Date(y.year,y.month-1,y.day,12);return isNaN(C.getTime())||C.setFullYear(y.year),C}let se=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:function(){return function ne(){return new ve}()},providedIn:"root"}),y})(),ve=(()=>{class y extends se{getDaysPerWeek(){return 7}getMonths(){return[1,2,3,4,5,6,7,8,9,10,11,12]}getWeeksPerMonth(){return 6}getNext(p,T="d",R=1){let W=Z(p),Te=!0,Ge=W.getMonth();switch(T){case"y":W.setFullYear(W.getFullYear()+R);break;case"m":Ge+=R,W.setMonth(Ge),Ge%=12,Ge<0&&(Ge+=12);break;case"d":W.setDate(W.getDate()+R),Te=!1;break;default:return p}return Te&&W.getMonth()!==Ge&&W.setDate(0),$(W)}getPrev(p,T="d",R=1){return this.getNext(p,T,-R)}getWeekday(p){let R=Z(p).getDay();return 0===R?7:R}getWeekNumber(p,T){7===T&&(T=0);const Te=Z(p[(11-T)%7]);Te.setDate(Te.getDate()+4-(Te.getDay()||7));const Ge=Te.getTime();return Te.setMonth(0),Te.setDate(1),Math.floor(Math.round((Ge-Te.getTime())/864e5)/7)+1}getToday(){return $(new Date)}isValid(p){if(!(p&&ho(p.year)&&ho(p.month)&&ho(p.day)&&0!==p.year))return!1;const T=Z(p);return!isNaN(T.getTime())&&T.getFullYear()===p.year&&T.getMonth()+1===p.month&&T.getDate()===p.day}}return y.\u0275fac=function(){let C;return function(T){return(C||(C=_.n5z(y)))(T||y)}}(),y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac}),y})(),me=(()=>{class y{getMonthLabel(p){return`${this.getMonthFullName(p.month,p.year)} ${this.getYearNumerals(p.year)}`}getDayNumerals(p){return`${p.day}`}getWeekNumerals(p){return`${p}`}getYearNumerals(p){return`${p}`}getWeekLabel(){return""}}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:function(p){let T=null;return T=p?new p:function de(y){return new ge(y)}(_.LFG(_.soG)),T},providedIn:"root"}),y})(),ge=(()=>{class y extends me{constructor(p){super(),this._locale=p,this._monthsShort=(0,Q.UT)(p,Q.x.Standalone,Q.Tn.Abbreviated),this._monthsFull=(0,Q.UT)(p,Q.x.Standalone,Q.Tn.Wide)}getWeekdayLabel(p,T){const R=(0,Q.Mn)(this._locale,Q.x.Standalone,void 0===T?Q.Tn.Short:T);return R.map((Te,Ge)=>R[(Ge+1)%7])[p-1]||""}getMonthShortName(p){return this._monthsShort[p-1]||""}getMonthFullName(p){return this._monthsFull[p-1]||""}getDayAriaLabel(p){const T=new Date(p.year,p.month-1,p.day);return(0,Q.p6)(T,"fullDate",this._locale)}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(_.soG))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac}),y})(),fe=(()=>{class y{constructor(p,T){this._calendar=p,this._i18n=T,this._VALIDATORS={dayTemplateData:R=>{if(this._state.dayTemplateData!==R)return{dayTemplateData:R}},displayMonths:R=>{if(ho(R=To(R))&&R>0&&this._state.displayMonths!==R)return{displayMonths:R}},disabled:R=>{if(this._state.disabled!==R)return{disabled:R}},firstDayOfWeek:R=>{if(ho(R=To(R))&&R>=0&&this._state.firstDayOfWeek!==R)return{firstDayOfWeek:R}},focusVisible:R=>{if(this._state.focusVisible!==R&&!this._state.disabled)return{focusVisible:R}},markDisabled:R=>{if(this._state.markDisabled!==R)return{markDisabled:R}},maxDate:R=>{const W=this.toValidDate(R,null);if(er(this._state.maxDate,W))return{maxDate:W}},minDate:R=>{const W=this.toValidDate(R,null);if(er(this._state.minDate,W))return{minDate:W}},navigation:R=>{if(this._state.navigation!==R)return{navigation:R}},outsideDays:R=>{if(this._state.outsideDays!==R)return{outsideDays:R}},weekdays:R=>{const W=!0===R||!1===R?Q.Tn.Short:R,Te=!0!==R&&!1!==R||R;if(this._state.weekdayWidth!==W||this._state.weekdaysVisible!==Te)return{weekdayWidth:W,weekdaysVisible:Te}}},this._model$=new Vt.x,this._dateSelect$=new Vt.x,this._state={dayTemplateData:null,markDisabled:null,maxDate:null,minDate:null,disabled:!1,displayMonths:1,firstDate:null,firstDayOfWeek:1,lastDate:null,focusDate:null,focusVisible:!1,months:[],navigation:"select",outsideDays:"visible",prevDisabled:!1,nextDisabled:!1,selectedDate:null,selectBoxes:{years:[],months:[]},weekdayWidth:Q.Tn.Short,weekdaysVisible:!0}}get model$(){return this._model$.pipe((0,cr.h)(p=>p.months.length>0))}get dateSelect$(){return this._dateSelect$.pipe((0,cr.h)(p=>null!==p))}set(p){let T=Object.keys(p).map(R=>this._VALIDATORS[R](p[R])).reduce((R,W)=>({...R,...W}),{});Object.keys(T).length>0&&this._nextState(T)}focus(p){const T=this.toValidDate(p,null);null!=T&&!this._state.disabled&&er(this._state.focusDate,T)&&this._nextState({focusDate:p})}focusSelect(){i(this._state.focusDate,this._state)&&this.select(this._state.focusDate,{emitEvent:!0})}open(p){const T=this.toValidDate(p,this._calendar.getToday());null!=T&&!this._state.disabled&&(!this._state.firstDate||ls(this._state.firstDate,T))&&this._nextState({firstDate:T})}select(p,T={}){const R=this.toValidDate(p,null);null!=R&&!this._state.disabled&&(er(this._state.selectedDate,R)&&this._nextState({selectedDate:R}),T.emitEvent&&i(R,this._state)&&this._dateSelect$.next(R))}toValidDate(p,T){const R=gn.from(p);return void 0===T&&(T=this._calendar.getToday()),this._calendar.isValid(R)?R:T}getMonth(p){for(let T of this._state.months)if(p.month===T.number&&p.year===T.year)return T;throw new Error(`month ${p.month} of year ${p.year} not found`)}_nextState(p){const T=this._updateState(p);this._patchContexts(T),this._state=T,this._model$.next(this._state)}_patchContexts(p){const{months:T,displayMonths:R,selectedDate:W,focusDate:Te,focusVisible:Ge,disabled:Xe,outsideDays:yt}=p;p.months.forEach(bt=>{bt.weeks.forEach(Nn=>{Nn.days.forEach(pn=>{Te&&(pn.context.focused=Te.equals(pn.date)&&Ge),pn.tabindex=!Xe&&Te&&pn.date.equals(Te)&&Te.month===bt.number?0:-1,!0===Xe&&(pn.context.disabled=!0),void 0!==W&&(pn.context.selected=null!==W&&W.equals(pn.date)),bt.number!==pn.date.month&&(pn.hidden="hidden"===yt||"collapsed"===yt||R>1&&pn.date.after(T[0].firstDate)&&pn.date.before(T[R-1].lastDate))})})})}_updateState(p){const T=Object.assign({},this._state,p);let R=T.firstDate;if(("minDate"in p||"maxDate"in p)&&(function la(y,C){if(C&&y&&C.before(y))throw new Error(`'maxDate' ${C} should be greater than 'minDate' ${y}`)}(T.minDate,T.maxDate),T.focusDate=d(T.focusDate,T.minDate,T.maxDate),T.firstDate=d(T.firstDate,T.minDate,T.maxDate),R=T.focusDate),"disabled"in p&&(T.focusVisible=!1),"selectedDate"in p&&0===this._state.months.length&&(R=T.selectedDate),"focusVisible"in p||"focusDate"in p&&(T.focusDate=d(T.focusDate,T.minDate,T.maxDate),R=T.focusDate,0!==T.months.length&&T.focusDate&&!T.focusDate.before(T.firstDate)&&!T.focusDate.after(T.lastDate)))return T;if("firstDate"in p&&(T.firstDate=d(T.firstDate,T.minDate,T.maxDate),R=T.firstDate),R){const Te=function S(y,C,p,T,R){const{displayMonths:W,months:Te}=p,Ge=Te.splice(0,Te.length);return Array.from({length:W},(yt,bt)=>{const Nn=Object.assign(y.getNext(C,"m",bt),{day:1});if(Te[bt]=null,!R){const pn=Ge.findIndex(Gn=>Gn.firstDate.equals(Nn));-1!==pn&&(Te[bt]=Ge.splice(pn,1)[0])}return Nn}).forEach((yt,bt)=>{null===Te[bt]&&(Te[bt]=function P(y,C,p,T,R={}){const{dayTemplateData:W,minDate:Te,maxDate:Ge,firstDayOfWeek:Xe,markDisabled:yt,outsideDays:bt,weekdayWidth:Nn,weekdaysVisible:pn}=p,Gn=y.getToday();R.firstDate=null,R.lastDate=null,R.number=C.month,R.year=C.year,R.weeks=R.weeks||[],R.weekdays=R.weekdays||[],C=function F(y,C,p){const T=y.getDaysPerWeek(),R=new gn(C.year,C.month,1),W=y.getWeekday(R)%T;return y.getPrev(R,"d",(T+W-p)%T)}(y,C,Xe),pn||(R.weekdays.length=0);for(let Zi=0;Zi<y.getWeeksPerMonth();Zi++){let ri=R.weeks[Zi];ri||(ri=R.weeks[Zi]={number:0,days:[],collapsed:!0});const Li=ri.days;for(let ur=0;ur<y.getDaysPerWeek();ur++){0===Zi&&pn&&(R.weekdays[ur]=T.getWeekdayLabel(y.getWeekday(C),Nn));const Pi=new gn(C.year,C.month,C.day),oo=y.getNext(Pi),ar=T.getDayAriaLabel(Pi);let hr=!!(Te&&Pi.before(Te)||Ge&&Pi.after(Ge));!hr&&yt&&(hr=yt(Pi,{month:R.number,year:R.year}));let lr=Pi.equals(Gn),Jr=W?W(Pi,{month:R.number,year:R.year}):void 0;null===R.firstDate&&Pi.month===R.number&&(R.firstDate=Pi),Pi.month===R.number&&oo.month!==R.number&&(R.lastDate=Pi);let Ar=Li[ur];Ar||(Ar=Li[ur]={}),Ar.date=Pi,Ar.context=Object.assign(Ar.context||{},{$implicit:Pi,date:Pi,data:Jr,currentMonth:R.number,currentYear:R.year,disabled:hr,focused:!1,selected:!1,today:lr}),Ar.tabindex=-1,Ar.ariaLabel=ar,Ar.hidden=!1,C=oo}ri.number=y.getWeekNumber(Li.map(ur=>ur.date),Xe),ri.collapsed="collapsed"===bt&&Li[0].date.month!==R.number&&Li[Li.length-1].date.month!==R.number}return R}(y,yt,p,T,Ge.shift()||{}))}),Te}(this._calendar,R,T,this._i18n,"dayTemplateData"in p||"firstDayOfWeek"in p||"markDisabled"in p||"minDate"in p||"maxDate"in p||"disabled"in p||"outsideDays"in p||"weekdaysVisible"in p);T.months=Te,T.firstDate=Te[0].firstDate,T.lastDate=Te[Te.length-1].lastDate,"selectedDate"in p&&!i(T.selectedDate,T)&&(T.selectedDate=null),"firstDate"in p&&(!T.focusDate||T.focusDate.before(T.firstDate)||T.focusDate.after(T.lastDate))&&(T.focusDate=R);const Ge=!this._state.firstDate||this._state.firstDate.year!==T.firstDate.year,Xe=!this._state.firstDate||this._state.firstDate.month!==T.firstDate.month;"select"===T.navigation?(("minDate"in p||"maxDate"in p||0===T.selectBoxes.years.length||Ge)&&(T.selectBoxes.years=function m(y,C,p){if(!y)return[];const T=C?Math.max(C.year,y.year-500):y.year-10,W=(p?Math.min(p.year,y.year+500):y.year+10)-T+1,Te=Array(W);for(let Ge=0;Ge<W;Ge++)Te[Ge]=T+Ge;return Te}(T.firstDate,T.minDate,T.maxDate)),("minDate"in p||"maxDate"in p||0===T.selectBoxes.months.length||Ge)&&(T.selectBoxes.months=function l(y,C,p,T){if(!C)return[];let R=y.getMonths(C.year);if(p&&C.year===p.year){const W=R.findIndex(Te=>Te===p.month);R=R.slice(W)}if(T&&C.year===T.year){const W=R.findIndex(Te=>Te===T.month);R=R.slice(0,W+1)}return R}(this._calendar,T.firstDate,T.minDate,T.maxDate))):T.selectBoxes={years:[],months:[]},("arrows"===T.navigation||"select"===T.navigation)&&(Xe||Ge||"minDate"in p||"maxDate"in p||"disabled"in p)&&(T.prevDisabled=T.disabled||function w(y,C,p){const T=Object.assign(y.getPrev(C,"m"),{day:1});return null!=p&&(T.year===p.year&&T.month<p.month||T.year<p.year&&1===p.month)}(this._calendar,T.firstDate,T.minDate),T.nextDisabled=T.disabled||function x(y,C,p){const T=Object.assign(y.getNext(C,"m"),{day:1});return null!=p&&T.after(p)}(this._calendar,T.lastDate,T.maxDate))}return T}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(se),_.LFG(me))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac}),y})();var De=(()=>{return(y=De||(De={}))[y.PREV=0]="PREV",y[y.NEXT=1]="NEXT",De;var y})();let we=(()=>{class y{constructor(){this.displayMonths=1,this.firstDayOfWeek=1,this.navigation="select",this.outsideDays="visible",this.showWeekNumbers=!1,this.weekdays=Q.Tn.Short}}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),Ue=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:function(){return function qe(){return new Ne}()},providedIn:"root"}),y})(),Ne=(()=>{class y extends Ue{fromModel(p){return p&&ho(p.year)&&ho(p.month)&&ho(p.day)?{year:p.year,month:p.month,day:p.day}:null}toModel(p){return p&&ho(p.year)&&ho(p.month)&&ho(p.day)?{year:p.year,month:p.month,day:p.day}:null}}return y.\u0275fac=function(){let C;return function(T){return(C||(C=_.n5z(y)))(T||y)}}(),y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac}),y})(),je=(()=>{class y{constructor(p,T){this.i18n=p,this._renderer=T,this.select=new _.vpe,this._month=-1,this._year=-1}changeMonth(p){this.select.emit(new gn(this.date.year,To(p),1))}changeYear(p){this.select.emit(new gn(To(p),this.date.month,1))}ngAfterViewChecked(){this.date&&(this.date.month!==this._month&&(this._month=this.date.month,this._renderer.setProperty(this.monthSelect.nativeElement,"value",this._month)),this.date.year!==this._year&&(this._year=this.date.year,this._renderer.setProperty(this.yearSelect.nativeElement,"value",this._year)))}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(me),_.Y36(_.Qsj))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-datepicker-navigation-select"]],viewQuery:function(p,T){if(1&p&&(_.Gf(fc,7,_.SBq),_.Gf(rs,7,_.SBq)),2&p){let R;_.iGM(R=_.CRH())&&(T.monthSelect=R.first),_.iGM(R=_.CRH())&&(T.yearSelect=R.first)}},inputs:{date:"date",disabled:"disabled",months:"months",years:"years"},outputs:{select:"select"},decls:6,vars:4,consts:function(){let C,p,T,R;return C=$localize`:@@ngb.datepicker.select-month:Select month`,p=$localize`:@@ngb.datepicker.select-month:Select month`,T=$localize`:@@ngb.datepicker.select-year:Select year`,R=$localize`:@@ngb.datepicker.select-year:Select year`,[["aria-label",C,"title",p,1,"form-select",3,"disabled","change"],["month",""],[3,"value",4,"ngFor","ngForOf"],["aria-label",T,"title",R,1,"form-select",3,"disabled","change"],["year",""],[3,"value"]]},template:function(p,T){1&p&&(_.TgZ(0,"select",0,1),_.NdJ("change",function(W){return T.changeMonth(W.target.value)}),_.YNc(2,va,2,3,"option",2),_.qZA(),_.TgZ(3,"select",3,4),_.NdJ("change",function(W){return T.changeYear(W.target.value)}),_.YNc(5,Qa,2,2,"option",2),_.qZA()),2&p&&(_.Q6J("disabled",T.disabled),_.xp6(2),_.Q6J("ngForOf",T.months),_.xp6(1),_.Q6J("disabled",T.disabled),_.xp6(2),_.Q6J("ngForOf",T.years))},dependencies:[Q.sg,Nt.YN,Nt.Kr],styles:["ngb-datepicker-navigation-select>.form-select{flex:1 1 auto;padding:0 .5rem;font-size:.875rem;height:1.85rem}ngb-datepicker-navigation-select>.form-select:focus{z-index:1}ngb-datepicker-navigation-select>.form-select::-ms-value{background-color:transparent!important}\n"],encapsulation:2,changeDetection:0}),y})(),Le=(()=>{class y{constructor(p){this.i18n=p,this.navigation=De,this.months=[],this.navigate=new _.vpe,this.select=new _.vpe}onClickPrev(p){p.currentTarget.focus(),this.navigate.emit(this.navigation.PREV)}onClickNext(p){p.currentTarget.focus(),this.navigate.emit(this.navigation.NEXT)}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(me))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-datepicker-navigation"]],inputs:{date:"date",disabled:"disabled",months:"months",showSelect:"showSelect",prevDisabled:"prevDisabled",nextDisabled:"nextDisabled",selectBoxes:"selectBoxes"},outputs:{navigate:"navigate",select:"select"},decls:8,vars:4,consts:function(){let C,p,T,R;return C=$localize`:@@ngb.datepicker.previous-month:Previous month`,p=$localize`:@@ngb.datepicker.previous-month:Previous month`,T=$localize`:@@ngb.datepicker.next-month:Next month`,R=$localize`:@@ngb.datepicker.next-month:Next month`,[[1,"ngb-dp-arrow"],["type","button","aria-label",C,"title",p,1,"btn","btn-link","ngb-dp-arrow-btn",3,"disabled","click"],[1,"ngb-dp-navigation-chevron"],["class","ngb-dp-navigation-select",3,"date","disabled","months","years","select",4,"ngIf"],[4,"ngIf"],[1,"ngb-dp-arrow","right"],["type","button","aria-label",T,"title",R,1,"btn","btn-link","ngb-dp-arrow-btn",3,"disabled","click"],[1,"ngb-dp-navigation-select",3,"date","disabled","months","years","select"],["ngFor","",3,"ngForOf"],["class","ngb-dp-arrow",4,"ngIf"],[1,"ngb-dp-month-name"]]},template:function(p,T){1&p&&(_.TgZ(0,"div",0)(1,"button",1),_.NdJ("click",function(W){return T.onClickPrev(W)}),_._UZ(2,"span",2),_.qZA()(),_.YNc(3,Jt,1,4,"ngb-datepicker-navigation-select",3),_.YNc(4,Lr,1,1,null,4),_.TgZ(5,"div",5)(6,"button",6),_.NdJ("click",function(W){return T.onClickNext(W)}),_._UZ(7,"span",2),_.qZA()()),2&p&&(_.xp6(1),_.Q6J("disabled",T.prevDisabled),_.xp6(2),_.Q6J("ngIf",T.showSelect),_.xp6(1),_.Q6J("ngIf",!T.showSelect),_.xp6(2),_.Q6J("disabled",T.nextDisabled))},dependencies:[Q.sg,Q.O5,je],styles:["ngb-datepicker-navigation{display:flex;align-items:center}.ngb-dp-navigation-chevron{border-style:solid;border-width:.2em .2em 0 0;display:inline-block;width:.75em;height:.75em;margin-left:.25em;margin-right:.15em;transform:rotate(-135deg)}.ngb-dp-arrow{display:flex;flex:1 1 auto;padding-right:0;padding-left:0;margin:0;width:2rem;height:2rem}.ngb-dp-arrow.right{justify-content:flex-end}.ngb-dp-arrow.right .ngb-dp-navigation-chevron{transform:rotate(45deg);margin-left:.15em;margin-right:.25em}.ngb-dp-arrow-btn{padding:0 .25rem;margin:0 .5rem;border:none;background-color:transparent;z-index:1}.ngb-dp-arrow-btn:focus{outline-width:1px;outline-style:auto}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.ngb-dp-arrow-btn:focus{outline-style:solid}}.ngb-dp-month-name{font-size:larger;height:2rem;line-height:2rem;text-align:center}.ngb-dp-navigation-select{display:flex;flex:1 1 9rem}\n"],encapsulation:2,changeDetection:0}),y})(),Je=(()=>{class y{constructor(p){this.i18n=p}isMuted(){return!this.selected&&(this.date.month!==this.currentMonth||this.disabled)}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(me))},y.\u0275cmp=_.Xpm({type:y,selectors:[["","ngbDatepickerDayView",""]],hostAttrs:[1,"btn-light"],hostVars:10,hostBindings:function(p,T){2&p&&_.ekj("bg-primary",T.selected)("text-white",T.selected)("text-muted",T.isMuted())("outside",T.isMuted())("active",T.focused)},inputs:{currentMonth:"currentMonth",date:"date",disabled:"disabled",focused:"focused",selected:"selected"},attrs:Na,decls:1,vars:1,template:function(p,T){1&p&&_._uU(0),2&p&&_.Oqu(T.i18n.getDayNumerals(T.date))},styles:["[ngbDatepickerDayView]{text-align:center;width:2rem;height:2rem;line-height:2rem;border-radius:.25rem;background:transparent}[ngbDatepickerDayView]:hover:not(.bg-primary),[ngbDatepickerDayView].active:not(.bg-primary){background-color:var(--bs-btn-bg);outline:1px solid var(--bs-border-color)}[ngbDatepickerDayView].outside{opacity:.5}\n"],encapsulation:2,changeDetection:0}),y})();var tt=(()=>{return(y=tt||(tt={}))[y.Tab=9]="Tab",y[y.Enter=13]="Enter",y[y.Escape=27]="Escape",y[y.Space=32]="Space",y[y.PageUp=33]="PageUp",y[y.PageDown=34]="PageDown",y[y.End=35]="End",y[y.Home=36]="Home",y[y.ArrowLeft=37]="ArrowLeft",y[y.ArrowUp=38]="ArrowUp",y[y.ArrowRight=39]="ArrowRight",y[y.ArrowDown=40]="ArrowDown",tt;var y})();let nn=(()=>{class y{processKey(p,T){const{state:R,calendar:W}=T;switch(p.which){case tt.PageUp:T.focusDate(W.getPrev(R.focusedDate,p.shiftKey?"y":"m",1));break;case tt.PageDown:T.focusDate(W.getNext(R.focusedDate,p.shiftKey?"y":"m",1));break;case tt.End:T.focusDate(p.shiftKey?R.maxDate:R.lastDate);break;case tt.Home:T.focusDate(p.shiftKey?R.minDate:R.firstDate);break;case tt.ArrowLeft:T.focusDate(W.getPrev(R.focusedDate,"d",1));break;case tt.ArrowUp:T.focusDate(W.getPrev(R.focusedDate,"d",W.getDaysPerWeek()));break;case tt.ArrowRight:T.focusDate(W.getNext(R.focusedDate,"d",1));break;case tt.ArrowDown:T.focusDate(W.getNext(R.focusedDate,"d",W.getDaysPerWeek()));break;case tt.Enter:case tt.Space:T.focusSelect();break;default:return}p.preventDefault(),p.stopPropagation()}}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),rt=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbDatepickerContent",""]]}),y})(),Pt=(()=>{class y{constructor(p,T,R,W,Te,Ge,Xe,yt){this._service=p,this._calendar=T,this.i18n=R,this._elementRef=Ge,this._ngbDateAdapter=Xe,this._ngZone=yt,this._controlValue=null,this._destroyed$=new Vt.x,this._publicState={},this.navigate=new _.vpe,this.dateSelect=new _.vpe,this.onChange=bt=>{},this.onTouched=()=>{},["dayTemplate","dayTemplateData","displayMonths","firstDayOfWeek","footerTemplate","markDisabled","minDate","maxDate","navigation","outsideDays","showWeekNumbers","startDate","weekdays"].forEach(bt=>this[bt]=W[bt]),p.dateSelect$.pipe(vi(this._destroyed$)).subscribe(bt=>{this.dateSelect.emit(bt)}),p.model$.pipe(vi(this._destroyed$)).subscribe(bt=>{const Nn=bt.firstDate,pn=this.model?this.model.firstDate:null;this._publicState={maxDate:bt.maxDate,minDate:bt.minDate,firstDate:bt.firstDate,lastDate:bt.lastDate,focusedDate:bt.focusDate,months:bt.months.map(ur=>ur.firstDate)};let Gn=!1;if(!Nn.equals(pn)&&(this.navigate.emit({current:pn?{year:pn.year,month:pn.month}:null,next:{year:Nn.year,month:Nn.month},preventDefault:()=>Gn=!0}),Gn&&null!==pn))return void this._service.open(pn);const Zi=bt.selectedDate,ri=bt.focusDate,Li=this.model?this.model.focusDate:null;this.model=bt,er(Zi,this._controlValue)&&(this._controlValue=Zi,this.onTouched(),this.onChange(this._ngbDateAdapter.toModel(Zi))),er(ri,Li)&&Li&&bt.focusVisible&&this.focus(),Te.markForCheck()})}get state(){return this._publicState}get calendar(){return this._calendar}focusDate(p){this._service.focus(gn.from(p))}focusSelect(){this._service.focusSelect()}focus(){this._ngZone.onStable.asObservable().pipe((0,Hi.q)(1)).subscribe(()=>{const p=this._elementRef.nativeElement.querySelector('div.ngb-dp-day[tabindex="0"]');p&&p.focus()})}navigateTo(p){this._service.open(gn.from(p?p.day?p:{...p,day:1}:null))}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{const p=Xt(this._contentEl.nativeElement,"focusin"),T=Xt(this._contentEl.nativeElement,"focusout"),{nativeElement:R}=this._elementRef;(0,vr.T)(p,T).pipe((0,cr.h)(({target:W,relatedTarget:Te})=>!(Zl(W,"ngb-dp-day")&&Zl(Te,"ngb-dp-day")&&R.contains(W)&&R.contains(Te))),vi(this._destroyed$)).subscribe(({type:W})=>this._ngZone.run(()=>this._service.set({focusVisible:"focusin"===W})))})}ngOnDestroy(){this._destroyed$.next()}ngOnInit(){if(void 0===this.model){const p={};["dayTemplateData","displayMonths","markDisabled","firstDayOfWeek","navigation","minDate","maxDate","outsideDays","weekdays"].forEach(T=>p[T]=this[T]),this._service.set(p),this.navigateTo(this.startDate)}this.dayTemplate||(this.dayTemplate=this._defaultDayTemplate)}ngOnChanges(p){const T={};if(["dayTemplateData","displayMonths","markDisabled","firstDayOfWeek","navigation","minDate","maxDate","outsideDays","weekdays"].filter(R=>R in p).forEach(R=>T[R]=this[R]),this._service.set(T),"startDate"in p){const{currentValue:R,previousValue:W}=p.startDate;ls(W,R)&&this.navigateTo(this.startDate)}}onDateSelect(p){this._service.focus(p),this._service.select(p,{emitEvent:!0})}onNavigateDateSelect(p){this._service.open(p)}onNavigateEvent(p){switch(p){case De.PREV:this._service.open(this._calendar.getPrev(this.model.firstDate,"m",1));break;case De.NEXT:this._service.open(this._calendar.getNext(this.model.firstDate,"m",1))}}registerOnChange(p){this.onChange=p}registerOnTouched(p){this.onTouched=p}setDisabledState(p){this._service.set({disabled:p})}writeValue(p){this._controlValue=gn.from(this._ngbDateAdapter.fromModel(p)),this._service.select(this._controlValue)}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(fe),_.Y36(se),_.Y36(me),_.Y36(we),_.Y36(_.sBO),_.Y36(_.SBq),_.Y36(Ue),_.Y36(_.R0b))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-datepicker"]],contentQueries:function(p,T,R){if(1&p&&_.Suo(R,rt,7),2&p){let W;_.iGM(W=_.CRH())&&(T.contentTemplate=W.first)}},viewQuery:function(p,T){if(1&p&&(_.Gf(xa,7),_.Gf(Bo,7)),2&p){let R;_.iGM(R=_.CRH())&&(T._defaultDayTemplate=R.first),_.iGM(R=_.CRH())&&(T._contentEl=R.first)}},hostVars:2,hostBindings:function(p,T){2&p&&_.ekj("disabled",T.model.disabled)},inputs:{dayTemplate:"dayTemplate",dayTemplateData:"dayTemplateData",displayMonths:"displayMonths",firstDayOfWeek:"firstDayOfWeek",footerTemplate:"footerTemplate",markDisabled:"markDisabled",maxDate:"maxDate",minDate:"minDate",navigation:"navigation",outsideDays:"outsideDays",showWeekNumbers:"showWeekNumbers",startDate:"startDate",weekdays:"weekdays"},outputs:{navigate:"navigate",dateSelect:"dateSelect"},exportAs:["ngbDatepicker"],features:[_._Bn([{provide:Nt.JU,useExisting:(0,_.Gpc)(()=>y),multi:!0},fe]),_.TTD],decls:10,vars:5,consts:[["defaultDayTemplate",""],["defaultContentTemplate",""],[1,"ngb-dp-header"],[3,"date","months","disabled","showSelect","prevDisabled","nextDisabled","selectBoxes","navigate","select",4,"ngIf"],[1,"ngb-dp-content"],["content",""],[3,"ngTemplateOutlet"],["ngbDatepickerDayView","",3,"date","currentMonth","selected","disabled","focused"],["class","ngb-dp-month",4,"ngFor","ngForOf"],[1,"ngb-dp-month"],["class","ngb-dp-month-name",4,"ngIf"],[3,"month"],[1,"ngb-dp-month-name"],[3,"date","months","disabled","showSelect","prevDisabled","nextDisabled","selectBoxes","navigate","select"]],template:function(p,T){if(1&p&&(_.YNc(0,J,1,5,"ng-template",null,0,_.W1O),_.YNc(2,ue,1,1,"ng-template",null,1,_.W1O),_.TgZ(4,"div",2),_.YNc(5,gt,1,7,"ngb-datepicker-navigation",3),_.qZA(),_.TgZ(6,"div",4,5),_.YNc(8,On,0,0,"ng-template",6),_.qZA(),_.YNc(9,Mi,0,0,"ng-template",6)),2&p){const R=_.MAs(3);_.xp6(5),_.Q6J("ngIf","none"!==T.navigation),_.xp6(1),_.ekj("ngb-dp-months",!T.contentTemplate),_.xp6(2),_.Q6J("ngTemplateOutlet",(null==T.contentTemplate?null:T.contentTemplate.templateRef)||R),_.xp6(1),_.Q6J("ngTemplateOutlet",T.footerTemplate)}},dependencies:function(){return[Q.sg,Q.O5,Q.tP,Bt,Le,Je]},styles:["ngb-datepicker{border:1px solid var(--bs-border-color);border-radius:.25rem;display:inline-block}ngb-datepicker-month{pointer-events:auto}ngb-datepicker.dropdown-menu{padding:0}ngb-datepicker.disabled .ngb-dp-weekday,ngb-datepicker.disabled .ngb-dp-week-number,ngb-datepicker.disabled .ngb-dp-month-name{color:var(--bs-text-muted)}.ngb-dp-body{z-index:1055}.ngb-dp-header{border-bottom:0;border-radius:.25rem .25rem 0 0;padding-top:.25rem;background-color:var(--bs-light)}.ngb-dp-months{display:flex}.ngb-dp-month{pointer-events:none}.ngb-dp-month-name{font-size:larger;height:2rem;line-height:2rem;text-align:center;background-color:var(--bs-light)}.ngb-dp-month+.ngb-dp-month .ngb-dp-month-name,.ngb-dp-month+.ngb-dp-month .ngb-dp-week{padding-left:1rem}.ngb-dp-month:last-child .ngb-dp-week{padding-right:.25rem}.ngb-dp-month:first-child .ngb-dp-week{padding-left:.25rem}.ngb-dp-month .ngb-dp-week:last-child{padding-bottom:.25rem}\n"],encapsulation:2,changeDetection:0}),y})(),Bt=(()=>{class y{constructor(p,T,R,W){this.i18n=p,this.datepicker=T,this._keyboardService=R,this._service=W}set month(p){this.viewModel=this._service.getMonth(p)}onKeyDown(p){this._keyboardService.processKey(p,this.datepicker)}doSelect(p){!p.context.disabled&&!p.hidden&&this.datepicker.onDateSelect(p.date)}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(me),_.Y36(Pt),_.Y36(nn),_.Y36(fe))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-datepicker-month"]],hostAttrs:["role","grid"],hostBindings:function(p,T){1&p&&_.NdJ("keydown",function(W){return T.onKeyDown(W)})},inputs:{month:"month"},decls:2,vars:2,consts:[["class","ngb-dp-week ngb-dp-weekdays","role","row",4,"ngIf"],["ngFor","",3,"ngForOf"],["role","row",1,"ngb-dp-week","ngb-dp-weekdays"],["class","ngb-dp-weekday ngb-dp-showweek small",4,"ngIf"],["class","ngb-dp-weekday small","role","columnheader",4,"ngFor","ngForOf"],[1,"ngb-dp-weekday","ngb-dp-showweek","small"],["role","columnheader",1,"ngb-dp-weekday","small"],["class","ngb-dp-week","role","row",4,"ngIf"],["role","row",1,"ngb-dp-week"],["class","ngb-dp-week-number small text-muted",4,"ngIf"],["class","ngb-dp-day","role","gridcell",3,"disabled","tabindex","hidden","ngb-dp-today","click",4,"ngFor","ngForOf"],[1,"ngb-dp-week-number","small","text-muted"],["role","gridcell",1,"ngb-dp-day",3,"tabindex","click"],[3,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(p,T){1&p&&(_.YNc(0,ws,3,2,"div",0),_.YNc(1,kl,1,1,"ng-template",1)),2&p&&(_.Q6J("ngIf",T.viewModel.weekdays.length>0),_.xp6(1),_.Q6J("ngForOf",T.viewModel.weeks))},dependencies:[Q.sg,Q.O5,Q.tP],styles:['ngb-datepicker-month{display:block}.ngb-dp-weekday,.ngb-dp-week-number{line-height:2rem;text-align:center;font-style:italic}.ngb-dp-weekday{color:var(--bs-info)}.ngb-dp-week{border-radius:.25rem;display:flex}.ngb-dp-weekdays{border-bottom:1px solid var(--bs-border-color);border-radius:0;background-color:var(--bs-light)}.ngb-dp-day,.ngb-dp-weekday,.ngb-dp-week-number{width:2rem;height:2rem}.ngb-dp-day{cursor:pointer}.ngb-dp-day.disabled,.ngb-dp-day.hidden{cursor:default;pointer-events:none}.ngb-dp-day[tabindex="0"]{z-index:1}\n'],encapsulation:2}),y})();const un=(y,C)=>!!C&&C.some(p=>p.contains(y)),_t=(y,C)=>!C||null!=function qu(y,C){return!C||typeof y.closest>"u"?null:y.closest(C)}(y,C),en=typeof navigator<"u"&&!!navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));function yn(y,C,p,T,R,W,Te,Ge){p&&y.runOutsideAngular((y=>en?()=>setTimeout(()=>y(),100):y)(()=>{const yt=Xt(C,"keydown").pipe(vi(R),(0,cr.h)(pn=>pn.which===tt.Escape),(0,zn.b)(pn=>pn.preventDefault())),bt=Xt(C,"mousedown").pipe((0,nr.U)(pn=>{const Gn=pn.target;return 2!==pn.button&&!un(Gn,Te)&&("inside"===p?un(Gn,W)&&_t(Gn,Ge):"outside"===p?!un(Gn,W):_t(Gn,Ge)||!un(Gn,W))}),vi(R)),Nn=Xt(C,"mouseup").pipe(Ho(bt),(0,cr.h)(([pn,Gn])=>Gn),function Oe(y,C=it){const p=_n(y,C);return Ve(()=>p)}(0),vi(R));Di([yt.pipe((0,nr.U)(pn=>0)),Nn.pipe((0,nr.U)(pn=>1))]).subscribe(pn=>y.run(()=>T(pn)))}))}const fn=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function Fn(y){const C=Array.from(y.querySelectorAll(fn)).filter(p=>-1!==p.tabIndex);return[C[0],C[C.length-1]]}const $n=(y,C,p,T=!1)=>{y.runOutsideAngular(()=>{const R=Xt(C,"focusin").pipe(vi(p),(0,nr.U)(W=>W.target));Xt(C,"keydown").pipe(vi(p),(0,cr.h)(W=>W.which===tt.Tab),Ho(R)).subscribe(([W,Te])=>{const[Ge,Xe]=Fn(C);(Te===Ge||Te===C)&&W.shiftKey&&(Xe.focus(),W.preventDefault()),Te===Xe&&!W.shiftKey&&(Ge.focus(),W.preventDefault())}),T&&Xt(C,"click").pipe(vi(p),Ho(R),(0,nr.U)(W=>W[1])).subscribe(W=>W.focus())})},ci=/\s+/,Fi=/  +/gi,Bn=/^start/,mi=/^end/,ji=/-(top|left)$/,Br=/-(bottom|right)$/,gr=/^left/,Ts=/^right/,Da=/^start/,Kl=/^end/;function Wr({placement:y,baseClass:C}){let p=Array.isArray(y)?y:y.split(ci),R=p.findIndex(Xe=>"auto"===Xe);R>=0&&["top","bottom","start","end","top-start","top-end","bottom-start","bottom-end","start-top","start-bottom","end-top","end-bottom"].forEach(function(Xe){null==p.find(yt=>-1!==yt.search("^"+Xe))&&p.splice(R++,1,Xe)});const W=p.map(Xe=>function fo(y){return y.replace(Bn,"left").replace(mi,"right").replace(ji,"-start").replace(Br,"-end")}(Xe));return{placement:W.shift(),modifiers:[{name:"bootstrapClasses",enabled:!!C,phase:"write",fn({state:Xe}){const yt=new RegExp(C+"(-[a-z]+)*","gi"),bt=Xe.elements.popper,Nn=Xe.placement;let pn=bt.className;pn=pn.replace(yt,""),pn+=` ${function Ir(y,C){let[p,T]=C.split("-");const R=p.replace(gr,"start").replace(Ts,"end");let W=[R];if(T){let Te=T;("left"===p||"right"===p)&&(Te=Te.replace(Da,"top").replace(Kl,"bottom")),W.push(`${R}-${Te}`)}return y&&(W=W.map(Te=>`${y}-${Te}`)),W.join(" ")}(C,Nn)}`,pn=pn.trim().replace(Fi," "),bt.className=pn}},Vs,Ma,_s,{enabled:!0,name:"flip",options:{fallbackPlacements:W}},{enabled:!0,name:"preventOverflow",phase:"main",fn:function(){}}]}}function bi(y){return y}function ro(){let y=null;return{createPopper(C){if(!y){let T=(C.updatePopperOptions||bi)(Wr(C));y=Ra(C.hostElement,C.targetElement,T)}},update(){y&&y.update()},setOptions(C){if(y){let T=(C.updatePopperOptions||bi)(Wr(C));y.setOptions(T)}},destroy(){y&&(y.destroy(),y=null)}}}let jo=(()=>{class y extends we{constructor(){super(...arguments),this.autoClose=!0,this.placement=["bottom-start","bottom-end","top-start","top-end"],this.restoreFocus=!0}}return y.\u0275fac=function(){let C;return function(T){return(C||(C=_.n5z(y)))(T||y)}}(),y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();function sr(y){return C=>(C.modifiers.push(yl,{name:"offset",options:{offset:()=>y}}),C)}let Tl=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:function(){return function Cs(){return new Hs}()},providedIn:"root"}),y})(),Hs=(()=>{class y extends Tl{parse(p){if(null!=p){const T=p.trim().split("-");if(1===T.length&&yo(T[0]))return{year:To(T[0]),month:null,day:null};if(2===T.length&&yo(T[0])&&yo(T[1]))return{year:To(T[0]),month:To(T[1]),day:null};if(3===T.length&&yo(T[0])&&yo(T[1])&&yo(T[2]))return{year:To(T[0]),month:To(T[1]),day:To(T[2])}}return null}format(p){return p?`${p.year}-${yo(p.month)?Yc(p.month):""}-${yo(p.day)?Yc(p.day):""}`:""}}return y.\u0275fac=function(){let C;return function(T){return(C||(C=_.n5z(y)))(T||y)}}(),y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac}),y})(),il=(()=>{class y{constructor(p,T,R,W,Te,Ge,Xe,yt,bt,Nn){this._parserFormatter=p,this._elRef=T,this._vcRef=R,this._renderer=W,this._ngZone=Te,this._calendar=Ge,this._dateAdapter=Xe,this._document=yt,this._changeDetector=bt,this._cRef=null,this._disabled=!1,this._elWithFocus=null,this._model=null,this._positioning=ro(),this._destroyCloseHandlers$=new Vt.x,this.dateSelect=new _.vpe,this.navigate=new _.vpe,this.closed=new _.vpe,this._onChange=pn=>{},this._onTouched=()=>{},this._validatorChange=()=>{},["autoClose","container","positionTarget","placement"].forEach(pn=>this[pn]=Nn[pn])}get disabled(){return this._disabled}set disabled(p){this._disabled=""===p||p&&"false"!==p,this.isOpen()&&this._cRef.instance.setDisabledState(this._disabled)}registerOnChange(p){this._onChange=p}registerOnTouched(p){this._onTouched=p}registerOnValidatorChange(p){this._validatorChange=p}setDisabledState(p){this.disabled=p}validate(p){const{value:T}=p;if(null!=T){const R=this._fromDateStruct(this._dateAdapter.fromModel(T));if(!R)return{ngbDate:{invalid:T}};if(this.minDate&&R.before(gn.from(this.minDate)))return{ngbDate:{minDate:{minDate:this.minDate,actual:T}}};if(this.maxDate&&R.after(gn.from(this.maxDate)))return{ngbDate:{maxDate:{maxDate:this.maxDate,actual:T}}}}return null}writeValue(p){this._model=this._fromDateStruct(this._dateAdapter.fromModel(p)),this._writeModelValue(this._model)}manualDateChange(p,T=!1){const R=p!==this._inputValue;R&&(this._inputValue=p,this._model=this._fromDateStruct(this._parserFormatter.parse(p))),(R||!T)&&this._onChange(this._model?this._dateAdapter.toModel(this._model):""===p?null:p),T&&this._model&&this._writeModelValue(this._model)}isOpen(){return!!this._cRef}open(){if(!this.isOpen()){let p;if(this._cRef=this._vcRef.createComponent(Pt),this._applyPopupStyling(this._cRef.location.nativeElement),this._applyDatepickerInputs(this._cRef),this._subscribeForDatepickerOutputs(this._cRef.instance),this._cRef.instance.ngOnInit(),this._cRef.instance.writeValue(this._dateAdapter.toModel(this._model)),this._cRef.instance.registerOnChange(T=>{this.writeValue(T),this._onChange(T),this._onTouched()}),this._cRef.changeDetectorRef.detectChanges(),this._cRef.instance.setDisabledState(this.disabled),"body"===this.container&&this._document.querySelector(this.container).appendChild(this._cRef.location.nativeElement),this._elWithFocus=this._document.activeElement,$n(this._ngZone,this._cRef.location.nativeElement,this.closed,!0),setTimeout(()=>this._cRef?.instance.focus()),p=no(this.positionTarget)?this._document.querySelector(this.positionTarget):this.positionTarget instanceof HTMLElement?this.positionTarget:this._elRef.nativeElement,this._ngZone.runOutsideAngular(()=>{this._cRef&&(this._positioning.createPopper({hostElement:p,targetElement:this._cRef.location.nativeElement,placement:this.placement,appendToBody:"body"===this.container,updatePopperOptions:sr([0,2])}),this._zoneSubscription=this._ngZone.onStable.subscribe(()=>this._positioning.update()))}),this.positionTarget&&!p)throw new Error("ngbDatepicker could not find element declared in [positionTarget] to position against.");this._setCloseHandlers()}}close(){if(this.isOpen()){this._vcRef.remove(this._vcRef.indexOf(this._cRef.hostView)),this._cRef=null,this._positioning.destroy(),this._zoneSubscription?.unsubscribe(),this._destroyCloseHandlers$.next(),this.closed.emit(),this._changeDetector.markForCheck();let p=this._elWithFocus;no(this.restoreFocus)?p=this._document.querySelector(this.restoreFocus):void 0!==this.restoreFocus&&(p=this.restoreFocus),p&&p.focus?p.focus():this._document.body.focus()}}toggle(){this.isOpen()?this.close():this.open()}navigateTo(p){this.isOpen()&&this._cRef.instance.navigateTo(p)}onBlur(){this._onTouched()}onFocus(){this._elWithFocus=this._elRef.nativeElement}ngOnChanges(p){if((p.minDate||p.maxDate)&&(this._validatorChange(),this.isOpen()&&(p.minDate&&(this._cRef.instance.minDate=this.minDate),p.maxDate&&(this._cRef.instance.maxDate=this.maxDate),this._cRef.instance.ngOnChanges(p))),p.datepickerClass){const{currentValue:T,previousValue:R}=p.datepickerClass;this._applyPopupClass(T,R)}p.autoClose&&this.isOpen()&&this._setCloseHandlers()}ngOnDestroy(){this.close()}_applyDatepickerInputs(p){["dayTemplate","dayTemplateData","displayMonths","firstDayOfWeek","footerTemplate","markDisabled","minDate","maxDate","navigation","outsideDays","showNavigation","showWeekNumbers","weekdays"].forEach(T=>{void 0!==this[T]&&p.setInput(T,this[T])}),p.setInput("startDate",this.startDate||this._model)}_applyPopupClass(p,T){const R=this._cRef?.location.nativeElement;R&&(p&&this._renderer.addClass(R,p),T&&this._renderer.removeClass(R,T))}_applyPopupStyling(p){this._renderer.addClass(p,"dropdown-menu"),this._renderer.addClass(p,"show"),"body"===this.container&&this._renderer.addClass(p,"ngb-dp-body"),this._applyPopupClass(this.datepickerClass)}_subscribeForDatepickerOutputs(p){p.navigate.subscribe(T=>this.navigate.emit(T)),p.dateSelect.subscribe(T=>{this.dateSelect.emit(T),(!0===this.autoClose||"inside"===this.autoClose)&&this.close()})}_writeModelValue(p){const T=this._parserFormatter.format(p);this._inputValue=T,this._renderer.setProperty(this._elRef.nativeElement,"value",T),this.isOpen()&&(this._cRef.instance.writeValue(this._dateAdapter.toModel(p)),this._onTouched())}_fromDateStruct(p){const T=p?new gn(p.year,p.month,p.day):null;return this._calendar.isValid(T)?T:null}_setCloseHandlers(){this._destroyCloseHandlers$.next(),yn(this._ngZone,this._document,this.autoClose,()=>this.close(),this._destroyCloseHandlers$,[],[this._elRef.nativeElement,this._cRef.location.nativeElement])}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(Tl),_.Y36(_.SBq),_.Y36(_.s_b),_.Y36(_.Qsj),_.Y36(_.R0b),_.Y36(se),_.Y36(Ue),_.Y36(Q.K0),_.Y36(_.sBO),_.Y36(jo))},y.\u0275dir=_.lG2({type:y,selectors:[["input","ngbDatepicker",""]],hostVars:1,hostBindings:function(p,T){1&p&&_.NdJ("input",function(W){return T.manualDateChange(W.target.value)})("change",function(W){return T.manualDateChange(W.target.value,!0)})("focus",function(){return T.onFocus()})("blur",function(){return T.onBlur()}),2&p&&_.Ikx("disabled",T.disabled)},inputs:{autoClose:"autoClose",datepickerClass:"datepickerClass",dayTemplate:"dayTemplate",dayTemplateData:"dayTemplateData",displayMonths:"displayMonths",firstDayOfWeek:"firstDayOfWeek",footerTemplate:"footerTemplate",markDisabled:"markDisabled",minDate:"minDate",maxDate:"maxDate",navigation:"navigation",outsideDays:"outsideDays",placement:"placement",restoreFocus:"restoreFocus",showWeekNumbers:"showWeekNumbers",startDate:"startDate",container:"container",positionTarget:"positionTarget",weekdays:"weekdays",disabled:"disabled"},outputs:{dateSelect:"dateSelect",navigate:"navigate",closed:"closed"},exportAs:["ngbDatepicker"],features:[_._Bn([{provide:Nt.JU,useExisting:(0,_.Gpc)(()=>y),multi:!0},{provide:Nt.Cf,useExisting:(0,_.Gpc)(()=>y),multi:!0},{provide:we,useExisting:jo}]),_.TTD]}),y})();new Date(1882,10,12),new Date(2174,10,25);let Ca=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez,Nt.u5]}),y})(),cs=(()=>{class y{constructor(){this.autoClose=!0,this.placement=["bottom-start","bottom-end","top-start","top-end"]}}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),dh=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275dir=_.lG2({type:y,selectors:[["",8,"navbar"]]}),y})(),Ga=(()=>{class y{constructor(p,T){this.elementRef=p,this._renderer=T,this._disabled=!1}set disabled(p){this._disabled=""===p||!0===p,this._renderer.setProperty(this.elementRef.nativeElement,"disabled",this._disabled)}get disabled(){return this._disabled}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.SBq),_.Y36(_.Qsj))},y.\u0275dir=_.lG2({type:y,selectors:[["","ngbDropdownItem",""]],hostAttrs:[1,"dropdown-item"],hostVars:3,hostBindings:function(p,T){2&p&&(_.Ikx("tabIndex",T.disabled?-1:0),_.ekj("disabled",T.disabled))},inputs:{disabled:"disabled"}}),y})(),Sd=(()=>{class y{constructor(p,T){this.dropdown=p,this.placement="bottom",this.isOpen=!1,this.nativeElement=T.nativeElement}}return y.\u0275fac=function(p){return new(p||y)(_.Y36((0,_.Gpc)(()=>Qu)),_.Y36(_.SBq))},y.\u0275dir=_.lG2({type:y,selectors:[["","ngbDropdownMenu",""]],contentQueries:function(p,T,R){if(1&p&&_.Suo(R,Ga,4),2&p){let W;_.iGM(W=_.CRH())&&(T.menuItems=W)}},hostVars:4,hostBindings:function(p,T){1&p&&_.NdJ("keydown.ArrowUp",function(W){return T.dropdown.onKeyDown(W)})("keydown.ArrowDown",function(W){return T.dropdown.onKeyDown(W)})("keydown.Home",function(W){return T.dropdown.onKeyDown(W)})("keydown.End",function(W){return T.dropdown.onKeyDown(W)})("keydown.Enter",function(W){return T.dropdown.onKeyDown(W)})("keydown.Space",function(W){return T.dropdown.onKeyDown(W)})("keydown.Tab",function(W){return T.dropdown.onKeyDown(W)})("keydown.Shift.Tab",function(W){return T.dropdown.onKeyDown(W)}),2&p&&_.ekj("dropdown-menu",!0)("show",T.dropdown.isOpen())}}),y})(),Ml=(()=>{class y{constructor(p,T){this.dropdown=p,this.nativeElement=T.nativeElement}}return y.\u0275fac=function(p){return new(p||y)(_.Y36((0,_.Gpc)(()=>Qu)),_.Y36(_.SBq))},y.\u0275dir=_.lG2({type:y,selectors:[["","ngbDropdownAnchor",""]],hostAttrs:[1,"dropdown-toggle"],hostVars:1,hostBindings:function(p,T){2&p&&_.uIk("aria-expanded",T.dropdown.isOpen())}}),y})(),jh=(()=>{class y extends Ml{constructor(p,T){super(p,T)}}return y.\u0275fac=function(p){return new(p||y)(_.Y36((0,_.Gpc)(()=>Qu)),_.Y36(_.SBq))},y.\u0275dir=_.lG2({type:y,selectors:[["","ngbDropdownToggle",""]],hostAttrs:[1,"dropdown-toggle"],hostVars:1,hostBindings:function(p,T){1&p&&_.NdJ("click",function(){return T.dropdown.toggle()})("keydown.ArrowUp",function(W){return T.dropdown.onKeyDown(W)})("keydown.ArrowDown",function(W){return T.dropdown.onKeyDown(W)})("keydown.Home",function(W){return T.dropdown.onKeyDown(W)})("keydown.End",function(W){return T.dropdown.onKeyDown(W)})("keydown.Tab",function(W){return T.dropdown.onKeyDown(W)})("keydown.Shift.Tab",function(W){return T.dropdown.onKeyDown(W)}),2&p&&_.uIk("aria-expanded",T.dropdown.isOpen())},features:[_._Bn([{provide:Ml,useExisting:(0,_.Gpc)(()=>y)}]),_.qOj]}),y})(),Qu=(()=>{class y{constructor(p,T,R,W,Te,Ge,Xe){this._changeDetector=p,this._document=R,this._ngZone=W,this._elementRef=Te,this._renderer=Ge,this._destroyCloseHandlers$=new Vt.x,this._bodyContainer=null,this._positioning=ro(),this._open=!1,this.openChange=new _.vpe,this.placement=T.placement,this.container=T.container,this.autoClose=T.autoClose,this.display=Xe?"static":"dynamic"}ngAfterContentInit(){this._ngZone.onStable.pipe((0,Hi.q)(1)).subscribe(()=>{this._applyPlacementClasses(),this._open&&this._setCloseHandlers()})}ngOnChanges(p){if(p.container&&this._open&&this._applyContainer(this.container),p.placement&&!p.placement.firstChange&&(this._positioning.setOptions({hostElement:this._anchor.nativeElement,targetElement:this._bodyContainer||this._menu.nativeElement,placement:this.placement,appendToBody:"body"===this.container}),this._applyPlacementClasses()),p.dropdownClass){const{currentValue:T,previousValue:R}=p.dropdownClass;this._applyCustomDropdownClass(T,R)}p.autoClose&&this._open&&(this.autoClose=p.autoClose.currentValue,this._setCloseHandlers())}isOpen(){return this._open}open(){this._open||(this._open=!0,this._applyContainer(this.container),this.openChange.emit(!0),this._setCloseHandlers(),this._anchor&&(this._anchor.nativeElement.focus(),"dynamic"===this.display&&this._ngZone.runOutsideAngular(()=>{this._positioning.createPopper({hostElement:this._anchor.nativeElement,targetElement:this._bodyContainer||this._menu.nativeElement,placement:this.placement,appendToBody:"body"===this.container,updatePopperOptions:sr([0,2])}),this._applyPlacementClasses(),this._zoneSubscription=this._ngZone.onStable.subscribe(()=>this._positionMenu())})))}_setCloseHandlers(){this._destroyCloseHandlers$.next(),yn(this._ngZone,this._document,this.autoClose,p=>{this.close(),0===p&&this._anchor.nativeElement.focus()},this._destroyCloseHandlers$,this._menu?[this._menu.nativeElement]:[],this._anchor?[this._anchor.nativeElement]:[],".dropdown-item,.dropdown-divider")}close(){this._open&&(this._open=!1,this._resetContainer(),this._positioning.destroy(),this._zoneSubscription?.unsubscribe(),this._destroyCloseHandlers$.next(),this.openChange.emit(!1),this._changeDetector.markForCheck())}toggle(){this.isOpen()?this.close():this.open()}ngOnDestroy(){this.close()}onKeyDown(p){const T=p.which,R=this._getMenuElements();let W=-1,Te=null;const Ge=this._isEventFromToggle(p);if(!Ge&&R.length&&R.forEach((Xe,yt)=>{Xe.contains(p.target)&&(Te=Xe),Xe===this._document.activeElement&&(W=yt)}),T!==tt.Space&&T!==tt.Enter){if(T!==tt.Tab){if(Ge||Te){if(this.open(),R.length){switch(T){case tt.ArrowDown:W=Math.min(W+1,R.length-1);break;case tt.ArrowUp:if(this._isDropup()&&-1===W){W=R.length-1;break}W=Math.max(W-1,0);break;case tt.Home:W=0;break;case tt.End:W=R.length-1}R[W].focus()}p.preventDefault()}}else if(p.target&&this.isOpen()&&this.autoClose){if(this._anchor.nativeElement===p.target)return void("body"!==this.container||p.shiftKey?p.shiftKey&&this.close():(this._renderer.setAttribute(this._menu.nativeElement,"tabindex","0"),this._menu.nativeElement.focus(),this._renderer.removeAttribute(this._menu.nativeElement,"tabindex")));if("body"===this.container){const Xe=this._menu.nativeElement.querySelectorAll(fn);p.shiftKey&&p.target===Xe[0]?(this._anchor.nativeElement.focus(),p.preventDefault()):!p.shiftKey&&p.target===Xe[Xe.length-1]&&(this._anchor.nativeElement.focus(),this.close())}else Xt(p.target,"focusout").pipe((0,Hi.q)(1)).subscribe(({relatedTarget:Xe})=>{this._elementRef.nativeElement.contains(Xe)||this.close()})}}else Te&&(!0===this.autoClose||"inside"===this.autoClose)&&Xt(Te,"click").pipe((0,Hi.q)(1)).subscribe(()=>this.close())}_isDropup(){return this._elementRef.nativeElement.classList.contains("dropup")}_isEventFromToggle(p){return this._anchor.nativeElement.contains(p.target)}_getMenuElements(){const p=this._menu;return null==p?[]:p.menuItems.filter(T=>!T.disabled).map(T=>T.elementRef.nativeElement)}_positionMenu(){const p=this._menu;this.isOpen()&&p&&("dynamic"===this.display?(this._positioning.update(),this._applyPlacementClasses()):this._applyPlacementClasses(this._getFirstPlacement(this.placement)))}_getFirstPlacement(p){return Array.isArray(p)?p[0]:p.split(" ")[0]}_resetContainer(){const p=this._renderer;this._menu&&p.appendChild(this._elementRef.nativeElement,this._menu.nativeElement),this._bodyContainer&&(p.removeChild(this._document.body,this._bodyContainer),this._bodyContainer=null)}_applyContainer(p=null){if(this._resetContainer(),"body"===p){const T=this._renderer,R=this._menu.nativeElement,W=this._bodyContainer=this._bodyContainer||T.createElement("div");T.setStyle(W,"position","absolute"),T.setStyle(R,"position","static"),T.setStyle(W,"z-index","1055"),T.appendChild(W,R),T.appendChild(this._document.body,W)}this._applyCustomDropdownClass(this.dropdownClass)}_applyCustomDropdownClass(p,T){const R="body"===this.container?this._bodyContainer:this._elementRef.nativeElement;R&&(T&&this._renderer.removeClass(R,T),p&&this._renderer.addClass(R,p))}_applyPlacementClasses(p){const T=this._menu;if(T){p||(p=this._getFirstPlacement(this.placement));const R=this._renderer,W=this._elementRef.nativeElement;R.removeClass(W,"dropup"),R.removeClass(W,"dropdown");const{nativeElement:Te}=T;"static"===this.display?(T.placement=null,R.setAttribute(Te,"data-bs-popper","static")):(T.placement=p,R.removeAttribute(Te,"data-bs-popper"));const Ge=-1!==p.search("^top")?"dropup":"dropdown";R.addClass(W,Ge);const Xe=this._bodyContainer;Xe&&(R.removeClass(Xe,"dropup"),R.removeClass(Xe,"dropdown"),R.addClass(Xe,Ge))}}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.sBO),_.Y36(cs),_.Y36(Q.K0),_.Y36(_.R0b),_.Y36(_.SBq),_.Y36(_.Qsj),_.Y36(dh,8))},y.\u0275dir=_.lG2({type:y,selectors:[["","ngbDropdown",""]],contentQueries:function(p,T,R){if(1&p&&(_.Suo(R,Sd,5),_.Suo(R,Ml,5)),2&p){let W;_.iGM(W=_.CRH())&&(T._menu=W.first),_.iGM(W=_.CRH())&&(T._anchor=W.first)}},hostVars:2,hostBindings:function(p,T){2&p&&_.ekj("show",T.isOpen())},inputs:{autoClose:"autoClose",dropdownClass:"dropdownClass",_open:["open","_open"],placement:"placement",container:"container",display:"display"},outputs:{openChange:"openChange"},exportAs:["ngbDropdown"],features:[_.TTD]}),y})(),Gh=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({}),y})();class rc{constructor(C,p,T){this.nodes=C,this.viewRef=p,this.componentRef=T}}let qp=(()=>{class y{constructor(p,T){this._el=p,this._zone=T}ngOnInit(){this._zone.onStable.asObservable().pipe((0,Hi.q)(1)).subscribe(()=>{Hr(this._zone,this._el.nativeElement,(p,T)=>{T&&za(p),p.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return Hr(this._zone,this._el.nativeElement,({classList:p})=>p.remove("show"),{animation:this.animation,runningTransition:"stop"})}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.SBq),_.Y36(_.R0b))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(p,T){2&p&&(_.Tol("modal-backdrop"+(T.backdropClass?" "+T.backdropClass:"")),_.ekj("show",!T.animation)("fade",T.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},decls:0,vars:0,template:function(p,T){},encapsulation:2}),y})();class al{close(C){}dismiss(C){}}class oc{constructor(C,p,T,R){this._windowCmptRef=C,this._contentRef=p,this._backdropCmptRef=T,this._beforeDismiss=R,this._closed=new Vt.x,this._dismissed=new Vt.x,this._hidden=new Vt.x,C.instance.dismissEvent.subscribe(W=>{this.dismiss(W)}),this.result=new Promise((W,Te)=>{this._resolve=W,this._reject=Te}),this.result.then(null,()=>{})}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(vi(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(vi(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}close(C){this._windowCmptRef&&(this._closed.next(C),this._resolve(C),this._removeModalElements())}_dismiss(C){this._dismissed.next(C),this._reject(C),this._removeModalElements()}dismiss(C){if(this._windowCmptRef)if(this._beforeDismiss){const p=this._beforeDismiss();!function Ba(y){return y&&y.then}(p)?!1!==p&&this._dismiss(C):p.then(T=>{!1!==T&&this._dismiss(C)},()=>{})}else this._dismiss(C)}_removeModalElements(){const C=this._windowCmptRef.instance.hide(),p=this._backdropCmptRef?this._backdropCmptRef.instance.hide():(0,ze.of)(void 0);C.subscribe(()=>{const{nativeElement:T}=this._windowCmptRef.location;T.parentNode.removeChild(T),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),p.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:T}=this._backdropCmptRef.location;T.parentNode.removeChild(T),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),Ao(C,p).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var nu=(()=>{return(y=nu||(nu={}))[y.BACKDROP_CLICK=0]="BACKDROP_CLICK",y[y.ESC=1]="ESC",nu;var y})();let ed=(()=>{class y{constructor(p,T,R){this._document=p,this._elRef=T,this._zone=R,this._closed$=new Vt.x,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new _.vpe,this.shown=new Vt.x,this.hidden=new Vt.x}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":no(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(p){this.dismissEvent.emit(p)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe((0,Hi.q)(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:p}=this._elRef,T={animation:this.animation,runningTransition:"stop"},Te=Ao(Hr(this._zone,p,()=>p.classList.remove("show"),T),Hr(this._zone,this._dialogEl.nativeElement,()=>{},T));return Te.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),Te}_show(){const p={animation:this.animation,runningTransition:"continue"};Ao(Hr(this._zone,this._elRef.nativeElement,(W,Te)=>{Te&&za(W),W.classList.add("show")},p),Hr(this._zone,this._dialogEl.nativeElement,()=>{},p)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:p}=this._elRef;this._zone.runOutsideAngular(()=>{Xt(p,"keydown").pipe(vi(this._closed$),(0,cr.h)(R=>R.which===tt.Escape)).subscribe(R=>{this.keyboard?requestAnimationFrame(()=>{R.defaultPrevented||this._zone.run(()=>this.dismiss(nu.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let T=!1;Xt(this._dialogEl.nativeElement,"mousedown").pipe(vi(this._closed$),(0,zn.b)(()=>T=!1),(0,zi.w)(()=>Xt(p,"mouseup").pipe(vi(this._closed$),(0,Hi.q)(1))),(0,cr.h)(({target:R})=>p===R)).subscribe(()=>{T=!0}),Xt(p,"click").pipe(vi(this._closed$)).subscribe(({target:R})=>{p===R&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!T&&this._zone.run(()=>this.dismiss(nu.BACKDROP_CLICK))),T=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:p}=this._elRef;if(!p.contains(document.activeElement)){const T=p.querySelector("[ngbAutofocus]"),R=Fn(p)[0];(T||R||p).focus()}}_restoreFocus(){const p=this._document.body,T=this._elWithFocus;let R;R=T&&T.focus&&p.contains(T)?T:p,this._zone.runOutsideAngular(()=>{setTimeout(()=>R.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&Hr(this._zone,this._elRef.nativeElement,({classList:p})=>(p.add("modal-static"),()=>p.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(Q.K0),_.Y36(_.SBq),_.Y36(_.R0b))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-modal-window"]],viewQuery:function(p,T){if(1&p&&_.Gf(vl,7),2&p){let R;_.iGM(R=_.CRH())&&(T._dialogEl=R.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(p,T){2&p&&(_.uIk("aria-modal",!0)("aria-labelledby",T.ariaLabelledBy)("aria-describedby",T.ariaDescribedBy),_.Tol("modal d-block"+(T.windowClass?" "+T.windowClass:"")),_.ekj("fade",T.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},ngContentSelectors:As,decls:4,vars:2,consts:[["role","document"],["dialog",""],[1,"modal-content"]],template:function(p,T){1&p&&(_.F$t(),_.TgZ(0,"div",0,1)(2,"div",2),_.Hsn(3),_.qZA()()),2&p&&_.Tol("modal-dialog"+(T.size?" modal-"+T.size:"")+(T.centered?" modal-dialog-centered":"")+T.fullscreenClass+(T.scrollable?" modal-dialog-scrollable":"")+(T.modalDialogClass?" "+T.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2}),y})(),td=(()=>{class y{constructor(p){this._document=p}hide(){const p=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),T=this._document.body,R=T.style,{overflow:W,paddingRight:Te}=R;if(p>0){const Ge=parseFloat(window.getComputedStyle(T).paddingRight);R.paddingRight=`${Ge+p}px`}return R.overflow="hidden",()=>{p>0&&(R.paddingRight=Te),R.overflow=W}}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(Q.K0))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),iu=(()=>{class y{constructor(p,T,R,W,Te,Ge){this._applicationRef=p,this._injector=T,this._document=R,this._scrollBar=W,this._rendererFactory=Te,this._ngZone=Ge,this._activeWindowCmptHasChanged=new Vt.x,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._backdropAttributes=["animation","backdropClass"],this._modalRefs=[],this._windowAttributes=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],this._windowCmpts=[],this._activeInstances=new _.vpe,this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const Xe=this._windowCmpts[this._windowCmpts.length-1];$n(this._ngZone,Xe.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(Xe.location.nativeElement)}})}_restoreScrollBar(){const p=this._scrollBarRestoreFn;p&&(this._scrollBarRestoreFn=null,p())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(p,T,R){const W=R.container instanceof HTMLElement?R.container:ss(R.container)?this._document.querySelector(R.container):this._document.body,Te=this._rendererFactory.createRenderer(null,null);if(!W)throw new Error(`The specified modal container "${R.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const Ge=new al,Xe=this._getContentRef(R.injector||p,T,Ge,R);let yt=!1!==R.backdrop?this._attachBackdrop(W):void 0,bt=this._attachWindowComponent(W,Xe.nodes),Nn=new oc(bt,Xe,yt,R.beforeDismiss);return this._registerModalRef(Nn),this._registerWindowCmpt(bt),Nn.hidden.pipe((0,Hi.q)(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(Te.removeClass(this._document.body,"modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),Ge.close=pn=>{Nn.close(pn)},Ge.dismiss=pn=>{Nn.dismiss(pn)},this._applyWindowOptions(bt.instance,R),1===this._modalRefs.length&&Te.addClass(this._document.body,"modal-open"),yt&&yt.instance&&(this._applyBackdropOptions(yt.instance,R),yt.changeDetectorRef.detectChanges()),bt.changeDetectorRef.detectChanges(),Nn}get activeInstances(){return this._activeInstances}dismissAll(p){this._modalRefs.forEach(T=>T.dismiss(p))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(p){let T=(0,_.LMc)(qp,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(T.hostView),p.appendChild(T.location.nativeElement),T}_attachWindowComponent(p,T){let R=(0,_.LMc)(ed,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:T});return this._applicationRef.attachView(R.hostView),p.appendChild(R.location.nativeElement),R}_applyWindowOptions(p,T){this._windowAttributes.forEach(R=>{ss(T[R])&&(p[R]=T[R])})}_applyBackdropOptions(p,T){this._backdropAttributes.forEach(R=>{ss(T[R])&&(p[R]=T[R])})}_getContentRef(p,T,R,W){return T?T instanceof _.Rgc?this._createFromTemplateRef(T,R):no(T)?this._createFromString(T):this._createFromComponent(p,T,R,W):new rc([])}_createFromTemplateRef(p,T){const W=p.createEmbeddedView({$implicit:T,close(Te){T.close(Te)},dismiss(Te){T.dismiss(Te)}});return this._applicationRef.attachView(W),new rc([W.rootNodes],W)}_createFromString(p){const T=this._document.createTextNode(`${p}`);return new rc([[T]])}_createFromComponent(p,T,R,W){const Te=_.zs3.create({providers:[{provide:al,useValue:R}],parent:p}),Ge=(0,_.LMc)(T,{environmentInjector:this._applicationRef.injector,elementInjector:Te}),Xe=Ge.location.nativeElement;return W.scrollable&&Xe.classList.add("component-host-scrollable"),this._applicationRef.attachView(Ge.hostView),new rc([[Xe]],Ge.hostView,Ge)}_setAriaHidden(p){const T=p.parentElement;T&&p!==this._document.body&&(Array.from(T.children).forEach(R=>{R!==p&&"SCRIPT"!==R.nodeName&&(this._ariaHiddenValues.set(R,R.getAttribute("aria-hidden")),R.setAttribute("aria-hidden","true"))}),this._setAriaHidden(T))}_revertAriaHidden(){this._ariaHiddenValues.forEach((p,T)=>{p?T.setAttribute("aria-hidden",p):T.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(p){const T=()=>{const R=this._modalRefs.indexOf(p);R>-1&&(this._modalRefs.splice(R,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(p),this._activeInstances.emit(this._modalRefs),p.result.then(T,T)}_registerWindowCmpt(p){this._windowCmpts.push(p),this._activeWindowCmptHasChanged.next(),p.onDestroy(()=>{const T=this._windowCmpts.indexOf(p);T>-1&&(this._windowCmpts.splice(T,1),this._activeWindowCmptHasChanged.next())})}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(_.z2F),_.LFG(_.zs3),_.LFG(Q.K0),_.LFG(td),_.LFG(_.FYo),_.LFG(_.R0b))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),Hf=(()=>{class y{constructor(p){this._ngbConfig=p,this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(p){this._animation=p}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(Qi))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),fh=(()=>{class y{constructor(p,T,R){this._injector=p,this._modalStack=T,this._config=R}open(p,T={}){const R={...this._config,animation:this._config.animation,...T};return this._modalStack.open(this._injector,p,R)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(p){this._modalStack.dismissAll(p)}hasOpenModals(){return this._modalStack.hasOpenModals()}}return y.\u0275fac=function(p){return new(p||y)(_.LFG(_.zs3),_.LFG(iu),_.LFG(Hf))},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),Wf=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({providers:[fh]}),y})(),Xp=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Jp=(()=>{class y{constructor(){this.disabled=!1,this.boundaryLinks=!1,this.directionLinks=!0,this.ellipses=!0,this.maxSize=0,this.pageSize=10,this.rotate=!1}}return y.\u0275fac=function(p){return new(p||y)},y.\u0275prov=_.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),Ec=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationEllipsis",""]]}),y})(),ca=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationFirst",""]]}),y})(),ou=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationLast",""]]}),y})(),ua=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationNext",""]]}),y})(),mh=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationNumber",""]]}),y})(),id=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationPrevious",""]]}),y})(),Au=(()=>{class y{constructor(p){this.templateRef=p}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(_.Rgc))},y.\u0275dir=_.lG2({type:y,selectors:[["ng-template","ngbPaginationPages",""]]}),y})(),su=(()=>{class y{constructor(p){this.pageCount=0,this.pages=[],this.page=1,this.pageChange=new _.vpe(!0),this.disabled=p.disabled,this.boundaryLinks=p.boundaryLinks,this.directionLinks=p.directionLinks,this.ellipses=p.ellipses,this.maxSize=p.maxSize,this.pageSize=p.pageSize,this.rotate=p.rotate,this.size=p.size}hasPrevious(){return this.page>1}hasNext(){return this.page<this.pageCount}nextDisabled(){return!this.hasNext()||this.disabled}previousDisabled(){return!this.hasPrevious()||this.disabled}selectPage(p){this._updatePages(p)}ngOnChanges(p){this._updatePages(this.page)}isEllipsis(p){return-1===p}_applyEllipses(p,T){this.ellipses&&(p>0&&(p>2?this.pages.unshift(-1):2===p&&this.pages.unshift(2),this.pages.unshift(1)),T<this.pageCount&&(T<this.pageCount-2?this.pages.push(-1):T===this.pageCount-2&&this.pages.push(this.pageCount-1),this.pages.push(this.pageCount)))}_applyRotation(){let p=0,T=this.pageCount,R=Math.floor(this.maxSize/2);return this.page<=R?T=this.maxSize:this.pageCount-this.page<R?p=this.pageCount-this.maxSize:(p=this.page-R-1,T=this.page+(this.maxSize%2==0?R-1:R)),[p,T]}_applyPagination(){let T=(Math.ceil(this.page/this.maxSize)-1)*this.maxSize;return[T,T+this.maxSize]}_setPageInRange(p){const T=this.page;this.page=function qc(y,C,p=0){return Math.max(Math.min(y,C),p)}(p,this.pageCount,1),this.page!==T&&yo(this.collectionSize)&&this.pageChange.emit(this.page)}_updatePages(p){this.pageCount=Math.ceil(this.collectionSize/this.pageSize),yo(this.pageCount)||(this.pageCount=0),this.pages.length=0;for(let T=1;T<=this.pageCount;T++)this.pages.push(T);if(this._setPageInRange(p),this.maxSize>0&&this.pageCount>this.maxSize){let T=0,R=this.pageCount;[T,R]=this.rotate?this._applyRotation():this._applyPagination(),this.pages=this.pages.slice(T,R),this._applyEllipses(T,R)}}}return y.\u0275fac=function(p){return new(p||y)(_.Y36(Jp))},y.\u0275cmp=_.Xpm({type:y,selectors:[["ngb-pagination"]],contentQueries:function(p,T,R){if(1&p&&(_.Suo(R,Ec,5),_.Suo(R,ca,5),_.Suo(R,ou,5),_.Suo(R,ua,5),_.Suo(R,mh,5),_.Suo(R,id,5),_.Suo(R,Au,5)),2&p){let W;_.iGM(W=_.CRH())&&(T.tplEllipsis=W.first),_.iGM(W=_.CRH())&&(T.tplFirst=W.first),_.iGM(W=_.CRH())&&(T.tplLast=W.first),_.iGM(W=_.CRH())&&(T.tplNext=W.first),_.iGM(W=_.CRH())&&(T.tplNumber=W.first),_.iGM(W=_.CRH())&&(T.tplPrevious=W.first),_.iGM(W=_.CRH())&&(T.tplPages=W.first)}},hostAttrs:["role","navigation"],inputs:{disabled:"disabled",boundaryLinks:"boundaryLinks",directionLinks:"directionLinks",ellipses:"ellipses",rotate:"rotate",collectionSize:"collectionSize",maxSize:"maxSize",page:"page",pageSize:"pageSize",size:"size"},outputs:{pageChange:"pageChange"},features:[_.TTD],decls:20,vars:12,consts:function(){let C,p,T,R,W,Te,Ge,Xe;return C=$localize`:@@ngb.pagination.first:««`,p=$localize`:@@ngb.pagination.previous:«`,T=$localize`:@@ngb.pagination.next:»`,R=$localize`:@@ngb.pagination.last:»»`,W=$localize`:@@ngb.pagination.first-aria:First`,Te=$localize`:@@ngb.pagination.previous-aria:Previous`,Ge=$localize`:@@ngb.pagination.next-aria:Next`,Xe=$localize`:@@ngb.pagination.last-aria:Last`,[["first",""],["previous",""],["next",""],["last",""],["ellipsis",""],["defaultNumber",""],["defaultPages",""],["class","page-item",3,"disabled",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["aria-hidden","true"],C,p,T,R,["class","visually-hidden",4,"ngIf"],[1,"visually-hidden"],["class","page-item",3,"active","disabled",4,"ngFor","ngForOf"],[1,"page-item"],["class","page-link","tabindex","-1","aria-disabled","true",4,"ngIf"],["class","page-link","href","",3,"click",4,"ngIf"],["tabindex","-1","aria-disabled","true",1,"page-link"],["href","",1,"page-link",3,"click"],["aria-label",W,"href","",1,"page-link",3,"click"],["aria-label",Te,"href","",1,"page-link",3,"click"],["aria-label",Ge,"href","",1,"page-link",3,"click"],["aria-label",Xe,"href","",1,"page-link",3,"click"]]},template:function(p,T){if(1&p&&(_.YNc(0,ie,2,0,"ng-template",null,0,_.W1O),_.YNc(2,H,2,0,"ng-template",null,1,_.W1O),_.YNc(4,ce,2,0,"ng-template",null,2,_.W1O),_.YNc(6,He,2,0,"ng-template",null,3,_.W1O),_.YNc(8,Dt,1,0,"ng-template",null,4,_.W1O),_.YNc(10,Ln,2,2,"ng-template",null,5,_.W1O),_.YNc(12,Ds,1,1,"ng-template",null,6,_.W1O),_.TgZ(14,"ul"),_.YNc(15,os,3,9,"li",7),_.YNc(16,Bl,3,8,"li",7),_.YNc(17,pc,0,0,"ng-template",8),_.YNc(18,mc,3,9,"li",7),_.YNc(19,yu,3,9,"li",7),_.qZA()),2&p){const R=_.MAs(13);_.xp6(14),_.Tol("pagination"+(T.size?" pagination-"+T.size:"")),_.xp6(1),_.Q6J("ngIf",T.boundaryLinks),_.xp6(1),_.Q6J("ngIf",T.directionLinks),_.xp6(1),_.Q6J("ngTemplateOutlet",(null==T.tplPages?null:T.tplPages.templateRef)||R)("ngTemplateOutletContext",_.kEZ(8,aa,T.page,T.pages,T.disabled)),_.xp6(1),_.Q6J("ngIf",T.directionLinks),_.xp6(1),_.Q6J("ngIf",T.boundaryLinks)}},dependencies:[Q.sg,Q.O5,Q.tP],encapsulation:2,changeDetection:0}),y})(),Id=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Qh=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Fs=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),So=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),tf=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),ip=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Ls=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({}),y})();new _.OlP("live announcer delay",{providedIn:"root",factory:function Od(){return 100}});let Rd=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Q.ez]}),y})(),Ou=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({}),y})();const Sc=[io,Qc,ke,gi,Ca,Gh,Wf,Xp,Ou,Id,Qh,Fs,So,tf,ip,Ls,Rd];let sm=(()=>{class y{}return y.\u0275fac=function(p){return new(p||y)},y.\u0275mod=_.oAB({type:y}),y.\u0275inj=_.cJS({imports:[Sc,io,Qc,ke,gi,Ca,Gh,Wf,Xp,Ou,Id,Qh,Fs,So,tf,ip,Ls,Rd]}),y})()}},Yn=>{Yn(Yn.s=8012)}]);